{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/* eslint-disable max-len */\nimport { isNullOrUndefined, extend, removeClass } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\n\nvar Crud =\n/** @class */\nfunction () {\n  function Crud(parent) {\n    this.parent = parent;\n    this.crudObj = {\n      sourceEvent: null,\n      targetEvent: null,\n      isCrudAction: false\n    };\n  }\n\n  Crud.prototype.getQuery = function () {\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    return this.parent.dataModule.generateQuery(start, end);\n  };\n\n  Crud.prototype.getTable = function () {\n    if (this.parent.eventSettings.query) {\n      var query = this.parent.eventSettings.query.clone();\n      return query.fromTable;\n    }\n\n    return null;\n  };\n\n  Crud.prototype.refreshDataManager = function () {\n    var _this = this;\n\n    if (!this.parent.activeView) {\n      return;\n    }\n\n    var start = this.parent.activeView.startDate();\n    var end = this.parent.activeView.endDate();\n    var dataManager = this.parent.dataModule.getData(this.parent.dataModule.generateQuery(start, end));\n    dataManager.then(function (e) {\n      return _this.dataManagerSuccess(e);\n    }).catch(function (e) {\n      return _this.dataManagerFailure(e);\n    });\n  };\n\n  Crud.prototype.dataManagerSuccess = function (e) {\n    var _this = this;\n\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.trigger(events.dataBinding, e, function (args) {\n      var resultData = extend([], args.result, null, true);\n      _this.parent.eventsData = resultData.filter(function (data) {\n        return !data[_this.parent.eventFields.isBlock];\n      });\n      _this.parent.blockData = resultData.filter(function (data) {\n        return data[_this.parent.eventFields.isBlock];\n      });\n\n      _this.refreshProcessedData();\n\n      if (_this.parent.dragAndDropModule && _this.parent.dragAndDropModule.actionObj.action === 'drag') {\n        _this.parent.dragAndDropModule.navigationWrapper();\n      }\n\n      _this.parent.trigger(events.dataBound, null, function () {\n        _this.parent.hideSpinner();\n\n        if (_this.parent.isPrinting) {\n          _this.parent.notify(events.print, {});\n        }\n      });\n    });\n  };\n\n  Crud.prototype.dataManagerFailure = function (e) {\n    var _this = this;\n\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.trigger(events.actionFailure, {\n      error: e\n    }, function () {\n      return _this.parent.hideSpinner();\n    });\n  };\n\n  Crud.prototype.refreshProcessedData = function (isVirtualScrollAction) {\n    if (isVirtualScrollAction === void 0) {\n      isVirtualScrollAction = false;\n    }\n\n    if (this.parent.dragAndDropModule) {\n      this.parent.dragAndDropModule.actionObj.action = '';\n      removeClass([this.parent.element], 'e-event-action');\n    }\n\n    if (this.parent.activeViewOptions && this.parent.activeViewOptions.eventTemplate) {\n      var templateNames = ['eventTemplate'];\n\n      if (this.crudObj.isCrudAction && ['Agenda', 'MonthAgenda', 'Year', 'TimelineYear'].indexOf(this.parent.currentView) === -1) {\n        templateNames = [];\n\n        for (var i = 0, len = this.crudObj.sourceEvent.length; i < len; i++) {\n          templateNames.push('eventTemplate_' + this.crudObj.sourceEvent[i].groupIndex);\n\n          if (this.crudObj.targetEvent[i] && this.crudObj.sourceEvent[i].groupIndex !== this.crudObj.targetEvent[i].groupIndex) {\n            templateNames.push('eventTemplate_' + this.crudObj.targetEvent[i].groupIndex);\n          }\n        }\n      }\n\n      this.parent.resetTemplates(templateNames);\n    }\n\n    if (isVirtualScrollAction) {\n      this.parent.notify(events.dataReady, {\n        processedData: this.parent.eventsProcessed\n      });\n      return;\n    }\n\n    var eventsData = this.parent.eventsData || [];\n    var blockData = this.parent.blockData || [];\n    var data = eventsData.concat(blockData);\n    this.parent.notify(events.dataReady, {\n      processedData: this.parent.eventBase ? this.parent.eventBase.processData(data) : []\n    });\n  };\n\n  Crud.prototype.refreshData = function (args) {\n    var _this = this;\n\n    var actionArgs = {\n      requestType: args.requestType,\n      cancel: false,\n      data: args.data,\n      addedRecords: args.editParams.addedRecords,\n      changedRecords: args.editParams.changedRecords,\n      deletedRecords: args.editParams.deletedRecords\n    };\n\n    if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element) {\n      this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n    }\n\n    if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element) {\n      this.parent.resizeModule.actionObj.element.style.display = 'none';\n    }\n\n    if (this.parent.isSpecificResourceEvents()) {\n      if (args.requestType === 'eventCreated' || args.requestType === 'eventRemoved') {\n        this.crudObj.isCrudAction = true;\n        this.crudObj.sourceEvent = [];\n        var crudData = args.data instanceof Array ? args.data.length === 0 && args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : args.data : (typeof args.data === 'string' || typeof args.data === 'number') && args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : [args.data];\n\n        var _loop_1 = function (data) {\n          this_1.crudObj.isCrudAction = !(args.requestType === 'eventRemoved' && !isNullOrUndefined(data.parent));\n          var groupIndex = this_1.parent.eventBase.getGroupIndexFromEvent(data);\n\n          if (groupIndex > -1 && this_1.parent.crudModule.crudObj.sourceEvent.filter(function (tdData) {\n            return tdData.groupIndex === groupIndex;\n          }).length === 0 && this_1.crudObj.isCrudAction) {\n            this_1.crudObj.sourceEvent.push(this_1.parent.resourceBase.lastResourceLevel[groupIndex]);\n          }\n        };\n\n        var this_1 = this;\n\n        for (var _i = 0, crudData_1 = crudData; _i < crudData_1.length; _i++) {\n          var data = crudData_1[_i];\n\n          _loop_1(data);\n        }\n\n        this.crudObj.targetEvent = this.crudObj.sourceEvent;\n      }\n    }\n\n    if (this.parent.dataModule.dataManager.dataSource.offline) {\n      this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n        if (!offlineArgs.cancel) {\n          _this.refreshDataManager();\n        }\n      });\n    } else {\n      args.promise.then(function () {\n        if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n          return;\n        }\n\n        _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n          if (!onlineArgs.cancel) {\n            _this.refreshDataManager();\n          }\n        });\n      }).catch(function (e) {\n        if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n          return;\n        }\n\n        _this.parent.trigger(events.actionFailure, {\n          error: e\n        });\n      });\n    }\n  };\n\n  Crud.prototype.addEvent = function (eventData) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowAdding && !this.parent.activeViewOptions.readonly) {\n      if (!this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData);\n        return;\n      }\n\n      var addEvents = eventData instanceof Array ? eventData : [eventData];\n      var args = {\n        requestType: 'eventCreate',\n        cancel: false,\n        data: addEvents,\n        addedRecords: addEvents,\n        changedRecords: [],\n        deletedRecords: []\n      };\n      this.parent.trigger(events.actionBegin, args, function (addArgs) {\n        if (!addArgs.cancel) {\n          var fields = _this.parent.eventFields;\n          var editParams = {\n            addedRecords: [],\n            changedRecords: [],\n            deletedRecords: []\n          };\n          var promise = void 0;\n\n          if (addArgs.addedRecords instanceof Array) {\n            for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n              var event_1 = _a[_i];\n              event_1 = _this.parent.eventBase.updateEventDateTime(event_1);\n              var eventData_1 = extend({}, _this.parent.eventBase.processTimezone(event_1, true), null, true);\n              editParams.addedRecords.push(eventData_1);\n            }\n\n            promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n          } else {\n            var event_2 = _this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n\n            editParams.addedRecords.push(event_2);\n            promise = _this.parent.dataModule.dataManager.insert(event_2, _this.getTable(), _this.getQuery());\n          }\n\n          var crudArgs = {\n            requestType: 'eventCreated',\n            cancel: false,\n            data: addArgs.addedRecords,\n            promise: promise,\n            editParams: editParams\n          };\n\n          _this.refreshData(crudArgs);\n        }\n      });\n    }\n  };\n\n  Crud.prototype.saveEvent = function (eventData, action) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowEditing && !this.parent.activeViewOptions.readonly) {\n      if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n        this.parent.quickPopup.openValidationError('blockAlert', eventData);\n        return;\n      }\n\n      this.parent.currentAction = action;\n\n      if (action) {\n        switch (action) {\n          case 'Save':\n            this.processSave(eventData);\n            break;\n\n          case 'EditOccurrence':\n            this.processOccurrences(eventData, action);\n            break;\n\n          case 'EditFollowingEvents':\n            this.processFollowSeries(eventData, action);\n            break;\n\n          case 'EditSeries':\n            this.processEntireSeries(eventData, action);\n            break;\n        }\n      } else {\n        var updateEvents = eventData instanceof Array ? eventData : [eventData];\n        var args = {\n          requestType: 'eventChange',\n          cancel: false,\n          data: eventData,\n          addedRecords: [],\n          changedRecords: updateEvents,\n          deletedRecords: []\n        };\n        this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n          if (!saveArgs.cancel) {\n            var promise = void 0;\n            var fields = _this.parent.eventFields;\n            var editParams = {\n              addedRecords: [],\n              changedRecords: [],\n              deletedRecords: []\n            };\n\n            if (saveArgs.changedRecords instanceof Array) {\n              for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n                var event_3 = _a[_i];\n                event_3 = _this.parent.eventBase.updateEventDateTime(event_3);\n                var eventData_2 = extend({}, _this.parent.eventBase.processTimezone(event_3, true), null, true);\n                editParams.changedRecords.push(eventData_2);\n              }\n\n              promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n            } else {\n              var event_4 = _this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n\n              editParams.changedRecords.push(event_4);\n              promise = _this.parent.dataModule.dataManager.update(fields.id, event_4, _this.getTable(), _this.getQuery());\n            }\n\n            var crudArgs = {\n              requestType: 'eventChanged',\n              cancel: false,\n              data: saveArgs.changedRecords,\n              promise: promise,\n              editParams: editParams\n            };\n\n            _this.refreshData(crudArgs);\n          }\n        });\n      }\n    }\n  };\n\n  Crud.prototype.deleteEvent = function (eventData, action) {\n    var _this = this;\n\n    if (this.parent.eventSettings.allowDeleting && !this.parent.activeViewOptions.readonly) {\n      this.parent.currentAction = action;\n      var deleteEvents = [];\n\n      if (typeof eventData === 'string' || typeof eventData === 'number') {\n        deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n          return eventObj[_this.parent.eventFields.id] === eventData;\n        });\n      } else {\n        deleteEvents = eventData instanceof Array ? eventData : [eventData];\n      }\n\n      if (action) {\n        switch (action) {\n          case 'Delete':\n            this.processDelete(deleteEvents);\n            break;\n\n          case 'DeleteOccurrence':\n            this.processOccurrences(deleteEvents, action);\n            break;\n\n          case 'DeleteFollowingEvents':\n            this.processFollowSeries(deleteEvents, action);\n            break;\n\n          case 'DeleteSeries':\n            this.processEntireSeries(deleteEvents, action);\n            break;\n        }\n      } else {\n        var args = {\n          requestType: 'eventRemove',\n          cancel: false,\n          data: eventData,\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: deleteEvents\n        };\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n          if (!deleteArgs.cancel) {\n            var promise = void 0;\n            var fields = _this.parent.eventFields;\n            var editParams = {\n              addedRecords: [],\n              changedRecords: [],\n              deletedRecords: []\n            };\n\n            if (deleteArgs.deletedRecords.length > 1) {\n              editParams.deletedRecords = editParams.deletedRecords.concat(deleteArgs.deletedRecords);\n              promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n            } else {\n              editParams.deletedRecords.push(deleteArgs.deletedRecords[0]);\n              promise = _this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], _this.getTable(), _this.getQuery());\n            }\n\n            _this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n\n            var crudArgs = {\n              requestType: 'eventRemoved',\n              cancel: false,\n              data: deleteArgs.deletedRecords,\n              promise: promise,\n              editParams: editParams\n            };\n\n            _this.refreshData(crudArgs);\n          }\n        });\n      }\n    }\n  };\n\n  Crud.prototype.processOccurrences = function (eventData, action) {\n    var _this = this;\n\n    var occurrenceData = [];\n    var isDeletedRecords = false;\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n        var event_5 = eventData_3[_i];\n        occurrenceData.push({\n          occurrence: event_5,\n          parent: this.getParentEvent(event_5)\n        });\n      }\n    } else {\n      occurrenceData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n\n    var updateEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateEvents,\n      deletedRecords: []\n    };\n    args.data = occurrenceData;\n    this.parent.trigger(events.actionBegin, args, function (occurrenceArgs) {\n      if (!occurrenceArgs.cancel) {\n        var fields = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var occurrenceEvents = occurrenceData instanceof Array ? occurrenceData : [occurrenceData];\n\n        var _loop_2 = function (a, count) {\n          var childEvent = occurrenceArgs.changedRecords[a];\n          var parentEvent = occurrenceEvents[a].parent;\n          var parentException = parentEvent[fields.recurrenceException];\n          var editedData = void 0;\n          var exceptionDate = void 0;\n\n          switch (action) {\n            case 'EditOccurrence':\n              editedData = _this.parent.eventsProcessed.filter(function (event) {\n                return event.Guid === childEvent.Guid;\n              })[0];\n              exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n\n              if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = exceptionDate;\n                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                childEvent[fields.followingID] = null;\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              } else {\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              }\n\n              break;\n\n            case 'DeleteOccurrence':\n              if (!childEvent[fields.recurrenceException]) {\n                parentEvent[fields.recurrenceException] = _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              }\n\n              if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                editParams.deletedRecords.push(childEvent);\n                isDeletedRecords = true;\n              }\n\n              break;\n          }\n        };\n\n        for (var a = 0, count = occurrenceArgs.changedRecords.length; a < count; a++) {\n          _loop_2(a, count);\n        }\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(occurrenceArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: isDeletedRecords ? occurrenceArgs.deletedRecords : occurrenceArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processFollowSeries = function (eventData, action) {\n    var _this = this;\n\n    var followData = [];\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n        var event_6 = eventData_4[_i];\n        followData.push({\n          occurrence: event_6,\n          parent: this.getParentEvent(event_6)\n        });\n      }\n    } else {\n      followData = {\n        occurrence: eventData,\n        parent: this.getParentEvent(eventData)\n      };\n    }\n\n    var updateFollowEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateFollowEvents,\n      deletedRecords: []\n    };\n    args.data = followData;\n    this.parent.trigger(events.actionBegin, args, function (followArgs) {\n      if (!followArgs.cancel) {\n        var fields_1 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var followEvents = followData instanceof Array ? followData : [followData];\n\n        var _loop_3 = function (a, count) {\n          var childEvent = followArgs.changedRecords[a];\n          var parentEvent = followEvents[a].parent;\n\n          var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n\n          var isSpanned = void 0;\n\n          switch (action) {\n            case 'EditFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent);\n\n              isSpanned = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n              childEvent[fields_1.followingID] = isSpanned ? null : parentEvent[fields_1.id];\n              childEvent[fields_1.recurrenceID] = null;\n              editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n\n              if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                childEvent[fields_1.recurrenceException] = null;\n\n                if (followData_1.occurrence.length > 0) {\n                  var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n\n                  if (rule.indexOf('COUNT') === -1) {\n                    childEvent[fields_1.recurrenceRule] = rule;\n                  }\n                }\n\n                if (followData_1.follow.length > 0) {\n                  childEvent[fields_1.recurrenceRule] = followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                  editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.follow);\n                }\n\n                if (isSpanned) {\n                  followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                    return eventObj[fields_1.recurrenceID] === childEvent[fields_1.id];\n                  });\n                }\n\n                editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence);\n              }\n\n              break;\n\n            case 'DeleteFollowingEvents':\n              _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n              editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n              break;\n          }\n        };\n\n        for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n          _loop_3(a, count);\n        }\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_1.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(followArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: followArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processEntireSeries = function (eventData, action) {\n    var _this = this;\n\n    var seriesData = [];\n    var isDeletedRecords = false;\n\n    if (eventData instanceof Array) {\n      for (var _i = 0, eventData_5 = eventData; _i < eventData_5.length; _i++) {\n        var event_7 = eventData_5[_i];\n        seriesData.push(this.getParentEvent(event_7, true));\n      }\n    } else {\n      seriesData = this.getParentEvent(eventData, true);\n    }\n\n    var updateSeriesEvents = eventData instanceof Array ? eventData : [eventData];\n    var args = {\n      requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: updateSeriesEvents,\n      deletedRecords: []\n    };\n    args.data = seriesData;\n    this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n      if (!seriesArgs.cancel) {\n        var fields_2 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n        var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n\n        var _loop_4 = function (a, count) {\n          var childEvent = seriesArgs.changedRecords[a];\n          var parentEvent = seriesEvents[a];\n\n          var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n\n          var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n\n          switch (action) {\n            case 'EditSeries':\n              if (childEvent[fields_2.startTime] > parentEvent[fields_2.startTime] && childEvent[fields_2.recurrenceRule]) {\n                _this.processRecurrenceRule(parentEvent, childEvent);\n              }\n\n              childEvent[fields_2.id] = parentEvent[fields_2.id];\n              childEvent[fields_2.recurrenceID] = null;\n              childEvent[fields_2.followingID] = null;\n\n              if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                  return eventObj[fields_2.id] === childEvent[fields_2.id];\n                });\n\n                if (originalParent.length > 0) {\n                  childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                }\n              } else {\n                childEvent[fields_2.recurrenceException] = null;\n                editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents);\n              }\n\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n              _this.parent.uiStateValues.isIgnoreOccurrence = false;\n              break;\n\n            case 'DeleteSeries':\n              editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents.concat(parentEvent));\n              isDeletedRecords = true;\n              break;\n          }\n        };\n\n        for (var a = 0, count = seriesArgs.changedRecords.length; a < count; a++) {\n          _loop_4(a, count);\n        }\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_2.id, _this.getTable(), _this.getQuery());\n\n        _this.parent.eventBase.selectWorkCellByTime(seriesArgs.changedRecords);\n\n        var crudArgs = {\n          requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n          cancel: false,\n          data: isDeletedRecords ? seriesArgs.deletedRecords : seriesArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processDelete = function (eventData) {\n    var _this = this;\n\n    var deleteData = [];\n\n    for (var _i = 0, eventData_6 = eventData; _i < eventData_6.length; _i++) {\n      var eventObj = eventData_6[_i];\n\n      if (eventObj[this.parent.eventFields.recurrenceRule]) {\n        deleteData.push({\n          occurrence: eventObj,\n          parent: this.getParentEvent(eventObj)\n        });\n      } else {\n        deleteData.push(eventObj);\n      }\n    }\n\n    var args = {\n      requestType: 'eventRemove',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: [],\n      deletedRecords: eventData\n    };\n    args.data = deleteData;\n    this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n      if (!deleteArgs.cancel) {\n        var fields_3 = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n\n        var _loop_5 = function (a, count) {\n          var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[a][_this.parent.eventFields.recurrenceRule]);\n\n          if (!isDelete) {\n            var parentEvent_1 = deleteData[a].parent;\n            var isEdited = editParams.changedRecords.filter(function (obj) {\n              return obj[fields_3.id] === parentEvent_1[fields_3.id];\n            });\n            var editedDate = deleteArgs.deletedRecords[a][fields_3.startTime];\n\n            if (isEdited.length > 0) {\n              var editedData = isEdited[0];\n              editedData[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n            } else {\n              parentEvent_1[fields_3.recurrenceException] = _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n            }\n\n            if (isEdited.length === 0) {\n              editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n            }\n\n            isDelete = deleteArgs.deletedRecords[a][fields_3.id] !== parentEvent_1[fields_3.id];\n          }\n\n          if (isDelete) {\n            editParams.deletedRecords.push(deleteArgs.deletedRecords[a]);\n          }\n        };\n\n        for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n          _loop_5(a, count);\n        }\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_3.id, _this.getTable(), _this.getQuery());\n\n        var crudArgs = {\n          requestType: 'eventRemoved',\n          cancel: false,\n          data: deleteArgs.deletedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.processSave = function (data) {\n    var _this = this;\n\n    var eventData = data instanceof Array ? data : [data];\n    var editData = [];\n\n    for (var _i = 0, eventData_7 = eventData; _i < eventData_7.length; _i++) {\n      var eventObj = eventData_7[_i];\n\n      if (eventObj[this.parent.eventFields.recurrenceRule]) {\n        editData.push({\n          occurrence: eventObj,\n          parent: this.getParentEvent(eventObj)\n        });\n      } else {\n        editData.push(eventObj);\n      }\n    }\n\n    var args = {\n      requestType: 'eventChange',\n      cancel: false,\n      addedRecords: [],\n      changedRecords: eventData,\n      deletedRecords: []\n    };\n    args.data = editData;\n    this.parent.trigger(events.actionBegin, args, function (editArgs) {\n      if (!editArgs.cancel) {\n        var fields = _this.parent.eventFields;\n        var editParams = {\n          addedRecords: [],\n          changedRecords: [],\n          deletedRecords: []\n        };\n\n        for (var _i = 0, _a = editArgs.changedRecords; _i < _a.length; _i++) {\n          var record = _a[_i];\n\n          if (!isNullOrUndefined(record[fields.recurrenceRule]) && isNullOrUndefined(record[fields.recurrenceException])) {\n            var exceptionString = getRecurrenceStringFromDate(record[fields.startTime]);\n\n            var parentEle = _this.getParentEvent(record);\n\n            parentEle[fields.recurrenceException] = isNullOrUndefined(parentEle[fields.recurrenceException]) ? exceptionString : parentEle[fields.recurrenceException].concat(',' + exceptionString);\n            record[fields.id] = _this.parent.getEventMaxID();\n            record[fields.recurrenceException] = exceptionString;\n            editParams.addedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEle, true));\n          } else {\n            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n          }\n        }\n\n        var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n\n        var crudArgs = {\n          requestType: 'eventChanged',\n          cancel: false,\n          data: editArgs.changedRecords,\n          promise: promise,\n          editParams: editParams\n        };\n\n        _this.refreshData(crudArgs);\n      }\n    });\n  };\n\n  Crud.prototype.getParentEvent = function (event, isParent) {\n    if (isParent === void 0) {\n      isParent = false;\n    }\n\n    var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n\n    if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n      this.parent.eventBase.timezoneConvert(parentEvent);\n    }\n\n    return parentEvent;\n  };\n\n  Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n    var exDate = getRecurrenceStringFromDate(eventStartTime);\n\n    if (!isNullOrUndefined(exceptionDateList)) {\n      if (exceptionDateList.indexOf(exDate) === -1) {\n        exceptionDateList = !isNullOrUndefined(exceptionDateList) ? exceptionDateList + ',' + exDate : exDate;\n      }\n    } else {\n      exceptionDateList = exDate;\n    }\n\n    return exceptionDateList;\n  };\n\n  Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n    var fields = this.parent.eventFields;\n    var recurrenceRule = parentEvent[fields.recurrenceRule];\n    var endDate;\n\n    if (followEvent instanceof Date) {\n      endDate = new Date(+followEvent);\n    } else {\n      endDate = new Date(+followEvent[fields.startTime]);\n      var newRecurrenceRule = followEvent[fields.recurrenceRule];\n\n      if (newRecurrenceRule) {\n        var startDate = parentEvent[fields.startTime];\n        var ruleException = this.parent.currentAction === 'DeleteFollowingEvents' ? followEvent[fields.recurrenceException] : null;\n        var dateCollection = generate(startDate, newRecurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n        var untilDate = new Date(dateCollection.slice(-1)[0]);\n        untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n        endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n        followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(newRecurrenceRule, new Date(+untilDate), false);\n      }\n    }\n\n    parentEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n  };\n\n  Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n    var splitRule = recurrenceRule.split(';');\n    var updatedRule = '';\n\n    for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n      var rule = splitRule_1[_i];\n\n      if (rule !== '') {\n        var ruleKey = rule.split('=')[0];\n        var ruleValue = rule.split('=')[1];\n\n        if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n          ruleValue = getRecurrenceStringFromDate(untilDate);\n          rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n        }\n\n        updatedRule += rule + ';';\n      }\n    }\n\n    if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n      updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n    }\n\n    return updatedRule;\n  };\n\n  Crud.prototype.isBlockEvent = function (eventData) {\n    var eventCollection = eventData instanceof Array ? eventData : [eventData];\n    var value = false;\n\n    for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n      var event_8 = eventCollection_1[_i];\n      value = event_8[this.parent.eventFields.isBlock] || false;\n    }\n\n    return value;\n  };\n  /**\n   * To destroy the crud module.\n   *\n   * @returns {void}\n   * @private\n   */\n\n\n  Crud.prototype.destroy = function () {\n    this.crudObj = null;\n    this.parent = null;\n  };\n\n  return Crud;\n}();\n\nexport { Crud };","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/@syncfusion/ej2-schedule/src/schedule/actions/crud.js"],"names":["isNullOrUndefined","extend","removeClass","getRecurrenceStringFromDate","generate","events","util","Crud","parent","crudObj","sourceEvent","targetEvent","isCrudAction","prototype","getQuery","start","activeView","startDate","end","endDate","dataModule","generateQuery","getTable","eventSettings","query","clone","fromTable","refreshDataManager","_this","dataManager","getData","then","e","dataManagerSuccess","catch","dataManagerFailure","isDestroyed","trigger","dataBinding","args","resultData","result","eventsData","filter","data","eventFields","isBlock","blockData","refreshProcessedData","dragAndDropModule","actionObj","action","navigationWrapper","dataBound","hideSpinner","isPrinting","notify","print","actionFailure","error","isVirtualScrollAction","element","activeViewOptions","eventTemplate","templateNames","indexOf","currentView","i","len","length","push","groupIndex","resetTemplates","dataReady","processedData","eventsProcessed","concat","eventBase","processData","refreshData","actionArgs","requestType","cancel","addedRecords","editParams","changedRecords","deletedRecords","style","display","resizeModule","isSpecificResourceEvents","crudData","Array","_loop_1","this_1","getGroupIndexFromEvent","crudModule","tdData","resourceBase","lastResourceLevel","_i","crudData_1","dataSource","offline","actionComplete","offlineArgs","promise","onlineArgs","addEvent","eventData","allowAdding","readonly","isBlockEvent","isBlockRange","quickPopup","openValidationError","addEvents","actionBegin","addArgs","fields","_a","event_1","updateEventDateTime","eventData_1","processTimezone","saveChanges","id","event_2","insert","crudArgs","saveEvent","allowEditing","currentAction","processSave","processOccurrences","processFollowSeries","processEntireSeries","updateEvents","saveArgs","event_3","eventData_2","event_4","update","deleteEvent","allowDeleting","deleteEvents","eventObj","processDelete","deleteArgs","remove","selectWorkCellByTime","occurrenceData","isDeletedRecords","eventData_3","event_5","occurrence","getParentEvent","occurrenceArgs","occurrenceEvents","_loop_2","a","count","childEvent","parentEvent","parentException","recurrenceException","editedData","exceptionDate","event","Guid","excludeDateCheck","startTime","recurrenceID","followingID","followData","eventData_4","event_6","updateFollowEvents","followArgs","fields_1","followEvents","_loop_3","followData_1","getEventCollections","isSpanned","processRecurrenceRule","isFollowingEvent","uiStateValues","isIgnoreOccurrence","rule","slice","recurrenceRule","follow","seriesData","eventData_5","event_7","updateSeriesEvents","seriesArgs","fields_2","seriesEvents","_loop_4","eventCollections","deletedEvents","originalParent","deleteData","eventData_6","fields_3","_loop_5","isDelete","parentEvent_1","isEdited","obj","editedDate","editData","eventData_7","editArgs","record","exceptionString","parentEle","getEventMaxID","isParent","startTimezone","endTimezone","timezoneConvert","eventStartTime","exceptionDateList","exDate","followEvent","Date","newRecurrenceRule","ruleException","dateCollection","firstDayOfWeek","untilDate","setHours","getHours","getMinutes","getSeconds","getUpdatedRecurrenceRule","addDays","getTime","splitRule","split","updatedRule","splitRule_1","ruleKey","ruleValue","replace","eventCollection","value","eventCollection_1","event_8","destroy"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable max-len */\nimport { isNullOrUndefined, extend, removeClass } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate, generate } from '../../recurrence-editor/date-generator';\nimport * as events from '../base/constant';\nimport * as util from '../base/util';\n/**\n * Schedule CRUD operations\n */\nvar Crud = /** @class */ (function () {\n    function Crud(parent) {\n        this.parent = parent;\n        this.crudObj = { sourceEvent: null, targetEvent: null, isCrudAction: false };\n    }\n    Crud.prototype.getQuery = function () {\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        return this.parent.dataModule.generateQuery(start, end);\n    };\n    Crud.prototype.getTable = function () {\n        if (this.parent.eventSettings.query) {\n            var query = this.parent.eventSettings.query.clone();\n            return query.fromTable;\n        }\n        return null;\n    };\n    Crud.prototype.refreshDataManager = function () {\n        var _this = this;\n        if (!this.parent.activeView) {\n            return;\n        }\n        var start = this.parent.activeView.startDate();\n        var end = this.parent.activeView.endDate();\n        var dataManager = this.parent.dataModule.getData(this.parent.dataModule.generateQuery(start, end));\n        dataManager.then(function (e) { return _this.dataManagerSuccess(e); }).catch(function (e) { return _this.dataManagerFailure(e); });\n    };\n    Crud.prototype.dataManagerSuccess = function (e) {\n        var _this = this;\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.trigger(events.dataBinding, e, function (args) {\n            var resultData = extend([], args.result, null, true);\n            _this.parent.eventsData = resultData.filter(function (data) { return !data[_this.parent.eventFields.isBlock]; });\n            _this.parent.blockData = resultData.filter(function (data) { return data[_this.parent.eventFields.isBlock]; });\n            _this.refreshProcessedData();\n            if (_this.parent.dragAndDropModule && _this.parent.dragAndDropModule.actionObj.action === 'drag') {\n                _this.parent.dragAndDropModule.navigationWrapper();\n            }\n            _this.parent.trigger(events.dataBound, null, function () {\n                _this.parent.hideSpinner();\n                if (_this.parent.isPrinting) {\n                    _this.parent.notify(events.print, {});\n                }\n            });\n        });\n    };\n    Crud.prototype.dataManagerFailure = function (e) {\n        var _this = this;\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.trigger(events.actionFailure, { error: e }, function () { return _this.parent.hideSpinner(); });\n    };\n    Crud.prototype.refreshProcessedData = function (isVirtualScrollAction) {\n        if (isVirtualScrollAction === void 0) { isVirtualScrollAction = false; }\n        if (this.parent.dragAndDropModule) {\n            this.parent.dragAndDropModule.actionObj.action = '';\n            removeClass([this.parent.element], 'e-event-action');\n        }\n        if (this.parent.activeViewOptions && this.parent.activeViewOptions.eventTemplate) {\n            var templateNames = ['eventTemplate'];\n            if (this.crudObj.isCrudAction &&\n                ['Agenda', 'MonthAgenda', 'Year', 'TimelineYear'].indexOf(this.parent.currentView) === -1) {\n                templateNames = [];\n                for (var i = 0, len = this.crudObj.sourceEvent.length; i < len; i++) {\n                    templateNames.push('eventTemplate_' + this.crudObj.sourceEvent[i].groupIndex);\n                    if (this.crudObj.targetEvent[i] && this.crudObj.sourceEvent[i].groupIndex !==\n                        this.crudObj.targetEvent[i].groupIndex) {\n                        templateNames.push('eventTemplate_' + this.crudObj.targetEvent[i].groupIndex);\n                    }\n                }\n            }\n            this.parent.resetTemplates(templateNames);\n        }\n        if (isVirtualScrollAction) {\n            this.parent.notify(events.dataReady, { processedData: this.parent.eventsProcessed });\n            return;\n        }\n        var eventsData = this.parent.eventsData || [];\n        var blockData = this.parent.blockData || [];\n        var data = eventsData.concat(blockData);\n        this.parent.notify(events.dataReady, { processedData: this.parent.eventBase ? this.parent.eventBase.processData(data) : [] });\n    };\n    Crud.prototype.refreshData = function (args) {\n        var _this = this;\n        var actionArgs = {\n            requestType: args.requestType, cancel: false, data: args.data,\n            addedRecords: args.editParams.addedRecords, changedRecords: args.editParams.changedRecords,\n            deletedRecords: args.editParams.deletedRecords\n        };\n        if (this.parent.dragAndDropModule && this.parent.dragAndDropModule.actionObj && this.parent.dragAndDropModule.actionObj.element) {\n            this.parent.dragAndDropModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.resizeModule && this.parent.resizeModule.actionObj && this.parent.resizeModule.actionObj.element) {\n            this.parent.resizeModule.actionObj.element.style.display = 'none';\n        }\n        if (this.parent.isSpecificResourceEvents()) {\n            if (args.requestType === 'eventCreated' || args.requestType === 'eventRemoved') {\n                this.crudObj.isCrudAction = true;\n                this.crudObj.sourceEvent = [];\n                var crudData = args.data instanceof Array ? (args.data.length === 0 &&\n                    args.requestType === 'eventRemoved' ? args.editParams.deletedRecords : args.data) :\n                    ((typeof args.data === 'string' || typeof args.data === 'number') && args.requestType === 'eventRemoved') ?\n                        args.editParams.deletedRecords : [args.data];\n                var _loop_1 = function (data) {\n                    this_1.crudObj.isCrudAction = !(args.requestType === 'eventRemoved' && !isNullOrUndefined(data.parent));\n                    var groupIndex = this_1.parent.eventBase.getGroupIndexFromEvent(data);\n                    if (groupIndex > -1 && this_1.parent.crudModule.crudObj.sourceEvent.filter(function (tdData) { return tdData.groupIndex === groupIndex; }).length === 0\n                        && this_1.crudObj.isCrudAction) {\n                        this_1.crudObj.sourceEvent.push(this_1.parent.resourceBase.lastResourceLevel[groupIndex]);\n                    }\n                };\n                var this_1 = this;\n                for (var _i = 0, crudData_1 = crudData; _i < crudData_1.length; _i++) {\n                    var data = crudData_1[_i];\n                    _loop_1(data);\n                }\n                this.crudObj.targetEvent = this.crudObj.sourceEvent;\n            }\n        }\n        if (this.parent.dataModule.dataManager.dataSource.offline) {\n            this.parent.trigger(events.actionComplete, actionArgs, function (offlineArgs) {\n                if (!offlineArgs.cancel) {\n                    _this.refreshDataManager();\n                }\n            });\n        }\n        else {\n            args.promise.then(function () {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionComplete, actionArgs, function (onlineArgs) {\n                    if (!onlineArgs.cancel) {\n                        _this.refreshDataManager();\n                    }\n                });\n            }).catch(function (e) {\n                if (!_this.parent || _this.parent && _this.parent.isDestroyed) {\n                    return;\n                }\n                _this.parent.trigger(events.actionFailure, { error: e });\n            });\n        }\n    };\n    Crud.prototype.addEvent = function (eventData) {\n        var _this = this;\n        if (this.parent.eventSettings.allowAdding && !this.parent.activeViewOptions.readonly) {\n            if (!this.isBlockEvent(eventData) && this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', eventData);\n                return;\n            }\n            var addEvents = (eventData instanceof Array) ? eventData : [eventData];\n            var args = {\n                requestType: 'eventCreate', cancel: false, data: addEvents,\n                addedRecords: addEvents, changedRecords: [], deletedRecords: []\n            };\n            this.parent.trigger(events.actionBegin, args, function (addArgs) {\n                if (!addArgs.cancel) {\n                    var fields = _this.parent.eventFields;\n                    var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                    var promise = void 0;\n                    if (addArgs.addedRecords instanceof Array) {\n                        for (var _i = 0, _a = addArgs.addedRecords; _i < _a.length; _i++) {\n                            var event_1 = _a[_i];\n                            event_1 = _this.parent.eventBase.updateEventDateTime(event_1);\n                            var eventData_1 = extend({}, _this.parent.eventBase.processTimezone(event_1, true), null, true);\n                            editParams.addedRecords.push(eventData_1);\n                        }\n                        promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                    }\n                    else {\n                        var event_2 = _this.parent.eventBase.processTimezone(addArgs.addedRecords, true);\n                        editParams.addedRecords.push(event_2);\n                        promise = _this.parent.dataModule.dataManager.insert(event_2, _this.getTable(), _this.getQuery());\n                    }\n                    var crudArgs = {\n                        requestType: 'eventCreated', cancel: false, data: addArgs.addedRecords, promise: promise, editParams: editParams\n                    };\n                    _this.refreshData(crudArgs);\n                }\n            });\n        }\n    };\n    Crud.prototype.saveEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowEditing && !this.parent.activeViewOptions.readonly) {\n            if (this.parent.currentAction !== 'EditFollowingEvents' && !this.isBlockEvent(eventData)\n                && this.parent.eventBase.isBlockRange(eventData)) {\n                this.parent.quickPopup.openValidationError('blockAlert', eventData);\n                return;\n            }\n            this.parent.currentAction = action;\n            if (action) {\n                switch (action) {\n                    case 'Save':\n                        this.processSave(eventData);\n                        break;\n                    case 'EditOccurrence':\n                        this.processOccurrences(eventData, action);\n                        break;\n                    case 'EditFollowingEvents':\n                        this.processFollowSeries(eventData, action);\n                        break;\n                    case 'EditSeries':\n                        this.processEntireSeries(eventData, action);\n                        break;\n                }\n            }\n            else {\n                var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n                var args = {\n                    requestType: 'eventChange', cancel: false, data: eventData,\n                    addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n                };\n                this.parent.trigger(events.actionBegin, args, function (saveArgs) {\n                    if (!saveArgs.cancel) {\n                        var promise = void 0;\n                        var fields = _this.parent.eventFields;\n                        var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                        if (saveArgs.changedRecords instanceof Array) {\n                            for (var _i = 0, _a = saveArgs.changedRecords; _i < _a.length; _i++) {\n                                var event_3 = _a[_i];\n                                event_3 = _this.parent.eventBase.updateEventDateTime(event_3);\n                                var eventData_2 = extend({}, _this.parent.eventBase.processTimezone(event_3, true), null, true);\n                                editParams.changedRecords.push(eventData_2);\n                            }\n                            promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                        }\n                        else {\n                            var event_4 = _this.parent.eventBase.processTimezone(saveArgs.changedRecords, true);\n                            editParams.changedRecords.push(event_4);\n                            promise = _this.parent.dataModule.dataManager.update(fields.id, event_4, _this.getTable(), _this.getQuery());\n                        }\n                        var crudArgs = {\n                            requestType: 'eventChanged', cancel: false,\n                            data: saveArgs.changedRecords, promise: promise, editParams: editParams\n                        };\n                        _this.refreshData(crudArgs);\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.deleteEvent = function (eventData, action) {\n        var _this = this;\n        if (this.parent.eventSettings.allowDeleting && !this.parent.activeViewOptions.readonly) {\n            this.parent.currentAction = action;\n            var deleteEvents = [];\n            if (typeof eventData === 'string' || typeof eventData === 'number') {\n                deleteEvents = this.parent.eventsData.filter(function (eventObj) {\n                    return eventObj[_this.parent.eventFields.id] === eventData;\n                });\n            }\n            else {\n                deleteEvents = (eventData instanceof Array ? eventData : [eventData]);\n            }\n            if (action) {\n                switch (action) {\n                    case 'Delete':\n                        this.processDelete(deleteEvents);\n                        break;\n                    case 'DeleteOccurrence':\n                        this.processOccurrences(deleteEvents, action);\n                        break;\n                    case 'DeleteFollowingEvents':\n                        this.processFollowSeries(deleteEvents, action);\n                        break;\n                    case 'DeleteSeries':\n                        this.processEntireSeries(deleteEvents, action);\n                        break;\n                }\n            }\n            else {\n                var args = {\n                    requestType: 'eventRemove', cancel: false, data: eventData,\n                    addedRecords: [], changedRecords: [], deletedRecords: deleteEvents\n                };\n                this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n                    if (!deleteArgs.cancel) {\n                        var promise = void 0;\n                        var fields = _this.parent.eventFields;\n                        var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                        if (deleteArgs.deletedRecords.length > 1) {\n                            editParams.deletedRecords = editParams.deletedRecords.concat(deleteArgs.deletedRecords);\n                            promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                        }\n                        else {\n                            editParams.deletedRecords.push(deleteArgs.deletedRecords[0]);\n                            promise = _this.parent.dataModule.dataManager.remove(fields.id, deleteArgs.deletedRecords[0], _this.getTable(), _this.getQuery());\n                        }\n                        _this.parent.eventBase.selectWorkCellByTime(deleteArgs.deletedRecords);\n                        var crudArgs = {\n                            requestType: 'eventRemoved', cancel: false,\n                            data: deleteArgs.deletedRecords, promise: promise, editParams: editParams\n                        };\n                        _this.refreshData(crudArgs);\n                    }\n                });\n            }\n        }\n    };\n    Crud.prototype.processOccurrences = function (eventData, action) {\n        var _this = this;\n        var occurrenceData = [];\n        var isDeletedRecords = false;\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_3 = eventData; _i < eventData_3.length; _i++) {\n                var event_5 = eventData_3[_i];\n                occurrenceData.push({ occurrence: event_5, parent: this.getParentEvent(event_5) });\n            }\n        }\n        else {\n            occurrenceData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditOccurrence' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateEvents, deletedRecords: []\n        };\n        args.data = occurrenceData;\n        this.parent.trigger(events.actionBegin, args, function (occurrenceArgs) {\n            if (!occurrenceArgs.cancel) {\n                var fields = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var occurrenceEvents = (occurrenceData instanceof Array ? occurrenceData : [occurrenceData]);\n                var _loop_2 = function (a, count) {\n                    var childEvent = occurrenceArgs.changedRecords[a];\n                    var parentEvent = occurrenceEvents[a].parent;\n                    var parentException = parentEvent[fields.recurrenceException];\n                    var editedData = void 0;\n                    var exceptionDate = void 0;\n                    switch (action) {\n                        case 'EditOccurrence':\n                            editedData = _this.parent.eventsProcessed.filter(function (event) { return event.Guid === childEvent.Guid; })[0];\n                            exceptionDate = _this.excludeDateCheck(editedData[fields.startTime], parentException);\n                            if (exceptionDate !== parentEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] = exceptionDate;\n                                childEvent[fields.recurrenceException] = getRecurrenceStringFromDate(editedData[fields.startTime]);\n                                childEvent[fields.recurrenceID] = parentEvent[fields.id];\n                                childEvent[fields.followingID] = null;\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                                editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            else {\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            }\n                            break;\n                        case 'DeleteOccurrence':\n                            if (!childEvent[fields.recurrenceException]) {\n                                parentEvent[fields.recurrenceException] =\n                                    _this.excludeDateCheck(childEvent[fields.startTime], parentException);\n                                editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            }\n                            if (childEvent[fields.id] !== parentEvent[fields.id]) {\n                                editParams.deletedRecords.push(childEvent);\n                                isDeletedRecords = true;\n                            }\n                            break;\n                    }\n                };\n                for (var a = 0, count = occurrenceArgs.changedRecords.length; a < count; a++) {\n                    _loop_2(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(occurrenceArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditOccurrence' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: isDeletedRecords ? occurrenceArgs.deletedRecords : occurrenceArgs.changedRecords,\n                    promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processFollowSeries = function (eventData, action) {\n        var _this = this;\n        var followData = [];\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_4 = eventData; _i < eventData_4.length; _i++) {\n                var event_6 = eventData_4[_i];\n                followData.push({ occurrence: event_6, parent: this.getParentEvent(event_6) });\n            }\n        }\n        else {\n            followData = { occurrence: eventData, parent: this.getParentEvent(eventData) };\n        }\n        var updateFollowEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditFollowingEvents' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateFollowEvents, deletedRecords: []\n        };\n        args.data = followData;\n        this.parent.trigger(events.actionBegin, args, function (followArgs) {\n            if (!followArgs.cancel) {\n                var fields_1 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var followEvents = followData instanceof Array ? followData : [followData];\n                var _loop_3 = function (a, count) {\n                    var childEvent = followArgs.changedRecords[a];\n                    var parentEvent = followEvents[a].parent;\n                    var followData_1 = _this.parent.eventBase.getEventCollections(parentEvent, childEvent);\n                    var isSpanned = void 0;\n                    switch (action) {\n                        case 'EditFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent);\n                            isSpanned = !_this.parent.eventBase.isFollowingEvent(parentEvent, childEvent);\n                            childEvent[fields_1.followingID] = isSpanned ? null : parentEvent[fields_1.id];\n                            childEvent[fields_1.recurrenceID] = null;\n                            editParams.addedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            if (!_this.parent.uiStateValues.isIgnoreOccurrence) {\n                                childEvent[fields_1.recurrenceException] = null;\n                                if (followData_1.occurrence.length > 0) {\n                                    var rule = followData_1.occurrence.slice(-1)[0][fields_1.recurrenceRule];\n                                    if (rule.indexOf('COUNT') === -1) {\n                                        childEvent[fields_1.recurrenceRule] = rule;\n                                    }\n                                }\n                                if (followData_1.follow.length > 0) {\n                                    childEvent[fields_1.recurrenceRule] = followData_1.follow.slice(-1)[0][fields_1.recurrenceRule];\n                                    editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.follow);\n                                }\n                                if (isSpanned) {\n                                    followData_1.occurrence = followData_1.occurrence.filter(function (eventObj) {\n                                        return eventObj[fields_1.recurrenceID] === childEvent[fields_1.id];\n                                    });\n                                }\n                                editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence);\n                            }\n                            break;\n                        case 'DeleteFollowingEvents':\n                            _this.processRecurrenceRule(parentEvent, childEvent[fields_1.startTime]);\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent, true));\n                            editParams.deletedRecords = editParams.deletedRecords.concat(followData_1.occurrence).concat(followData_1.follow);\n                            break;\n                    }\n                };\n                for (var a = 0, count = followArgs.changedRecords.length; a < count; a++) {\n                    _loop_3(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_1.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(followArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditFollowingEvents' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: followArgs.changedRecords, promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processEntireSeries = function (eventData, action) {\n        var _this = this;\n        var seriesData = [];\n        var isDeletedRecords = false;\n        if (eventData instanceof Array) {\n            for (var _i = 0, eventData_5 = eventData; _i < eventData_5.length; _i++) {\n                var event_7 = eventData_5[_i];\n                seriesData.push(this.getParentEvent(event_7, true));\n            }\n        }\n        else {\n            seriesData = this.getParentEvent(eventData, true);\n        }\n        var updateSeriesEvents = (eventData instanceof Array) ? eventData : [eventData];\n        var args = {\n            requestType: action === 'EditSeries' ? 'eventChange' : 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: updateSeriesEvents, deletedRecords: []\n        };\n        args.data = seriesData;\n        this.parent.trigger(events.actionBegin, args, function (seriesArgs) {\n            if (!seriesArgs.cancel) {\n                var fields_2 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var seriesEvents = seriesData instanceof Array ? seriesData : [seriesData];\n                var _loop_4 = function (a, count) {\n                    var childEvent = seriesArgs.changedRecords[a];\n                    var parentEvent = seriesEvents[a];\n                    var eventCollections = _this.parent.eventBase.getEventCollections(parentEvent);\n                    var deletedEvents = eventCollections.follow.concat(eventCollections.occurrence);\n                    switch (action) {\n                        case 'EditSeries':\n                            if ((childEvent[fields_2.startTime] > parentEvent[fields_2.startTime]) && childEvent[fields_2.recurrenceRule]) {\n                                _this.processRecurrenceRule(parentEvent, childEvent);\n                            }\n                            childEvent[fields_2.id] = parentEvent[fields_2.id];\n                            childEvent[fields_2.recurrenceID] = null;\n                            childEvent[fields_2.followingID] = null;\n                            if (_this.parent.uiStateValues.isIgnoreOccurrence && childEvent[fields_2.recurrenceException]) {\n                                var originalParent = _this.parent.eventsData.filter(function (eventObj) {\n                                    return eventObj[fields_2.id] === childEvent[fields_2.id];\n                                });\n                                if (originalParent.length > 0) {\n                                    childEvent[fields_2.recurrenceRule] = originalParent[0][fields_2.recurrenceRule];\n                                }\n                            }\n                            else {\n                                childEvent[fields_2.recurrenceException] = null;\n                                editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents);\n                            }\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(childEvent, true));\n                            _this.parent.uiStateValues.isIgnoreOccurrence = false;\n                            break;\n                        case 'DeleteSeries':\n                            editParams.deletedRecords = editParams.deletedRecords.concat(deletedEvents.concat(parentEvent));\n                            isDeletedRecords = true;\n                            break;\n                    }\n                };\n                for (var a = 0, count = seriesArgs.changedRecords.length; a < count; a++) {\n                    _loop_4(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_2.id, _this.getTable(), _this.getQuery());\n                _this.parent.eventBase.selectWorkCellByTime(seriesArgs.changedRecords);\n                var crudArgs = {\n                    requestType: action === 'EditSeries' ? 'eventChanged' : 'eventRemoved',\n                    cancel: false, data: isDeletedRecords ? seriesArgs.deletedRecords : seriesArgs.changedRecords,\n                    promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processDelete = function (eventData) {\n        var _this = this;\n        var deleteData = [];\n        for (var _i = 0, eventData_6 = eventData; _i < eventData_6.length; _i++) {\n            var eventObj = eventData_6[_i];\n            if (eventObj[this.parent.eventFields.recurrenceRule]) {\n                deleteData.push({ occurrence: eventObj, parent: this.getParentEvent(eventObj) });\n            }\n            else {\n                deleteData.push(eventObj);\n            }\n        }\n        var args = {\n            requestType: 'eventRemove', cancel: false,\n            addedRecords: [], changedRecords: [], deletedRecords: eventData\n        };\n        args.data = deleteData;\n        this.parent.trigger(events.actionBegin, args, function (deleteArgs) {\n            if (!deleteArgs.cancel) {\n                var fields_3 = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                var _loop_5 = function (a, count) {\n                    var isDelete = isNullOrUndefined(deleteArgs.deletedRecords[a][_this.parent.eventFields.recurrenceRule]);\n                    if (!isDelete) {\n                        var parentEvent_1 = deleteData[a].parent;\n                        var isEdited = editParams.changedRecords.filter(function (obj) {\n                            return obj[fields_3.id] === parentEvent_1[fields_3.id];\n                        });\n                        var editedDate = deleteArgs.deletedRecords[a][fields_3.startTime];\n                        if (isEdited.length > 0) {\n                            var editedData = isEdited[0];\n                            editedData[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, editedData[fields_3.recurrenceException]);\n                        }\n                        else {\n                            parentEvent_1[fields_3.recurrenceException] =\n                                _this.excludeDateCheck(editedDate, parentEvent_1[fields_3.recurrenceException]);\n                        }\n                        if (isEdited.length === 0) {\n                            editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEvent_1, true));\n                        }\n                        isDelete = deleteArgs.deletedRecords[a][fields_3.id] !== parentEvent_1[fields_3.id];\n                    }\n                    if (isDelete) {\n                        editParams.deletedRecords.push(deleteArgs.deletedRecords[a]);\n                    }\n                };\n                for (var a = 0, count = deleteArgs.deletedRecords.length; a < count; a++) {\n                    _loop_5(a, count);\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields_3.id, _this.getTable(), _this.getQuery());\n                var crudArgs = {\n                    requestType: 'eventRemoved', cancel: false, data: deleteArgs.deletedRecords, promise: promise, editParams: editParams\n                };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.processSave = function (data) {\n        var _this = this;\n        var eventData = (data instanceof Array) ? data : [data];\n        var editData = [];\n        for (var _i = 0, eventData_7 = eventData; _i < eventData_7.length; _i++) {\n            var eventObj = eventData_7[_i];\n            if (eventObj[this.parent.eventFields.recurrenceRule]) {\n                editData.push({ occurrence: eventObj, parent: this.getParentEvent(eventObj) });\n            }\n            else {\n                editData.push(eventObj);\n            }\n        }\n        var args = { requestType: 'eventChange', cancel: false, addedRecords: [], changedRecords: eventData, deletedRecords: [] };\n        args.data = editData;\n        this.parent.trigger(events.actionBegin, args, function (editArgs) {\n            if (!editArgs.cancel) {\n                var fields = _this.parent.eventFields;\n                var editParams = { addedRecords: [], changedRecords: [], deletedRecords: [] };\n                for (var _i = 0, _a = editArgs.changedRecords; _i < _a.length; _i++) {\n                    var record = _a[_i];\n                    if (!isNullOrUndefined(record[fields.recurrenceRule]) && isNullOrUndefined(record[fields.recurrenceException])) {\n                        var exceptionString = getRecurrenceStringFromDate(record[fields.startTime]);\n                        var parentEle = _this.getParentEvent(record);\n                        parentEle[fields.recurrenceException] = isNullOrUndefined(parentEle[fields.recurrenceException]) ?\n                            exceptionString : parentEle[fields.recurrenceException].concat(',' + exceptionString);\n                        record[fields.id] = _this.parent.getEventMaxID();\n                        record[fields.recurrenceException] = exceptionString;\n                        editParams.addedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n                        editParams.changedRecords.push(_this.parent.eventBase.processTimezone(parentEle, true));\n                    }\n                    else {\n                        editParams.changedRecords.push(_this.parent.eventBase.processTimezone(record, true));\n                    }\n                }\n                var promise = _this.parent.dataModule.dataManager.saveChanges(editParams, fields.id, _this.getTable(), _this.getQuery());\n                var crudArgs = { requestType: 'eventChanged', cancel: false, data: editArgs.changedRecords, promise: promise, editParams: editParams };\n                _this.refreshData(crudArgs);\n            }\n        });\n    };\n    Crud.prototype.getParentEvent = function (event, isParent) {\n        if (isParent === void 0) { isParent = false; }\n        var parentEvent = this.parent.eventBase.getParentEvent(event, isParent) || event;\n        if (parentEvent[this.parent.eventFields.startTimezone] || parentEvent[this.parent.eventFields.endTimezone]) {\n            this.parent.eventBase.timezoneConvert(parentEvent);\n        }\n        return parentEvent;\n    };\n    Crud.prototype.excludeDateCheck = function (eventStartTime, exceptionDateList) {\n        var exDate = getRecurrenceStringFromDate(eventStartTime);\n        if (!isNullOrUndefined(exceptionDateList)) {\n            if (exceptionDateList.indexOf(exDate) === -1) {\n                exceptionDateList = !(isNullOrUndefined(exceptionDateList)) ? exceptionDateList + ',' + exDate : exDate;\n            }\n        }\n        else {\n            exceptionDateList = exDate;\n        }\n        return exceptionDateList;\n    };\n    Crud.prototype.processRecurrenceRule = function (parentEvent, followEvent) {\n        var fields = this.parent.eventFields;\n        var recurrenceRule = parentEvent[fields.recurrenceRule];\n        var endDate;\n        if (followEvent instanceof Date) {\n            endDate = new Date(+followEvent);\n        }\n        else {\n            endDate = new Date(+followEvent[fields.startTime]);\n            var newRecurrenceRule = followEvent[fields.recurrenceRule];\n            if (newRecurrenceRule) {\n                var startDate = parentEvent[fields.startTime];\n                var ruleException = (this.parent.currentAction === 'DeleteFollowingEvents') ? followEvent[fields.recurrenceException] : null;\n                var dateCollection = generate(startDate, newRecurrenceRule, ruleException, this.parent.activeViewOptions.firstDayOfWeek);\n                var untilDate = new Date(dateCollection.slice(-1)[0]);\n                untilDate.setHours(endDate.getHours(), endDate.getMinutes(), endDate.getSeconds());\n                endDate.setHours(startDate.getHours(), startDate.getMinutes(), startDate.getSeconds());\n                followEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(newRecurrenceRule, new Date(+untilDate), false);\n            }\n        }\n        parentEvent[fields.recurrenceRule] = this.getUpdatedRecurrenceRule(recurrenceRule, util.addDays(new Date(endDate.getTime()), -1), true);\n    };\n    Crud.prototype.getUpdatedRecurrenceRule = function (recurrenceRule, untilDate, isParent) {\n        var splitRule = recurrenceRule.split(';');\n        var updatedRule = '';\n        for (var _i = 0, splitRule_1 = splitRule; _i < splitRule_1.length; _i++) {\n            var rule = splitRule_1[_i];\n            if (rule !== '') {\n                var ruleKey = rule.split('=')[0];\n                var ruleValue = rule.split('=')[1];\n                if (ruleKey === 'COUNT' || ruleKey === 'UNTIL') {\n                    ruleValue = getRecurrenceStringFromDate(untilDate);\n                    rule = rule.replace(rule, 'UNTIL=' + ruleValue);\n                }\n                updatedRule += rule + ';';\n            }\n        }\n        if (isParent && updatedRule.indexOf('UNTIL') === -1) {\n            updatedRule += 'UNTIL=' + getRecurrenceStringFromDate(untilDate);\n        }\n        return updatedRule;\n    };\n    Crud.prototype.isBlockEvent = function (eventData) {\n        var eventCollection = (eventData instanceof Array) ? eventData : [eventData];\n        var value = false;\n        for (var _i = 0, eventCollection_1 = eventCollection; _i < eventCollection_1.length; _i++) {\n            var event_8 = eventCollection_1[_i];\n            value = event_8[this.parent.eventFields.isBlock] || false;\n        }\n        return value;\n    };\n    /**\n     * To destroy the crud module.\n     *\n     * @returns {void}\n     * @private\n     */\n    Crud.prototype.destroy = function () {\n        this.crudObj = null;\n        this.parent = null;\n    };\n    return Crud;\n}());\nexport { Crud };\n"]},"metadata":{},"sourceType":"module"}