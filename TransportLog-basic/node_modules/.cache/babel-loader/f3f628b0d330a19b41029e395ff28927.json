{"ast":null,"code":"/**\r\n * DevExtreme (esm/data/array_utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { isDefined, isEmptyObject, isObject, isPlainObject } from \"../core/utils/type\";\nimport config from \"../core/config\";\nimport Guid from \"../core/guid\";\nimport { extend } from \"../core/utils/extend\";\nimport { errors } from \"./errors\";\nimport { deepExtendArraySafe } from \"../core/utils/object\";\nimport { compileGetter } from \"../core/utils/data\";\nimport { keysEqual, rejectedPromise, trivialPromise } from \"./utils\";\n\nfunction hasKey(target, keyOrKeys) {\n  var key;\n  var keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\n\n  while (keys.length) {\n    key = keys.shift();\n\n    if (key in target) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction findItems(keyInfo, items, key, groupCount) {\n  var childItems;\n  var result;\n\n  if (groupCount) {\n    for (var i = 0; i < items.length; i++) {\n      childItems = items[i].items || items[i].collapsedItems || [];\n      result = findItems(keyInfo, childItems || [], key, groupCount - 1);\n\n      if (result) {\n        return result;\n      }\n    }\n  } else if (indexByKey(keyInfo, items, key) >= 0) {\n    return items;\n  }\n}\n\nfunction getItems(keyInfo, items, key, groupCount) {\n  if (groupCount) {\n    return findItems(keyInfo, items, key, groupCount) || [];\n  }\n\n  return items;\n}\n\nfunction generateDataByKeyMap(keyInfo, array) {\n  if (keyInfo.key() && (!array._dataByKeyMap || array._dataByKeyMapLength !== array.length)) {\n    var dataByKeyMap = {};\n    var arrayLength = array.length;\n\n    for (var i = 0; i < arrayLength; i++) {\n      dataByKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = array[i];\n    }\n\n    array._dataByKeyMap = dataByKeyMap;\n    array._dataByKeyMapLength = arrayLength;\n  }\n}\n\nfunction getCacheValue(array, key) {\n  if (array._dataByKeyMap) {\n    return array._dataByKeyMap[JSON.stringify(key)];\n  }\n}\n\nfunction getHasKeyCacheValue(array, key) {\n  if (array._dataByKeyMap) {\n    return array._dataByKeyMap[JSON.stringify(key)];\n  }\n\n  return true;\n}\n\nfunction setDataByKeyMapValue(array, key, data) {\n  if (array._dataByKeyMap) {\n    array._dataByKeyMap[JSON.stringify(key)] = data;\n    array._dataByKeyMapLength += data ? 1 : -1;\n  }\n}\n\nfunction cloneInstanceWithChangedPaths(instance, changes, clonedInstances) {\n  clonedInstances = clonedInstances || new WeakMap();\n  var result = instance ? Object.create(Object.getPrototypeOf(instance)) : {};\n\n  if (instance) {\n    clonedInstances.set(instance, result);\n  }\n\n  var instanceWithoutPrototype = _extends({}, instance);\n\n  deepExtendArraySafe(result, instanceWithoutPrototype, true, true);\n\n  for (var name in instanceWithoutPrototype) {\n    var value = instanceWithoutPrototype[name];\n    var change = null === changes || void 0 === changes ? void 0 : changes[name];\n\n    if (isObject(value) && !isPlainObject(value) && isObject(change) && !clonedInstances.has(value)) {\n      result[name] = cloneInstanceWithChangedPaths(value, change, clonedInstances);\n    }\n  }\n\n  for (var _name in result) {\n    var prop = result[_name];\n\n    if (isObject(prop) && clonedInstances.has(prop)) {\n      result[_name] = clonedInstances.get(prop);\n    }\n  }\n\n  return result;\n}\n\nfunction createObjectWithChanges(target, changes) {\n  var result = cloneInstanceWithChangedPaths(target, changes);\n  return deepExtendArraySafe(result, changes, true, true);\n}\n\nfunction applyBatch(_ref) {\n  var {\n    keyInfo: keyInfo,\n    data: data,\n    changes: changes,\n    groupCount: groupCount,\n    useInsertIndex: useInsertIndex,\n    immutable: immutable,\n    disableCache: disableCache,\n    logError: logError\n  } = _ref;\n  var resultItems = true === immutable ? [...data] : data;\n  changes.forEach(item => {\n    var items = \"insert\" === item.type ? resultItems : getItems(keyInfo, resultItems, item.key, groupCount);\n    !disableCache && generateDataByKeyMap(keyInfo, items);\n\n    switch (item.type) {\n      case \"update\":\n        update(keyInfo, items, item.key, item.data, true, immutable, logError);\n        break;\n\n      case \"insert\":\n        insert(keyInfo, items, item.data, useInsertIndex && isDefined(item.index) ? item.index : -1, true, logError);\n        break;\n\n      case \"remove\":\n        remove(keyInfo, items, item.key, true, logError);\n    }\n  });\n  return resultItems;\n}\n\nfunction getErrorResult(isBatch, logError, errorCode) {\n  return !isBatch ? rejectedPromise(errors.Error(errorCode)) : logError && errors.log(errorCode);\n}\n\nfunction applyChanges(data, changes) {\n  var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var {\n    keyExpr = \"id\",\n    immutable = true\n  } = options;\n  var keyGetter = compileGetter(keyExpr);\n  var keyInfo = {\n    key: () => keyExpr,\n    keyOf: obj => keyGetter(obj)\n  };\n  return applyBatch({\n    keyInfo: keyInfo,\n    data: data,\n    changes: changes,\n    immutable: immutable,\n    disableCache: true,\n    logError: true\n  });\n}\n\nfunction update(keyInfo, array, key, data, isBatch, immutable, logError) {\n  var target;\n  var keyExpr = keyInfo.key();\n\n  if (keyExpr) {\n    if (hasKey(data, keyExpr) && !keysEqual(keyExpr, key, keyInfo.keyOf(data))) {\n      return getErrorResult(isBatch, logError, \"E4017\");\n    }\n\n    target = getCacheValue(array, key);\n\n    if (!target) {\n      var index = indexByKey(keyInfo, array, key);\n\n      if (index < 0) {\n        return getErrorResult(isBatch, logError, \"E4009\");\n      }\n\n      target = array[index];\n\n      if (true === immutable && isDefined(target)) {\n        var newTarget = createObjectWithChanges(target, data);\n        array[index] = newTarget;\n        return !isBatch && trivialPromise(newTarget, key);\n      }\n    }\n  } else {\n    target = key;\n  }\n\n  deepExtendArraySafe(target, data, true);\n\n  if (!isBatch) {\n    if (config().useLegacyStoreResult) {\n      return trivialPromise(key, data);\n    } else {\n      return trivialPromise(target, key);\n    }\n  }\n}\n\nfunction insert(keyInfo, array, data, index, isBatch, logError) {\n  var keyValue;\n  var keyExpr = keyInfo.key();\n  var obj = isPlainObject(data) ? extend({}, data) : data;\n\n  if (keyExpr) {\n    keyValue = keyInfo.keyOf(obj);\n\n    if (void 0 === keyValue || \"object\" === typeof keyValue && isEmptyObject(keyValue)) {\n      if (Array.isArray(keyExpr)) {\n        throw errors.Error(\"E4007\");\n      }\n\n      keyValue = obj[keyExpr] = String(new Guid());\n    } else if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\n      return getErrorResult(isBatch, logError, \"E4008\");\n    }\n  } else {\n    keyValue = obj;\n  }\n\n  if (index >= 0) {\n    array.splice(index, 0, obj);\n  } else {\n    array.push(obj);\n  }\n\n  setDataByKeyMapValue(array, keyValue, obj);\n\n  if (!isBatch) {\n    return trivialPromise(config().useLegacyStoreResult ? data : obj, keyValue);\n  }\n}\n\nfunction remove(keyInfo, array, key, isBatch, logError) {\n  var index = indexByKey(keyInfo, array, key);\n\n  if (index > -1) {\n    array.splice(index, 1);\n    setDataByKeyMapValue(array, key, null);\n  }\n\n  if (!isBatch) {\n    return trivialPromise(key);\n  } else if (index < 0) {\n    return getErrorResult(isBatch, logError, \"E4009\");\n  }\n}\n\nfunction indexByKey(keyInfo, array, key) {\n  var keyExpr = keyInfo.key();\n\n  if (!getHasKeyCacheValue(array, key)) {\n    return -1;\n  }\n\n  for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\n    if (keysEqual(keyExpr, keyInfo.keyOf(array[i]), key)) {\n      return i;\n    }\n  }\n\n  return -1;\n}\n\nexport { applyBatch, createObjectWithChanges, update, insert, remove, indexByKey, applyChanges };","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/data/array_utils.js"],"names":["_extends","isDefined","isEmptyObject","isObject","isPlainObject","config","Guid","extend","errors","deepExtendArraySafe","compileGetter","keysEqual","rejectedPromise","trivialPromise","hasKey","target","keyOrKeys","key","keys","split","slice","length","shift","findItems","keyInfo","items","groupCount","childItems","result","i","collapsedItems","indexByKey","getItems","generateDataByKeyMap","array","_dataByKeyMap","_dataByKeyMapLength","dataByKeyMap","arrayLength","JSON","stringify","keyOf","getCacheValue","getHasKeyCacheValue","setDataByKeyMapValue","data","cloneInstanceWithChangedPaths","instance","changes","clonedInstances","WeakMap","Object","create","getPrototypeOf","set","instanceWithoutPrototype","name","value","change","has","_name","prop","get","createObjectWithChanges","applyBatch","_ref","useInsertIndex","immutable","disableCache","logError","resultItems","forEach","item","type","update","insert","index","remove","getErrorResult","isBatch","errorCode","Error","log","applyChanges","options","arguments","keyExpr","keyGetter","obj","newTarget","useLegacyStoreResult","keyValue","Array","isArray","String","splice","push"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/data/array_utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport {\r\n    isDefined,\r\n    isEmptyObject,\r\n    isObject,\r\n    isPlainObject\r\n} from \"../core/utils/type\";\r\nimport config from \"../core/config\";\r\nimport Guid from \"../core/guid\";\r\nimport {\r\n    extend\r\n} from \"../core/utils/extend\";\r\nimport {\r\n    errors\r\n} from \"./errors\";\r\nimport {\r\n    deepExtendArraySafe\r\n} from \"../core/utils/object\";\r\nimport {\r\n    compileGetter\r\n} from \"../core/utils/data\";\r\nimport {\r\n    keysEqual,\r\n    rejectedPromise,\r\n    trivialPromise\r\n} from \"./utils\";\r\n\r\nfunction hasKey(target, keyOrKeys) {\r\n    var key;\r\n    var keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\r\n    while (keys.length) {\r\n        key = keys.shift();\r\n        if (key in target) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction findItems(keyInfo, items, key, groupCount) {\r\n    var childItems;\r\n    var result;\r\n    if (groupCount) {\r\n        for (var i = 0; i < items.length; i++) {\r\n            childItems = items[i].items || items[i].collapsedItems || [];\r\n            result = findItems(keyInfo, childItems || [], key, groupCount - 1);\r\n            if (result) {\r\n                return result\r\n            }\r\n        }\r\n    } else if (indexByKey(keyInfo, items, key) >= 0) {\r\n        return items\r\n    }\r\n}\r\n\r\nfunction getItems(keyInfo, items, key, groupCount) {\r\n    if (groupCount) {\r\n        return findItems(keyInfo, items, key, groupCount) || []\r\n    }\r\n    return items\r\n}\r\n\r\nfunction generateDataByKeyMap(keyInfo, array) {\r\n    if (keyInfo.key() && (!array._dataByKeyMap || array._dataByKeyMapLength !== array.length)) {\r\n        var dataByKeyMap = {};\r\n        var arrayLength = array.length;\r\n        for (var i = 0; i < arrayLength; i++) {\r\n            dataByKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = array[i]\r\n        }\r\n        array._dataByKeyMap = dataByKeyMap;\r\n        array._dataByKeyMapLength = arrayLength\r\n    }\r\n}\r\n\r\nfunction getCacheValue(array, key) {\r\n    if (array._dataByKeyMap) {\r\n        return array._dataByKeyMap[JSON.stringify(key)]\r\n    }\r\n}\r\n\r\nfunction getHasKeyCacheValue(array, key) {\r\n    if (array._dataByKeyMap) {\r\n        return array._dataByKeyMap[JSON.stringify(key)]\r\n    }\r\n    return true\r\n}\r\n\r\nfunction setDataByKeyMapValue(array, key, data) {\r\n    if (array._dataByKeyMap) {\r\n        array._dataByKeyMap[JSON.stringify(key)] = data;\r\n        array._dataByKeyMapLength += data ? 1 : -1\r\n    }\r\n}\r\n\r\nfunction cloneInstanceWithChangedPaths(instance, changes, clonedInstances) {\r\n    clonedInstances = clonedInstances || new WeakMap;\r\n    var result = instance ? Object.create(Object.getPrototypeOf(instance)) : {};\r\n    if (instance) {\r\n        clonedInstances.set(instance, result)\r\n    }\r\n    var instanceWithoutPrototype = _extends({}, instance);\r\n    deepExtendArraySafe(result, instanceWithoutPrototype, true, true);\r\n    for (var name in instanceWithoutPrototype) {\r\n        var value = instanceWithoutPrototype[name];\r\n        var change = null === changes || void 0 === changes ? void 0 : changes[name];\r\n        if (isObject(value) && !isPlainObject(value) && isObject(change) && !clonedInstances.has(value)) {\r\n            result[name] = cloneInstanceWithChangedPaths(value, change, clonedInstances)\r\n        }\r\n    }\r\n    for (var _name in result) {\r\n        var prop = result[_name];\r\n        if (isObject(prop) && clonedInstances.has(prop)) {\r\n            result[_name] = clonedInstances.get(prop)\r\n        }\r\n    }\r\n    return result\r\n}\r\n\r\nfunction createObjectWithChanges(target, changes) {\r\n    var result = cloneInstanceWithChangedPaths(target, changes);\r\n    return deepExtendArraySafe(result, changes, true, true)\r\n}\r\n\r\nfunction applyBatch(_ref) {\r\n    var {\r\n        keyInfo: keyInfo,\r\n        data: data,\r\n        changes: changes,\r\n        groupCount: groupCount,\r\n        useInsertIndex: useInsertIndex,\r\n        immutable: immutable,\r\n        disableCache: disableCache,\r\n        logError: logError\r\n    } = _ref;\r\n    var resultItems = true === immutable ? [...data] : data;\r\n    changes.forEach(item => {\r\n        var items = \"insert\" === item.type ? resultItems : getItems(keyInfo, resultItems, item.key, groupCount);\r\n        !disableCache && generateDataByKeyMap(keyInfo, items);\r\n        switch (item.type) {\r\n            case \"update\":\r\n                update(keyInfo, items, item.key, item.data, true, immutable, logError);\r\n                break;\r\n            case \"insert\":\r\n                insert(keyInfo, items, item.data, useInsertIndex && isDefined(item.index) ? item.index : -1, true, logError);\r\n                break;\r\n            case \"remove\":\r\n                remove(keyInfo, items, item.key, true, logError)\r\n        }\r\n    });\r\n    return resultItems\r\n}\r\n\r\nfunction getErrorResult(isBatch, logError, errorCode) {\r\n    return !isBatch ? rejectedPromise(errors.Error(errorCode)) : logError && errors.log(errorCode)\r\n}\r\n\r\nfunction applyChanges(data, changes) {\r\n    var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var {\r\n        keyExpr: keyExpr = \"id\",\r\n        immutable: immutable = true\r\n    } = options;\r\n    var keyGetter = compileGetter(keyExpr);\r\n    var keyInfo = {\r\n        key: () => keyExpr,\r\n        keyOf: obj => keyGetter(obj)\r\n    };\r\n    return applyBatch({\r\n        keyInfo: keyInfo,\r\n        data: data,\r\n        changes: changes,\r\n        immutable: immutable,\r\n        disableCache: true,\r\n        logError: true\r\n    })\r\n}\r\n\r\nfunction update(keyInfo, array, key, data, isBatch, immutable, logError) {\r\n    var target;\r\n    var keyExpr = keyInfo.key();\r\n    if (keyExpr) {\r\n        if (hasKey(data, keyExpr) && !keysEqual(keyExpr, key, keyInfo.keyOf(data))) {\r\n            return getErrorResult(isBatch, logError, \"E4017\")\r\n        }\r\n        target = getCacheValue(array, key);\r\n        if (!target) {\r\n            var index = indexByKey(keyInfo, array, key);\r\n            if (index < 0) {\r\n                return getErrorResult(isBatch, logError, \"E4009\")\r\n            }\r\n            target = array[index];\r\n            if (true === immutable && isDefined(target)) {\r\n                var newTarget = createObjectWithChanges(target, data);\r\n                array[index] = newTarget;\r\n                return !isBatch && trivialPromise(newTarget, key)\r\n            }\r\n        }\r\n    } else {\r\n        target = key\r\n    }\r\n    deepExtendArraySafe(target, data, true);\r\n    if (!isBatch) {\r\n        if (config().useLegacyStoreResult) {\r\n            return trivialPromise(key, data)\r\n        } else {\r\n            return trivialPromise(target, key)\r\n        }\r\n    }\r\n}\r\n\r\nfunction insert(keyInfo, array, data, index, isBatch, logError) {\r\n    var keyValue;\r\n    var keyExpr = keyInfo.key();\r\n    var obj = isPlainObject(data) ? extend({}, data) : data;\r\n    if (keyExpr) {\r\n        keyValue = keyInfo.keyOf(obj);\r\n        if (void 0 === keyValue || \"object\" === typeof keyValue && isEmptyObject(keyValue)) {\r\n            if (Array.isArray(keyExpr)) {\r\n                throw errors.Error(\"E4007\")\r\n            }\r\n            keyValue = obj[keyExpr] = String(new Guid)\r\n        } else if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\r\n            return getErrorResult(isBatch, logError, \"E4008\")\r\n        }\r\n    } else {\r\n        keyValue = obj\r\n    }\r\n    if (index >= 0) {\r\n        array.splice(index, 0, obj)\r\n    } else {\r\n        array.push(obj)\r\n    }\r\n    setDataByKeyMapValue(array, keyValue, obj);\r\n    if (!isBatch) {\r\n        return trivialPromise(config().useLegacyStoreResult ? data : obj, keyValue)\r\n    }\r\n}\r\n\r\nfunction remove(keyInfo, array, key, isBatch, logError) {\r\n    var index = indexByKey(keyInfo, array, key);\r\n    if (index > -1) {\r\n        array.splice(index, 1);\r\n        setDataByKeyMapValue(array, key, null)\r\n    }\r\n    if (!isBatch) {\r\n        return trivialPromise(key)\r\n    } else if (index < 0) {\r\n        return getErrorResult(isBatch, logError, \"E4009\")\r\n    }\r\n}\r\n\r\nfunction indexByKey(keyInfo, array, key) {\r\n    var keyExpr = keyInfo.key();\r\n    if (!getHasKeyCacheValue(array, key)) {\r\n        return -1\r\n    }\r\n    for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\r\n        if (keysEqual(keyExpr, keyInfo.keyOf(array[i]), key)) {\r\n            return i\r\n        }\r\n    }\r\n    return -1\r\n}\r\nexport {\r\n    applyBatch,\r\n    createObjectWithChanges,\r\n    update,\r\n    insert,\r\n    remove,\r\n    indexByKey,\r\n    applyChanges\r\n};\r\n"]},"metadata":{},"sourceType":"module"}