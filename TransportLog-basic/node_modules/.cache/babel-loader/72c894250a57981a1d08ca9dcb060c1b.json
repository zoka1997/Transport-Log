{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/appointmentPopup/form.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport $ from \"../../../core/renderer\";\nimport Form from \"../../form\";\nimport dateSerialization from \"../../../core/utils/date_serialization\";\nimport messageLocalization from \"../../../localization/message\";\nimport devices from \"../../../core/devices\";\nimport DataSource from \"../../../data/data_source\";\nimport timeZoneDataUtils from \"../timezones/utils.timezones_data\";\nimport { extend } from \"../../../core/utils/extend\";\nimport dateUtils from \"../../../core/utils/date\";\nimport { Semaphore } from \"../../../renovation/ui/scheduler/utils/semaphore/semaphore\";\nimport \"../recurrence_editor\";\nimport \"../../text_area\";\nimport \"../../tag_box\";\nimport \"../../switch\";\nimport \"../../select_box\";\nvar SCREEN_SIZE_OF_SINGLE_COLUMN = 600;\nexport var APPOINTMENT_FORM_GROUP_NAMES = {\n  Main: \"mainGroup\",\n  Recurrence: \"recurrenceGroup\"\n};\n\nvar getStartDateWithStartHour = (startDate, startDayHour) => new Date(new Date(startDate).setHours(startDayHour));\n\nvar validateAppointmentFormDate = (editor, value, previousValue) => {\n  var isCurrentDateCorrect = null === value || !!value;\n  var isPreviousDateCorrect = null === previousValue || !!previousValue;\n\n  if (!isCurrentDateCorrect && isPreviousDateCorrect) {\n    editor.option(\"value\", previousValue);\n  }\n};\n\nvar updateRecurrenceItemVisibility = (recurrenceRuleExpr, value, form) => {\n  var _form$getEditor;\n\n  form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"visible\", value);\n  !value && form.updateData(recurrenceRuleExpr, \"\");\n  null === (_form$getEditor = form.getEditor(recurrenceRuleExpr)) || void 0 === _form$getEditor ? void 0 : _form$getEditor.changeValueByVisibility(value);\n};\n\nvar createDateBoxEditor = (dataField, colSpan, firstDayOfWeek, label, onValueChanged) => ({\n  editorType: \"dxDateBox\",\n  dataField: dataField,\n  colSpan: colSpan,\n  label: {\n    text: messageLocalization.format(label)\n  },\n  validationRules: [{\n    type: \"required\"\n  }],\n  editorOptions: {\n    width: \"100%\",\n    calendarOptions: {\n      firstDayOfWeek: firstDayOfWeek\n    },\n    onValueChanged: onValueChanged,\n    useMaskBehavior: true\n  }\n});\n\nexport class AppointmentForm {\n  constructor(scheduler) {\n    this.scheduler = scheduler;\n    this.form = null;\n    this.semaphore = new Semaphore();\n  }\n\n  get dxForm() {\n    return this.form;\n  }\n\n  set readOnly(value) {\n    this.form.option(\"readOnly\", value);\n    var {\n      recurrenceRuleExpr: recurrenceRuleExpr\n    } = this.scheduler.getDataAccessors().expr;\n    var recurrenceEditor = this.form.getEditor(recurrenceRuleExpr);\n    null === recurrenceEditor || void 0 === recurrenceEditor ? void 0 : recurrenceEditor.option(\"readOnly\", value);\n  }\n\n  get formData() {\n    return this.form.option(\"formData\");\n  }\n\n  set formData(value) {\n    this.form.option(\"formData\", value);\n  }\n\n  create(triggerResize, changeSize, formData) {\n    var allowTimeZoneEditing = this.scheduler.getEditingConfig().allowTimeZoneEditing;\n    var {\n      expr: expr\n    } = this.scheduler.getDataAccessors();\n    var recurrenceEditorVisibility = !!formData[expr.recurrenceRuleExpr];\n    var colSpan = recurrenceEditorVisibility ? 1 : 2;\n    var mainItems = [...this._createMainItems(expr, triggerResize, changeSize, allowTimeZoneEditing), ...this.scheduler.createResourceEditorModel()];\n    changeSize(recurrenceEditorVisibility);\n    var items = [{\n      itemType: \"group\",\n      name: APPOINTMENT_FORM_GROUP_NAMES.Main,\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      colSpan: colSpan,\n      items: mainItems\n    }, {\n      itemType: \"group\",\n      name: APPOINTMENT_FORM_GROUP_NAMES.Recurrence,\n      visible: recurrenceEditorVisibility,\n      colSpan: colSpan,\n      items: this._createRecurrenceEditor(expr)\n    }];\n    var element = $(\"<div>\");\n    this.form = this.scheduler.createComponent(element, Form, {\n      items: items,\n      showValidationSummary: true,\n      scrollingEnabled: true,\n      colCount: \"auto\",\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      formData: formData,\n      showColonAfterLabel: false,\n      labelLocation: \"top\",\n      customizeItem: e => {\n        if (this.form && \"group\" === e.itemType) {\n          var dataExprs = this.scheduler.getDataAccessors().expr;\n          var startDate = new Date(this.formData[dataExprs.startDateExpr]);\n          var endDate = new Date(this.formData[dataExprs.endDateExpr]);\n          var startTimeZoneEditor = e.items.find(i => i.dataField === dataExprs.startDateTimeZoneExpr);\n          var endTimeZoneEditor = e.items.find(i => i.dataField === dataExprs.endDateTimeZoneExpr);\n\n          if (startTimeZoneEditor) {\n            startTimeZoneEditor.editorOptions.dataSource = this.createTimeZoneDataSource(startDate);\n          }\n\n          if (endTimeZoneEditor) {\n            endTimeZoneEditor.editorOptions.dataSource = this.createTimeZoneDataSource(endDate);\n          }\n        }\n      },\n      screenByWidth: width => width < SCREEN_SIZE_OF_SINGLE_COLUMN || \"desktop\" !== devices.current().deviceType ? \"xs\" : \"lg\"\n    });\n  }\n\n  createTimeZoneDataSource(date) {\n    return new DataSource({\n      store: timeZoneDataUtils.getDisplayedTimeZones(date),\n      paginate: true,\n      pageSize: 10\n    });\n  }\n\n  _dateBoxValueChanged(args, dateExpr, isNeedCorrect) {\n    validateAppointmentFormDate(args.component, args.value, args.previousValue);\n    var value = dateSerialization.deserializeDate(args.value);\n    var previousValue = dateSerialization.deserializeDate(args.previousValue);\n    var dateEditor = this.form.getEditor(dateExpr);\n    var dateValue = dateSerialization.deserializeDate(dateEditor.option(\"value\"));\n\n    if (this.semaphore.isFree() && dateValue && value && isNeedCorrect(dateValue, value)) {\n      var duration = previousValue ? dateValue.getTime() - previousValue.getTime() : 0;\n      dateEditor.option(\"value\", new Date(value.getTime() + duration));\n    }\n  }\n\n  _createTimezoneEditor(timeZoneExpr, secondTimeZoneExpr, visibleIndex, colSpan, isMainTimeZone) {\n    var visible = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : false;\n    var noTzTitle = messageLocalization.format(\"dxScheduler-noTimezoneTitle\");\n    return {\n      dataField: timeZoneExpr,\n      editorType: \"dxSelectBox\",\n      visibleIndex: visibleIndex,\n      colSpan: colSpan,\n      label: {\n        text: \" \"\n      },\n      editorOptions: {\n        displayExpr: \"title\",\n        valueExpr: \"id\",\n        placeholder: noTzTitle,\n        searchEnabled: true,\n        onValueChanged: args => {\n          var form = this.form;\n          var secondTimezoneEditor = form.getEditor(secondTimeZoneExpr);\n\n          if (isMainTimeZone) {\n            secondTimezoneEditor.option(\"value\", args.value);\n          }\n        }\n      },\n      visible: visible\n    };\n  }\n\n  _createDateBoxItems(dataExprs, allowTimeZoneEditing) {\n    var colSpan = allowTimeZoneEditing ? 2 : 1;\n    var firstDayOfWeek = this.scheduler.getFirstDayOfWeek();\n    return [createDateBoxEditor(dataExprs.startDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelStartDate\", args => {\n      this._dateBoxValueChanged(args, dataExprs.endDateExpr, (endValue, startValue) => endValue < startValue);\n    }), this._createTimezoneEditor(dataExprs.startDateTimeZoneExpr, dataExprs.endDateTimeZoneExpr, 1, colSpan, true, allowTimeZoneEditing), createDateBoxEditor(dataExprs.endDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelEndDate\", args => {\n      this._dateBoxValueChanged(args, dataExprs.startDateExpr, (startValue, endValue) => endValue < startValue);\n    }), this._createTimezoneEditor(dataExprs.endDateTimeZoneExpr, dataExprs.startDateTimeZoneExpr, 3, colSpan, false, allowTimeZoneEditing)];\n  }\n\n  _changeFormItemDateType(itemPath, isAllDay) {\n    var itemEditorOptions = this.form.itemOption(itemPath).editorOptions;\n    var type = isAllDay ? \"date\" : \"datetime\";\n\n    var newEditorOption = _extends({}, itemEditorOptions, {\n      type: type\n    });\n\n    this.form.itemOption(itemPath, \"editorOptions\", newEditorOption);\n  }\n\n  _createMainItems(dataExprs, triggerResize, changeSize, allowTimeZoneEditing) {\n    return [{\n      dataField: dataExprs.textExpr,\n      editorType: \"dxTextBox\",\n      colSpan: 2,\n      label: {\n        text: messageLocalization.format(\"dxScheduler-editorLabelTitle\")\n      }\n    }, {\n      itemType: \"group\",\n      colSpan: 2,\n      colCountByScreen: {\n        lg: 2,\n        xs: 1\n      },\n      items: this._createDateBoxItems(dataExprs, allowTimeZoneEditing)\n    }, {\n      itemType: \"group\",\n      colCountByScreen: {\n        lg: 3,\n        xs: 3\n      },\n      colSpan: 2,\n      items: [{\n        dataField: dataExprs.allDayExpr,\n        cssClass: \"dx-appointment-form-switch\",\n        editorType: \"dxSwitch\",\n        label: {\n          text: messageLocalization.format(\"dxScheduler-allDay\"),\n          location: \"right\"\n        },\n        editorOptions: {\n          onValueChanged: args => {\n            var value = args.value;\n            var startDateEditor = this.form.getEditor(dataExprs.startDateExpr);\n            var endDateEditor = this.form.getEditor(dataExprs.endDateExpr);\n            var startDate = dateSerialization.deserializeDate(startDateEditor.option(\"value\"));\n\n            if (this.semaphore.isFree() && startDate) {\n              if (value) {\n                var allDayStartDate = dateUtils.trimTime(startDate);\n                startDateEditor.option(\"value\", new Date(allDayStartDate));\n                endDateEditor.option(\"value\", new Date(allDayStartDate));\n              } else {\n                var startDateWithStartHour = getStartDateWithStartHour(startDate, this.scheduler.getStartDayHour());\n                var endDate = this.scheduler.getCalculatedEndDate(startDateWithStartHour);\n                startDateEditor.option(\"value\", startDateWithStartHour);\n                endDateEditor.option(\"value\", endDate);\n              }\n            }\n\n            var startDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(dataExprs.startDateExpr);\n            var endDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(dataExprs.endDateExpr);\n\n            this._changeFormItemDateType(startDateItemPath, value);\n\n            this._changeFormItemDateType(endDateItemPath, value);\n          }\n        }\n      }, {\n        editorType: \"dxSwitch\",\n        dataField: \"repeat\",\n        cssClass: \"dx-appointment-form-switch\",\n        name: \"visibilityChanged\",\n        label: {\n          text: messageLocalization.format(\"dxScheduler-editorLabelRecurrence\"),\n          location: \"right\"\n        },\n        editorOptions: {\n          onValueChanged: args => {\n            var form = this.form;\n            var colSpan = args.value ? 1 : 2;\n            form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Main, \"colSpan\", colSpan);\n            form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"colSpan\", colSpan);\n            updateRecurrenceItemVisibility(dataExprs.recurrenceRuleExpr, args.value, form);\n            changeSize(args.value);\n            triggerResize();\n          }\n        }\n      }]\n    }, {\n      itemType: \"empty\",\n      colSpan: 2\n    }, {\n      dataField: dataExprs.descriptionExpr,\n      editorType: \"dxTextArea\",\n      colSpan: 2,\n      label: {\n        text: messageLocalization.format(\"dxScheduler-editorLabelDescription\")\n      }\n    }, {\n      itemType: \"empty\",\n      colSpan: 2\n    }];\n  }\n\n  _createRecurrenceEditor(dataExprs) {\n    return [{\n      dataField: dataExprs.recurrenceRuleExpr,\n      editorType: \"dxRecurrenceEditor\",\n      editorOptions: {\n        firstDayOfWeek: this.scheduler.getFirstDayOfWeek()\n      },\n      label: {\n        text: \" \",\n        visible: false\n      }\n    }];\n  }\n\n  setEditorsType(allDay) {\n    var {\n      startDateExpr: startDateExpr,\n      endDateExpr: endDateExpr\n    } = this.scheduler.getDataAccessors().expr;\n    var startDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(startDateExpr);\n    var endDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \".\").concat(endDateExpr);\n    var startDateFormItem = this.form.itemOption(startDateItemPath);\n    var endDateFormItem = this.form.itemOption(endDateItemPath);\n\n    if (startDateFormItem && endDateFormItem) {\n      var startDateEditorOptions = startDateFormItem.editorOptions;\n      var endDateEditorOptions = endDateFormItem.editorOptions;\n      startDateEditorOptions.type = endDateEditorOptions.type = allDay ? \"date\" : \"datetime\";\n      this.form.itemOption(startDateItemPath, \"editorOptions\", startDateEditorOptions);\n      this.form.itemOption(endDateItemPath, \"editorOptions\", endDateEditorOptions);\n    }\n  }\n\n  updateRecurrenceEditorStartDate(date, expression) {\n    var options = {\n      startDate: date\n    };\n    this.setEditorOptions(expression, \"Recurrence\", options);\n  }\n\n  setEditorOptions(name, groupName, options) {\n    var editorPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.groupName, \".\").concat(name);\n    var editor = this.form.itemOption(editorPath);\n    editor && this.form.itemOption(editorPath, \"editorOptions\", extend({}, editor.editorOptions, options));\n  }\n\n  setTimeZoneEditorDataSource(date, path) {\n    var dataSource = this.createTimeZoneDataSource(date);\n    this.setEditorOptions(path, \"Main\", {\n      dataSource: dataSource\n    });\n  }\n\n  updateFormData(formData) {\n    this.semaphore.take();\n    this.form.option(\"formData\", formData);\n    var dataExprs = this.scheduler.getDataAccessors().expr;\n    var allDay = formData[dataExprs.allDayExpr];\n    var startDate = new Date(formData[dataExprs.startDateExpr]);\n    var endDate = new Date(formData[dataExprs.endDateExpr]);\n    this.setTimeZoneEditorDataSource(startDate, dataExprs.startDateTimeZoneExpr);\n    this.setTimeZoneEditorDataSource(endDate, dataExprs.endDateTimeZoneExpr);\n    this.updateRecurrenceEditorStartDate(startDate, dataExprs.recurrenceRuleExpr);\n    this.setEditorsType(allDay);\n    this.semaphore.release();\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/scheduler/appointmentPopup/form.js"],"names":["_extends","$","Form","dateSerialization","messageLocalization","devices","DataSource","timeZoneDataUtils","extend","dateUtils","Semaphore","SCREEN_SIZE_OF_SINGLE_COLUMN","APPOINTMENT_FORM_GROUP_NAMES","Main","Recurrence","getStartDateWithStartHour","startDate","startDayHour","Date","setHours","validateAppointmentFormDate","editor","value","previousValue","isCurrentDateCorrect","isPreviousDateCorrect","option","updateRecurrenceItemVisibility","recurrenceRuleExpr","form","_form$getEditor","itemOption","updateData","getEditor","changeValueByVisibility","createDateBoxEditor","dataField","colSpan","firstDayOfWeek","label","onValueChanged","editorType","text","format","validationRules","type","editorOptions","width","calendarOptions","useMaskBehavior","AppointmentForm","constructor","scheduler","semaphore","dxForm","readOnly","getDataAccessors","expr","recurrenceEditor","formData","create","triggerResize","changeSize","allowTimeZoneEditing","getEditingConfig","recurrenceEditorVisibility","mainItems","_createMainItems","createResourceEditorModel","items","itemType","name","colCountByScreen","lg","xs","visible","_createRecurrenceEditor","element","createComponent","showValidationSummary","scrollingEnabled","colCount","showColonAfterLabel","labelLocation","customizeItem","e","dataExprs","startDateExpr","endDate","endDateExpr","startTimeZoneEditor","find","i","startDateTimeZoneExpr","endTimeZoneEditor","endDateTimeZoneExpr","dataSource","createTimeZoneDataSource","screenByWidth","current","deviceType","date","store","getDisplayedTimeZones","paginate","pageSize","_dateBoxValueChanged","args","dateExpr","isNeedCorrect","component","deserializeDate","dateEditor","dateValue","isFree","duration","getTime","_createTimezoneEditor","timeZoneExpr","secondTimeZoneExpr","visibleIndex","isMainTimeZone","arguments","length","noTzTitle","displayExpr","valueExpr","placeholder","searchEnabled","secondTimezoneEditor","_createDateBoxItems","getFirstDayOfWeek","endValue","startValue","_changeFormItemDateType","itemPath","isAllDay","itemEditorOptions","newEditorOption","textExpr","allDayExpr","cssClass","location","startDateEditor","endDateEditor","allDayStartDate","trimTime","startDateWithStartHour","getStartDayHour","getCalculatedEndDate","startDateItemPath","concat","endDateItemPath","descriptionExpr","setEditorsType","allDay","startDateFormItem","endDateFormItem","startDateEditorOptions","endDateEditorOptions","updateRecurrenceEditorStartDate","expression","options","setEditorOptions","groupName","editorPath","setTimeZoneEditorDataSource","path","updateFormData","take","release"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/appointmentPopup/form.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport $ from \"../../../core/renderer\";\r\nimport Form from \"../../form\";\r\nimport dateSerialization from \"../../../core/utils/date_serialization\";\r\nimport messageLocalization from \"../../../localization/message\";\r\nimport devices from \"../../../core/devices\";\r\nimport DataSource from \"../../../data/data_source\";\r\nimport timeZoneDataUtils from \"../timezones/utils.timezones_data\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport dateUtils from \"../../../core/utils/date\";\r\nimport {\r\n    Semaphore\r\n} from \"../../../renovation/ui/scheduler/utils/semaphore/semaphore\";\r\nimport \"../recurrence_editor\";\r\nimport \"../../text_area\";\r\nimport \"../../tag_box\";\r\nimport \"../../switch\";\r\nimport \"../../select_box\";\r\nvar SCREEN_SIZE_OF_SINGLE_COLUMN = 600;\r\nexport var APPOINTMENT_FORM_GROUP_NAMES = {\r\n    Main: \"mainGroup\",\r\n    Recurrence: \"recurrenceGroup\"\r\n};\r\nvar getStartDateWithStartHour = (startDate, startDayHour) => new Date(new Date(startDate).setHours(startDayHour));\r\nvar validateAppointmentFormDate = (editor, value, previousValue) => {\r\n    var isCurrentDateCorrect = null === value || !!value;\r\n    var isPreviousDateCorrect = null === previousValue || !!previousValue;\r\n    if (!isCurrentDateCorrect && isPreviousDateCorrect) {\r\n        editor.option(\"value\", previousValue)\r\n    }\r\n};\r\nvar updateRecurrenceItemVisibility = (recurrenceRuleExpr, value, form) => {\r\n    var _form$getEditor;\r\n    form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"visible\", value);\r\n    !value && form.updateData(recurrenceRuleExpr, \"\");\r\n    null === (_form$getEditor = form.getEditor(recurrenceRuleExpr)) || void 0 === _form$getEditor ? void 0 : _form$getEditor.changeValueByVisibility(value)\r\n};\r\nvar createDateBoxEditor = (dataField, colSpan, firstDayOfWeek, label, onValueChanged) => ({\r\n    editorType: \"dxDateBox\",\r\n    dataField: dataField,\r\n    colSpan: colSpan,\r\n    label: {\r\n        text: messageLocalization.format(label)\r\n    },\r\n    validationRules: [{\r\n        type: \"required\"\r\n    }],\r\n    editorOptions: {\r\n        width: \"100%\",\r\n        calendarOptions: {\r\n            firstDayOfWeek: firstDayOfWeek\r\n        },\r\n        onValueChanged: onValueChanged,\r\n        useMaskBehavior: true\r\n    }\r\n});\r\nexport class AppointmentForm {\r\n    constructor(scheduler) {\r\n        this.scheduler = scheduler;\r\n        this.form = null;\r\n        this.semaphore = new Semaphore\r\n    }\r\n    get dxForm() {\r\n        return this.form\r\n    }\r\n    set readOnly(value) {\r\n        this.form.option(\"readOnly\", value);\r\n        var {\r\n            recurrenceRuleExpr: recurrenceRuleExpr\r\n        } = this.scheduler.getDataAccessors().expr;\r\n        var recurrenceEditor = this.form.getEditor(recurrenceRuleExpr);\r\n        null === recurrenceEditor || void 0 === recurrenceEditor ? void 0 : recurrenceEditor.option(\"readOnly\", value)\r\n    }\r\n    get formData() {\r\n        return this.form.option(\"formData\")\r\n    }\r\n    set formData(value) {\r\n        this.form.option(\"formData\", value)\r\n    }\r\n    create(triggerResize, changeSize, formData) {\r\n        var allowTimeZoneEditing = this.scheduler.getEditingConfig().allowTimeZoneEditing;\r\n        var {\r\n            expr: expr\r\n        } = this.scheduler.getDataAccessors();\r\n        var recurrenceEditorVisibility = !!formData[expr.recurrenceRuleExpr];\r\n        var colSpan = recurrenceEditorVisibility ? 1 : 2;\r\n        var mainItems = [...this._createMainItems(expr, triggerResize, changeSize, allowTimeZoneEditing), ...this.scheduler.createResourceEditorModel()];\r\n        changeSize(recurrenceEditorVisibility);\r\n        var items = [{\r\n            itemType: \"group\",\r\n            name: APPOINTMENT_FORM_GROUP_NAMES.Main,\r\n            colCountByScreen: {\r\n                lg: 2,\r\n                xs: 1\r\n            },\r\n            colSpan: colSpan,\r\n            items: mainItems\r\n        }, {\r\n            itemType: \"group\",\r\n            name: APPOINTMENT_FORM_GROUP_NAMES.Recurrence,\r\n            visible: recurrenceEditorVisibility,\r\n            colSpan: colSpan,\r\n            items: this._createRecurrenceEditor(expr)\r\n        }];\r\n        var element = $(\"<div>\");\r\n        this.form = this.scheduler.createComponent(element, Form, {\r\n            items: items,\r\n            showValidationSummary: true,\r\n            scrollingEnabled: true,\r\n            colCount: \"auto\",\r\n            colCountByScreen: {\r\n                lg: 2,\r\n                xs: 1\r\n            },\r\n            formData: formData,\r\n            showColonAfterLabel: false,\r\n            labelLocation: \"top\",\r\n            customizeItem: e => {\r\n                if (this.form && \"group\" === e.itemType) {\r\n                    var dataExprs = this.scheduler.getDataAccessors().expr;\r\n                    var startDate = new Date(this.formData[dataExprs.startDateExpr]);\r\n                    var endDate = new Date(this.formData[dataExprs.endDateExpr]);\r\n                    var startTimeZoneEditor = e.items.find(i => i.dataField === dataExprs.startDateTimeZoneExpr);\r\n                    var endTimeZoneEditor = e.items.find(i => i.dataField === dataExprs.endDateTimeZoneExpr);\r\n                    if (startTimeZoneEditor) {\r\n                        startTimeZoneEditor.editorOptions.dataSource = this.createTimeZoneDataSource(startDate)\r\n                    }\r\n                    if (endTimeZoneEditor) {\r\n                        endTimeZoneEditor.editorOptions.dataSource = this.createTimeZoneDataSource(endDate)\r\n                    }\r\n                }\r\n            },\r\n            screenByWidth: width => width < SCREEN_SIZE_OF_SINGLE_COLUMN || \"desktop\" !== devices.current().deviceType ? \"xs\" : \"lg\"\r\n        })\r\n    }\r\n    createTimeZoneDataSource(date) {\r\n        return new DataSource({\r\n            store: timeZoneDataUtils.getDisplayedTimeZones(date),\r\n            paginate: true,\r\n            pageSize: 10\r\n        })\r\n    }\r\n    _dateBoxValueChanged(args, dateExpr, isNeedCorrect) {\r\n        validateAppointmentFormDate(args.component, args.value, args.previousValue);\r\n        var value = dateSerialization.deserializeDate(args.value);\r\n        var previousValue = dateSerialization.deserializeDate(args.previousValue);\r\n        var dateEditor = this.form.getEditor(dateExpr);\r\n        var dateValue = dateSerialization.deserializeDate(dateEditor.option(\"value\"));\r\n        if (this.semaphore.isFree() && dateValue && value && isNeedCorrect(dateValue, value)) {\r\n            var duration = previousValue ? dateValue.getTime() - previousValue.getTime() : 0;\r\n            dateEditor.option(\"value\", new Date(value.getTime() + duration))\r\n        }\r\n    }\r\n    _createTimezoneEditor(timeZoneExpr, secondTimeZoneExpr, visibleIndex, colSpan, isMainTimeZone) {\r\n        var visible = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : false;\r\n        var noTzTitle = messageLocalization.format(\"dxScheduler-noTimezoneTitle\");\r\n        return {\r\n            dataField: timeZoneExpr,\r\n            editorType: \"dxSelectBox\",\r\n            visibleIndex: visibleIndex,\r\n            colSpan: colSpan,\r\n            label: {\r\n                text: \" \"\r\n            },\r\n            editorOptions: {\r\n                displayExpr: \"title\",\r\n                valueExpr: \"id\",\r\n                placeholder: noTzTitle,\r\n                searchEnabled: true,\r\n                onValueChanged: args => {\r\n                    var form = this.form;\r\n                    var secondTimezoneEditor = form.getEditor(secondTimeZoneExpr);\r\n                    if (isMainTimeZone) {\r\n                        secondTimezoneEditor.option(\"value\", args.value)\r\n                    }\r\n                }\r\n            },\r\n            visible: visible\r\n        }\r\n    }\r\n    _createDateBoxItems(dataExprs, allowTimeZoneEditing) {\r\n        var colSpan = allowTimeZoneEditing ? 2 : 1;\r\n        var firstDayOfWeek = this.scheduler.getFirstDayOfWeek();\r\n        return [createDateBoxEditor(dataExprs.startDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelStartDate\", args => {\r\n            this._dateBoxValueChanged(args, dataExprs.endDateExpr, (endValue, startValue) => endValue < startValue)\r\n        }), this._createTimezoneEditor(dataExprs.startDateTimeZoneExpr, dataExprs.endDateTimeZoneExpr, 1, colSpan, true, allowTimeZoneEditing), createDateBoxEditor(dataExprs.endDateExpr, colSpan, firstDayOfWeek, \"dxScheduler-editorLabelEndDate\", args => {\r\n            this._dateBoxValueChanged(args, dataExprs.startDateExpr, (startValue, endValue) => endValue < startValue)\r\n        }), this._createTimezoneEditor(dataExprs.endDateTimeZoneExpr, dataExprs.startDateTimeZoneExpr, 3, colSpan, false, allowTimeZoneEditing)]\r\n    }\r\n    _changeFormItemDateType(itemPath, isAllDay) {\r\n        var itemEditorOptions = this.form.itemOption(itemPath).editorOptions;\r\n        var type = isAllDay ? \"date\" : \"datetime\";\r\n        var newEditorOption = _extends({}, itemEditorOptions, {\r\n            type: type\r\n        });\r\n        this.form.itemOption(itemPath, \"editorOptions\", newEditorOption)\r\n    }\r\n    _createMainItems(dataExprs, triggerResize, changeSize, allowTimeZoneEditing) {\r\n        return [{\r\n            dataField: dataExprs.textExpr,\r\n            editorType: \"dxTextBox\",\r\n            colSpan: 2,\r\n            label: {\r\n                text: messageLocalization.format(\"dxScheduler-editorLabelTitle\")\r\n            }\r\n        }, {\r\n            itemType: \"group\",\r\n            colSpan: 2,\r\n            colCountByScreen: {\r\n                lg: 2,\r\n                xs: 1\r\n            },\r\n            items: this._createDateBoxItems(dataExprs, allowTimeZoneEditing)\r\n        }, {\r\n            itemType: \"group\",\r\n            colCountByScreen: {\r\n                lg: 3,\r\n                xs: 3\r\n            },\r\n            colSpan: 2,\r\n            items: [{\r\n                dataField: dataExprs.allDayExpr,\r\n                cssClass: \"dx-appointment-form-switch\",\r\n                editorType: \"dxSwitch\",\r\n                label: {\r\n                    text: messageLocalization.format(\"dxScheduler-allDay\"),\r\n                    location: \"right\"\r\n                },\r\n                editorOptions: {\r\n                    onValueChanged: args => {\r\n                        var value = args.value;\r\n                        var startDateEditor = this.form.getEditor(dataExprs.startDateExpr);\r\n                        var endDateEditor = this.form.getEditor(dataExprs.endDateExpr);\r\n                        var startDate = dateSerialization.deserializeDate(startDateEditor.option(\"value\"));\r\n                        if (this.semaphore.isFree() && startDate) {\r\n                            if (value) {\r\n                                var allDayStartDate = dateUtils.trimTime(startDate);\r\n                                startDateEditor.option(\"value\", new Date(allDayStartDate));\r\n                                endDateEditor.option(\"value\", new Date(allDayStartDate))\r\n                            } else {\r\n                                var startDateWithStartHour = getStartDateWithStartHour(startDate, this.scheduler.getStartDayHour());\r\n                                var endDate = this.scheduler.getCalculatedEndDate(startDateWithStartHour);\r\n                                startDateEditor.option(\"value\", startDateWithStartHour);\r\n                                endDateEditor.option(\"value\", endDate)\r\n                            }\r\n                        }\r\n                        var startDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(dataExprs.startDateExpr);\r\n                        var endDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(dataExprs.endDateExpr);\r\n                        this._changeFormItemDateType(startDateItemPath, value);\r\n                        this._changeFormItemDateType(endDateItemPath, value)\r\n                    }\r\n                }\r\n            }, {\r\n                editorType: \"dxSwitch\",\r\n                dataField: \"repeat\",\r\n                cssClass: \"dx-appointment-form-switch\",\r\n                name: \"visibilityChanged\",\r\n                label: {\r\n                    text: messageLocalization.format(\"dxScheduler-editorLabelRecurrence\"),\r\n                    location: \"right\"\r\n                },\r\n                editorOptions: {\r\n                    onValueChanged: args => {\r\n                        var form = this.form;\r\n                        var colSpan = args.value ? 1 : 2;\r\n                        form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Main, \"colSpan\", colSpan);\r\n                        form.itemOption(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \"colSpan\", colSpan);\r\n                        updateRecurrenceItemVisibility(dataExprs.recurrenceRuleExpr, args.value, form);\r\n                        changeSize(args.value);\r\n                        triggerResize()\r\n                    }\r\n                }\r\n            }]\r\n        }, {\r\n            itemType: \"empty\",\r\n            colSpan: 2\r\n        }, {\r\n            dataField: dataExprs.descriptionExpr,\r\n            editorType: \"dxTextArea\",\r\n            colSpan: 2,\r\n            label: {\r\n                text: messageLocalization.format(\"dxScheduler-editorLabelDescription\")\r\n            }\r\n        }, {\r\n            itemType: \"empty\",\r\n            colSpan: 2\r\n        }]\r\n    }\r\n    _createRecurrenceEditor(dataExprs) {\r\n        return [{\r\n            dataField: dataExprs.recurrenceRuleExpr,\r\n            editorType: \"dxRecurrenceEditor\",\r\n            editorOptions: {\r\n                firstDayOfWeek: this.scheduler.getFirstDayOfWeek()\r\n            },\r\n            label: {\r\n                text: \" \",\r\n                visible: false\r\n            }\r\n        }]\r\n    }\r\n    setEditorsType(allDay) {\r\n        var {\r\n            startDateExpr: startDateExpr,\r\n            endDateExpr: endDateExpr\r\n        } = this.scheduler.getDataAccessors().expr;\r\n        var startDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Main, \".\").concat(startDateExpr);\r\n        var endDateItemPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.Recurrence, \".\").concat(endDateExpr);\r\n        var startDateFormItem = this.form.itemOption(startDateItemPath);\r\n        var endDateFormItem = this.form.itemOption(endDateItemPath);\r\n        if (startDateFormItem && endDateFormItem) {\r\n            var startDateEditorOptions = startDateFormItem.editorOptions;\r\n            var endDateEditorOptions = endDateFormItem.editorOptions;\r\n            startDateEditorOptions.type = endDateEditorOptions.type = allDay ? \"date\" : \"datetime\";\r\n            this.form.itemOption(startDateItemPath, \"editorOptions\", startDateEditorOptions);\r\n            this.form.itemOption(endDateItemPath, \"editorOptions\", endDateEditorOptions)\r\n        }\r\n    }\r\n    updateRecurrenceEditorStartDate(date, expression) {\r\n        var options = {\r\n            startDate: date\r\n        };\r\n        this.setEditorOptions(expression, \"Recurrence\", options)\r\n    }\r\n    setEditorOptions(name, groupName, options) {\r\n        var editorPath = \"\".concat(APPOINTMENT_FORM_GROUP_NAMES.groupName, \".\").concat(name);\r\n        var editor = this.form.itemOption(editorPath);\r\n        editor && this.form.itemOption(editorPath, \"editorOptions\", extend({}, editor.editorOptions, options))\r\n    }\r\n    setTimeZoneEditorDataSource(date, path) {\r\n        var dataSource = this.createTimeZoneDataSource(date);\r\n        this.setEditorOptions(path, \"Main\", {\r\n            dataSource: dataSource\r\n        })\r\n    }\r\n    updateFormData(formData) {\r\n        this.semaphore.take();\r\n        this.form.option(\"formData\", formData);\r\n        var dataExprs = this.scheduler.getDataAccessors().expr;\r\n        var allDay = formData[dataExprs.allDayExpr];\r\n        var startDate = new Date(formData[dataExprs.startDateExpr]);\r\n        var endDate = new Date(formData[dataExprs.endDateExpr]);\r\n        this.setTimeZoneEditorDataSource(startDate, dataExprs.startDateTimeZoneExpr);\r\n        this.setTimeZoneEditorDataSource(endDate, dataExprs.endDateTimeZoneExpr);\r\n        this.updateRecurrenceEditorStartDate(startDate, dataExprs.recurrenceRuleExpr);\r\n        this.setEditorsType(allDay);\r\n        this.semaphore.release()\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}