{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate } from '../../recurrence-editor/date-generator';\n/**\n * ICalendar Import Module\n */\n\nvar ICalendarImport =\n/** @class */\nfunction () {\n  function ICalendarImport(parent) {\n    this.allDay = false;\n    this.parent = parent;\n  }\n\n  ICalendarImport.prototype.initializeCalendarImport = function (fileContent) {\n    var _this = this;\n\n    if (fileContent && fileContent instanceof Blob) {\n      var fileReader_1 = new FileReader();\n\n      fileReader_1.onload = function () {\n        var iCalString = fileReader_1.result;\n\n        _this.iCalendarParser(iCalString);\n      };\n\n      fileReader_1.readAsText(fileContent, 'UTF-8');\n    } else if (fileContent && typeof fileContent === 'string') {\n      this.iCalendarParser(fileContent);\n    }\n  };\n\n  ICalendarImport.prototype.iCalendarParser = function (iCalString) {\n    var _this = this;\n\n    var fields = this.parent.eventFields;\n    var events = [];\n    var uId = 'UID';\n    var calArray = iCalString.replace(new RegExp('\\\\r', 'g'), '').split('\\n');\n    var isEvent = false;\n    var curEvent; // eslint-disable-next-line prefer-const\n\n    var id = this.parent.eventBase.getEventMaxID();\n    var count = 0;\n    calArray.forEach(function (element) {\n      var index;\n      var type;\n      var value;\n\n      if (!isEvent && element === 'BEGIN:VEVENT') {\n        isEvent = true;\n        curEvent = {};\n      }\n\n      if (isEvent && element === 'END:VEVENT') {\n        isEvent = false;\n        events.push(curEvent);\n        curEvent = null;\n      }\n\n      if (isEvent) {\n        index = element.indexOf(':');\n        type = element.substr(0, index).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n        value = element.substr(index + 1, element.length - (index + 1)).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n\n        if (element.indexOf('SUMMARY') !== -1) {\n          type = 'SUMMARY';\n        }\n\n        if (element.indexOf('DTSTART') !== -1) {\n          curEvent[fields.startTime] = _this.dateParsing(element);\n          curEvent[fields.isAllDay] = _this.allDay;\n          _this.allDay = false;\n        } else if (element.indexOf('DTEND') !== -1) {\n          curEvent[fields.endTime] = _this.dateParsing(element);\n        } else if (element.indexOf('EXDATE') !== -1) {\n          value = getRecurrenceStringFromDate(_this.dateParsing(element));\n          curEvent[fields.recurrenceException] = isNullOrUndefined(curEvent[fields.recurrenceException]) ? value : curEvent[fields.recurrenceException] + ',' + value;\n        } else if (element.indexOf('RECURRENCE-ID') !== -1) {\n          value = getRecurrenceStringFromDate(_this.dateParsing(element));\n          curEvent[fields.recurrenceException] = value;\n          curEvent[fields.recurrenceID] = value;\n        } else {\n          switch (type) {\n            case 'BEGIN':\n              break;\n\n            case 'UID':\n              curEvent[uId] = value;\n\n              if (typeof id == 'number') {\n                curEvent[fields.id] = parseInt(value, 10);\n\n                if (isNaN(curEvent[fields.id])) {\n                  curEvent[fields.id] = id + count;\n                  count++;\n                }\n              } else {\n                curEvent[fields.id] = value;\n              }\n\n              break;\n\n            case 'SUMMARY':\n              curEvent[fields.subject] = value;\n              break;\n\n            case 'LOCATION':\n              curEvent[fields.location] = value;\n              break;\n\n            case 'DESCRIPTION':\n              curEvent[fields.description] = value;\n              break;\n\n            case 'ISREADONLY':\n              curEvent[fields.isReadonly] = value.indexOf('true') > -1;\n              break;\n\n            case 'RRULE':\n              curEvent[fields.recurrenceRule] = value;\n              break;\n\n            default:\n              if (_this.parent.resourceCollection.length > 0) {\n                var resData = _this.parent.resourceCollection.filter(function (data) {\n                  return data.field === type;\n                });\n\n                curEvent[type] = resData.length > 0 && typeof resData[0].dataSource[0][resData[0].idField] == 'number' ? parseInt(value, 10) : value;\n              } else {\n                curEvent[type] = value;\n              }\n\n          }\n        }\n      }\n    });\n    var app = extend([], events, null, true);\n    this.parent.addEvent(this.processOccurrence(app, id));\n  };\n\n  ICalendarImport.prototype.processOccurrence = function (app, maxId) {\n    var _this = this;\n\n    var appoint = [];\n    var uId = 'UID';\n    var fields = this.parent.eventFields;\n    var appointmentIds = [];\n    this.parent.eventsData.forEach(function (eventObj) {\n      appointmentIds.push(eventObj[fields.id]);\n    });\n    app.forEach(function (eventObj) {\n      var parentObj;\n      var id; // eslint-disable-next-line no-prototype-builtins\n\n      if (!eventObj.hasOwnProperty(fields.recurrenceID)) {\n        parentObj = eventObj;\n        id = eventObj[fields.id];\n      }\n\n      if (appointmentIds.indexOf(eventObj[fields.id]) < 0) {\n        var data = app.filter(function (data) {\n          return data.UID === eventObj[uId];\n        });\n\n        if (data.length > 1 && isNullOrUndefined(eventObj[fields.recurrenceID])) {\n          id = typeof maxId === 'number' ? maxId++ : id;\n\n          for (var i = 0; i < data.length; i++) {\n            // eslint-disable-next-line no-prototype-builtins\n            if (data[i].hasOwnProperty(fields.recurrenceID)) {\n              var exdate = data[i][fields.recurrenceID];\n              data[i][fields.id] = typeof maxId === 'number' ? maxId++ : _this.parent.eventBase.generateGuid();\n              data[i][fields.recurrenceID] = id;\n              data[i][fields.recurrenceException] = null;\n              parentObj[fields.recurrenceException] = _this.getExcludeDateString(parentObj[fields.recurrenceException], exdate);\n              delete data[i][uId];\n              appoint.push(data[i]);\n            }\n          }\n\n          delete parentObj[uId];\n          parentObj[fields.id] = id;\n          appoint.push(parentObj); // eslint-disable-next-line no-prototype-builtins\n        } else if (!eventObj.hasOwnProperty(fields.recurrenceID)) {\n          delete eventObj[uId];\n          eventObj[fields.id] = typeof maxId === 'number' ? maxId++ : id;\n          appoint.push(eventObj);\n        }\n      }\n    });\n    return appoint;\n  };\n\n  ICalendarImport.prototype.getExcludeDateString = function (parentException, occurrenceException) {\n    if (isNullOrUndefined(parentException)) {\n      return occurrenceException;\n    } else if (isNullOrUndefined(occurrenceException)) {\n      return parentException;\n    }\n\n    var parentExDate = parentException.split(',').map(function (x) {\n      return x.split('T')[0];\n    });\n    var childExDate = occurrenceException.split(',').map(function (x) {\n      return x.split('T')[0];\n    });\n    var exDate = parentExDate.filter(function (x) {\n      return childExDate.indexOf(x) > -1;\n    });\n\n    if (exDate.length > 0) {\n      return parentException;\n    }\n\n    return parentException + ',' + occurrenceException;\n  };\n\n  ICalendarImport.prototype.getDateString = function (value) {\n    value = value || ''; // eslint-disable-next-line no-useless-escape\n\n    return value.replace(/\\\\\\,/g, ',').replace(/\\\\\\;/g, ';').replace(/\\\\[nN]/g, '\\n').replace(/\\\\\\\\/g, '\\\\');\n  };\n\n  ICalendarImport.prototype.dateParsing = function (element) {\n    var expression = /([^':;]+)((?:;(?:[^':;]+)(?:=(?:(?:'[^']*')|(?:[^':;]+))))*):(.*)/;\n    var split = element.match(expression).slice(1);\n    var value = split[split.length - 1];\n    var newDate = new Date(this.getDateString(value));\n\n    if (element && (element.indexOf('VALUE=DATE') > -1 || element.indexOf('RECURRENCE-ID;TZID') > -1)) {\n      var data_1 = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(value);\n\n      if (data_1 !== null) {\n        newDate = new Date(parseInt(data_1[1], 10), parseInt(data_1[2], 10) - 1, parseInt(data_1[3], 10));\n      }\n\n      if (element.indexOf('DTSTART') > -1) {\n        this.allDay = true;\n      }\n    }\n\n    var data = /^(\\d{4})(\\d{2})(\\d{2})T(\\d{2})(\\d{2})(\\d{2})(Z)?$/.exec(value);\n\n    if (data !== null) {\n      if (data[7] === 'Z') {\n        newDate = new Date(Date.UTC(parseInt(data[1], 10), parseInt(data[2], 10) - 1, parseInt(data[3], 10), parseInt(data[4], 10), parseInt(data[5], 10), parseInt(data[6], 10)));\n      } else {\n        newDate = new Date(parseInt(data[1], 10), parseInt(data[2], 10) - 1, parseInt(data[3], 10), parseInt(data[4], 10), parseInt(data[5], 10), parseInt(data[6], 10));\n      }\n    }\n\n    return newDate;\n  };\n\n  ICalendarImport.prototype.getModuleName = function () {\n    return 'iCalendarImport';\n  };\n\n  ICalendarImport.prototype.destroy = function () {\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n  };\n\n  return ICalendarImport;\n}();\n\nexport { ICalendarImport };","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/@syncfusion/ej2-schedule/src/schedule/exports/calendar-import.js"],"names":["isNullOrUndefined","extend","getRecurrenceStringFromDate","ICalendarImport","parent","allDay","prototype","initializeCalendarImport","fileContent","_this","Blob","fileReader_1","FileReader","onload","iCalString","result","iCalendarParser","readAsText","fields","eventFields","events","uId","calArray","replace","RegExp","split","isEvent","curEvent","id","eventBase","getEventMaxID","count","forEach","element","index","type","value","push","indexOf","substr","length","startTime","dateParsing","isAllDay","endTime","recurrenceException","recurrenceID","parseInt","isNaN","subject","location","description","isReadonly","recurrenceRule","resourceCollection","resData","filter","data","field","dataSource","idField","app","addEvent","processOccurrence","maxId","appoint","appointmentIds","eventsData","eventObj","parentObj","hasOwnProperty","UID","i","exdate","generateGuid","getExcludeDateString","parentException","occurrenceException","parentExDate","map","x","childExDate","exDate","getDateString","expression","match","slice","newDate","Date","data_1","exec","UTC","getModuleName","destroy","isDestroyed"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { isNullOrUndefined, extend } from '@syncfusion/ej2-base';\nimport { getRecurrenceStringFromDate } from '../../recurrence-editor/date-generator';\n/**\n * ICalendar Import Module\n */\nvar ICalendarImport = /** @class */ (function () {\n    function ICalendarImport(parent) {\n        this.allDay = false;\n        this.parent = parent;\n    }\n    ICalendarImport.prototype.initializeCalendarImport = function (fileContent) {\n        var _this = this;\n        if (fileContent && fileContent instanceof Blob) {\n            var fileReader_1 = new FileReader();\n            fileReader_1.onload = function () {\n                var iCalString = fileReader_1.result;\n                _this.iCalendarParser(iCalString);\n            };\n            fileReader_1.readAsText(fileContent, 'UTF-8');\n        }\n        else if (fileContent && typeof fileContent === 'string') {\n            this.iCalendarParser(fileContent);\n        }\n    };\n    ICalendarImport.prototype.iCalendarParser = function (iCalString) {\n        var _this = this;\n        var fields = this.parent.eventFields;\n        var events = [];\n        var uId = 'UID';\n        var calArray = iCalString.replace(new RegExp('\\\\r', 'g'), '').split('\\n');\n        var isEvent = false;\n        var curEvent;\n        // eslint-disable-next-line prefer-const\n        var id = this.parent.eventBase.getEventMaxID();\n        var count = 0;\n        calArray.forEach(function (element) {\n            var index;\n            var type;\n            var value;\n            if (!isEvent && element === 'BEGIN:VEVENT') {\n                isEvent = true;\n                curEvent = {};\n            }\n            if (isEvent && element === 'END:VEVENT') {\n                isEvent = false;\n                events.push(curEvent);\n                curEvent = null;\n            }\n            if (isEvent) {\n                index = element.indexOf(':');\n                type = element.substr(0, index).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n                value = element.substr(index + 1, element.length - (index + 1)).replace(/^\\s\\s*/, '').replace(/\\s\\s*$/, '');\n                if (element.indexOf('SUMMARY') !== -1) {\n                    type = 'SUMMARY';\n                }\n                if (element.indexOf('DTSTART') !== -1) {\n                    curEvent[fields.startTime] = _this.dateParsing(element);\n                    curEvent[fields.isAllDay] = _this.allDay;\n                    _this.allDay = false;\n                }\n                else if (element.indexOf('DTEND') !== -1) {\n                    curEvent[fields.endTime] = _this.dateParsing(element);\n                }\n                else if (element.indexOf('EXDATE') !== -1) {\n                    value = getRecurrenceStringFromDate(_this.dateParsing(element));\n                    curEvent[fields.recurrenceException] = (isNullOrUndefined(curEvent[fields.recurrenceException])) ?\n                        value : curEvent[fields.recurrenceException] + ',' + value;\n                }\n                else if (element.indexOf('RECURRENCE-ID') !== -1) {\n                    value = getRecurrenceStringFromDate(_this.dateParsing(element));\n                    curEvent[fields.recurrenceException] = value;\n                    curEvent[fields.recurrenceID] = value;\n                }\n                else {\n                    switch (type) {\n                        case 'BEGIN':\n                            break;\n                        case 'UID':\n                            curEvent[uId] = value;\n                            if (typeof (id) == 'number') {\n                                curEvent[fields.id] = parseInt(value, 10);\n                                if (isNaN(curEvent[fields.id])) {\n                                    curEvent[fields.id] = id + count;\n                                    count++;\n                                }\n                            }\n                            else {\n                                curEvent[fields.id] = value;\n                            }\n                            break;\n                        case 'SUMMARY':\n                            curEvent[fields.subject] = value;\n                            break;\n                        case 'LOCATION':\n                            curEvent[fields.location] = value;\n                            break;\n                        case 'DESCRIPTION':\n                            curEvent[fields.description] = value;\n                            break;\n                        case 'ISREADONLY':\n                            curEvent[fields.isReadonly] = (value.indexOf('true') > -1);\n                            break;\n                        case 'RRULE':\n                            curEvent[fields.recurrenceRule] = value;\n                            break;\n                        default:\n                            if (_this.parent.resourceCollection.length > 0) {\n                                var resData = _this.parent.resourceCollection.filter(function (data) { return data.field === type; });\n                                curEvent[type] = (resData.length > 0 && (typeof (resData[0].dataSource[0][resData[0].idField]) == 'number')) ? parseInt(value, 10) : value;\n                            }\n                            else {\n                                curEvent[type] = value;\n                            }\n                    }\n                }\n            }\n        });\n        var app = extend([], events, null, true);\n        this.parent.addEvent(this.processOccurrence(app, id));\n    };\n    ICalendarImport.prototype.processOccurrence = function (app, maxId) {\n        var _this = this;\n        var appoint = [];\n        var uId = 'UID';\n        var fields = this.parent.eventFields;\n        var appointmentIds = [];\n        this.parent.eventsData.forEach(function (eventObj) {\n            appointmentIds.push(eventObj[fields.id]);\n        });\n        app.forEach(function (eventObj) {\n            var parentObj;\n            var id;\n            // eslint-disable-next-line no-prototype-builtins\n            if (!eventObj.hasOwnProperty(fields.recurrenceID)) {\n                parentObj = eventObj;\n                id = eventObj[fields.id];\n            }\n            if (appointmentIds.indexOf(eventObj[fields.id]) < 0) {\n                var data = app.filter(function (data) { return data.UID === eventObj[uId]; });\n                if (data.length > 1 && isNullOrUndefined(eventObj[fields.recurrenceID])) {\n                    id = typeof (maxId) === 'number' ? maxId++ : id;\n                    for (var i = 0; i < data.length; i++) {\n                        // eslint-disable-next-line no-prototype-builtins\n                        if (data[i].hasOwnProperty(fields.recurrenceID)) {\n                            var exdate = data[i][fields.recurrenceID];\n                            data[i][fields.id] = typeof (maxId) === 'number' ? maxId++ : _this.parent.eventBase.generateGuid();\n                            data[i][fields.recurrenceID] = id;\n                            data[i][fields.recurrenceException] = null;\n                            parentObj[fields.recurrenceException] =\n                                _this.getExcludeDateString(parentObj[fields.recurrenceException], exdate);\n                            delete data[i][uId];\n                            appoint.push(data[i]);\n                        }\n                    }\n                    delete parentObj[uId];\n                    parentObj[fields.id] = id;\n                    appoint.push(parentObj);\n                    // eslint-disable-next-line no-prototype-builtins\n                }\n                else if (!eventObj.hasOwnProperty(fields.recurrenceID)) {\n                    delete eventObj[uId];\n                    eventObj[fields.id] = typeof (maxId) === 'number' ? maxId++ : id;\n                    appoint.push(eventObj);\n                }\n            }\n        });\n        return appoint;\n    };\n    ICalendarImport.prototype.getExcludeDateString = function (parentException, occurrenceException) {\n        if (isNullOrUndefined(parentException)) {\n            return occurrenceException;\n        }\n        else if (isNullOrUndefined(occurrenceException)) {\n            return parentException;\n        }\n        var parentExDate = parentException.split(',').map(function (x) { return x.split('T')[0]; });\n        var childExDate = occurrenceException.split(',').map(function (x) { return x.split('T')[0]; });\n        var exDate = parentExDate.filter(function (x) { return childExDate.indexOf(x) > -1; });\n        if (exDate.length > 0) {\n            return parentException;\n        }\n        return parentException + ',' + occurrenceException;\n    };\n    ICalendarImport.prototype.getDateString = function (value) {\n        value = value || '';\n        // eslint-disable-next-line no-useless-escape\n        return (value.replace(/\\\\\\,/g, ',').replace(/\\\\\\;/g, ';').replace(/\\\\[nN]/g, '\\n').replace(/\\\\\\\\/g, '\\\\'));\n    };\n    ICalendarImport.prototype.dateParsing = function (element) {\n        var expression = /([^':;]+)((?:;(?:[^':;]+)(?:=(?:(?:'[^']*')|(?:[^':;]+))))*):(.*)/;\n        var split = (element.match(expression)).slice(1);\n        var value = split[split.length - 1];\n        var newDate = new Date(this.getDateString(value));\n        if (element && (element.indexOf('VALUE=DATE') > -1 || element.indexOf('RECURRENCE-ID;TZID') > -1)) {\n            var data_1 = /^(\\d{4})(\\d{2})(\\d{2})$/.exec(value);\n            if (data_1 !== null) {\n                newDate = new Date(parseInt(data_1[1], 10), parseInt(data_1[2], 10) - 1, parseInt(data_1[3], 10));\n            }\n            if (element.indexOf('DTSTART') > -1) {\n                this.allDay = true;\n            }\n        }\n        var data = /^(\\d{4})(\\d{2})(\\d{2})T(\\d{2})(\\d{2})(\\d{2})(Z)?$/.exec(value);\n        if (data !== null) {\n            if (data[7] === 'Z') {\n                newDate = new Date(Date.UTC(parseInt(data[1], 10), parseInt(data[2], 10) - 1, parseInt(data[3], 10), parseInt(data[4], 10), parseInt(data[5], 10), parseInt(data[6], 10)));\n            }\n            else {\n                newDate = new Date(parseInt(data[1], 10), parseInt(data[2], 10) - 1, parseInt(data[3], 10), parseInt(data[4], 10), parseInt(data[5], 10), parseInt(data[6], 10));\n            }\n        }\n        return newDate;\n    };\n    ICalendarImport.prototype.getModuleName = function () {\n        return 'iCalendarImport';\n    };\n    ICalendarImport.prototype.destroy = function () {\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n    };\n    return ICalendarImport;\n}());\nexport { ICalendarImport };\n"]},"metadata":{},"sourceType":"module"}