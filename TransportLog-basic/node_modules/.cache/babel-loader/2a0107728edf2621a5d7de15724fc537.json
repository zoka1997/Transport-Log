{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport Button from \"../button\";\nimport { move, locate } from \"../../animation/translator\";\nimport messageLocalization from \"../../localization/message\";\nimport { FunctionTemplate } from \"../../core/templates/function_template\";\nimport { when } from \"../../core/utils/deferred\";\nimport { extendFromObject } from \"../../core/utils/extend\";\nimport { getBoundingRect } from \"../../core/utils/position\";\nimport { AppointmentTooltipInfo } from \"./dataStructures\";\nimport { LIST_ITEM_DATA_KEY, LIST_ITEM_CLASS } from \"./constants\";\nimport { createAppointmentAdapter } from \"./appointmentAdapter\";\nimport { getOverflowIndicatorColor } from \"../../renovation/ui/scheduler/appointment/overflow_indicator/utils\";\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\nexport class CompactAppointmentsHelper {\n  constructor(instance) {\n    this.instance = instance;\n    this.elements = [];\n  }\n\n  render(options) {\n    var {\n      isCompact: isCompact,\n      items: items,\n      buttonColor: buttonColor\n    } = options;\n\n    var template = this._createTemplate(items.data.length, isCompact);\n\n    var button = this._createCompactButton(template, options);\n\n    var $button = button.$element();\n\n    this._makeBackgroundColor($button, items.colors, buttonColor);\n\n    this._makeBackgroundDarker($button);\n\n    this.elements.push($button);\n    $button.data(\"items\", this._createTooltipInfos(items));\n    return $button;\n  }\n\n  clear() {\n    this.elements.forEach(button => {\n      button.detach();\n      button.remove();\n    });\n    this.elements = [];\n  }\n\n  _createTooltipInfos(items) {\n    return items.data.map((appointment, index) => {\n      var _items$settings;\n\n      var targetedAdapter = createAppointmentAdapter(appointment, this.instance._dataAccessors, this.instance.timeZoneCalculator).clone();\n\n      if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\n        var {\n          info: info\n        } = items.settings[index];\n        targetedAdapter.startDate = info.sourceAppointment.startDate;\n        targetedAdapter.endDate = info.sourceAppointment.endDate;\n      }\n\n      return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index]);\n    });\n  }\n\n  _onButtonClick(e, options) {\n    var $button = $(e.element);\n    this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options, $button));\n  }\n\n  _getExtraOptionsForTooltip(options, $appointmentCollector) {\n    return {\n      clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\n      dragBehavior: options.allowDrag && this._createTooltipDragBehavior($appointmentCollector).bind(this),\n      dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\n      isButtonClick: true\n    };\n  }\n\n  _clickEvent(onAppointmentClick) {\n    return e => {\n      var config = {\n        itemData: e.itemData.appointment,\n        itemElement: e.itemElement,\n        targetedAppointment: e.itemData.targetedAppointment\n      };\n      var createClickEvent = extendFromObject(this.instance.fire(\"mapAppointmentFields\", config), e, false);\n      delete createClickEvent.itemData;\n      delete createClickEvent.itemIndex;\n      delete createClickEvent.itemElement;\n      onAppointmentClick(createClickEvent);\n    };\n  }\n\n  _createTooltipDragBehavior($appointmentCollector) {\n    return e => {\n      var $element = $(e.element);\n      var workSpace = this.instance.getWorkSpace();\n      var initialPosition = locate($appointmentCollector);\n      var options = {\n        filter: \".\".concat(LIST_ITEM_CLASS),\n        isSetCursorOffset: true,\n        initialPosition: initialPosition,\n        getItemData: itemElement => {\n          var _$$data;\n\n          return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment;\n        },\n        getItemSettings: (_, event) => event.itemSettings\n      };\n\n      workSpace._createDragBehaviorBase($element, options);\n    };\n  }\n\n  _getCollectorOffset(width, cellWidth) {\n    return cellWidth - width - this._getCollectorRightOffset();\n  }\n\n  _getCollectorRightOffset() {\n    return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET;\n  }\n\n  _makeBackgroundDarker(button) {\n    button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"));\n  }\n\n  _makeBackgroundColor($button, colors, color) {\n    when.apply(null, colors).done(function () {\n      this._makeBackgroundColorCore($button, color, [...arguments]);\n    }.bind(this));\n  }\n\n  _makeBackgroundColorCore($button, color, itemColors) {\n    color && color.done(color => {\n      var backgroundColor = getOverflowIndicatorColor(color, itemColors);\n\n      if (backgroundColor) {\n        $button.css(\"backgroundColor\", backgroundColor);\n      }\n    });\n  }\n\n  _setPosition(element, position) {\n    move(element, {\n      top: position.top,\n      left: position.left\n    });\n  }\n\n  _createCompactButton(template, options) {\n    var $button = this._createCompactButtonElement(options);\n\n    return this.instance._createComponent($button, Button, {\n      type: \"default\",\n      width: options.width,\n      height: options.height,\n      onClick: e => this._onButtonClick(e, options),\n      template: this._renderTemplate(template, options.items, options.isCompact)\n    });\n  }\n\n  _createCompactButtonElement(_ref) {\n    var {\n      isCompact: isCompact,\n      $container: $container,\n      coordinates: coordinates\n    } = _ref;\n    var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\n\n    this._setPosition(result, coordinates);\n\n    return result;\n  }\n\n  _renderTemplate(template, items, isCompact) {\n    return new FunctionTemplate(options => template.render({\n      model: {\n        appointmentCount: items.data.length,\n        isCompact: isCompact\n      },\n      container: options.container\n    }));\n  }\n\n  _createTemplate(count, isCompact) {\n    this._initButtonTemplate(count, isCompact);\n\n    return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\");\n  }\n\n  _initButtonTemplate(count, isCompact) {\n    this.instance._templateManager.addDefaultTemplates({\n      appointmentCollector: new FunctionTemplate(options => this._createButtonTemplate(count, $(options.container), isCompact))\n    });\n  }\n\n  _createButtonTemplate(appointmentCount, element, isCompact) {\n    var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\n    return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS);\n  }\n\n}","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/scheduler/compactAppointmentsHelper.js"],"names":["$","Button","move","locate","messageLocalization","FunctionTemplate","when","extendFromObject","getBoundingRect","AppointmentTooltipInfo","LIST_ITEM_DATA_KEY","LIST_ITEM_CLASS","createAppointmentAdapter","getOverflowIndicatorColor","APPOINTMENT_COLLECTOR_CLASS","COMPACT_APPOINTMENT_COLLECTOR_CLASS","APPOINTMENT_COLLECTOR_CONTENT_CLASS","WEEK_VIEW_COLLECTOR_OFFSET","COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET","CompactAppointmentsHelper","constructor","instance","elements","render","options","isCompact","items","buttonColor","template","_createTemplate","data","length","button","_createCompactButton","$button","$element","_makeBackgroundColor","colors","_makeBackgroundDarker","push","_createTooltipInfos","clear","forEach","detach","remove","map","appointment","index","_items$settings","targetedAdapter","_dataAccessors","timeZoneCalculator","clone","settings","info","startDate","sourceAppointment","endDate","source","_onButtonClick","e","element","showAppointmentTooltipCore","_getExtraOptionsForTooltip","$appointmentCollector","clickEvent","_clickEvent","onAppointmentClick","bind","dragBehavior","allowDrag","_createTooltipDragBehavior","dropDownAppointmentTemplate","option","isButtonClick","config","itemData","itemElement","targetedAppointment","createClickEvent","fire","itemIndex","workSpace","getWorkSpace","initialPosition","filter","concat","isSetCursorOffset","getItemData","_$$data","getItemSettings","_","event","itemSettings","_createDragBehaviorBase","_getCollectorOffset","width","cellWidth","_getCollectorRightOffset","getRenderingStrategyInstance","_isCompactTheme","css","get","color","apply","done","_makeBackgroundColorCore","arguments","itemColors","backgroundColor","_setPosition","position","top","left","_createCompactButtonElement","_createComponent","type","height","onClick","_renderTemplate","_ref","$container","coordinates","result","addClass","toggleClass","appendTo","model","appointmentCount","container","count","_initButtonTemplate","_getAppointmentTemplate","_templateManager","addDefaultTemplates","appointmentCollector","_createButtonTemplate","text","getFormatter","append"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/compactAppointmentsHelper.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport Button from \"../button\";\r\nimport {\r\n    move,\r\n    locate\r\n} from \"../../animation/translator\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    FunctionTemplate\r\n} from \"../../core/templates/function_template\";\r\nimport {\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    extendFromObject\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    getBoundingRect\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    AppointmentTooltipInfo\r\n} from \"./dataStructures\";\r\nimport {\r\n    LIST_ITEM_DATA_KEY,\r\n    LIST_ITEM_CLASS\r\n} from \"./constants\";\r\nimport {\r\n    createAppointmentAdapter\r\n} from \"./appointmentAdapter\";\r\nimport {\r\n    getOverflowIndicatorColor\r\n} from \"../../renovation/ui/scheduler/appointment/overflow_indicator/utils\";\r\nvar APPOINTMENT_COLLECTOR_CLASS = \"dx-scheduler-appointment-collector\";\r\nvar COMPACT_APPOINTMENT_COLLECTOR_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-compact\";\r\nvar APPOINTMENT_COLLECTOR_CONTENT_CLASS = APPOINTMENT_COLLECTOR_CLASS + \"-content\";\r\nvar WEEK_VIEW_COLLECTOR_OFFSET = 5;\r\nvar COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET = 1;\r\nexport class CompactAppointmentsHelper {\r\n    constructor(instance) {\r\n        this.instance = instance;\r\n        this.elements = []\r\n    }\r\n    render(options) {\r\n        var {\r\n            isCompact: isCompact,\r\n            items: items,\r\n            buttonColor: buttonColor\r\n        } = options;\r\n        var template = this._createTemplate(items.data.length, isCompact);\r\n        var button = this._createCompactButton(template, options);\r\n        var $button = button.$element();\r\n        this._makeBackgroundColor($button, items.colors, buttonColor);\r\n        this._makeBackgroundDarker($button);\r\n        this.elements.push($button);\r\n        $button.data(\"items\", this._createTooltipInfos(items));\r\n        return $button\r\n    }\r\n    clear() {\r\n        this.elements.forEach(button => {\r\n            button.detach();\r\n            button.remove()\r\n        });\r\n        this.elements = []\r\n    }\r\n    _createTooltipInfos(items) {\r\n        return items.data.map((appointment, index) => {\r\n            var _items$settings;\r\n            var targetedAdapter = createAppointmentAdapter(appointment, this.instance._dataAccessors, this.instance.timeZoneCalculator).clone();\r\n            if ((null === (_items$settings = items.settings) || void 0 === _items$settings ? void 0 : _items$settings.length) > 0) {\r\n                var {\r\n                    info: info\r\n                } = items.settings[index];\r\n                targetedAdapter.startDate = info.sourceAppointment.startDate;\r\n                targetedAdapter.endDate = info.sourceAppointment.endDate\r\n            }\r\n            return new AppointmentTooltipInfo(appointment, targetedAdapter.source(), items.colors[index], items.settings[index])\r\n        })\r\n    }\r\n    _onButtonClick(e, options) {\r\n        var $button = $(e.element);\r\n        this.instance.showAppointmentTooltipCore($button, $button.data(\"items\"), this._getExtraOptionsForTooltip(options, $button))\r\n    }\r\n    _getExtraOptionsForTooltip(options, $appointmentCollector) {\r\n        return {\r\n            clickEvent: this._clickEvent(options.onAppointmentClick).bind(this),\r\n            dragBehavior: options.allowDrag && this._createTooltipDragBehavior($appointmentCollector).bind(this),\r\n            dropDownAppointmentTemplate: this.instance.option().dropDownAppointmentTemplate,\r\n            isButtonClick: true\r\n        }\r\n    }\r\n    _clickEvent(onAppointmentClick) {\r\n        return e => {\r\n            var config = {\r\n                itemData: e.itemData.appointment,\r\n                itemElement: e.itemElement,\r\n                targetedAppointment: e.itemData.targetedAppointment\r\n            };\r\n            var createClickEvent = extendFromObject(this.instance.fire(\"mapAppointmentFields\", config), e, false);\r\n            delete createClickEvent.itemData;\r\n            delete createClickEvent.itemIndex;\r\n            delete createClickEvent.itemElement;\r\n            onAppointmentClick(createClickEvent)\r\n        }\r\n    }\r\n    _createTooltipDragBehavior($appointmentCollector) {\r\n        return e => {\r\n            var $element = $(e.element);\r\n            var workSpace = this.instance.getWorkSpace();\r\n            var initialPosition = locate($appointmentCollector);\r\n            var options = {\r\n                filter: \".\".concat(LIST_ITEM_CLASS),\r\n                isSetCursorOffset: true,\r\n                initialPosition: initialPosition,\r\n                getItemData: itemElement => {\r\n                    var _$$data;\r\n                    return null === (_$$data = $(itemElement).data(LIST_ITEM_DATA_KEY)) || void 0 === _$$data ? void 0 : _$$data.appointment\r\n                },\r\n                getItemSettings: (_, event) => event.itemSettings\r\n            };\r\n            workSpace._createDragBehaviorBase($element, options)\r\n        }\r\n    }\r\n    _getCollectorOffset(width, cellWidth) {\r\n        return cellWidth - width - this._getCollectorRightOffset()\r\n    }\r\n    _getCollectorRightOffset() {\r\n        return this.instance.getRenderingStrategyInstance()._isCompactTheme() ? COMPACT_THEME_WEEK_VIEW_COLLECTOR_OFFSET : WEEK_VIEW_COLLECTOR_OFFSET\r\n    }\r\n    _makeBackgroundDarker(button) {\r\n        button.css(\"boxShadow\", \"inset \".concat(getBoundingRect(button.get(0)).width, \"px 0 0 0 rgba(0, 0, 0, 0.3)\"))\r\n    }\r\n    _makeBackgroundColor($button, colors, color) {\r\n        when.apply(null, colors).done(function() {\r\n            this._makeBackgroundColorCore($button, color, [...arguments])\r\n        }.bind(this))\r\n    }\r\n    _makeBackgroundColorCore($button, color, itemColors) {\r\n        color && color.done(color => {\r\n            var backgroundColor = getOverflowIndicatorColor(color, itemColors);\r\n            if (backgroundColor) {\r\n                $button.css(\"backgroundColor\", backgroundColor)\r\n            }\r\n        })\r\n    }\r\n    _setPosition(element, position) {\r\n        move(element, {\r\n            top: position.top,\r\n            left: position.left\r\n        })\r\n    }\r\n    _createCompactButton(template, options) {\r\n        var $button = this._createCompactButtonElement(options);\r\n        return this.instance._createComponent($button, Button, {\r\n            type: \"default\",\r\n            width: options.width,\r\n            height: options.height,\r\n            onClick: e => this._onButtonClick(e, options),\r\n            template: this._renderTemplate(template, options.items, options.isCompact)\r\n        })\r\n    }\r\n    _createCompactButtonElement(_ref) {\r\n        var {\r\n            isCompact: isCompact,\r\n            $container: $container,\r\n            coordinates: coordinates\r\n        } = _ref;\r\n        var result = $(\"<div>\").addClass(APPOINTMENT_COLLECTOR_CLASS).toggleClass(COMPACT_APPOINTMENT_COLLECTOR_CLASS, isCompact).appendTo($container);\r\n        this._setPosition(result, coordinates);\r\n        return result\r\n    }\r\n    _renderTemplate(template, items, isCompact) {\r\n        return new FunctionTemplate(options => template.render({\r\n            model: {\r\n                appointmentCount: items.data.length,\r\n                isCompact: isCompact\r\n            },\r\n            container: options.container\r\n        }))\r\n    }\r\n    _createTemplate(count, isCompact) {\r\n        this._initButtonTemplate(count, isCompact);\r\n        return this.instance._getAppointmentTemplate(\"appointmentCollectorTemplate\")\r\n    }\r\n    _initButtonTemplate(count, isCompact) {\r\n        this.instance._templateManager.addDefaultTemplates({\r\n            appointmentCollector: new FunctionTemplate(options => this._createButtonTemplate(count, $(options.container), isCompact))\r\n        })\r\n    }\r\n    _createButtonTemplate(appointmentCount, element, isCompact) {\r\n        var text = isCompact ? appointmentCount : messageLocalization.getFormatter(\"dxScheduler-moreAppointments\")(appointmentCount);\r\n        return element.append($(\"<span>\").text(text)).addClass(APPOINTMENT_COLLECTOR_CONTENT_CLASS)\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}