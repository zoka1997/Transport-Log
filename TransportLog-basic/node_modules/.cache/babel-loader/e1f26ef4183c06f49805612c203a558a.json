{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.validating.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getOuterWidth, getWidth, getOuterHeight, setHeight } from \"../../core/utils/size\";\nimport $ from \"../../core/renderer\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport modules from \"./ui.grid_core.modules\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport { createObjectWithChanges } from \"../../data/array_utils\";\nimport { deferUpdate, equalByValue, getKeyHash } from \"../../core/utils/common\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isDefined, isEmptyObject, isObject } from \"../../core/utils/type\";\nimport { extend } from \"../../core/utils/extend\";\nimport { focused } from \"../widget/selectors\";\nimport messageLocalization from \"../../localization/message\";\nimport Button from \"../button\";\nimport pointerEvents from \"../../events/pointer\";\nimport ValidationEngine from \"../validation_engine\";\nimport Validator from \"../validator\";\nimport Overlay from \"../overlay/ui.overlay\";\nimport errors from \"../widget/ui.errors\";\nimport { Deferred, when, fromPromise } from \"../../core/utils/deferred\";\nimport LoadIndicator from \"../load_indicator\";\nimport { encodeHtml } from \"../../core/utils/string\";\nimport browser from \"../../core/utils/browser\";\nvar INVALIDATE_CLASS = \"invalid\";\nvar REVERT_TOOLTIP_CLASS = \"revert-tooltip\";\nvar ROWS_VIEW_CLASS = \"rowsview\";\nvar INVALID_MESSAGE_CLASS = \"dx-invalid-message\";\nvar WIDGET_INVALID_MESSAGE_CLASS = \"invalid-message\";\nvar INVALID_MESSAGE_ALWAYS_CLASS = \"dx-invalid-message-always\";\nvar REVERT_BUTTON_CLASS = \"dx-revert-button\";\nvar VALIDATOR_CLASS = \"validator\";\nvar PENDING_INDICATOR_CLASS = \"dx-pending-indicator\";\nvar VALIDATION_PENDING_CLASS = \"dx-validation-pending\";\nvar CONTENT_CLASS = \"content\";\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\nvar PADDING_BETWEEN_TOOLTIPS = 2;\nvar EDIT_MODE_ROW = \"row\";\nvar EDIT_MODE_FORM = \"form\";\nvar EDIT_MODE_BATCH = \"batch\";\nvar EDIT_MODE_CELL = \"cell\";\nvar EDIT_MODE_POPUP = \"popup\";\nvar GROUP_CELL_CLASS = \"dx-group-cell\";\nvar FORM_BASED_MODES = [EDIT_MODE_POPUP, EDIT_MODE_FORM];\nvar COMMAND_TRANSPARENT = \"transparent\";\nvar VALIDATION_STATUS = {\n  valid: \"valid\",\n  invalid: \"invalid\",\n  pending: \"pending\"\n};\nvar EDIT_DATA_INSERT_TYPE = \"insert\";\nvar EDIT_DATA_REMOVE_TYPE = \"remove\";\nvar VALIDATION_CANCELLED = \"cancel\";\n\nvar validationResultIsValid = function (result) {\n  return isDefined(result) && result !== VALIDATION_CANCELLED;\n};\n\nvar cellValueShouldBeValidated = function (value, rowOptions) {\n  return void 0 !== value || void 0 === value && rowOptions && !rowOptions.isNewRow;\n};\n\nvar ValidatingController = modules.Controller.inherit({\n  init: function () {\n    this._editingController = this.getController(\"editing\");\n    this.createAction(\"onRowValidating\");\n\n    if (!this._validationState) {\n      this.initValidationState();\n    }\n  },\n\n  initValidationState() {\n    this._validationState = [];\n    this._validationStateCache = {};\n  },\n\n  _rowIsValidated: function (change) {\n    var validationData = this._getValidationData(null === change || void 0 === change ? void 0 : change.key);\n\n    return !!validationData && !!validationData.validated;\n  },\n  _getValidationData: function (key, create) {\n    var keyHash = getKeyHash(key);\n    var isObjectKeyHash = isObject(keyHash);\n    var validationData;\n\n    if (isObjectKeyHash) {\n      validationData = this._validationState.filter(data => equalByValue(data.key, key))[0];\n    } else {\n      validationData = this._validationStateCache[keyHash];\n    }\n\n    if (!validationData && create) {\n      validationData = {\n        key: key,\n        isValid: true\n      };\n\n      this._validationState.push(validationData);\n\n      if (!isObjectKeyHash) {\n        this._validationStateCache[keyHash] = validationData;\n      }\n    }\n\n    return validationData;\n  },\n  _getBrokenRules: function (validationData, validationResults) {\n    var brokenRules;\n\n    if (validationResults) {\n      brokenRules = validationResults.brokenRules || validationResults.brokenRule && [validationResults.brokenRule];\n    } else {\n      brokenRules = validationData.brokenRules || [];\n    }\n\n    return brokenRules;\n  },\n  _rowValidating: function (validationData, validationResults) {\n    var deferred = new Deferred();\n\n    var change = this._editingController.getChangeByKey(null === validationData || void 0 === validationData ? void 0 : validationData.key);\n\n    var brokenRules = this._getBrokenRules(validationData, validationResults);\n\n    var isValid = validationResults ? validationResults.isValid : validationData.isValid;\n    var parameters = {\n      brokenRules: brokenRules,\n      isValid: isValid,\n      key: change.key,\n      newData: change.data,\n      oldData: this._editingController._getOldData(change.key),\n      promise: null,\n      errorText: this.getHiddenValidatorsErrorText(brokenRules)\n    };\n    this.executeAction(\"onRowValidating\", parameters);\n    when(fromPromise(parameters.promise)).always(function () {\n      validationData.isValid = parameters.isValid;\n      validationData.errorText = parameters.errorText;\n      deferred.resolve(parameters);\n    });\n    return deferred.promise();\n  },\n  getHiddenValidatorsErrorText: function (brokenRules) {\n    var brokenRulesMessages = [];\n    each(brokenRules, function (_, brokenRule) {\n      var column = brokenRule.column;\n      var isGroupExpandColumn = column && void 0 !== column.groupIndex && !column.showWhenGrouped;\n      var isVisibleColumn = column && column.visible;\n\n      if (!brokenRule.validator.$element().parent().length && (!isVisibleColumn || isGroupExpandColumn)) {\n        brokenRulesMessages.push(brokenRule.message);\n      }\n    });\n    return brokenRulesMessages.join(\", \");\n  },\n  validate: function (isFull) {\n    var isValid = true;\n    var editingController = this._editingController;\n    var deferred = new Deferred();\n    var completeList = [];\n    var editMode = editingController.getEditMode();\n    isFull = isFull || editMode === EDIT_MODE_ROW;\n\n    if (this._isValidationInProgress) {\n      return deferred.resolve(false).promise();\n    }\n\n    this._isValidationInProgress = true;\n\n    if (isFull) {\n      editingController.addDeferred(deferred);\n      var changes = editingController.getChanges();\n      each(changes, (index, _ref) => {\n        var {\n          type: type,\n          key: key\n        } = _ref;\n\n        if (\"remove\" !== type) {\n          var validationData = this._getValidationData(key, true);\n\n          var validationResult = this.validateGroup(validationData);\n          completeList.push(validationResult);\n          validationResult.done(validationResult => {\n            validationData.validated = true;\n            isValid = isValid && validationResult.isValid;\n          });\n        }\n      });\n    } else if (this._currentCellValidator) {\n      var validationResult = this.validateGroup(this._currentCellValidator._findGroup());\n      completeList.push(validationResult);\n      validationResult.done(validationResult => {\n        isValid = validationResult.isValid;\n      });\n    }\n\n    when(...completeList).done(() => {\n      this._isValidationInProgress = false;\n      deferred.resolve(isValid);\n    });\n    return deferred.promise();\n  },\n  validateGroup: function (validationData) {\n    var _validationResult;\n\n    var result = new Deferred();\n    var validateGroup = validationData && ValidationEngine.getGroupConfig(validationData);\n    var validationResult;\n\n    if (null !== validateGroup && void 0 !== validateGroup && validateGroup.validators.length) {\n      this.resetRowValidationResults(validationData);\n      validationResult = ValidationEngine.validateGroup(validationData);\n    }\n\n    when((null === (_validationResult = validationResult) || void 0 === _validationResult ? void 0 : _validationResult.complete) || validationResult).done(validationResult => {\n      when(this._rowValidating(validationData, validationResult)).done(result.resolve);\n    });\n    return result.promise();\n  },\n  isRowDataModified: change => !isEmptyObject(change.data),\n  updateValidationState: function (change) {\n    var editMode = this._editingController.getEditMode();\n\n    var key = change.key;\n\n    var validationData = this._getValidationData(key, true);\n\n    if (-1 === FORM_BASED_MODES.indexOf(editMode)) {\n      if (change.type === EDIT_DATA_INSERT_TYPE && !this.isRowDataModified(change)) {\n        validationData.isValid = true;\n        return;\n      }\n\n      this.setDisableApplyValidationResults(true);\n      var groupConfig = ValidationEngine.getGroupConfig(validationData);\n\n      if (groupConfig) {\n        var validationResult = ValidationEngine.validateGroup(validationData);\n        when(validationResult.complete || validationResult).done(validationResult => {\n          validationData.isValid = validationResult.isValid;\n          validationData.brokenRules = validationResult.brokenRules;\n        });\n      } else if (!validationData.brokenRules || !validationData.brokenRules.length) {\n        validationData.isValid = true;\n      }\n\n      this.setDisableApplyValidationResults(false);\n    } else {\n      validationData.isValid = true;\n    }\n  },\n  setValidator: function (validator) {\n    this._currentCellValidator = validator;\n  },\n  renderCellPendingIndicator: function ($container) {\n    var $indicator = $container.find(\".\" + PENDING_INDICATOR_CLASS);\n\n    if (!$indicator.length) {\n      var $indicatorContainer = $container;\n      $indicator = $(\"<div>\").appendTo($indicatorContainer).addClass(PENDING_INDICATOR_CLASS);\n\n      this._createComponent($indicator, LoadIndicator);\n\n      $container.addClass(VALIDATION_PENDING_CLASS);\n    }\n  },\n  disposeCellPendingIndicator: function ($container) {\n    var $indicator = $container.find(\".\" + PENDING_INDICATOR_CLASS);\n\n    if ($indicator.length) {\n      var indicator = LoadIndicator.getInstance($indicator);\n\n      if (indicator) {\n        indicator.dispose();\n        indicator.$element().remove();\n      }\n\n      $container.removeClass(VALIDATION_PENDING_CLASS);\n    }\n  },\n  validationStatusChanged: function (result) {\n    var validator = result.validator;\n    var validationGroup = validator.option(\"validationGroup\");\n    var column = validator.option(\"dataGetter\")().column;\n    this.updateCellValidationResult({\n      rowKey: validationGroup.key,\n      columnIndex: column.index,\n      validationResult: result\n    });\n  },\n  validatorInitialized: function (arg) {\n    arg.component.on(\"validating\", this.validationStatusChanged.bind(this));\n    arg.component.on(\"validated\", this.validationStatusChanged.bind(this));\n  },\n  validatorDisposing: function (arg) {\n    var validator = arg.component;\n    var validationGroup = validator.option(\"validationGroup\");\n    var column = validator.option(\"dataGetter\")().column;\n    var result = this.getCellValidationResult({\n      rowKey: null === validationGroup || void 0 === validationGroup ? void 0 : validationGroup.key,\n      columnIndex: column.index\n    });\n\n    if (validationResultIsValid(result) && result.status === VALIDATION_STATUS.pending) {\n      this.cancelCellValidationResult({\n        change: validationGroup,\n        columnIndex: column.index\n      });\n    }\n  },\n  applyValidationResult: function ($container, result) {\n    var validator = result.validator;\n    var validationGroup = validator.option(\"validationGroup\");\n    var column = validator.option(\"dataGetter\")().column;\n    result.brokenRules && result.brokenRules.forEach(rule => {\n      rule.columnIndex = column.index;\n      rule.column = column;\n    });\n\n    if ($container) {\n      var validationResult = this.getCellValidationResult({\n        rowKey: validationGroup.key,\n        columnIndex: column.index\n      });\n      var requestIsDisabled = validationResultIsValid(validationResult) && validationResult.disabledPendingId === result.id;\n\n      if (this._disableApplyValidationResults || requestIsDisabled) {\n        return;\n      }\n\n      if (result.status === VALIDATION_STATUS.invalid) {\n        var $focus = $container.find(\":focus\");\n\n        if (!focused($focus)) {\n          eventsEngine.trigger($focus, \"focus\");\n          eventsEngine.trigger($focus, pointerEvents.down);\n        }\n      }\n\n      var editor = !column.editCellTemplate && this.getController(\"editorFactory\").getEditorInstance($container);\n\n      if (result.status === VALIDATION_STATUS.pending) {\n        if (editor) {\n          editor.option(\"validationStatus\", VALIDATION_STATUS.pending);\n        } else {\n          this.renderCellPendingIndicator($container);\n        }\n      } else if (editor) {\n        editor.option(\"validationStatus\", VALIDATION_STATUS.valid);\n      } else {\n        this.disposeCellPendingIndicator($container);\n      }\n\n      $container.toggleClass(this.addWidgetPrefix(INVALIDATE_CLASS), result.status === VALIDATION_STATUS.invalid);\n    }\n  },\n  _syncInternalEditingData: function (parameters) {\n    var _parameters$row;\n\n    var editingController = this._editingController;\n    var change = editingController.getChangeByKey(parameters.key);\n\n    var oldDataFromState = editingController._getOldData(parameters.key);\n\n    var oldData = null === (_parameters$row = parameters.row) || void 0 === _parameters$row ? void 0 : _parameters$row.oldData;\n\n    if (change && oldData && !oldDataFromState) {\n      editingController._addInternalData({\n        key: parameters.key,\n        oldData: oldData\n      });\n    }\n  },\n  createValidator: function (parameters, $container) {\n    var editingController = this._editingController;\n    var column = parameters.column;\n    var showEditorAlways = column.showEditorAlways;\n\n    if (isDefined(column.command) || !column.validationRules || !Array.isArray(column.validationRules) || !column.validationRules.length) {\n      return;\n    }\n\n    var editIndex = editingController.getIndexByKey(parameters.key, editingController.getChanges());\n    var needCreateValidator = editIndex > -1;\n\n    if (!needCreateValidator) {\n      if (!showEditorAlways) {\n        var columnsController = this.getController(\"columns\");\n        var visibleColumns = (null === columnsController || void 0 === columnsController ? void 0 : columnsController.getVisibleColumns()) || [];\n        showEditorAlways = visibleColumns.some(function (column) {\n          return column.showEditorAlways;\n        });\n      }\n\n      var isEditRow = equalByValue(this.option(\"editing.editRowKey\"), parameters.key);\n      var isCellOrBatchEditingAllowed = editingController.isCellOrBatchEditMode() && editingController.allowUpdating({\n        row: parameters.row\n      });\n      needCreateValidator = isEditRow || isCellOrBatchEditingAllowed && showEditorAlways;\n\n      if (isCellOrBatchEditingAllowed && showEditorAlways) {\n        var _parameters$row$oldDa, _parameters$row2;\n\n        editingController._addInternalData({\n          key: parameters.key,\n          oldData: null !== (_parameters$row$oldDa = null === (_parameters$row2 = parameters.row) || void 0 === _parameters$row2 ? void 0 : _parameters$row2.oldData) && void 0 !== _parameters$row$oldDa ? _parameters$row$oldDa : parameters.data\n        });\n      }\n    }\n\n    if (needCreateValidator) {\n      if ($container && !$container.length) {\n        errors.log(\"E1050\");\n        return;\n      }\n\n      this._syncInternalEditingData(parameters);\n\n      var validationData = this._getValidationData(parameters.key, true);\n\n      var getValue = () => {\n        var change = editingController.getChangeByKey(null === validationData || void 0 === validationData ? void 0 : validationData.key);\n        var value = column.calculateCellValue((null === change || void 0 === change ? void 0 : change.data) || {});\n        return void 0 !== value ? value : parameters.value;\n      };\n\n      var useDefaultValidator = $container && $container.hasClass(\"dx-widget\");\n      $container && $container.addClass(this.addWidgetPrefix(VALIDATOR_CLASS));\n      var validator = new Validator($container || $(\"<div>\"), {\n        name: column.caption,\n        validationRules: extend(true, [], column.validationRules),\n        validationGroup: validationData,\n        adapter: useDefaultValidator ? null : {\n          getValue: getValue,\n          applyValidationResults: result => {\n            this.applyValidationResult($container, result);\n          }\n        },\n        dataGetter: function () {\n          var key = null === validationData || void 0 === validationData ? void 0 : validationData.key;\n          var change = editingController.getChangeByKey(key);\n\n          var oldData = editingController._getOldData(key);\n\n          return {\n            data: createObjectWithChanges(oldData, null === change || void 0 === change ? void 0 : change.data),\n            column: column\n          };\n        },\n        onInitialized: this.validatorInitialized.bind(this),\n        onDisposing: this.validatorDisposing.bind(this)\n      });\n\n      if (useDefaultValidator) {\n        var adapter = validator.option(\"adapter\");\n\n        if (adapter) {\n          adapter.getValue = getValue;\n          adapter.validationRequestsCallbacks = [];\n\n          adapter.bypass = () => parameters.row.isNewRow && !this._isValidationInProgress && !editingController.isCellModified(parameters);\n        }\n      }\n\n      return validator;\n    }\n  },\n  setDisableApplyValidationResults: function (flag) {\n    this._disableApplyValidationResults = flag;\n  },\n  getDisableApplyValidationResults: function () {\n    return this._disableApplyValidationResults;\n  },\n  isCurrentValidatorProcessing: function (_ref2) {\n    var {\n      rowKey: rowKey,\n      columnIndex: columnIndex\n    } = _ref2;\n    return this._currentCellValidator && equalByValue(this._currentCellValidator.option(\"validationGroup\").key, rowKey) && this._currentCellValidator.option(\"dataGetter\")().column.index === columnIndex;\n  },\n  validateCell: function (validator) {\n    var cellParams = {\n      rowKey: validator.option(\"validationGroup\").key,\n      columnIndex: validator.option(\"dataGetter\")().column.index\n    };\n    var validationResult = this.getCellValidationResult(cellParams);\n    var stateRestored = validationResultIsValid(validationResult);\n\n    if (!stateRestored) {\n      validationResult = validator.validate();\n    }\n\n    var deferred = new Deferred();\n    var adapter = validator.option(\"adapter\");\n\n    if (stateRestored && validationResult.status === VALIDATION_STATUS.pending) {\n      this.updateCellValidationResult(cellParams);\n      adapter.applyValidationResults(validationResult);\n    }\n\n    when(validationResult.complete || validationResult).done(validationResult => {\n      stateRestored && adapter.applyValidationResults(validationResult);\n      deferred.resolve(validationResult);\n    });\n    return deferred.promise();\n  },\n  updateCellValidationResult: function (_ref3) {\n    var {\n      rowKey: rowKey,\n      columnIndex: columnIndex,\n      validationResult: validationResult\n    } = _ref3;\n\n    var validationData = this._getValidationData(rowKey);\n\n    if (!validationData) {\n      return;\n    }\n\n    if (!validationData.validationResults) {\n      validationData.validationResults = {};\n    }\n\n    var result;\n\n    if (validationResult) {\n      result = extend({}, validationResult);\n      validationData.validationResults[columnIndex] = result;\n\n      if (validationResult.status === VALIDATION_STATUS.pending) {\n        if (this._editingController.getEditMode() === EDIT_MODE_CELL) {\n          result.deferred = new Deferred();\n          result.complete.always(() => {\n            result.deferred.resolve();\n          });\n\n          this._editingController.addDeferred(result.deferred);\n        }\n\n        if (this._disableApplyValidationResults) {\n          result.disabledPendingId = validationResult.id;\n          return;\n        }\n      }\n    } else {\n      result = validationData.validationResults[columnIndex];\n    }\n\n    if (result && result.disabledPendingId) {\n      delete result.disabledPendingId;\n    }\n  },\n  getCellValidationResult: function (_ref4) {\n    var _validationData$valid;\n\n    var {\n      rowKey: rowKey,\n      columnIndex: columnIndex\n    } = _ref4;\n\n    var validationData = this._getValidationData(rowKey, true);\n\n    return null === validationData || void 0 === validationData ? void 0 : null === (_validationData$valid = validationData.validationResults) || void 0 === _validationData$valid ? void 0 : _validationData$valid[columnIndex];\n  },\n  removeCellValidationResult: function (_ref5) {\n    var {\n      change: change,\n      columnIndex: columnIndex\n    } = _ref5;\n\n    var validationData = this._getValidationData(null === change || void 0 === change ? void 0 : change.key);\n\n    if (validationData && validationData.validationResults) {\n      this.cancelCellValidationResult({\n        change: change,\n        columnIndex: columnIndex\n      });\n      delete validationData.validationResults[columnIndex];\n    }\n  },\n  cancelCellValidationResult: function (_ref6) {\n    var {\n      change: change,\n      columnIndex: columnIndex\n    } = _ref6;\n\n    var validationData = this._getValidationData(change.key);\n\n    if (change && validationData.validationResults) {\n      var result = validationData.validationResults[columnIndex];\n\n      if (result) {\n        result.deferred && result.deferred.reject(VALIDATION_CANCELLED);\n        validationData.validationResults[columnIndex] = VALIDATION_CANCELLED;\n      }\n    }\n  },\n  resetRowValidationResults: function (validationData) {\n    if (validationData) {\n      validationData.validationResults && delete validationData.validationResults;\n      delete validationData.validated;\n    }\n  },\n  isInvalidCell: function (_ref7) {\n    var {\n      rowKey: rowKey,\n      columnIndex: columnIndex\n    } = _ref7;\n    var result = this.getCellValidationResult({\n      rowKey: rowKey,\n      columnIndex: columnIndex\n    });\n    return validationResultIsValid(result) && result.status === VALIDATION_STATUS.invalid;\n  },\n  getCellValidator: function (_ref8) {\n    var {\n      rowKey: rowKey,\n      columnIndex: columnIndex\n    } = _ref8;\n\n    var validationData = this._getValidationData(rowKey);\n\n    var groupConfig = validationData && ValidationEngine.getGroupConfig(validationData);\n    var validators = groupConfig && groupConfig.validators;\n    return validators && validators.filter(v => {\n      var column = v.option(\"dataGetter\")().column;\n      return column ? column.index === columnIndex : false;\n    })[0];\n  },\n  setCellValidationStatus: function (cellOptions) {\n    var validationResult = this.getCellValidationResult({\n      rowKey: cellOptions.key,\n      columnIndex: cellOptions.column.index\n    });\n\n    if (isDefined(validationResult)) {\n      cellOptions.validationStatus = validationResult !== VALIDATION_CANCELLED ? validationResult.status : VALIDATION_CANCELLED;\n    } else {\n      delete cellOptions.validationStatus;\n    }\n  }\n});\nexport var validatingModule = {\n  defaultOptions: function () {\n    return {\n      editing: {\n        texts: {\n          validationCancelChanges: messageLocalization.format(\"dxDataGrid-validationCancelChanges\")\n        }\n      }\n    };\n  },\n  controllers: {\n    validating: ValidatingController\n  },\n  extenders: {\n    controllers: {\n      editing: {\n        _addChange: function (changeParams) {\n          var change = this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n\n          if (change && changeParams.type !== EDIT_DATA_REMOVE_TYPE) {\n            validatingController.updateValidationState(change);\n          }\n\n          return change;\n        },\n        _handleChangesChange: function (args) {\n          this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n          args.value.forEach(change => {\n            if (void 0 === validatingController._getValidationData(change.key)) {\n              validatingController.updateValidationState(change);\n            }\n          });\n        },\n        _updateRowAndPageIndices: function () {\n          var that = this;\n          var startInsertIndex = that.getView(\"rowsView\").getTopVisibleItemIndex();\n          var rowIndex = startInsertIndex;\n          each(that.getChanges(), (_, _ref9) => {\n            var {\n              key: key,\n              type: type\n            } = _ref9;\n\n            var validationData = this.getController(\"validating\")._getValidationData(key);\n\n            if (validationData && !validationData.isValid && validationData.pageIndex !== that._pageIndex) {\n              validationData.pageIndex = that._pageIndex;\n\n              if (type === EDIT_DATA_INSERT_TYPE) {\n                validationData.rowIndex = startInsertIndex;\n              } else {\n                validationData.rowIndex = rowIndex;\n              }\n\n              rowIndex++;\n            }\n          });\n        },\n        _getValidationGroupsInForm: function (detailOptions) {\n          var validatingController = this.getController(\"validating\");\n\n          var validationData = validatingController._getValidationData(detailOptions.key, true);\n\n          return {\n            validationGroup: validationData\n          };\n        },\n        _validateEditFormAfterUpdate: function (row, isCustomSetCellValue) {\n          if (isCustomSetCellValue && this._editForm) {\n            this._editForm.validate();\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _prepareEditCell: function (params) {\n          var isNotCanceled = this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n\n          if (isNotCanceled && params.column.showEditorAlways) {\n            validatingController.updateValidationState({\n              key: params.key\n            });\n          }\n\n          return isNotCanceled;\n        },\n        processItems: function (items, changeType) {\n          var changes = this.getChanges();\n          var dataController = this.getController(\"data\");\n          var validatingController = this.getController(\"validating\");\n          items = this.callBase(items, changeType);\n          var itemsCount = items.length;\n\n          var addInValidItem = function (change, validationData) {\n            var data = {\n              key: change.key\n            };\n\n            var index = function (change, items) {\n              var index = -1;\n              var isInsert = change.type === EDIT_DATA_INSERT_TYPE;\n              var key = change.key;\n              each(items, function (i, item) {\n                if (equalByValue(key, isInsert ? item.key : dataController.keyOf(item))) {\n                  index = i;\n                  return false;\n                }\n              });\n              return index;\n            }(change, items);\n\n            if (index >= 0) {\n              return;\n            }\n\n            validationData.rowIndex = validationData.rowIndex > itemsCount ? validationData.rowIndex % itemsCount : validationData.rowIndex;\n            var rowIndex = validationData.rowIndex;\n            data[INSERT_INDEX] = 1;\n            items.splice(rowIndex, 0, data);\n          };\n\n          if (this.getEditMode() === EDIT_MODE_BATCH && \"prepend\" !== changeType && \"append\" !== changeType) {\n            changes.forEach(change => {\n              var key = change.key;\n\n              var validationData = validatingController._getValidationData(key);\n\n              if (validationData && change.type && validationData.pageIndex === this._pageIndex && (null === change || void 0 === change ? void 0 : change.pageIndex) !== this._pageIndex) {\n                addInValidItem(change, validationData);\n              }\n            });\n          }\n\n          return items;\n        },\n        processDataItem: function (item) {\n          var isInserted = item.data[INSERT_INDEX];\n          var key = isInserted ? item.data.key : item.key;\n          var editMode = this.getEditMode();\n\n          if (editMode === EDIT_MODE_BATCH && isInserted && key) {\n            var changes = this.getChanges();\n            var editIndex = gridCoreUtils.getIndexByKey(key, changes);\n\n            if (editIndex >= 0) {\n              var change = changes[editIndex];\n\n              if (change.type !== EDIT_DATA_INSERT_TYPE) {\n                var oldData = this._getOldData(change.key);\n\n                item.data = extend(true, {}, oldData, change.data);\n                item.key = key;\n              }\n            }\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _createInvisibleColumnValidators: function (changes) {\n          var that = this;\n          var validatingController = this.getController(\"validating\");\n          var columnsController = this.getController(\"columns\");\n          var columns = columnsController.getColumns();\n          var invisibleColumns = columnsController.getInvisibleColumns().filter(column => !column.isBand);\n          var groupColumns = columnsController.getGroupColumns().filter(column => !column.showWhenGrouped && -1 === invisibleColumns.indexOf(column));\n          var invisibleColumnValidators = [];\n\n          var isCellVisible = (column, rowKey) => this._dataController.getRowIndexByKey(rowKey) >= 0 && invisibleColumns.indexOf(column) < 0;\n\n          invisibleColumns.push(...groupColumns);\n\n          if (-1 === FORM_BASED_MODES.indexOf(this.getEditMode())) {\n            each(columns, function (_, column) {\n              changes.forEach(function (change) {\n                var data;\n\n                if (isCellVisible(column, change.key)) {\n                  return;\n                }\n\n                if (change.type === EDIT_DATA_INSERT_TYPE) {\n                  data = change.data;\n                } else if (\"update\" === change.type) {\n                  var oldData = that._getOldData(change.key);\n\n                  data = createObjectWithChanges(oldData, change.data);\n                }\n\n                if (data) {\n                  var validator = validatingController.createValidator({\n                    column: column,\n                    key: change.key,\n                    value: column.calculateCellValue(data)\n                  });\n\n                  if (validator) {\n                    invisibleColumnValidators.push(validator);\n                  }\n                }\n              });\n            });\n          }\n\n          return function () {\n            invisibleColumnValidators.forEach(function (validator) {\n              validator.dispose();\n            });\n          };\n        },\n        _beforeSaveEditData: function (change, editIndex) {\n          var result = this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n\n          var validationData = validatingController._getValidationData(null === change || void 0 === change ? void 0 : change.key);\n\n          if (change) {\n            var isValid = \"remove\" === change.type || validationData.isValid;\n            result = result || !isValid;\n          } else {\n            var disposeValidators = this._createInvisibleColumnValidators(this.getChanges());\n\n            result = new Deferred();\n            this.executeOperation(result, () => {\n              validatingController.validate(true).done(isFullValid => {\n                disposeValidators();\n\n                this._updateRowAndPageIndices();\n\n                switch (this.getEditMode()) {\n                  case EDIT_MODE_CELL:\n                    if (!isFullValid) {\n                      this._focusEditingCell();\n                    }\n\n                    break;\n\n                  case EDIT_MODE_BATCH:\n                    if (!isFullValid) {\n                      this._resetEditRowKey();\n\n                      this._resetEditColumnName();\n\n                      this.getController(\"data\").updateItems();\n                    }\n\n                }\n\n                result.resolve(!isFullValid);\n              });\n            });\n          }\n\n          return result.promise ? result.promise() : result;\n        },\n        _beforeEditCell: function (rowIndex, columnIndex, item) {\n          var result = this.callBase(rowIndex, columnIndex, item);\n\n          if (this.getEditMode() === EDIT_MODE_CELL) {\n            var $cell = this._rowsView._getCellElement(rowIndex, columnIndex);\n\n            var validator = $cell && $cell.data(\"dxValidator\");\n            var rowOptions = $cell && $cell.closest(\".dx-row\").data(\"options\");\n            var value = validator && validator.option(\"adapter\").getValue();\n\n            if (validator && cellValueShouldBeValidated(value, rowOptions)) {\n              var validatingController = this.getController(\"validating\");\n              var deferred = new Deferred();\n              when(validatingController.validateCell(validator), result).done((validationResult, result) => {\n                deferred.resolve(validationResult.status === VALIDATION_STATUS.valid && result);\n              });\n              return deferred.promise();\n            } else if (!validator) {\n              return result;\n            }\n          }\n        },\n        _afterSaveEditData: function (cancel) {\n          var $firstErrorRow;\n          var isCellEditMode = this.getEditMode() === EDIT_MODE_CELL;\n          each(this.getChanges(), (_, change) => {\n            var $errorRow = this._showErrorRow(change);\n\n            $firstErrorRow = $firstErrorRow || $errorRow;\n          });\n\n          if ($firstErrorRow) {\n            var scrollable = this._rowsView.getScrollable();\n\n            if (scrollable) {\n              scrollable.update();\n              scrollable.scrollToElement($firstErrorRow);\n            }\n          }\n\n          if (cancel && isCellEditMode && this._needUpdateRow()) {\n            var editRowIndex = this.getEditRowIndex();\n\n            this._dataController.updateItems({\n              changeType: \"update\",\n              rowIndices: [editRowIndex]\n            });\n\n            this._focusEditingCell();\n          } else if (!cancel) {\n            var shouldResetValidationState = true;\n\n            if (isCellEditMode) {\n              var columns = this.getController(\"columns\").getColumns();\n              var columnsWithValidatingEditors = columns.filter(col => {\n                var _col$validationRules;\n\n                return col.showEditorAlways && (null === (_col$validationRules = col.validationRules) || void 0 === _col$validationRules ? void 0 : _col$validationRules.length) > 0;\n              }).length > 0;\n              shouldResetValidationState = !columnsWithValidatingEditors;\n            }\n\n            if (shouldResetValidationState) {\n              this.getController(\"validating\").initValidationState();\n            }\n          }\n        },\n        _handleDataChanged: function (args) {\n          var validationState = this.getController(\"validating\")._validationState;\n\n          if (\"standard\" === this.option(\"scrolling.mode\")) {\n            this.resetRowAndPageIndices();\n          }\n\n          if (\"prepend\" === args.changeType) {\n            each(validationState, function (_, validationData) {\n              validationData.rowIndex += args.items.length;\n            });\n          }\n\n          this.callBase(args);\n        },\n        resetRowAndPageIndices: function () {\n          var validationState = this.getController(\"validating\")._validationState;\n\n          each(validationState, (_, validationData) => {\n            if (validationData.pageIndex !== this._pageIndex) {\n              delete validationData.pageIndex;\n              delete validationData.rowIndex;\n            }\n          });\n        },\n        _beforeCancelEditData: function () {\n          this.getController(\"validating\").initValidationState();\n          this.callBase();\n        },\n        _showErrorRow: function (change) {\n          var $popupContent;\n          var errorHandling = this.getController(\"errorHandling\");\n          var items = this.getController(\"data\").items();\n          var rowIndex = this.getIndexByKey(change.key, items);\n\n          var validationData = this.getController(\"validating\")._getValidationData(change.key);\n\n          if (!(null !== validationData && void 0 !== validationData && validationData.isValid) && null !== validationData && void 0 !== validationData && validationData.errorText && rowIndex >= 0) {\n            $popupContent = this.getPopupContent();\n            return errorHandling && errorHandling.renderErrorRow(null === validationData || void 0 === validationData ? void 0 : validationData.errorText, rowIndex, $popupContent);\n          }\n        },\n        updateFieldValue: function (e) {\n          var validatingController = this.getController(\"validating\");\n          var deferred = new Deferred();\n          validatingController.removeCellValidationResult({\n            change: this.getChangeByKey(e.key),\n            columnIndex: e.column.index\n          });\n          this.callBase.apply(this, arguments).done(() => {\n            var currentValidator = validatingController.getCellValidator({\n              rowKey: e.key,\n              columnIndex: e.column.index\n            });\n            when(currentValidator && validatingController.validateCell(currentValidator)).done(validationResult => {\n              this.getController(\"editorFactory\").refocus();\n              deferred.resolve(validationResult);\n            });\n          });\n          return deferred.promise();\n        },\n        highlightDataCell: function ($cell, parameters) {\n          this.callBase.apply(this, arguments);\n          var validatingController = this.getController(\"validating\");\n          validatingController.setCellValidationStatus(parameters);\n          var isEditableCell = !!parameters.setValue;\n          var cellModified = this.isCellModified(parameters);\n          var isValidated = isDefined(parameters.validationStatus);\n          var needValidation = cellModified && parameters.column.setCellValue || isEditableCell && !cellModified && !(parameters.row.isNewRow || !isValidated);\n\n          if (needValidation) {\n            var validator = $cell.data(\"dxValidator\");\n\n            if (validator) {\n              when(this.getController(\"validating\").validateCell(validator)).done(() => {\n                validatingController.setCellValidationStatus(parameters);\n              });\n            }\n          }\n        },\n        getChangeByKey: function (key) {\n          var changes = this.getChanges();\n          return changes[gridCoreUtils.getIndexByKey(key, changes)];\n        },\n        isCellModified: function (parameters) {\n          var cellModified = this.callBase(parameters);\n          var change = this.getChangeByKey(parameters.key);\n          var isCellInvalid = !!parameters.row && this.getController(\"validating\").isInvalidCell({\n            rowKey: parameters.key,\n            columnIndex: parameters.column.index\n          });\n          return cellModified || this.getController(\"validating\")._rowIsValidated(change) && isCellInvalid;\n        }\n      },\n      editorFactory: {\n        _showRevertButton: function ($container) {\n          if (!$container || !$container.length) {\n            return;\n          }\n\n          var $tooltipElement = this._rowsView.element().find(\".\" + this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\n\n          var $overlayContainer = $container.closest(\".\".concat(this.addWidgetPrefix(CONTENT_CLASS)));\n          $tooltipElement && $tooltipElement.remove();\n          $tooltipElement = $(\"<div>\").addClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS)).appendTo($container);\n          var tooltipOptions = {\n            animation: null,\n            visible: true,\n            width: \"auto\",\n            height: \"auto\",\n            shading: false,\n            container: $overlayContainer,\n            propagateOutsideClick: true,\n            hideOnOutsideClick: false,\n            copyRootClassesToWrapper: true,\n            _ignoreCopyRootClassesToWrapperDeprecation: true,\n            contentTemplate: () => {\n              var $buttonElement = $(\"<div>\").addClass(REVERT_BUTTON_CLASS);\n              var buttonOptions = {\n                icon: \"revert\",\n                hint: this.option(\"editing.texts.validationCancelChanges\"),\n                onClick: () => {\n                  this._editingController.cancelEditData();\n                }\n              };\n              return new Button($buttonElement, buttonOptions).$element();\n            },\n            position: {\n              my: \"left top\",\n              at: \"right top\",\n              offset: \"1 0\",\n              collision: \"flip\",\n              boundaryOffset: \"0 0\",\n              boundary: this._rowsView.element(),\n              of: $container\n            },\n            onPositioned: this._positionedHandler.bind(this)\n          };\n          return new Overlay($tooltipElement, tooltipOptions);\n        },\n        _hideFixedGroupCell: function ($cell, overlayOptions) {\n          var $nextFixedRowElement;\n          var $groupCellElement;\n\n          var isFixedColumns = this._rowsView.isFixedColumns();\n\n          var isFormOrPopupEditMode = this._editingController.isFormOrPopupEditMode();\n\n          if (isFixedColumns && !isFormOrPopupEditMode) {\n            var nextRowOptions = $cell.closest(\".dx-row\").next().data(\"options\");\n\n            if (nextRowOptions && \"group\" === nextRowOptions.rowType) {\n              $nextFixedRowElement = $(this._rowsView.getRowElement(nextRowOptions.rowIndex)).last();\n              $groupCellElement = $nextFixedRowElement.find(\".\" + GROUP_CELL_CLASS);\n\n              if ($groupCellElement.length && \"hidden\" !== $groupCellElement.get(0).style.visibility) {\n                $groupCellElement.css(\"visibility\", \"hidden\");\n\n                overlayOptions.onDisposing = function () {\n                  $groupCellElement.css(\"visibility\", \"\");\n                };\n              }\n            }\n          }\n        },\n        _positionedHandler: function (e, isOverlayVisible) {\n          if (!e.component.__skipPositionProcessing) {\n            var isRevertButton = $(e.element).hasClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\n\n            var needRepaint = !isRevertButton && this._rowsView.updateFreeSpaceRowHeight();\n\n            var normalizedPosition = this._normalizeValidationMessagePositionAndMaxWidth(e, isRevertButton, isOverlayVisible);\n\n            e.component.__skipPositionProcessing = !!(needRepaint || normalizedPosition);\n\n            if (normalizedPosition) {\n              e.component.option(normalizedPosition);\n            } else if (needRepaint) {\n              e.component.repaint();\n            }\n          }\n        },\n        _showValidationMessage: function ($cell, messages, alignment, revertTooltip) {\n          var editorPopup = $cell.find(\".dx-dropdowneditor-overlay\").data(\"dxPopup\");\n          var isOverlayVisible = editorPopup && editorPopup.option(\"visible\");\n          var myPosition = isOverlayVisible ? \"top right\" : \"top \" + alignment;\n          var atPosition = isOverlayVisible ? \"top left\" : \"bottom \" + alignment;\n          var $overlayContainer = $cell.closest(\".\".concat(this.addWidgetPrefix(CONTENT_CLASS)));\n          var errorMessageText = \"\";\n          messages && messages.forEach(function (message) {\n            errorMessageText += (errorMessageText.length ? \"<br/>\" : \"\") + encodeHtml(message);\n          });\n          var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\n\n          this._rowsView.element().find(\".\" + invalidMessageClass).remove();\n\n          var $overlayElement = $(\"<div>\").addClass(INVALID_MESSAGE_CLASS).addClass(INVALID_MESSAGE_ALWAYS_CLASS).addClass(invalidMessageClass).html(errorMessageText).appendTo($cell);\n          var overlayOptions = {\n            container: $overlayContainer,\n            shading: false,\n            width: \"auto\",\n            height: \"auto\",\n            visible: true,\n            animation: false,\n            propagateOutsideClick: true,\n            hideOnOutsideClick: false,\n            copyRootClassesToWrapper: true,\n            _ignoreCopyRootClassesToWrapperDeprecation: true,\n            position: {\n              collision: \"flip\",\n              boundary: this._rowsView.element(),\n              boundaryOffset: \"0 0\",\n              offset: {\n                x: 0,\n                y: !isOverlayVisible && browser.mozilla ? -1 : 0\n              },\n              my: myPosition,\n              at: atPosition,\n              of: $cell\n            },\n            onPositioned: e => {\n              this._positionedHandler(e, isOverlayVisible);\n\n              this._shiftValidationMessageIfNeed(e.component.$content(), revertTooltip && revertTooltip.$content(), $cell);\n            }\n          };\n\n          this._hideFixedGroupCell($cell, overlayOptions);\n\n          new Overlay($overlayElement, overlayOptions);\n        },\n        _normalizeValidationMessagePositionAndMaxWidth: function (options, isRevertButton, isOverlayVisible) {\n          var fixedColumns = this._columnsController.getFixedColumns();\n\n          if (!fixedColumns || !fixedColumns.length) {\n            return;\n          }\n\n          var position;\n          var visibleTableWidth = !isRevertButton && (that = this, element = options.element, rowIndex = $(element).closest(\"tr\").index(), $cellElements = $(that._rowsView.getRowElement(rowIndex)).first().children().filter(\":not(.dx-hidden-cell)\"), that._rowsView._getWidths($cellElements).reduce((w1, w2) => w1 + w2, 0));\n          var that, element, rowIndex, $cellElements;\n          var $overlayContentElement = options.component.$content();\n          var validationMessageWidth = getOuterWidth($overlayContentElement, true);\n          var needMaxWidth = !isRevertButton && validationMessageWidth > visibleTableWidth;\n\n          var columnIndex = this._rowsView.getCellIndex($(options.element).closest(\"td\"));\n\n          var boundaryNonFixedColumnsInfo = function (fixedColumns) {\n            var firstNonFixedColumnIndex;\n            var lastNonFixedColumnIndex;\n            fixedColumns.some((column, index) => {\n              if (column.command === COMMAND_TRANSPARENT) {\n                firstNonFixedColumnIndex = 0 === index ? -1 : index;\n                lastNonFixedColumnIndex = index === fixedColumns.length - 1 ? -1 : index + column.colspan - 1;\n                return true;\n              }\n            });\n            return {\n              startColumnIndex: firstNonFixedColumnIndex,\n              endColumnIndex: lastNonFixedColumnIndex\n            };\n          }(fixedColumns);\n\n          if (!isRevertButton && (columnIndex === boundaryNonFixedColumnsInfo.startColumnIndex || needMaxWidth)) {\n            position = {\n              collision: \"none flip\",\n              my: \"top left\",\n              at: isOverlayVisible ? \"top right\" : \"bottom left\"\n            };\n          } else if (columnIndex === boundaryNonFixedColumnsInfo.endColumnIndex) {\n            position = {\n              collision: \"none flip\",\n              my: \"top right\",\n              at: isRevertButton || isOverlayVisible ? \"top left\" : \"bottom right\"\n            };\n\n            if (isRevertButton) {\n              position.offset = \"-1 0\";\n            }\n          }\n\n          return position && {\n            position: position,\n            maxWidth: needMaxWidth ? visibleTableWidth - 2 : void 0\n          };\n        },\n        _shiftValidationMessageIfNeed: function ($content, $revertContent, $cell) {\n          if (!$revertContent) {\n            return;\n          }\n\n          var contentOffset = $content.offset();\n          var revertContentOffset = $revertContent.offset();\n\n          if (contentOffset.top === revertContentOffset.top && contentOffset.left + getWidth($content) > revertContentOffset.left) {\n            var left = getWidth($revertContent) + PADDING_BETWEEN_TOOLTIPS;\n            $content.css(\"left\", revertContentOffset.left < $cell.offset().left ? -left : left);\n          }\n        },\n        _getTooltipsSelector: function () {\n          var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\n          var revertTooltipClass = this.addWidgetPrefix(REVERT_TOOLTIP_CLASS);\n          return \".dx-editor-cell .\" + revertTooltipClass + \", .dx-editor-cell .\" + invalidMessageClass + \", .dx-cell-modified .\" + invalidMessageClass;\n        },\n        init: function () {\n          this.callBase();\n          this._editingController = this.getController(\"editing\");\n          this._columnsController = this.getController(\"columns\");\n          this._rowsView = this.getView(\"rowsView\");\n        },\n        loseFocus: function (skipValidator) {\n          if (!skipValidator) {\n            this.getController(\"validating\").setValidator(null);\n          }\n\n          this.callBase();\n        },\n        updateCellState: function ($element, validationResult, hideBorder) {\n          var _change$data;\n\n          var $focus = null === $element || void 0 === $element ? void 0 : $element.closest(this._getFocusCellSelector());\n          var $cell = null !== $focus && void 0 !== $focus && $focus.is(\"td\") ? $focus : null;\n          var rowOptions = null === $focus || void 0 === $focus ? void 0 : $focus.closest(\".dx-row\").data(\"options\");\n          var change = rowOptions ? this.getController(\"editing\").getChangeByKey(rowOptions.key) : null;\n          var column = $cell && this.getController(\"columns\").getVisibleColumns()[$cell.index()];\n          var isCellModified = void 0 !== (null === change || void 0 === change ? void 0 : null === (_change$data = change.data) || void 0 === _change$data ? void 0 : _change$data[null === column || void 0 === column ? void 0 : column.name]) && !this._editingController.isSaving();\n          var revertTooltip;\n\n          if ((null === validationResult || void 0 === validationResult ? void 0 : validationResult.status) === VALIDATION_STATUS.invalid || isCellModified) {\n            if (this._editingController.getEditMode() === EDIT_MODE_CELL) {\n              revertTooltip = this._showRevertButton($focus);\n            }\n          }\n\n          var showValidationMessage = validationResult && validationResult.status === VALIDATION_STATUS.invalid;\n\n          if (showValidationMessage && $cell && column && validationResult && validationResult.brokenRules) {\n            var errorMessages = [];\n            validationResult.brokenRules.forEach(function (rule) {\n              if (rule.message) {\n                errorMessages.push(rule.message);\n              }\n            });\n\n            if (errorMessages.length) {\n              this._showValidationMessage($focus, errorMessages, column.alignment || \"left\", revertTooltip);\n            }\n          }\n\n          !hideBorder && this._rowsView.element() && this._rowsView.updateFreeSpaceRowHeight();\n        },\n        focus: function ($element, hideBorder) {\n          if (!arguments.length) {\n            return this.callBase();\n          }\n\n          var $tooltips = $element && $element.closest(\".\" + this.addWidgetPrefix(ROWS_VIEW_CLASS)).find(this._getTooltipsSelector());\n          $tooltips && $tooltips.remove();\n\n          if (null !== $element && void 0 !== $element && $element.hasClass(\"dx-row\")) {\n            return this.callBase($element, hideBorder);\n          }\n\n          var $focus = null === $element || void 0 === $element ? void 0 : $element.closest(this._getFocusCellSelector());\n          var callBase = this.callBase;\n          var validator = $focus && ($focus.data(\"dxValidator\") || $element.find(\".\" + this.addWidgetPrefix(VALIDATOR_CLASS)).eq(0).data(\"dxValidator\"));\n          var rowOptions = $focus && $focus.closest(\".dx-row\").data(\"options\");\n          var editingController = this.getController(\"editing\");\n          var change = rowOptions ? editingController.getChangeByKey(rowOptions.key) : null;\n          var validationResult;\n          var validatingController = this.getController(\"validating\");\n\n          if (validator) {\n            validatingController.setValidator(validator);\n            var value = validator.option(\"adapter\").getValue();\n\n            if (cellValueShouldBeValidated(value, rowOptions) || validatingController._rowIsValidated(change)) {\n              editingController.waitForDeferredOperations().done(() => {\n                when(validatingController.validateCell(validator)).done(result => {\n                  validationResult = result;\n                  var column = validationResult.validator.option(\"dataGetter\")().column;\n\n                  if (change && column && !validatingController.isCurrentValidatorProcessing({\n                    rowKey: change.key,\n                    columnIndex: column.index\n                  })) {\n                    return;\n                  }\n\n                  if (validationResult.status === VALIDATION_STATUS.invalid) {\n                    hideBorder = true;\n                  }\n\n                  this.updateCellState($element, validationResult, hideBorder);\n                  callBase.call(this, $element, hideBorder);\n                });\n              });\n              return this.callBase($element, hideBorder);\n            }\n          }\n\n          this.updateCellState($element, validationResult, hideBorder);\n          return this.callBase($element, hideBorder);\n        },\n        getEditorInstance: function ($container) {\n          var $editor = $container.find(\".dx-texteditor\").eq(0);\n          return gridCoreUtils.getWidgetInstance($editor);\n        }\n      },\n      data: {\n        _isCellChanged: function (oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\n          var _oldRow$cells, _cell$column$validati;\n\n          var cell = null === (_oldRow$cells = oldRow.cells) || void 0 === _oldRow$cells ? void 0 : _oldRow$cells[columnIndex];\n          var oldValidationStatus = cell && cell.validationStatus;\n          var validatingController = this.getController(\"validating\");\n          var validationResult = validatingController.getCellValidationResult({\n            rowKey: oldRow.key,\n            columnIndex: columnIndex\n          });\n\n          var validationData = validatingController._getValidationData(oldRow.key);\n\n          var newValidationStatus = validationResultIsValid(validationResult) ? validationResult.status : validationResult;\n          var rowIsModified = JSON.stringify(newRow.modifiedValues) !== JSON.stringify(oldRow.modifiedValues);\n          var cellIsMarkedAsInvalid = $(null === cell || void 0 === cell ? void 0 : cell.cellElement).hasClass(this.addWidgetPrefix(INVALIDATE_CLASS));\n          var editingChanged = oldRow.isEditing !== newRow.isEditing;\n          var hasValidationRules = null === cell || void 0 === cell ? void 0 : null === (_cell$column$validati = cell.column.validationRules) || void 0 === _cell$column$validati ? void 0 : _cell$column$validati.length;\n\n          if (editingChanged && hasValidationRules || oldValidationStatus !== newValidationStatus && rowIsModified || validationData.isValid && cellIsMarkedAsInvalid) {\n            return true;\n          }\n\n          return this.callBase.apply(this, arguments);\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        updateFreeSpaceRowHeight: function ($table) {\n          var $rowElements;\n          var $freeSpaceRowElement;\n          var $freeSpaceRowElements;\n          var $element = this.element();\n          var $tooltipContent = $element && $element.find(\".\" + this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS) + \" .dx-overlay-content\");\n          this.callBase($table);\n\n          if ($tooltipContent && $tooltipContent.length) {\n            $rowElements = this._getRowElements();\n            $freeSpaceRowElements = this._getFreeSpaceRowElements($table);\n            $freeSpaceRowElement = $freeSpaceRowElements.first();\n\n            if ($freeSpaceRowElement && 1 === $rowElements.length && (!$freeSpaceRowElement.is(\":visible\") || getOuterHeight($tooltipContent) > getOuterHeight($freeSpaceRowElement))) {\n              $freeSpaceRowElements.show();\n              setHeight($freeSpaceRowElements, getOuterHeight($tooltipContent));\n              return true;\n            }\n          }\n        },\n        _formItemPrepared: function (cellOptions, $container) {\n          this.callBase.apply(this, arguments);\n          deferUpdate(() => {\n            var $editor = $container.find(\".dx-widget\").first();\n            var isEditorDisposed = $editor.length && !$editor.children().length;\n\n            if (!isEditorDisposed) {\n              this.getController(\"validating\").createValidator(cellOptions, $editor);\n            }\n          });\n        },\n        _cellPrepared: function ($cell, parameters) {\n          if (!this.getController(\"editing\").isFormOrPopupEditMode()) {\n            this.getController(\"validating\").createValidator(parameters, $cell);\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _restoreErrorRow: function (contentTable) {\n          var editingController = this.getController(\"editing\");\n          editingController && editingController.hasChanges() && this._getRowElements(contentTable).each((_, item) => {\n            var rowOptions = $(item).data(\"options\");\n\n            if (rowOptions) {\n              var change = editingController.getChangeByKey(rowOptions.key);\n              change && editingController._showErrorRow(change);\n            }\n          });\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.validating.js"],"names":["getOuterWidth","getWidth","getOuterHeight","setHeight","$","eventsEngine","modules","gridCoreUtils","createObjectWithChanges","deferUpdate","equalByValue","getKeyHash","each","isDefined","isEmptyObject","isObject","extend","focused","messageLocalization","Button","pointerEvents","ValidationEngine","Validator","Overlay","errors","Deferred","when","fromPromise","LoadIndicator","encodeHtml","browser","INVALIDATE_CLASS","REVERT_TOOLTIP_CLASS","ROWS_VIEW_CLASS","INVALID_MESSAGE_CLASS","WIDGET_INVALID_MESSAGE_CLASS","INVALID_MESSAGE_ALWAYS_CLASS","REVERT_BUTTON_CLASS","VALIDATOR_CLASS","PENDING_INDICATOR_CLASS","VALIDATION_PENDING_CLASS","CONTENT_CLASS","INSERT_INDEX","PADDING_BETWEEN_TOOLTIPS","EDIT_MODE_ROW","EDIT_MODE_FORM","EDIT_MODE_BATCH","EDIT_MODE_CELL","EDIT_MODE_POPUP","GROUP_CELL_CLASS","FORM_BASED_MODES","COMMAND_TRANSPARENT","VALIDATION_STATUS","valid","invalid","pending","EDIT_DATA_INSERT_TYPE","EDIT_DATA_REMOVE_TYPE","VALIDATION_CANCELLED","validationResultIsValid","result","cellValueShouldBeValidated","value","rowOptions","isNewRow","ValidatingController","Controller","inherit","init","_editingController","getController","createAction","_validationState","initValidationState","_validationStateCache","_rowIsValidated","change","validationData","_getValidationData","key","validated","create","keyHash","isObjectKeyHash","filter","data","isValid","push","_getBrokenRules","validationResults","brokenRules","brokenRule","_rowValidating","deferred","getChangeByKey","parameters","newData","oldData","_getOldData","promise","errorText","getHiddenValidatorsErrorText","executeAction","always","resolve","brokenRulesMessages","_","column","isGroupExpandColumn","groupIndex","showWhenGrouped","isVisibleColumn","visible","validator","$element","parent","length","message","join","validate","isFull","editingController","completeList","editMode","getEditMode","_isValidationInProgress","addDeferred","changes","getChanges","index","_ref","type","validationResult","validateGroup","done","_currentCellValidator","_findGroup","_validationResult","getGroupConfig","validators","resetRowValidationResults","complete","isRowDataModified","updateValidationState","indexOf","setDisableApplyValidationResults","groupConfig","setValidator","renderCellPendingIndicator","$container","$indicator","find","$indicatorContainer","appendTo","addClass","_createComponent","disposeCellPendingIndicator","indicator","getInstance","dispose","remove","removeClass","validationStatusChanged","validationGroup","option","updateCellValidationResult","rowKey","columnIndex","validatorInitialized","arg","component","on","bind","validatorDisposing","getCellValidationResult","status","cancelCellValidationResult","applyValidationResult","forEach","rule","requestIsDisabled","disabledPendingId","id","_disableApplyValidationResults","$focus","trigger","down","editor","editCellTemplate","getEditorInstance","toggleClass","addWidgetPrefix","_syncInternalEditingData","_parameters$row","oldDataFromState","row","_addInternalData","createValidator","showEditorAlways","command","validationRules","Array","isArray","editIndex","getIndexByKey","needCreateValidator","columnsController","visibleColumns","getVisibleColumns","some","isEditRow","isCellOrBatchEditingAllowed","isCellOrBatchEditMode","allowUpdating","_parameters$row$oldDa","_parameters$row2","log","getValue","calculateCellValue","useDefaultValidator","hasClass","name","caption","adapter","applyValidationResults","dataGetter","onInitialized","onDisposing","validationRequestsCallbacks","bypass","isCellModified","flag","getDisableApplyValidationResults","isCurrentValidatorProcessing","_ref2","validateCell","cellParams","stateRestored","_ref3","_ref4","_validationData$valid","removeCellValidationResult","_ref5","_ref6","reject","isInvalidCell","_ref7","getCellValidator","_ref8","v","setCellValidationStatus","cellOptions","validationStatus","validatingModule","defaultOptions","editing","texts","validationCancelChanges","format","controllers","validating","extenders","_addChange","changeParams","callBase","apply","arguments","validatingController","_handleChangesChange","args","_updateRowAndPageIndices","that","startInsertIndex","getView","getTopVisibleItemIndex","rowIndex","_ref9","pageIndex","_pageIndex","_getValidationGroupsInForm","detailOptions","_validateEditFormAfterUpdate","isCustomSetCellValue","_editForm","_prepareEditCell","params","isNotCanceled","processItems","items","changeType","dataController","itemsCount","addInValidItem","isInsert","i","item","keyOf","splice","processDataItem","isInserted","_createInvisibleColumnValidators","columns","getColumns","invisibleColumns","getInvisibleColumns","isBand","groupColumns","getGroupColumns","invisibleColumnValidators","isCellVisible","_dataController","getRowIndexByKey","_beforeSaveEditData","disposeValidators","executeOperation","isFullValid","_focusEditingCell","_resetEditRowKey","_resetEditColumnName","updateItems","_beforeEditCell","$cell","_rowsView","_getCellElement","closest","_afterSaveEditData","cancel","$firstErrorRow","isCellEditMode","$errorRow","_showErrorRow","scrollable","getScrollable","update","scrollToElement","_needUpdateRow","editRowIndex","getEditRowIndex","rowIndices","shouldResetValidationState","columnsWithValidatingEditors","col","_col$validationRules","_handleDataChanged","validationState","resetRowAndPageIndices","_beforeCancelEditData","$popupContent","errorHandling","getPopupContent","renderErrorRow","updateFieldValue","e","currentValidator","refocus","highlightDataCell","isEditableCell","setValue","cellModified","isValidated","needValidation","setCellValue","isCellInvalid","editorFactory","_showRevertButton","$tooltipElement","element","$overlayContainer","concat","tooltipOptions","animation","width","height","shading","container","propagateOutsideClick","hideOnOutsideClick","copyRootClassesToWrapper","_ignoreCopyRootClassesToWrapperDeprecation","contentTemplate","$buttonElement","buttonOptions","icon","hint","onClick","cancelEditData","position","my","at","offset","collision","boundaryOffset","boundary","of","onPositioned","_positionedHandler","_hideFixedGroupCell","overlayOptions","$nextFixedRowElement","$groupCellElement","isFixedColumns","isFormOrPopupEditMode","nextRowOptions","next","rowType","getRowElement","last","get","style","visibility","css","isOverlayVisible","__skipPositionProcessing","isRevertButton","needRepaint","updateFreeSpaceRowHeight","normalizedPosition","_normalizeValidationMessagePositionAndMaxWidth","repaint","_showValidationMessage","messages","alignment","revertTooltip","editorPopup","myPosition","atPosition","errorMessageText","invalidMessageClass","$overlayElement","html","x","y","mozilla","_shiftValidationMessageIfNeed","$content","options","fixedColumns","_columnsController","getFixedColumns","visibleTableWidth","$cellElements","first","children","_getWidths","reduce","w1","w2","$overlayContentElement","validationMessageWidth","needMaxWidth","getCellIndex","boundaryNonFixedColumnsInfo","firstNonFixedColumnIndex","lastNonFixedColumnIndex","colspan","startColumnIndex","endColumnIndex","maxWidth","$revertContent","contentOffset","revertContentOffset","top","left","_getTooltipsSelector","revertTooltipClass","loseFocus","skipValidator","updateCellState","hideBorder","_change$data","_getFocusCellSelector","is","isSaving","showValidationMessage","errorMessages","focus","$tooltips","eq","waitForDeferredOperations","call","$editor","getWidgetInstance","_isCellChanged","oldRow","newRow","visibleRowIndex","isLiveUpdate","_oldRow$cells","_cell$column$validati","cell","cells","oldValidationStatus","newValidationStatus","rowIsModified","JSON","stringify","modifiedValues","cellIsMarkedAsInvalid","cellElement","editingChanged","isEditing","hasValidationRules","views","rowsView","$table","$rowElements","$freeSpaceRowElement","$freeSpaceRowElements","$tooltipContent","_getRowElements","_getFreeSpaceRowElements","show","_formItemPrepared","isEditorDisposed","_cellPrepared","_restoreErrorRow","contentTable","hasChanges"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.validating.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    getOuterWidth,\r\n    getWidth,\r\n    getOuterHeight,\r\n    setHeight\r\n} from \"../../core/utils/size\";\r\nimport $ from \"../../core/renderer\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport modules from \"./ui.grid_core.modules\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nimport {\r\n    createObjectWithChanges\r\n} from \"../../data/array_utils\";\r\nimport {\r\n    deferUpdate,\r\n    equalByValue,\r\n    getKeyHash\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    isDefined,\r\n    isEmptyObject,\r\n    isObject\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    focused\r\n} from \"../widget/selectors\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport Button from \"../button\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport ValidationEngine from \"../validation_engine\";\r\nimport Validator from \"../validator\";\r\nimport Overlay from \"../overlay/ui.overlay\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport {\r\n    Deferred,\r\n    when,\r\n    fromPromise\r\n} from \"../../core/utils/deferred\";\r\nimport LoadIndicator from \"../load_indicator\";\r\nimport {\r\n    encodeHtml\r\n} from \"../../core/utils/string\";\r\nimport browser from \"../../core/utils/browser\";\r\nvar INVALIDATE_CLASS = \"invalid\";\r\nvar REVERT_TOOLTIP_CLASS = \"revert-tooltip\";\r\nvar ROWS_VIEW_CLASS = \"rowsview\";\r\nvar INVALID_MESSAGE_CLASS = \"dx-invalid-message\";\r\nvar WIDGET_INVALID_MESSAGE_CLASS = \"invalid-message\";\r\nvar INVALID_MESSAGE_ALWAYS_CLASS = \"dx-invalid-message-always\";\r\nvar REVERT_BUTTON_CLASS = \"dx-revert-button\";\r\nvar VALIDATOR_CLASS = \"validator\";\r\nvar PENDING_INDICATOR_CLASS = \"dx-pending-indicator\";\r\nvar VALIDATION_PENDING_CLASS = \"dx-validation-pending\";\r\nvar CONTENT_CLASS = \"content\";\r\nvar INSERT_INDEX = \"__DX_INSERT_INDEX__\";\r\nvar PADDING_BETWEEN_TOOLTIPS = 2;\r\nvar EDIT_MODE_ROW = \"row\";\r\nvar EDIT_MODE_FORM = \"form\";\r\nvar EDIT_MODE_BATCH = \"batch\";\r\nvar EDIT_MODE_CELL = \"cell\";\r\nvar EDIT_MODE_POPUP = \"popup\";\r\nvar GROUP_CELL_CLASS = \"dx-group-cell\";\r\nvar FORM_BASED_MODES = [EDIT_MODE_POPUP, EDIT_MODE_FORM];\r\nvar COMMAND_TRANSPARENT = \"transparent\";\r\nvar VALIDATION_STATUS = {\r\n    valid: \"valid\",\r\n    invalid: \"invalid\",\r\n    pending: \"pending\"\r\n};\r\nvar EDIT_DATA_INSERT_TYPE = \"insert\";\r\nvar EDIT_DATA_REMOVE_TYPE = \"remove\";\r\nvar VALIDATION_CANCELLED = \"cancel\";\r\nvar validationResultIsValid = function(result) {\r\n    return isDefined(result) && result !== VALIDATION_CANCELLED\r\n};\r\nvar cellValueShouldBeValidated = function(value, rowOptions) {\r\n    return void 0 !== value || void 0 === value && rowOptions && !rowOptions.isNewRow\r\n};\r\nvar ValidatingController = modules.Controller.inherit({\r\n    init: function() {\r\n        this._editingController = this.getController(\"editing\");\r\n        this.createAction(\"onRowValidating\");\r\n        if (!this._validationState) {\r\n            this.initValidationState()\r\n        }\r\n    },\r\n    initValidationState() {\r\n        this._validationState = [];\r\n        this._validationStateCache = {}\r\n    },\r\n    _rowIsValidated: function(change) {\r\n        var validationData = this._getValidationData(null === change || void 0 === change ? void 0 : change.key);\r\n        return !!validationData && !!validationData.validated\r\n    },\r\n    _getValidationData: function(key, create) {\r\n        var keyHash = getKeyHash(key);\r\n        var isObjectKeyHash = isObject(keyHash);\r\n        var validationData;\r\n        if (isObjectKeyHash) {\r\n            validationData = this._validationState.filter(data => equalByValue(data.key, key))[0]\r\n        } else {\r\n            validationData = this._validationStateCache[keyHash]\r\n        }\r\n        if (!validationData && create) {\r\n            validationData = {\r\n                key: key,\r\n                isValid: true\r\n            };\r\n            this._validationState.push(validationData);\r\n            if (!isObjectKeyHash) {\r\n                this._validationStateCache[keyHash] = validationData\r\n            }\r\n        }\r\n        return validationData\r\n    },\r\n    _getBrokenRules: function(validationData, validationResults) {\r\n        var brokenRules;\r\n        if (validationResults) {\r\n            brokenRules = validationResults.brokenRules || validationResults.brokenRule && [validationResults.brokenRule]\r\n        } else {\r\n            brokenRules = validationData.brokenRules || []\r\n        }\r\n        return brokenRules\r\n    },\r\n    _rowValidating: function(validationData, validationResults) {\r\n        var deferred = new Deferred;\r\n        var change = this._editingController.getChangeByKey(null === validationData || void 0 === validationData ? void 0 : validationData.key);\r\n        var brokenRules = this._getBrokenRules(validationData, validationResults);\r\n        var isValid = validationResults ? validationResults.isValid : validationData.isValid;\r\n        var parameters = {\r\n            brokenRules: brokenRules,\r\n            isValid: isValid,\r\n            key: change.key,\r\n            newData: change.data,\r\n            oldData: this._editingController._getOldData(change.key),\r\n            promise: null,\r\n            errorText: this.getHiddenValidatorsErrorText(brokenRules)\r\n        };\r\n        this.executeAction(\"onRowValidating\", parameters);\r\n        when(fromPromise(parameters.promise)).always((function() {\r\n            validationData.isValid = parameters.isValid;\r\n            validationData.errorText = parameters.errorText;\r\n            deferred.resolve(parameters)\r\n        }));\r\n        return deferred.promise()\r\n    },\r\n    getHiddenValidatorsErrorText: function(brokenRules) {\r\n        var brokenRulesMessages = [];\r\n        each(brokenRules, (function(_, brokenRule) {\r\n            var column = brokenRule.column;\r\n            var isGroupExpandColumn = column && void 0 !== column.groupIndex && !column.showWhenGrouped;\r\n            var isVisibleColumn = column && column.visible;\r\n            if (!brokenRule.validator.$element().parent().length && (!isVisibleColumn || isGroupExpandColumn)) {\r\n                brokenRulesMessages.push(brokenRule.message)\r\n            }\r\n        }));\r\n        return brokenRulesMessages.join(\", \")\r\n    },\r\n    validate: function(isFull) {\r\n        var isValid = true;\r\n        var editingController = this._editingController;\r\n        var deferred = new Deferred;\r\n        var completeList = [];\r\n        var editMode = editingController.getEditMode();\r\n        isFull = isFull || editMode === EDIT_MODE_ROW;\r\n        if (this._isValidationInProgress) {\r\n            return deferred.resolve(false).promise()\r\n        }\r\n        this._isValidationInProgress = true;\r\n        if (isFull) {\r\n            editingController.addDeferred(deferred);\r\n            var changes = editingController.getChanges();\r\n            each(changes, (index, _ref) => {\r\n                var {\r\n                    type: type,\r\n                    key: key\r\n                } = _ref;\r\n                if (\"remove\" !== type) {\r\n                    var validationData = this._getValidationData(key, true);\r\n                    var validationResult = this.validateGroup(validationData);\r\n                    completeList.push(validationResult);\r\n                    validationResult.done(validationResult => {\r\n                        validationData.validated = true;\r\n                        isValid = isValid && validationResult.isValid\r\n                    })\r\n                }\r\n            })\r\n        } else if (this._currentCellValidator) {\r\n            var validationResult = this.validateGroup(this._currentCellValidator._findGroup());\r\n            completeList.push(validationResult);\r\n            validationResult.done(validationResult => {\r\n                isValid = validationResult.isValid\r\n            })\r\n        }\r\n        when(...completeList).done(() => {\r\n            this._isValidationInProgress = false;\r\n            deferred.resolve(isValid)\r\n        });\r\n        return deferred.promise()\r\n    },\r\n    validateGroup: function(validationData) {\r\n        var _validationResult;\r\n        var result = new Deferred;\r\n        var validateGroup = validationData && ValidationEngine.getGroupConfig(validationData);\r\n        var validationResult;\r\n        if (null !== validateGroup && void 0 !== validateGroup && validateGroup.validators.length) {\r\n            this.resetRowValidationResults(validationData);\r\n            validationResult = ValidationEngine.validateGroup(validationData)\r\n        }\r\n        when((null === (_validationResult = validationResult) || void 0 === _validationResult ? void 0 : _validationResult.complete) || validationResult).done(validationResult => {\r\n            when(this._rowValidating(validationData, validationResult)).done(result.resolve)\r\n        });\r\n        return result.promise()\r\n    },\r\n    isRowDataModified: change => !isEmptyObject(change.data),\r\n    updateValidationState: function(change) {\r\n        var editMode = this._editingController.getEditMode();\r\n        var key = change.key;\r\n        var validationData = this._getValidationData(key, true);\r\n        if (-1 === FORM_BASED_MODES.indexOf(editMode)) {\r\n            if (change.type === EDIT_DATA_INSERT_TYPE && !this.isRowDataModified(change)) {\r\n                validationData.isValid = true;\r\n                return\r\n            }\r\n            this.setDisableApplyValidationResults(true);\r\n            var groupConfig = ValidationEngine.getGroupConfig(validationData);\r\n            if (groupConfig) {\r\n                var validationResult = ValidationEngine.validateGroup(validationData);\r\n                when(validationResult.complete || validationResult).done(validationResult => {\r\n                    validationData.isValid = validationResult.isValid;\r\n                    validationData.brokenRules = validationResult.brokenRules\r\n                })\r\n            } else if (!validationData.brokenRules || !validationData.brokenRules.length) {\r\n                validationData.isValid = true\r\n            }\r\n            this.setDisableApplyValidationResults(false)\r\n        } else {\r\n            validationData.isValid = true\r\n        }\r\n    },\r\n    setValidator: function(validator) {\r\n        this._currentCellValidator = validator\r\n    },\r\n    renderCellPendingIndicator: function($container) {\r\n        var $indicator = $container.find(\".\" + PENDING_INDICATOR_CLASS);\r\n        if (!$indicator.length) {\r\n            var $indicatorContainer = $container;\r\n            $indicator = $(\"<div>\").appendTo($indicatorContainer).addClass(PENDING_INDICATOR_CLASS);\r\n            this._createComponent($indicator, LoadIndicator);\r\n            $container.addClass(VALIDATION_PENDING_CLASS)\r\n        }\r\n    },\r\n    disposeCellPendingIndicator: function($container) {\r\n        var $indicator = $container.find(\".\" + PENDING_INDICATOR_CLASS);\r\n        if ($indicator.length) {\r\n            var indicator = LoadIndicator.getInstance($indicator);\r\n            if (indicator) {\r\n                indicator.dispose();\r\n                indicator.$element().remove()\r\n            }\r\n            $container.removeClass(VALIDATION_PENDING_CLASS)\r\n        }\r\n    },\r\n    validationStatusChanged: function(result) {\r\n        var validator = result.validator;\r\n        var validationGroup = validator.option(\"validationGroup\");\r\n        var column = validator.option(\"dataGetter\")().column;\r\n        this.updateCellValidationResult({\r\n            rowKey: validationGroup.key,\r\n            columnIndex: column.index,\r\n            validationResult: result\r\n        })\r\n    },\r\n    validatorInitialized: function(arg) {\r\n        arg.component.on(\"validating\", this.validationStatusChanged.bind(this));\r\n        arg.component.on(\"validated\", this.validationStatusChanged.bind(this))\r\n    },\r\n    validatorDisposing: function(arg) {\r\n        var validator = arg.component;\r\n        var validationGroup = validator.option(\"validationGroup\");\r\n        var column = validator.option(\"dataGetter\")().column;\r\n        var result = this.getCellValidationResult({\r\n            rowKey: null === validationGroup || void 0 === validationGroup ? void 0 : validationGroup.key,\r\n            columnIndex: column.index\r\n        });\r\n        if (validationResultIsValid(result) && result.status === VALIDATION_STATUS.pending) {\r\n            this.cancelCellValidationResult({\r\n                change: validationGroup,\r\n                columnIndex: column.index\r\n            })\r\n        }\r\n    },\r\n    applyValidationResult: function($container, result) {\r\n        var validator = result.validator;\r\n        var validationGroup = validator.option(\"validationGroup\");\r\n        var column = validator.option(\"dataGetter\")().column;\r\n        result.brokenRules && result.brokenRules.forEach(rule => {\r\n            rule.columnIndex = column.index;\r\n            rule.column = column\r\n        });\r\n        if ($container) {\r\n            var validationResult = this.getCellValidationResult({\r\n                rowKey: validationGroup.key,\r\n                columnIndex: column.index\r\n            });\r\n            var requestIsDisabled = validationResultIsValid(validationResult) && validationResult.disabledPendingId === result.id;\r\n            if (this._disableApplyValidationResults || requestIsDisabled) {\r\n                return\r\n            }\r\n            if (result.status === VALIDATION_STATUS.invalid) {\r\n                var $focus = $container.find(\":focus\");\r\n                if (!focused($focus)) {\r\n                    eventsEngine.trigger($focus, \"focus\");\r\n                    eventsEngine.trigger($focus, pointerEvents.down)\r\n                }\r\n            }\r\n            var editor = !column.editCellTemplate && this.getController(\"editorFactory\").getEditorInstance($container);\r\n            if (result.status === VALIDATION_STATUS.pending) {\r\n                if (editor) {\r\n                    editor.option(\"validationStatus\", VALIDATION_STATUS.pending)\r\n                } else {\r\n                    this.renderCellPendingIndicator($container)\r\n                }\r\n            } else if (editor) {\r\n                editor.option(\"validationStatus\", VALIDATION_STATUS.valid)\r\n            } else {\r\n                this.disposeCellPendingIndicator($container)\r\n            }\r\n            $container.toggleClass(this.addWidgetPrefix(INVALIDATE_CLASS), result.status === VALIDATION_STATUS.invalid)\r\n        }\r\n    },\r\n    _syncInternalEditingData: function(parameters) {\r\n        var _parameters$row;\r\n        var editingController = this._editingController;\r\n        var change = editingController.getChangeByKey(parameters.key);\r\n        var oldDataFromState = editingController._getOldData(parameters.key);\r\n        var oldData = null === (_parameters$row = parameters.row) || void 0 === _parameters$row ? void 0 : _parameters$row.oldData;\r\n        if (change && oldData && !oldDataFromState) {\r\n            editingController._addInternalData({\r\n                key: parameters.key,\r\n                oldData: oldData\r\n            })\r\n        }\r\n    },\r\n    createValidator: function(parameters, $container) {\r\n        var editingController = this._editingController;\r\n        var column = parameters.column;\r\n        var showEditorAlways = column.showEditorAlways;\r\n        if (isDefined(column.command) || !column.validationRules || !Array.isArray(column.validationRules) || !column.validationRules.length) {\r\n            return\r\n        }\r\n        var editIndex = editingController.getIndexByKey(parameters.key, editingController.getChanges());\r\n        var needCreateValidator = editIndex > -1;\r\n        if (!needCreateValidator) {\r\n            if (!showEditorAlways) {\r\n                var columnsController = this.getController(\"columns\");\r\n                var visibleColumns = (null === columnsController || void 0 === columnsController ? void 0 : columnsController.getVisibleColumns()) || [];\r\n                showEditorAlways = visibleColumns.some((function(column) {\r\n                    return column.showEditorAlways\r\n                }))\r\n            }\r\n            var isEditRow = equalByValue(this.option(\"editing.editRowKey\"), parameters.key);\r\n            var isCellOrBatchEditingAllowed = editingController.isCellOrBatchEditMode() && editingController.allowUpdating({\r\n                row: parameters.row\r\n            });\r\n            needCreateValidator = isEditRow || isCellOrBatchEditingAllowed && showEditorAlways;\r\n            if (isCellOrBatchEditingAllowed && showEditorAlways) {\r\n                var _parameters$row$oldDa, _parameters$row2;\r\n                editingController._addInternalData({\r\n                    key: parameters.key,\r\n                    oldData: null !== (_parameters$row$oldDa = null === (_parameters$row2 = parameters.row) || void 0 === _parameters$row2 ? void 0 : _parameters$row2.oldData) && void 0 !== _parameters$row$oldDa ? _parameters$row$oldDa : parameters.data\r\n                })\r\n            }\r\n        }\r\n        if (needCreateValidator) {\r\n            if ($container && !$container.length) {\r\n                errors.log(\"E1050\");\r\n                return\r\n            }\r\n            this._syncInternalEditingData(parameters);\r\n            var validationData = this._getValidationData(parameters.key, true);\r\n            var getValue = () => {\r\n                var change = editingController.getChangeByKey(null === validationData || void 0 === validationData ? void 0 : validationData.key);\r\n                var value = column.calculateCellValue((null === change || void 0 === change ? void 0 : change.data) || {});\r\n                return void 0 !== value ? value : parameters.value\r\n            };\r\n            var useDefaultValidator = $container && $container.hasClass(\"dx-widget\");\r\n            $container && $container.addClass(this.addWidgetPrefix(VALIDATOR_CLASS));\r\n            var validator = new Validator($container || $(\"<div>\"), {\r\n                name: column.caption,\r\n                validationRules: extend(true, [], column.validationRules),\r\n                validationGroup: validationData,\r\n                adapter: useDefaultValidator ? null : {\r\n                    getValue: getValue,\r\n                    applyValidationResults: result => {\r\n                        this.applyValidationResult($container, result)\r\n                    }\r\n                },\r\n                dataGetter: function() {\r\n                    var key = null === validationData || void 0 === validationData ? void 0 : validationData.key;\r\n                    var change = editingController.getChangeByKey(key);\r\n                    var oldData = editingController._getOldData(key);\r\n                    return {\r\n                        data: createObjectWithChanges(oldData, null === change || void 0 === change ? void 0 : change.data),\r\n                        column: column\r\n                    }\r\n                },\r\n                onInitialized: this.validatorInitialized.bind(this),\r\n                onDisposing: this.validatorDisposing.bind(this)\r\n            });\r\n            if (useDefaultValidator) {\r\n                var adapter = validator.option(\"adapter\");\r\n                if (adapter) {\r\n                    adapter.getValue = getValue;\r\n                    adapter.validationRequestsCallbacks = [];\r\n                    adapter.bypass = () => parameters.row.isNewRow && !this._isValidationInProgress && !editingController.isCellModified(parameters)\r\n                }\r\n            }\r\n            return validator\r\n        }\r\n    },\r\n    setDisableApplyValidationResults: function(flag) {\r\n        this._disableApplyValidationResults = flag\r\n    },\r\n    getDisableApplyValidationResults: function() {\r\n        return this._disableApplyValidationResults\r\n    },\r\n    isCurrentValidatorProcessing: function(_ref2) {\r\n        var {\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex\r\n        } = _ref2;\r\n        return this._currentCellValidator && equalByValue(this._currentCellValidator.option(\"validationGroup\").key, rowKey) && this._currentCellValidator.option(\"dataGetter\")().column.index === columnIndex\r\n    },\r\n    validateCell: function(validator) {\r\n        var cellParams = {\r\n            rowKey: validator.option(\"validationGroup\").key,\r\n            columnIndex: validator.option(\"dataGetter\")().column.index\r\n        };\r\n        var validationResult = this.getCellValidationResult(cellParams);\r\n        var stateRestored = validationResultIsValid(validationResult);\r\n        if (!stateRestored) {\r\n            validationResult = validator.validate()\r\n        }\r\n        var deferred = new Deferred;\r\n        var adapter = validator.option(\"adapter\");\r\n        if (stateRestored && validationResult.status === VALIDATION_STATUS.pending) {\r\n            this.updateCellValidationResult(cellParams);\r\n            adapter.applyValidationResults(validationResult)\r\n        }\r\n        when(validationResult.complete || validationResult).done(validationResult => {\r\n            stateRestored && adapter.applyValidationResults(validationResult);\r\n            deferred.resolve(validationResult)\r\n        });\r\n        return deferred.promise()\r\n    },\r\n    updateCellValidationResult: function(_ref3) {\r\n        var {\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex,\r\n            validationResult: validationResult\r\n        } = _ref3;\r\n        var validationData = this._getValidationData(rowKey);\r\n        if (!validationData) {\r\n            return\r\n        }\r\n        if (!validationData.validationResults) {\r\n            validationData.validationResults = {}\r\n        }\r\n        var result;\r\n        if (validationResult) {\r\n            result = extend({}, validationResult);\r\n            validationData.validationResults[columnIndex] = result;\r\n            if (validationResult.status === VALIDATION_STATUS.pending) {\r\n                if (this._editingController.getEditMode() === EDIT_MODE_CELL) {\r\n                    result.deferred = new Deferred;\r\n                    result.complete.always(() => {\r\n                        result.deferred.resolve()\r\n                    });\r\n                    this._editingController.addDeferred(result.deferred)\r\n                }\r\n                if (this._disableApplyValidationResults) {\r\n                    result.disabledPendingId = validationResult.id;\r\n                    return\r\n                }\r\n            }\r\n        } else {\r\n            result = validationData.validationResults[columnIndex]\r\n        }\r\n        if (result && result.disabledPendingId) {\r\n            delete result.disabledPendingId\r\n        }\r\n    },\r\n    getCellValidationResult: function(_ref4) {\r\n        var _validationData$valid;\r\n        var {\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex\r\n        } = _ref4;\r\n        var validationData = this._getValidationData(rowKey, true);\r\n        return null === validationData || void 0 === validationData ? void 0 : null === (_validationData$valid = validationData.validationResults) || void 0 === _validationData$valid ? void 0 : _validationData$valid[columnIndex]\r\n    },\r\n    removeCellValidationResult: function(_ref5) {\r\n        var {\r\n            change: change,\r\n            columnIndex: columnIndex\r\n        } = _ref5;\r\n        var validationData = this._getValidationData(null === change || void 0 === change ? void 0 : change.key);\r\n        if (validationData && validationData.validationResults) {\r\n            this.cancelCellValidationResult({\r\n                change: change,\r\n                columnIndex: columnIndex\r\n            });\r\n            delete validationData.validationResults[columnIndex]\r\n        }\r\n    },\r\n    cancelCellValidationResult: function(_ref6) {\r\n        var {\r\n            change: change,\r\n            columnIndex: columnIndex\r\n        } = _ref6;\r\n        var validationData = this._getValidationData(change.key);\r\n        if (change && validationData.validationResults) {\r\n            var result = validationData.validationResults[columnIndex];\r\n            if (result) {\r\n                result.deferred && result.deferred.reject(VALIDATION_CANCELLED);\r\n                validationData.validationResults[columnIndex] = VALIDATION_CANCELLED\r\n            }\r\n        }\r\n    },\r\n    resetRowValidationResults: function(validationData) {\r\n        if (validationData) {\r\n            validationData.validationResults && delete validationData.validationResults;\r\n            delete validationData.validated\r\n        }\r\n    },\r\n    isInvalidCell: function(_ref7) {\r\n        var {\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex\r\n        } = _ref7;\r\n        var result = this.getCellValidationResult({\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex\r\n        });\r\n        return validationResultIsValid(result) && result.status === VALIDATION_STATUS.invalid\r\n    },\r\n    getCellValidator: function(_ref8) {\r\n        var {\r\n            rowKey: rowKey,\r\n            columnIndex: columnIndex\r\n        } = _ref8;\r\n        var validationData = this._getValidationData(rowKey);\r\n        var groupConfig = validationData && ValidationEngine.getGroupConfig(validationData);\r\n        var validators = groupConfig && groupConfig.validators;\r\n        return validators && validators.filter(v => {\r\n            var column = v.option(\"dataGetter\")().column;\r\n            return column ? column.index === columnIndex : false\r\n        })[0]\r\n    },\r\n    setCellValidationStatus: function(cellOptions) {\r\n        var validationResult = this.getCellValidationResult({\r\n            rowKey: cellOptions.key,\r\n            columnIndex: cellOptions.column.index\r\n        });\r\n        if (isDefined(validationResult)) {\r\n            cellOptions.validationStatus = validationResult !== VALIDATION_CANCELLED ? validationResult.status : VALIDATION_CANCELLED\r\n        } else {\r\n            delete cellOptions.validationStatus\r\n        }\r\n    }\r\n});\r\nexport var validatingModule = {\r\n    defaultOptions: function() {\r\n        return {\r\n            editing: {\r\n                texts: {\r\n                    validationCancelChanges: messageLocalization.format(\"dxDataGrid-validationCancelChanges\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        validating: ValidatingController\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            editing: {\r\n                _addChange: function(changeParams) {\r\n                    var change = this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    if (change && changeParams.type !== EDIT_DATA_REMOVE_TYPE) {\r\n                        validatingController.updateValidationState(change)\r\n                    }\r\n                    return change\r\n                },\r\n                _handleChangesChange: function(args) {\r\n                    this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    args.value.forEach(change => {\r\n                        if (void 0 === validatingController._getValidationData(change.key)) {\r\n                            validatingController.updateValidationState(change)\r\n                        }\r\n                    })\r\n                },\r\n                _updateRowAndPageIndices: function() {\r\n                    var that = this;\r\n                    var startInsertIndex = that.getView(\"rowsView\").getTopVisibleItemIndex();\r\n                    var rowIndex = startInsertIndex;\r\n                    each(that.getChanges(), (_, _ref9) => {\r\n                        var {\r\n                            key: key,\r\n                            type: type\r\n                        } = _ref9;\r\n                        var validationData = this.getController(\"validating\")._getValidationData(key);\r\n                        if (validationData && !validationData.isValid && validationData.pageIndex !== that._pageIndex) {\r\n                            validationData.pageIndex = that._pageIndex;\r\n                            if (type === EDIT_DATA_INSERT_TYPE) {\r\n                                validationData.rowIndex = startInsertIndex\r\n                            } else {\r\n                                validationData.rowIndex = rowIndex\r\n                            }\r\n                            rowIndex++\r\n                        }\r\n                    })\r\n                },\r\n                _getValidationGroupsInForm: function(detailOptions) {\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var validationData = validatingController._getValidationData(detailOptions.key, true);\r\n                    return {\r\n                        validationGroup: validationData\r\n                    }\r\n                },\r\n                _validateEditFormAfterUpdate: function(row, isCustomSetCellValue) {\r\n                    if (isCustomSetCellValue && this._editForm) {\r\n                        this._editForm.validate()\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _prepareEditCell: function(params) {\r\n                    var isNotCanceled = this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    if (isNotCanceled && params.column.showEditorAlways) {\r\n                        validatingController.updateValidationState({\r\n                            key: params.key\r\n                        })\r\n                    }\r\n                    return isNotCanceled\r\n                },\r\n                processItems: function(items, changeType) {\r\n                    var changes = this.getChanges();\r\n                    var dataController = this.getController(\"data\");\r\n                    var validatingController = this.getController(\"validating\");\r\n                    items = this.callBase(items, changeType);\r\n                    var itemsCount = items.length;\r\n                    var addInValidItem = function(change, validationData) {\r\n                        var data = {\r\n                            key: change.key\r\n                        };\r\n                        var index = function(change, items) {\r\n                            var index = -1;\r\n                            var isInsert = change.type === EDIT_DATA_INSERT_TYPE;\r\n                            var key = change.key;\r\n                            each(items, (function(i, item) {\r\n                                if (equalByValue(key, isInsert ? item.key : dataController.keyOf(item))) {\r\n                                    index = i;\r\n                                    return false\r\n                                }\r\n                            }));\r\n                            return index\r\n                        }(change, items);\r\n                        if (index >= 0) {\r\n                            return\r\n                        }\r\n                        validationData.rowIndex = validationData.rowIndex > itemsCount ? validationData.rowIndex % itemsCount : validationData.rowIndex;\r\n                        var rowIndex = validationData.rowIndex;\r\n                        data[INSERT_INDEX] = 1;\r\n                        items.splice(rowIndex, 0, data)\r\n                    };\r\n                    if (this.getEditMode() === EDIT_MODE_BATCH && \"prepend\" !== changeType && \"append\" !== changeType) {\r\n                        changes.forEach(change => {\r\n                            var key = change.key;\r\n                            var validationData = validatingController._getValidationData(key);\r\n                            if (validationData && change.type && validationData.pageIndex === this._pageIndex && (null === change || void 0 === change ? void 0 : change.pageIndex) !== this._pageIndex) {\r\n                                addInValidItem(change, validationData)\r\n                            }\r\n                        })\r\n                    }\r\n                    return items\r\n                },\r\n                processDataItem: function(item) {\r\n                    var isInserted = item.data[INSERT_INDEX];\r\n                    var key = isInserted ? item.data.key : item.key;\r\n                    var editMode = this.getEditMode();\r\n                    if (editMode === EDIT_MODE_BATCH && isInserted && key) {\r\n                        var changes = this.getChanges();\r\n                        var editIndex = gridCoreUtils.getIndexByKey(key, changes);\r\n                        if (editIndex >= 0) {\r\n                            var change = changes[editIndex];\r\n                            if (change.type !== EDIT_DATA_INSERT_TYPE) {\r\n                                var oldData = this._getOldData(change.key);\r\n                                item.data = extend(true, {}, oldData, change.data);\r\n                                item.key = key\r\n                            }\r\n                        }\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _createInvisibleColumnValidators: function(changes) {\r\n                    var that = this;\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var columnsController = this.getController(\"columns\");\r\n                    var columns = columnsController.getColumns();\r\n                    var invisibleColumns = columnsController.getInvisibleColumns().filter(column => !column.isBand);\r\n                    var groupColumns = columnsController.getGroupColumns().filter(column => !column.showWhenGrouped && -1 === invisibleColumns.indexOf(column));\r\n                    var invisibleColumnValidators = [];\r\n                    var isCellVisible = (column, rowKey) => this._dataController.getRowIndexByKey(rowKey) >= 0 && invisibleColumns.indexOf(column) < 0;\r\n                    invisibleColumns.push(...groupColumns);\r\n                    if (-1 === FORM_BASED_MODES.indexOf(this.getEditMode())) {\r\n                        each(columns, (function(_, column) {\r\n                            changes.forEach((function(change) {\r\n                                var data;\r\n                                if (isCellVisible(column, change.key)) {\r\n                                    return\r\n                                }\r\n                                if (change.type === EDIT_DATA_INSERT_TYPE) {\r\n                                    data = change.data\r\n                                } else if (\"update\" === change.type) {\r\n                                    var oldData = that._getOldData(change.key);\r\n                                    data = createObjectWithChanges(oldData, change.data)\r\n                                }\r\n                                if (data) {\r\n                                    var validator = validatingController.createValidator({\r\n                                        column: column,\r\n                                        key: change.key,\r\n                                        value: column.calculateCellValue(data)\r\n                                    });\r\n                                    if (validator) {\r\n                                        invisibleColumnValidators.push(validator)\r\n                                    }\r\n                                }\r\n                            }))\r\n                        }))\r\n                    }\r\n                    return function() {\r\n                        invisibleColumnValidators.forEach((function(validator) {\r\n                            validator.dispose()\r\n                        }))\r\n                    }\r\n                },\r\n                _beforeSaveEditData: function(change, editIndex) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var validationData = validatingController._getValidationData(null === change || void 0 === change ? void 0 : change.key);\r\n                    if (change) {\r\n                        var isValid = \"remove\" === change.type || validationData.isValid;\r\n                        result = result || !isValid\r\n                    } else {\r\n                        var disposeValidators = this._createInvisibleColumnValidators(this.getChanges());\r\n                        result = new Deferred;\r\n                        this.executeOperation(result, () => {\r\n                            validatingController.validate(true).done(isFullValid => {\r\n                                disposeValidators();\r\n                                this._updateRowAndPageIndices();\r\n                                switch (this.getEditMode()) {\r\n                                    case EDIT_MODE_CELL:\r\n                                        if (!isFullValid) {\r\n                                            this._focusEditingCell()\r\n                                        }\r\n                                        break;\r\n                                    case EDIT_MODE_BATCH:\r\n                                        if (!isFullValid) {\r\n                                            this._resetEditRowKey();\r\n                                            this._resetEditColumnName();\r\n                                            this.getController(\"data\").updateItems()\r\n                                        }\r\n                                }\r\n                                result.resolve(!isFullValid)\r\n                            })\r\n                        })\r\n                    }\r\n                    return result.promise ? result.promise() : result\r\n                },\r\n                _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n                    var result = this.callBase(rowIndex, columnIndex, item);\r\n                    if (this.getEditMode() === EDIT_MODE_CELL) {\r\n                        var $cell = this._rowsView._getCellElement(rowIndex, columnIndex);\r\n                        var validator = $cell && $cell.data(\"dxValidator\");\r\n                        var rowOptions = $cell && $cell.closest(\".dx-row\").data(\"options\");\r\n                        var value = validator && validator.option(\"adapter\").getValue();\r\n                        if (validator && cellValueShouldBeValidated(value, rowOptions)) {\r\n                            var validatingController = this.getController(\"validating\");\r\n                            var deferred = new Deferred;\r\n                            when(validatingController.validateCell(validator), result).done((validationResult, result) => {\r\n                                deferred.resolve(validationResult.status === VALIDATION_STATUS.valid && result)\r\n                            });\r\n                            return deferred.promise()\r\n                        } else if (!validator) {\r\n                            return result\r\n                        }\r\n                    }\r\n                },\r\n                _afterSaveEditData: function(cancel) {\r\n                    var $firstErrorRow;\r\n                    var isCellEditMode = this.getEditMode() === EDIT_MODE_CELL;\r\n                    each(this.getChanges(), (_, change) => {\r\n                        var $errorRow = this._showErrorRow(change);\r\n                        $firstErrorRow = $firstErrorRow || $errorRow\r\n                    });\r\n                    if ($firstErrorRow) {\r\n                        var scrollable = this._rowsView.getScrollable();\r\n                        if (scrollable) {\r\n                            scrollable.update();\r\n                            scrollable.scrollToElement($firstErrorRow)\r\n                        }\r\n                    }\r\n                    if (cancel && isCellEditMode && this._needUpdateRow()) {\r\n                        var editRowIndex = this.getEditRowIndex();\r\n                        this._dataController.updateItems({\r\n                            changeType: \"update\",\r\n                            rowIndices: [editRowIndex]\r\n                        });\r\n                        this._focusEditingCell()\r\n                    } else if (!cancel) {\r\n                        var shouldResetValidationState = true;\r\n                        if (isCellEditMode) {\r\n                            var columns = this.getController(\"columns\").getColumns();\r\n                            var columnsWithValidatingEditors = columns.filter(col => {\r\n                                var _col$validationRules;\r\n                                return col.showEditorAlways && (null === (_col$validationRules = col.validationRules) || void 0 === _col$validationRules ? void 0 : _col$validationRules.length) > 0\r\n                            }).length > 0;\r\n                            shouldResetValidationState = !columnsWithValidatingEditors\r\n                        }\r\n                        if (shouldResetValidationState) {\r\n                            this.getController(\"validating\").initValidationState()\r\n                        }\r\n                    }\r\n                },\r\n                _handleDataChanged: function(args) {\r\n                    var validationState = this.getController(\"validating\")._validationState;\r\n                    if (\"standard\" === this.option(\"scrolling.mode\")) {\r\n                        this.resetRowAndPageIndices()\r\n                    }\r\n                    if (\"prepend\" === args.changeType) {\r\n                        each(validationState, (function(_, validationData) {\r\n                            validationData.rowIndex += args.items.length\r\n                        }))\r\n                    }\r\n                    this.callBase(args)\r\n                },\r\n                resetRowAndPageIndices: function() {\r\n                    var validationState = this.getController(\"validating\")._validationState;\r\n                    each(validationState, (_, validationData) => {\r\n                        if (validationData.pageIndex !== this._pageIndex) {\r\n                            delete validationData.pageIndex;\r\n                            delete validationData.rowIndex\r\n                        }\r\n                    })\r\n                },\r\n                _beforeCancelEditData: function() {\r\n                    this.getController(\"validating\").initValidationState();\r\n                    this.callBase()\r\n                },\r\n                _showErrorRow: function(change) {\r\n                    var $popupContent;\r\n                    var errorHandling = this.getController(\"errorHandling\");\r\n                    var items = this.getController(\"data\").items();\r\n                    var rowIndex = this.getIndexByKey(change.key, items);\r\n                    var validationData = this.getController(\"validating\")._getValidationData(change.key);\r\n                    if (!(null !== validationData && void 0 !== validationData && validationData.isValid) && null !== validationData && void 0 !== validationData && validationData.errorText && rowIndex >= 0) {\r\n                        $popupContent = this.getPopupContent();\r\n                        return errorHandling && errorHandling.renderErrorRow(null === validationData || void 0 === validationData ? void 0 : validationData.errorText, rowIndex, $popupContent)\r\n                    }\r\n                },\r\n                updateFieldValue: function(e) {\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var deferred = new Deferred;\r\n                    validatingController.removeCellValidationResult({\r\n                        change: this.getChangeByKey(e.key),\r\n                        columnIndex: e.column.index\r\n                    });\r\n                    this.callBase.apply(this, arguments).done(() => {\r\n                        var currentValidator = validatingController.getCellValidator({\r\n                            rowKey: e.key,\r\n                            columnIndex: e.column.index\r\n                        });\r\n                        when(currentValidator && validatingController.validateCell(currentValidator)).done(validationResult => {\r\n                            this.getController(\"editorFactory\").refocus();\r\n                            deferred.resolve(validationResult)\r\n                        })\r\n                    });\r\n                    return deferred.promise()\r\n                },\r\n                highlightDataCell: function($cell, parameters) {\r\n                    this.callBase.apply(this, arguments);\r\n                    var validatingController = this.getController(\"validating\");\r\n                    validatingController.setCellValidationStatus(parameters);\r\n                    var isEditableCell = !!parameters.setValue;\r\n                    var cellModified = this.isCellModified(parameters);\r\n                    var isValidated = isDefined(parameters.validationStatus);\r\n                    var needValidation = cellModified && parameters.column.setCellValue || isEditableCell && !cellModified && !(parameters.row.isNewRow || !isValidated);\r\n                    if (needValidation) {\r\n                        var validator = $cell.data(\"dxValidator\");\r\n                        if (validator) {\r\n                            when(this.getController(\"validating\").validateCell(validator)).done(() => {\r\n                                validatingController.setCellValidationStatus(parameters)\r\n                            })\r\n                        }\r\n                    }\r\n                },\r\n                getChangeByKey: function(key) {\r\n                    var changes = this.getChanges();\r\n                    return changes[gridCoreUtils.getIndexByKey(key, changes)]\r\n                },\r\n                isCellModified: function(parameters) {\r\n                    var cellModified = this.callBase(parameters);\r\n                    var change = this.getChangeByKey(parameters.key);\r\n                    var isCellInvalid = !!parameters.row && this.getController(\"validating\").isInvalidCell({\r\n                        rowKey: parameters.key,\r\n                        columnIndex: parameters.column.index\r\n                    });\r\n                    return cellModified || this.getController(\"validating\")._rowIsValidated(change) && isCellInvalid\r\n                }\r\n            },\r\n            editorFactory: {\r\n                _showRevertButton: function($container) {\r\n                    if (!$container || !$container.length) {\r\n                        return\r\n                    }\r\n                    var $tooltipElement = this._rowsView.element().find(\".\" + this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\r\n                    var $overlayContainer = $container.closest(\".\".concat(this.addWidgetPrefix(CONTENT_CLASS)));\r\n                    $tooltipElement && $tooltipElement.remove();\r\n                    $tooltipElement = $(\"<div>\").addClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS)).appendTo($container);\r\n                    var tooltipOptions = {\r\n                        animation: null,\r\n                        visible: true,\r\n                        width: \"auto\",\r\n                        height: \"auto\",\r\n                        shading: false,\r\n                        container: $overlayContainer,\r\n                        propagateOutsideClick: true,\r\n                        hideOnOutsideClick: false,\r\n                        copyRootClassesToWrapper: true,\r\n                        _ignoreCopyRootClassesToWrapperDeprecation: true,\r\n                        contentTemplate: () => {\r\n                            var $buttonElement = $(\"<div>\").addClass(REVERT_BUTTON_CLASS);\r\n                            var buttonOptions = {\r\n                                icon: \"revert\",\r\n                                hint: this.option(\"editing.texts.validationCancelChanges\"),\r\n                                onClick: () => {\r\n                                    this._editingController.cancelEditData()\r\n                                }\r\n                            };\r\n                            return new Button($buttonElement, buttonOptions).$element()\r\n                        },\r\n                        position: {\r\n                            my: \"left top\",\r\n                            at: \"right top\",\r\n                            offset: \"1 0\",\r\n                            collision: \"flip\",\r\n                            boundaryOffset: \"0 0\",\r\n                            boundary: this._rowsView.element(),\r\n                            of: $container\r\n                        },\r\n                        onPositioned: this._positionedHandler.bind(this)\r\n                    };\r\n                    return new Overlay($tooltipElement, tooltipOptions)\r\n                },\r\n                _hideFixedGroupCell: function($cell, overlayOptions) {\r\n                    var $nextFixedRowElement;\r\n                    var $groupCellElement;\r\n                    var isFixedColumns = this._rowsView.isFixedColumns();\r\n                    var isFormOrPopupEditMode = this._editingController.isFormOrPopupEditMode();\r\n                    if (isFixedColumns && !isFormOrPopupEditMode) {\r\n                        var nextRowOptions = $cell.closest(\".dx-row\").next().data(\"options\");\r\n                        if (nextRowOptions && \"group\" === nextRowOptions.rowType) {\r\n                            $nextFixedRowElement = $(this._rowsView.getRowElement(nextRowOptions.rowIndex)).last();\r\n                            $groupCellElement = $nextFixedRowElement.find(\".\" + GROUP_CELL_CLASS);\r\n                            if ($groupCellElement.length && \"hidden\" !== $groupCellElement.get(0).style.visibility) {\r\n                                $groupCellElement.css(\"visibility\", \"hidden\");\r\n                                overlayOptions.onDisposing = function() {\r\n                                    $groupCellElement.css(\"visibility\", \"\")\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                },\r\n                _positionedHandler: function(e, isOverlayVisible) {\r\n                    if (!e.component.__skipPositionProcessing) {\r\n                        var isRevertButton = $(e.element).hasClass(this.addWidgetPrefix(REVERT_TOOLTIP_CLASS));\r\n                        var needRepaint = !isRevertButton && this._rowsView.updateFreeSpaceRowHeight();\r\n                        var normalizedPosition = this._normalizeValidationMessagePositionAndMaxWidth(e, isRevertButton, isOverlayVisible);\r\n                        e.component.__skipPositionProcessing = !!(needRepaint || normalizedPosition);\r\n                        if (normalizedPosition) {\r\n                            e.component.option(normalizedPosition)\r\n                        } else if (needRepaint) {\r\n                            e.component.repaint()\r\n                        }\r\n                    }\r\n                },\r\n                _showValidationMessage: function($cell, messages, alignment, revertTooltip) {\r\n                    var editorPopup = $cell.find(\".dx-dropdowneditor-overlay\").data(\"dxPopup\");\r\n                    var isOverlayVisible = editorPopup && editorPopup.option(\"visible\");\r\n                    var myPosition = isOverlayVisible ? \"top right\" : \"top \" + alignment;\r\n                    var atPosition = isOverlayVisible ? \"top left\" : \"bottom \" + alignment;\r\n                    var $overlayContainer = $cell.closest(\".\".concat(this.addWidgetPrefix(CONTENT_CLASS)));\r\n                    var errorMessageText = \"\";\r\n                    messages && messages.forEach((function(message) {\r\n                        errorMessageText += (errorMessageText.length ? \"<br/>\" : \"\") + encodeHtml(message)\r\n                    }));\r\n                    var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\r\n                    this._rowsView.element().find(\".\" + invalidMessageClass).remove();\r\n                    var $overlayElement = $(\"<div>\").addClass(INVALID_MESSAGE_CLASS).addClass(INVALID_MESSAGE_ALWAYS_CLASS).addClass(invalidMessageClass).html(errorMessageText).appendTo($cell);\r\n                    var overlayOptions = {\r\n                        container: $overlayContainer,\r\n                        shading: false,\r\n                        width: \"auto\",\r\n                        height: \"auto\",\r\n                        visible: true,\r\n                        animation: false,\r\n                        propagateOutsideClick: true,\r\n                        hideOnOutsideClick: false,\r\n                        copyRootClassesToWrapper: true,\r\n                        _ignoreCopyRootClassesToWrapperDeprecation: true,\r\n                        position: {\r\n                            collision: \"flip\",\r\n                            boundary: this._rowsView.element(),\r\n                            boundaryOffset: \"0 0\",\r\n                            offset: {\r\n                                x: 0,\r\n                                y: !isOverlayVisible && browser.mozilla ? -1 : 0\r\n                            },\r\n                            my: myPosition,\r\n                            at: atPosition,\r\n                            of: $cell\r\n                        },\r\n                        onPositioned: e => {\r\n                            this._positionedHandler(e, isOverlayVisible);\r\n                            this._shiftValidationMessageIfNeed(e.component.$content(), revertTooltip && revertTooltip.$content(), $cell)\r\n                        }\r\n                    };\r\n                    this._hideFixedGroupCell($cell, overlayOptions);\r\n                    new Overlay($overlayElement, overlayOptions)\r\n                },\r\n                _normalizeValidationMessagePositionAndMaxWidth: function(options, isRevertButton, isOverlayVisible) {\r\n                    var fixedColumns = this._columnsController.getFixedColumns();\r\n                    if (!fixedColumns || !fixedColumns.length) {\r\n                        return\r\n                    }\r\n                    var position;\r\n                    var visibleTableWidth = !isRevertButton && (that = this, element = options.element, rowIndex = $(element).closest(\"tr\").index(), $cellElements = $(that._rowsView.getRowElement(rowIndex)).first().children().filter(\":not(.dx-hidden-cell)\"), that._rowsView._getWidths($cellElements).reduce((w1, w2) => w1 + w2, 0));\r\n                    var that, element, rowIndex, $cellElements;\r\n                    var $overlayContentElement = options.component.$content();\r\n                    var validationMessageWidth = getOuterWidth($overlayContentElement, true);\r\n                    var needMaxWidth = !isRevertButton && validationMessageWidth > visibleTableWidth;\r\n                    var columnIndex = this._rowsView.getCellIndex($(options.element).closest(\"td\"));\r\n                    var boundaryNonFixedColumnsInfo = function(fixedColumns) {\r\n                        var firstNonFixedColumnIndex;\r\n                        var lastNonFixedColumnIndex;\r\n                        fixedColumns.some((column, index) => {\r\n                            if (column.command === COMMAND_TRANSPARENT) {\r\n                                firstNonFixedColumnIndex = 0 === index ? -1 : index;\r\n                                lastNonFixedColumnIndex = index === fixedColumns.length - 1 ? -1 : index + column.colspan - 1;\r\n                                return true\r\n                            }\r\n                        });\r\n                        return {\r\n                            startColumnIndex: firstNonFixedColumnIndex,\r\n                            endColumnIndex: lastNonFixedColumnIndex\r\n                        }\r\n                    }(fixedColumns);\r\n                    if (!isRevertButton && (columnIndex === boundaryNonFixedColumnsInfo.startColumnIndex || needMaxWidth)) {\r\n                        position = {\r\n                            collision: \"none flip\",\r\n                            my: \"top left\",\r\n                            at: isOverlayVisible ? \"top right\" : \"bottom left\"\r\n                        }\r\n                    } else if (columnIndex === boundaryNonFixedColumnsInfo.endColumnIndex) {\r\n                        position = {\r\n                            collision: \"none flip\",\r\n                            my: \"top right\",\r\n                            at: isRevertButton || isOverlayVisible ? \"top left\" : \"bottom right\"\r\n                        };\r\n                        if (isRevertButton) {\r\n                            position.offset = \"-1 0\"\r\n                        }\r\n                    }\r\n                    return position && {\r\n                        position: position,\r\n                        maxWidth: needMaxWidth ? visibleTableWidth - 2 : void 0\r\n                    }\r\n                },\r\n                _shiftValidationMessageIfNeed: function($content, $revertContent, $cell) {\r\n                    if (!$revertContent) {\r\n                        return\r\n                    }\r\n                    var contentOffset = $content.offset();\r\n                    var revertContentOffset = $revertContent.offset();\r\n                    if (contentOffset.top === revertContentOffset.top && contentOffset.left + getWidth($content) > revertContentOffset.left) {\r\n                        var left = getWidth($revertContent) + PADDING_BETWEEN_TOOLTIPS;\r\n                        $content.css(\"left\", revertContentOffset.left < $cell.offset().left ? -left : left)\r\n                    }\r\n                },\r\n                _getTooltipsSelector: function() {\r\n                    var invalidMessageClass = this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS);\r\n                    var revertTooltipClass = this.addWidgetPrefix(REVERT_TOOLTIP_CLASS);\r\n                    return \".dx-editor-cell .\" + revertTooltipClass + \", .dx-editor-cell .\" + invalidMessageClass + \", .dx-cell-modified .\" + invalidMessageClass\r\n                },\r\n                init: function() {\r\n                    this.callBase();\r\n                    this._editingController = this.getController(\"editing\");\r\n                    this._columnsController = this.getController(\"columns\");\r\n                    this._rowsView = this.getView(\"rowsView\")\r\n                },\r\n                loseFocus: function(skipValidator) {\r\n                    if (!skipValidator) {\r\n                        this.getController(\"validating\").setValidator(null)\r\n                    }\r\n                    this.callBase()\r\n                },\r\n                updateCellState: function($element, validationResult, hideBorder) {\r\n                    var _change$data;\r\n                    var $focus = null === $element || void 0 === $element ? void 0 : $element.closest(this._getFocusCellSelector());\r\n                    var $cell = null !== $focus && void 0 !== $focus && $focus.is(\"td\") ? $focus : null;\r\n                    var rowOptions = null === $focus || void 0 === $focus ? void 0 : $focus.closest(\".dx-row\").data(\"options\");\r\n                    var change = rowOptions ? this.getController(\"editing\").getChangeByKey(rowOptions.key) : null;\r\n                    var column = $cell && this.getController(\"columns\").getVisibleColumns()[$cell.index()];\r\n                    var isCellModified = void 0 !== (null === change || void 0 === change ? void 0 : null === (_change$data = change.data) || void 0 === _change$data ? void 0 : _change$data[null === column || void 0 === column ? void 0 : column.name]) && !this._editingController.isSaving();\r\n                    var revertTooltip;\r\n                    if ((null === validationResult || void 0 === validationResult ? void 0 : validationResult.status) === VALIDATION_STATUS.invalid || isCellModified) {\r\n                        if (this._editingController.getEditMode() === EDIT_MODE_CELL) {\r\n                            revertTooltip = this._showRevertButton($focus)\r\n                        }\r\n                    }\r\n                    var showValidationMessage = validationResult && validationResult.status === VALIDATION_STATUS.invalid;\r\n                    if (showValidationMessage && $cell && column && validationResult && validationResult.brokenRules) {\r\n                        var errorMessages = [];\r\n                        validationResult.brokenRules.forEach((function(rule) {\r\n                            if (rule.message) {\r\n                                errorMessages.push(rule.message)\r\n                            }\r\n                        }));\r\n                        if (errorMessages.length) {\r\n                            this._showValidationMessage($focus, errorMessages, column.alignment || \"left\", revertTooltip)\r\n                        }\r\n                    }!hideBorder && this._rowsView.element() && this._rowsView.updateFreeSpaceRowHeight()\r\n                },\r\n                focus: function($element, hideBorder) {\r\n                    if (!arguments.length) {\r\n                        return this.callBase()\r\n                    }\r\n                    var $tooltips = $element && $element.closest(\".\" + this.addWidgetPrefix(ROWS_VIEW_CLASS)).find(this._getTooltipsSelector());\r\n                    $tooltips && $tooltips.remove();\r\n                    if (null !== $element && void 0 !== $element && $element.hasClass(\"dx-row\")) {\r\n                        return this.callBase($element, hideBorder)\r\n                    }\r\n                    var $focus = null === $element || void 0 === $element ? void 0 : $element.closest(this._getFocusCellSelector());\r\n                    var callBase = this.callBase;\r\n                    var validator = $focus && ($focus.data(\"dxValidator\") || $element.find(\".\" + this.addWidgetPrefix(VALIDATOR_CLASS)).eq(0).data(\"dxValidator\"));\r\n                    var rowOptions = $focus && $focus.closest(\".dx-row\").data(\"options\");\r\n                    var editingController = this.getController(\"editing\");\r\n                    var change = rowOptions ? editingController.getChangeByKey(rowOptions.key) : null;\r\n                    var validationResult;\r\n                    var validatingController = this.getController(\"validating\");\r\n                    if (validator) {\r\n                        validatingController.setValidator(validator);\r\n                        var value = validator.option(\"adapter\").getValue();\r\n                        if (cellValueShouldBeValidated(value, rowOptions) || validatingController._rowIsValidated(change)) {\r\n                            editingController.waitForDeferredOperations().done(() => {\r\n                                when(validatingController.validateCell(validator)).done(result => {\r\n                                    validationResult = result;\r\n                                    var column = validationResult.validator.option(\"dataGetter\")().column;\r\n                                    if (change && column && !validatingController.isCurrentValidatorProcessing({\r\n                                            rowKey: change.key,\r\n                                            columnIndex: column.index\r\n                                        })) {\r\n                                        return\r\n                                    }\r\n                                    if (validationResult.status === VALIDATION_STATUS.invalid) {\r\n                                        hideBorder = true\r\n                                    }\r\n                                    this.updateCellState($element, validationResult, hideBorder);\r\n                                    callBase.call(this, $element, hideBorder)\r\n                                })\r\n                            });\r\n                            return this.callBase($element, hideBorder)\r\n                        }\r\n                    }\r\n                    this.updateCellState($element, validationResult, hideBorder);\r\n                    return this.callBase($element, hideBorder)\r\n                },\r\n                getEditorInstance: function($container) {\r\n                    var $editor = $container.find(\".dx-texteditor\").eq(0);\r\n                    return gridCoreUtils.getWidgetInstance($editor)\r\n                }\r\n            },\r\n            data: {\r\n                _isCellChanged: function(oldRow, newRow, visibleRowIndex, columnIndex, isLiveUpdate) {\r\n                    var _oldRow$cells, _cell$column$validati;\r\n                    var cell = null === (_oldRow$cells = oldRow.cells) || void 0 === _oldRow$cells ? void 0 : _oldRow$cells[columnIndex];\r\n                    var oldValidationStatus = cell && cell.validationStatus;\r\n                    var validatingController = this.getController(\"validating\");\r\n                    var validationResult = validatingController.getCellValidationResult({\r\n                        rowKey: oldRow.key,\r\n                        columnIndex: columnIndex\r\n                    });\r\n                    var validationData = validatingController._getValidationData(oldRow.key);\r\n                    var newValidationStatus = validationResultIsValid(validationResult) ? validationResult.status : validationResult;\r\n                    var rowIsModified = JSON.stringify(newRow.modifiedValues) !== JSON.stringify(oldRow.modifiedValues);\r\n                    var cellIsMarkedAsInvalid = $(null === cell || void 0 === cell ? void 0 : cell.cellElement).hasClass(this.addWidgetPrefix(INVALIDATE_CLASS));\r\n                    var editingChanged = oldRow.isEditing !== newRow.isEditing;\r\n                    var hasValidationRules = null === cell || void 0 === cell ? void 0 : null === (_cell$column$validati = cell.column.validationRules) || void 0 === _cell$column$validati ? void 0 : _cell$column$validati.length;\r\n                    if (editingChanged && hasValidationRules || oldValidationStatus !== newValidationStatus && rowIsModified || validationData.isValid && cellIsMarkedAsInvalid) {\r\n                        return true\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                updateFreeSpaceRowHeight: function($table) {\r\n                    var $rowElements;\r\n                    var $freeSpaceRowElement;\r\n                    var $freeSpaceRowElements;\r\n                    var $element = this.element();\r\n                    var $tooltipContent = $element && $element.find(\".\" + this.addWidgetPrefix(WIDGET_INVALID_MESSAGE_CLASS) + \" .dx-overlay-content\");\r\n                    this.callBase($table);\r\n                    if ($tooltipContent && $tooltipContent.length) {\r\n                        $rowElements = this._getRowElements();\r\n                        $freeSpaceRowElements = this._getFreeSpaceRowElements($table);\r\n                        $freeSpaceRowElement = $freeSpaceRowElements.first();\r\n                        if ($freeSpaceRowElement && 1 === $rowElements.length && (!$freeSpaceRowElement.is(\":visible\") || getOuterHeight($tooltipContent) > getOuterHeight($freeSpaceRowElement))) {\r\n                            $freeSpaceRowElements.show();\r\n                            setHeight($freeSpaceRowElements, getOuterHeight($tooltipContent));\r\n                            return true\r\n                        }\r\n                    }\r\n                },\r\n                _formItemPrepared: function(cellOptions, $container) {\r\n                    this.callBase.apply(this, arguments);\r\n                    deferUpdate(() => {\r\n                        var $editor = $container.find(\".dx-widget\").first();\r\n                        var isEditorDisposed = $editor.length && !$editor.children().length;\r\n                        if (!isEditorDisposed) {\r\n                            this.getController(\"validating\").createValidator(cellOptions, $editor)\r\n                        }\r\n                    })\r\n                },\r\n                _cellPrepared: function($cell, parameters) {\r\n                    if (!this.getController(\"editing\").isFormOrPopupEditMode()) {\r\n                        this.getController(\"validating\").createValidator(parameters, $cell)\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _restoreErrorRow: function(contentTable) {\r\n                    var editingController = this.getController(\"editing\");\r\n                    editingController && editingController.hasChanges() && this._getRowElements(contentTable).each((_, item) => {\r\n                        var rowOptions = $(item).data(\"options\");\r\n                        if (rowOptions) {\r\n                            var change = editingController.getChangeByKey(rowOptions.key);\r\n                            change && editingController._showErrorRow(change)\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}