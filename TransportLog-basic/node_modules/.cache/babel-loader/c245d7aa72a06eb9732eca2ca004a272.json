{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport modules from \"./ui.grid_core.modules\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport { isDefined, isFunction } from \"../../core/utils/type\";\nimport { each } from \"../../core/utils/iterator\";\nimport { extend } from \"../../core/utils/extend\";\nimport Popup from \"../popup\";\nimport TreeView from \"../tree_view\";\nimport List from \"../list_light\";\nimport \"../list/modules/search\";\nimport \"../list/modules/selection\";\nimport messageLocalization from \"../../localization/message\";\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\n\nfunction resetChildrenItemSelection(items) {\n  items = items || [];\n\n  for (var i = 0; i < items.length; i++) {\n    items[i].selected = false;\n    resetChildrenItemSelection(items[i].items);\n  }\n}\n\nfunction updateSelectAllState(e, filterValues) {\n  if (e.component.option(\"searchValue\")) {\n    return;\n  }\n\n  var selectAllCheckBox = $(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\n\n  if (selectAllCheckBox && filterValues && filterValues.length) {\n    selectAllCheckBox.option(\"value\", void 0);\n  }\n}\n\nfunction isSearchEnabled(that, options) {\n  var headerFilter = options.headerFilter;\n\n  if (headerFilter && isDefined(headerFilter.allowSearch)) {\n    return headerFilter.allowSearch;\n  }\n\n  return that.option(\"headerFilter.allowSearch\");\n}\n\nexport function updateHeaderFilterItemSelectionState(item, filterValuesMatch, isExcludeFilter) {\n  if (filterValuesMatch ^ isExcludeFilter) {\n    item.selected = true;\n\n    if (isExcludeFilter && item.items) {\n      for (var j = 0; j < item.items.length; j++) {\n        if (!item.items[j].selected) {\n          item.selected = void 0;\n          break;\n        }\n      }\n    }\n  } else if (isExcludeFilter || item.selected) {\n    item.selected = false;\n    resetChildrenItemSelection(item.items);\n  }\n}\nexport var HeaderFilterView = modules.View.inherit({\n  getPopupContainer: function () {\n    return this._popupContainer;\n  },\n  getListContainer: function () {\n    return this._listContainer;\n  },\n  applyHeaderFilter: function (options) {\n    var list = this.getListContainer();\n    var searchValue = list.option(\"searchValue\");\n    var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\n    var filterValues = [];\n\n    if (!isSelectAll) {\n      if (\"tree\" === options.type) {\n        if (options.filterType) {\n          options.filterType = \"include\";\n        }\n\n        !function fillSelectedItemKeys(filterValues, items, isExclude) {\n          each(items, function (_, item) {\n            if (void 0 !== item.selected && !!item.selected ^ isExclude) {\n              var node = list._getNode(item);\n\n              var hasChildren = list._hasChildren(node);\n\n              var hasChildrenWithSelection = hasChildren && item.items && item.items.some(item => item.selected);\n\n              if (!searchValue || !hasChildrenWithSelection) {\n                filterValues.push(item.value);\n                return;\n              }\n            }\n\n            if (item.items && item.items.length) {\n              fillSelectedItemKeys(filterValues, item.items, isExclude);\n            }\n          });\n        }(filterValues, list.option(\"items\"), false);\n        options.filterValues = filterValues;\n      }\n    } else {\n      if (\"tree\" === options.type) {\n        options.filterType = \"exclude\";\n      }\n\n      if (Array.isArray(options.filterValues)) {\n        options.filterValues = [];\n      }\n    }\n\n    if (options.filterValues && !options.filterValues.length) {\n      options.filterValues = null;\n    }\n\n    options.apply();\n    this.hideHeaderFilterMenu();\n  },\n  showHeaderFilterMenu: function ($columnElement, options) {\n    if (options) {\n      this._initializePopupContainer(options);\n\n      var popupContainer = this.getPopupContainer();\n      this.hideHeaderFilterMenu();\n      this.updatePopup($columnElement, options);\n      popupContainer.show();\n    }\n  },\n  hideHeaderFilterMenu: function () {\n    var headerFilterMenu = this.getPopupContainer();\n    headerFilterMenu && headerFilterMenu.hide();\n  },\n  updatePopup: function ($element, options) {\n    var showColumnLines = this.option(\"showColumnLines\");\n    var alignment = \"right\" === options.alignment ^ !showColumnLines ? \"left\" : \"right\";\n\n    this._popupContainer.setAria({\n      role: \"dialog\",\n      label: messageLocalization.format(\"dxDataGrid-headerFilterLabel\")\n    });\n\n    if (this._popupContainer) {\n      this._cleanPopupContent();\n\n      this._popupContainer.option(\"position\", {\n        my: alignment + \" top\",\n        at: alignment + \" bottom\",\n        of: $element,\n        collision: \"flip fit\"\n      });\n    }\n  },\n  _getSearchExpr: function (options) {\n    var lookup = options.lookup;\n    var useDefaultSearchExpr = options.useDefaultSearchExpr;\n    var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\n\n    if (useDefaultSearchExpr || isDefined(headerFilterDataSource) && !isFunction(headerFilterDataSource)) {\n      return DEFAULT_SEARCH_EXPRESSION;\n    }\n\n    if (lookup) {\n      return lookup.displayExpr || \"this\";\n    }\n\n    if (options.dataSource) {\n      var group = options.dataSource.group;\n\n      if (Array.isArray(group) && group.length > 0) {\n        return group[0].selector;\n      } else if (isFunction(group) && !options.remoteFiltering) {\n        return group;\n      }\n    }\n\n    return options.dataField || options.selector;\n  },\n  _cleanPopupContent: function () {\n    this._popupContainer && this._popupContainer.$content().empty();\n  },\n  _initializePopupContainer: function (options) {\n    var that = this;\n    var $element = that.element();\n    var headerFilterOptions = that.option(\"headerFilter\");\n    var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\n    var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\n    var dxPopupOptions = {\n      width: width,\n      height: height,\n      visible: false,\n      shading: false,\n      showTitle: false,\n      showCloseButton: false,\n      hideOnParentScroll: false,\n      dragEnabled: false,\n      hideOnOutsideClick: true,\n      focusStateEnabled: false,\n      copyRootClassesToWrapper: true,\n      _ignoreCopyRootClassesToWrapperDeprecation: true,\n      toolbarItems: [{\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.ok,\n          onClick: function () {\n            that.applyHeaderFilter(options);\n          }\n        }\n      }, {\n        toolbar: \"bottom\",\n        location: \"after\",\n        widget: \"dxButton\",\n        options: {\n          text: headerFilterOptions.texts.cancel,\n          onClick: function () {\n            that.hideHeaderFilterMenu();\n          }\n        }\n      }],\n      resizeEnabled: true,\n      onShowing: function (e) {\n        e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\n\n        that._initializeListContainer(options);\n\n        options.onShowing && options.onShowing(e);\n      },\n      onShown: function () {\n        that.getListContainer().focus();\n      },\n      onHidden: options.onHidden,\n      onInitialized: function (e) {\n        var component = e.component;\n        component.option(\"animation\", component._getDefaultOptions().animation);\n      }\n    };\n\n    if (!isDefined(that._popupContainer)) {\n      that._popupContainer = that._createComponent($element, Popup, dxPopupOptions);\n    } else {\n      that._popupContainer.option(dxPopupOptions);\n    }\n  },\n  _initializeListContainer: function (options) {\n    var that = this;\n\n    var $content = that._popupContainer.$content();\n\n    var widgetOptions = {\n      searchEnabled: isSearchEnabled(that, options),\n      searchTimeout: that.option(\"headerFilter.searchTimeout\"),\n      searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\n      dataSource: options.dataSource,\n      onContentReady: function () {\n        that.renderCompleted.fire();\n      },\n      itemTemplate: function (data, _, element) {\n        var $element = $(element);\n\n        if (options.encodeHtml) {\n          return $element.text(data.text);\n        }\n\n        return $element.html(data.text);\n      }\n    };\n\n    function onOptionChanged(e) {\n      if (\"searchValue\" === e.fullName && !options.isFilterBuilder && false !== that.option(\"headerFilter.hideSelectAllOnSearch\")) {\n        if (\"tree\" === options.type) {\n          e.component.option(\"showCheckBoxesMode\", e.value ? \"normal\" : \"selectAll\");\n        } else {\n          e.component.option(\"selectionMode\", e.value ? \"multiple\" : \"all\");\n        }\n      }\n    }\n\n    if (\"tree\" === options.type) {\n      that._listContainer = that._createComponent($(\"<div>\").appendTo($content), TreeView, extend(widgetOptions, {\n        showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\n        onOptionChanged: onOptionChanged,\n        keyExpr: \"id\"\n      }));\n    } else {\n      that._listContainer = that._createComponent($(\"<div>\").appendTo($content), List, extend(widgetOptions, {\n        searchExpr: that._getSearchExpr(options),\n        pageLoadMode: \"scrollBottom\",\n        showSelectionControls: true,\n        selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\n        onOptionChanged: onOptionChanged,\n        onSelectionChanged: function (e) {\n          var items = e.component.option(\"items\");\n          var selectedItems = e.component.option(\"selectedItems\");\n\n          if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\n            var filterValues = options.filterValues || [];\n            var isExclude = \"exclude\" === options.filterType;\n\n            if (0 === selectedItems.length && items.length && (filterValues.length <= 1 || isExclude && filterValues.length === items.length - 1)) {\n              options.filterType = \"include\";\n              options.filterValues = [];\n            } else if (selectedItems.length === items.length) {\n              options.filterType = \"exclude\";\n              options.filterValues = [];\n            }\n          }\n\n          each(items, function (index, item) {\n            var selected = gridCoreUtils.getIndexByKey(item, selectedItems, null) >= 0;\n            var oldSelected = !!item.selected;\n\n            if (oldSelected !== selected) {\n              item.selected = selected;\n              options.filterValues = options.filterValues || [];\n              var filterValueIndex = gridCoreUtils.getIndexByKey(item.value, options.filterValues, null);\n\n              if (filterValueIndex >= 0) {\n                options.filterValues.splice(filterValueIndex, 1);\n              }\n\n              if (selected ^ \"exclude\" === options.filterType) {\n                options.filterValues.push(item.value);\n              }\n            }\n          });\n          updateSelectAllState(e, options.filterValues);\n        },\n        onContentReady: function (e) {\n          var component = e.component;\n          var items = component.option(\"items\");\n          var selectedItems = [];\n          each(items, function () {\n            if (this.selected) {\n              selectedItems.push(this);\n            }\n          });\n          component._selectedItemsUpdating = true;\n          component.option(\"selectedItems\", selectedItems);\n          component._selectedItemsUpdating = false;\n          updateSelectAllState(e, options.filterValues);\n        }\n      }));\n    }\n  },\n  _renderCore: function () {\n    this.element().addClass(HEADER_FILTER_MENU_CLASS);\n  }\n});\nexport var allowHeaderFiltering = function (column) {\n  return isDefined(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering;\n};\nexport var headerFilterMixin = {\n  _applyColumnState: function (options) {\n    var $headerFilterIndicator;\n    var rootElement = options.rootElement;\n    var column = options.column;\n\n    if (\"headerFilter\" === options.name) {\n      rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\n\n      if (allowHeaderFiltering(column)) {\n        $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\n\n        if (!this.option(\"useLegacyKeyboardNavigation\")) {\n          $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0);\n        }\n\n        var indicatorLabel = messageLocalization.format(\"dxDataGrid-headerFilterIndicatorLabel\", column.caption);\n        $headerFilterIndicator.attr(\"aria-label\", indicatorLabel);\n        $headerFilterIndicator.attr(\"aria-haspopup\", \"dialog\");\n        $headerFilterIndicator.attr(\"role\", \"button\");\n      }\n\n      return $headerFilterIndicator;\n    }\n\n    return this.callBase(options);\n  },\n  _isHeaderFilterEmpty: function (column) {\n    return !column.filterValues || !column.filterValues.length;\n  },\n  _getIndicatorClassName: function (name) {\n    if (\"headerFilter\" === name) {\n      return HEADER_FILTER_CLASS;\n    }\n\n    return this.callBase(name);\n  },\n  _renderIndicator: function (options) {\n    var $container = options.container;\n    var $indicator = options.indicator;\n\n    if (\"headerFilter\" === options.name) {\n      var rtlEnabled = this.option(\"rtlEnabled\");\n\n      if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\n        $container.prepend($indicator);\n        return;\n      }\n    }\n\n    this.callBase(options);\n  },\n  optionChanged: function (args) {\n    if (\"headerFilter\" === args.name) {\n      var requireReady = \"columnHeadersView\" === this.name;\n\n      this._invalidate(requireReady, requireReady);\n\n      args.handled = true;\n    } else {\n      this.callBase(args);\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.header_filter_core.js"],"names":["$","modules","gridCoreUtils","isDefined","isFunction","each","extend","Popup","TreeView","List","messageLocalization","HEADER_FILTER_CLASS","HEADER_FILTER_MENU_CLASS","DEFAULT_SEARCH_EXPRESSION","resetChildrenItemSelection","items","i","length","selected","updateSelectAllState","e","filterValues","component","option","selectAllCheckBox","element","find","data","isSearchEnabled","that","options","headerFilter","allowSearch","updateHeaderFilterItemSelectionState","item","filterValuesMatch","isExcludeFilter","j","HeaderFilterView","View","inherit","getPopupContainer","_popupContainer","getListContainer","_listContainer","applyHeaderFilter","list","searchValue","isSelectAll","isFilterBuilder","$element","eq","hasClass","type","filterType","fillSelectedItemKeys","isExclude","_","node","_getNode","hasChildren","_hasChildren","hasChildrenWithSelection","some","push","value","Array","isArray","apply","hideHeaderFilterMenu","showHeaderFilterMenu","$columnElement","_initializePopupContainer","popupContainer","updatePopup","show","headerFilterMenu","hide","showColumnLines","alignment","setAria","role","label","format","_cleanPopupContent","my","at","of","collision","_getSearchExpr","lookup","useDefaultSearchExpr","headerFilterDataSource","dataSource","displayExpr","group","selector","remoteFiltering","dataField","$content","empty","headerFilterOptions","width","height","dxPopupOptions","visible","shading","showTitle","showCloseButton","hideOnParentScroll","dragEnabled","hideOnOutsideClick","focusStateEnabled","copyRootClassesToWrapper","_ignoreCopyRootClassesToWrapperDeprecation","toolbarItems","toolbar","location","widget","text","texts","ok","onClick","cancel","resizeEnabled","onShowing","parent","addClass","_initializeListContainer","onShown","focus","onHidden","onInitialized","_getDefaultOptions","animation","_createComponent","widgetOptions","searchEnabled","searchTimeout","searchMode","onContentReady","renderCompleted","fire","itemTemplate","encodeHtml","html","onOptionChanged","fullName","appendTo","showCheckBoxesMode","keyExpr","searchExpr","pageLoadMode","showSelectionControls","selectionMode","onSelectionChanged","selectedItems","_selectedItemsUpdating","index","getIndexByKey","oldSelected","filterValueIndex","splice","_renderCore","allowHeaderFiltering","column","allowFiltering","headerFilterMixin","_applyColumnState","$headerFilterIndicator","rootElement","name","remove","callBase","toggleClass","_isHeaderFilterEmpty","attr","indicatorLabel","caption","_getIndicatorClassName","_renderIndicator","$container","container","$indicator","indicator","rtlEnabled","children","columnAlignment","prepend","optionChanged","args","requireReady","_invalidate","handled"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.header_filter_core.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport modules from \"./ui.grid_core.modules\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nimport {\r\n    isDefined,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport Popup from \"../popup\";\r\nimport TreeView from \"../tree_view\";\r\nimport List from \"../list_light\";\r\nimport \"../list/modules/search\";\r\nimport \"../list/modules/selection\";\r\nimport messageLocalization from \"../../localization/message\";\r\nvar HEADER_FILTER_CLASS = \"dx-header-filter\";\r\nvar HEADER_FILTER_MENU_CLASS = \"dx-header-filter-menu\";\r\nvar DEFAULT_SEARCH_EXPRESSION = \"text\";\r\n\r\nfunction resetChildrenItemSelection(items) {\r\n    items = items || [];\r\n    for (var i = 0; i < items.length; i++) {\r\n        items[i].selected = false;\r\n        resetChildrenItemSelection(items[i].items)\r\n    }\r\n}\r\n\r\nfunction updateSelectAllState(e, filterValues) {\r\n    if (e.component.option(\"searchValue\")) {\r\n        return\r\n    }\r\n    var selectAllCheckBox = $(e.element).find(\".dx-list-select-all-checkbox\").data(\"dxCheckBox\");\r\n    if (selectAllCheckBox && filterValues && filterValues.length) {\r\n        selectAllCheckBox.option(\"value\", void 0)\r\n    }\r\n}\r\n\r\nfunction isSearchEnabled(that, options) {\r\n    var headerFilter = options.headerFilter;\r\n    if (headerFilter && isDefined(headerFilter.allowSearch)) {\r\n        return headerFilter.allowSearch\r\n    }\r\n    return that.option(\"headerFilter.allowSearch\")\r\n}\r\nexport function updateHeaderFilterItemSelectionState(item, filterValuesMatch, isExcludeFilter) {\r\n    if (filterValuesMatch ^ isExcludeFilter) {\r\n        item.selected = true;\r\n        if (isExcludeFilter && item.items) {\r\n            for (var j = 0; j < item.items.length; j++) {\r\n                if (!item.items[j].selected) {\r\n                    item.selected = void 0;\r\n                    break\r\n                }\r\n            }\r\n        }\r\n    } else if (isExcludeFilter || item.selected) {\r\n        item.selected = false;\r\n        resetChildrenItemSelection(item.items)\r\n    }\r\n}\r\nexport var HeaderFilterView = modules.View.inherit({\r\n    getPopupContainer: function() {\r\n        return this._popupContainer\r\n    },\r\n    getListContainer: function() {\r\n        return this._listContainer\r\n    },\r\n    applyHeaderFilter: function(options) {\r\n        var list = this.getListContainer();\r\n        var searchValue = list.option(\"searchValue\");\r\n        var isSelectAll = !searchValue && !options.isFilterBuilder && list.$element().find(\".dx-checkbox\").eq(0).hasClass(\"dx-checkbox-checked\");\r\n        var filterValues = [];\r\n        if (!isSelectAll) {\r\n            if (\"tree\" === options.type) {\r\n                if (options.filterType) {\r\n                    options.filterType = \"include\"\r\n                }! function fillSelectedItemKeys(filterValues, items, isExclude) {\r\n                    each(items, (function(_, item) {\r\n                        if (void 0 !== item.selected && !!item.selected ^ isExclude) {\r\n                            var node = list._getNode(item);\r\n                            var hasChildren = list._hasChildren(node);\r\n                            var hasChildrenWithSelection = hasChildren && item.items && item.items.some(item => item.selected);\r\n                            if (!searchValue || !hasChildrenWithSelection) {\r\n                                filterValues.push(item.value);\r\n                                return\r\n                            }\r\n                        }\r\n                        if (item.items && item.items.length) {\r\n                            fillSelectedItemKeys(filterValues, item.items, isExclude)\r\n                        }\r\n                    }))\r\n                }(filterValues, list.option(\"items\"), false);\r\n                options.filterValues = filterValues\r\n            }\r\n        } else {\r\n            if (\"tree\" === options.type) {\r\n                options.filterType = \"exclude\"\r\n            }\r\n            if (Array.isArray(options.filterValues)) {\r\n                options.filterValues = []\r\n            }\r\n        }\r\n        if (options.filterValues && !options.filterValues.length) {\r\n            options.filterValues = null\r\n        }\r\n        options.apply();\r\n        this.hideHeaderFilterMenu()\r\n    },\r\n    showHeaderFilterMenu: function($columnElement, options) {\r\n        if (options) {\r\n            this._initializePopupContainer(options);\r\n            var popupContainer = this.getPopupContainer();\r\n            this.hideHeaderFilterMenu();\r\n            this.updatePopup($columnElement, options);\r\n            popupContainer.show()\r\n        }\r\n    },\r\n    hideHeaderFilterMenu: function() {\r\n        var headerFilterMenu = this.getPopupContainer();\r\n        headerFilterMenu && headerFilterMenu.hide()\r\n    },\r\n    updatePopup: function($element, options) {\r\n        var showColumnLines = this.option(\"showColumnLines\");\r\n        var alignment = \"right\" === options.alignment ^ !showColumnLines ? \"left\" : \"right\";\r\n        this._popupContainer.setAria({\r\n            role: \"dialog\",\r\n            label: messageLocalization.format(\"dxDataGrid-headerFilterLabel\")\r\n        });\r\n        if (this._popupContainer) {\r\n            this._cleanPopupContent();\r\n            this._popupContainer.option(\"position\", {\r\n                my: alignment + \" top\",\r\n                at: alignment + \" bottom\",\r\n                of: $element,\r\n                collision: \"flip fit\"\r\n            })\r\n        }\r\n    },\r\n    _getSearchExpr: function(options) {\r\n        var lookup = options.lookup;\r\n        var useDefaultSearchExpr = options.useDefaultSearchExpr;\r\n        var headerFilterDataSource = options.headerFilter && options.headerFilter.dataSource;\r\n        if (useDefaultSearchExpr || isDefined(headerFilterDataSource) && !isFunction(headerFilterDataSource)) {\r\n            return DEFAULT_SEARCH_EXPRESSION\r\n        }\r\n        if (lookup) {\r\n            return lookup.displayExpr || \"this\"\r\n        }\r\n        if (options.dataSource) {\r\n            var group = options.dataSource.group;\r\n            if (Array.isArray(group) && group.length > 0) {\r\n                return group[0].selector\r\n            } else if (isFunction(group) && !options.remoteFiltering) {\r\n                return group\r\n            }\r\n        }\r\n        return options.dataField || options.selector\r\n    },\r\n    _cleanPopupContent: function() {\r\n        this._popupContainer && this._popupContainer.$content().empty()\r\n    },\r\n    _initializePopupContainer: function(options) {\r\n        var that = this;\r\n        var $element = that.element();\r\n        var headerFilterOptions = that.option(\"headerFilter\");\r\n        var width = options.headerFilter && options.headerFilter.width || headerFilterOptions && headerFilterOptions.width;\r\n        var height = options.headerFilter && options.headerFilter.height || headerFilterOptions && headerFilterOptions.height;\r\n        var dxPopupOptions = {\r\n            width: width,\r\n            height: height,\r\n            visible: false,\r\n            shading: false,\r\n            showTitle: false,\r\n            showCloseButton: false,\r\n            hideOnParentScroll: false,\r\n            dragEnabled: false,\r\n            hideOnOutsideClick: true,\r\n            focusStateEnabled: false,\r\n            copyRootClassesToWrapper: true,\r\n            _ignoreCopyRootClassesToWrapperDeprecation: true,\r\n            toolbarItems: [{\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.ok,\r\n                    onClick: function() {\r\n                        that.applyHeaderFilter(options)\r\n                    }\r\n                }\r\n            }, {\r\n                toolbar: \"bottom\",\r\n                location: \"after\",\r\n                widget: \"dxButton\",\r\n                options: {\r\n                    text: headerFilterOptions.texts.cancel,\r\n                    onClick: function() {\r\n                        that.hideHeaderFilterMenu()\r\n                    }\r\n                }\r\n            }],\r\n            resizeEnabled: true,\r\n            onShowing: function(e) {\r\n                e.component.$content().parent().addClass(\"dx-dropdowneditor-overlay\");\r\n                that._initializeListContainer(options);\r\n                options.onShowing && options.onShowing(e)\r\n            },\r\n            onShown: function() {\r\n                that.getListContainer().focus()\r\n            },\r\n            onHidden: options.onHidden,\r\n            onInitialized: function(e) {\r\n                var component = e.component;\r\n                component.option(\"animation\", component._getDefaultOptions().animation)\r\n            }\r\n        };\r\n        if (!isDefined(that._popupContainer)) {\r\n            that._popupContainer = that._createComponent($element, Popup, dxPopupOptions)\r\n        } else {\r\n            that._popupContainer.option(dxPopupOptions)\r\n        }\r\n    },\r\n    _initializeListContainer: function(options) {\r\n        var that = this;\r\n        var $content = that._popupContainer.$content();\r\n        var widgetOptions = {\r\n            searchEnabled: isSearchEnabled(that, options),\r\n            searchTimeout: that.option(\"headerFilter.searchTimeout\"),\r\n            searchMode: options.headerFilter && options.headerFilter.searchMode || \"\",\r\n            dataSource: options.dataSource,\r\n            onContentReady: function() {\r\n                that.renderCompleted.fire()\r\n            },\r\n            itemTemplate: function(data, _, element) {\r\n                var $element = $(element);\r\n                if (options.encodeHtml) {\r\n                    return $element.text(data.text)\r\n                }\r\n                return $element.html(data.text)\r\n            }\r\n        };\r\n\r\n        function onOptionChanged(e) {\r\n            if (\"searchValue\" === e.fullName && !options.isFilterBuilder && false !== that.option(\"headerFilter.hideSelectAllOnSearch\")) {\r\n                if (\"tree\" === options.type) {\r\n                    e.component.option(\"showCheckBoxesMode\", e.value ? \"normal\" : \"selectAll\")\r\n                } else {\r\n                    e.component.option(\"selectionMode\", e.value ? \"multiple\" : \"all\")\r\n                }\r\n            }\r\n        }\r\n        if (\"tree\" === options.type) {\r\n            that._listContainer = that._createComponent($(\"<div>\").appendTo($content), TreeView, extend(widgetOptions, {\r\n                showCheckBoxesMode: options.isFilterBuilder ? \"normal\" : \"selectAll\",\r\n                onOptionChanged: onOptionChanged,\r\n                keyExpr: \"id\"\r\n            }))\r\n        } else {\r\n            that._listContainer = that._createComponent($(\"<div>\").appendTo($content), List, extend(widgetOptions, {\r\n                searchExpr: that._getSearchExpr(options),\r\n                pageLoadMode: \"scrollBottom\",\r\n                showSelectionControls: true,\r\n                selectionMode: options.isFilterBuilder ? \"multiple\" : \"all\",\r\n                onOptionChanged: onOptionChanged,\r\n                onSelectionChanged: function(e) {\r\n                    var items = e.component.option(\"items\");\r\n                    var selectedItems = e.component.option(\"selectedItems\");\r\n                    if (!e.component._selectedItemsUpdating && !e.component.option(\"searchValue\") && !options.isFilterBuilder) {\r\n                        var filterValues = options.filterValues || [];\r\n                        var isExclude = \"exclude\" === options.filterType;\r\n                        if (0 === selectedItems.length && items.length && (filterValues.length <= 1 || isExclude && filterValues.length === items.length - 1)) {\r\n                            options.filterType = \"include\";\r\n                            options.filterValues = []\r\n                        } else if (selectedItems.length === items.length) {\r\n                            options.filterType = \"exclude\";\r\n                            options.filterValues = []\r\n                        }\r\n                    }\r\n                    each(items, (function(index, item) {\r\n                        var selected = gridCoreUtils.getIndexByKey(item, selectedItems, null) >= 0;\r\n                        var oldSelected = !!item.selected;\r\n                        if (oldSelected !== selected) {\r\n                            item.selected = selected;\r\n                            options.filterValues = options.filterValues || [];\r\n                            var filterValueIndex = gridCoreUtils.getIndexByKey(item.value, options.filterValues, null);\r\n                            if (filterValueIndex >= 0) {\r\n                                options.filterValues.splice(filterValueIndex, 1)\r\n                            }\r\n                            if (selected ^ \"exclude\" === options.filterType) {\r\n                                options.filterValues.push(item.value)\r\n                            }\r\n                        }\r\n                    }));\r\n                    updateSelectAllState(e, options.filterValues)\r\n                },\r\n                onContentReady: function(e) {\r\n                    var component = e.component;\r\n                    var items = component.option(\"items\");\r\n                    var selectedItems = [];\r\n                    each(items, (function() {\r\n                        if (this.selected) {\r\n                            selectedItems.push(this)\r\n                        }\r\n                    }));\r\n                    component._selectedItemsUpdating = true;\r\n                    component.option(\"selectedItems\", selectedItems);\r\n                    component._selectedItemsUpdating = false;\r\n                    updateSelectAllState(e, options.filterValues)\r\n                }\r\n            }))\r\n        }\r\n    },\r\n    _renderCore: function() {\r\n        this.element().addClass(HEADER_FILTER_MENU_CLASS)\r\n    }\r\n});\r\nexport var allowHeaderFiltering = function(column) {\r\n    return isDefined(column.allowHeaderFiltering) ? column.allowHeaderFiltering : column.allowFiltering\r\n};\r\nexport var headerFilterMixin = {\r\n    _applyColumnState: function(options) {\r\n        var $headerFilterIndicator;\r\n        var rootElement = options.rootElement;\r\n        var column = options.column;\r\n        if (\"headerFilter\" === options.name) {\r\n            rootElement.find(\".\" + HEADER_FILTER_CLASS).remove();\r\n            if (allowHeaderFiltering(column)) {\r\n                $headerFilterIndicator = this.callBase(options).toggleClass(\"dx-header-filter-empty\", this._isHeaderFilterEmpty(column));\r\n                if (!this.option(\"useLegacyKeyboardNavigation\")) {\r\n                    $headerFilterIndicator.attr(\"tabindex\", this.option(\"tabindex\") || 0)\r\n                }\r\n                var indicatorLabel = messageLocalization.format(\"dxDataGrid-headerFilterIndicatorLabel\", column.caption);\r\n                $headerFilterIndicator.attr(\"aria-label\", indicatorLabel);\r\n                $headerFilterIndicator.attr(\"aria-haspopup\", \"dialog\");\r\n                $headerFilterIndicator.attr(\"role\", \"button\")\r\n            }\r\n            return $headerFilterIndicator\r\n        }\r\n        return this.callBase(options)\r\n    },\r\n    _isHeaderFilterEmpty: function(column) {\r\n        return !column.filterValues || !column.filterValues.length\r\n    },\r\n    _getIndicatorClassName: function(name) {\r\n        if (\"headerFilter\" === name) {\r\n            return HEADER_FILTER_CLASS\r\n        }\r\n        return this.callBase(name)\r\n    },\r\n    _renderIndicator: function(options) {\r\n        var $container = options.container;\r\n        var $indicator = options.indicator;\r\n        if (\"headerFilter\" === options.name) {\r\n            var rtlEnabled = this.option(\"rtlEnabled\");\r\n            if ($container.children().length && (!rtlEnabled && \"right\" === options.columnAlignment || rtlEnabled && \"left\" === options.columnAlignment)) {\r\n                $container.prepend($indicator);\r\n                return\r\n            }\r\n        }\r\n        this.callBase(options)\r\n    },\r\n    optionChanged: function(args) {\r\n        if (\"headerFilter\" === args.name) {\r\n            var requireReady = \"columnHeadersView\" === this.name;\r\n            this._invalidate(requireReady, requireReady);\r\n            args.handled = true\r\n        } else {\r\n            this.callBase(args)\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}