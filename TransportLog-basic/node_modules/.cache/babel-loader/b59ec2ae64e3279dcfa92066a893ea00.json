{"ast":null,"code":"/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { extend } from '@syncfusion/ej2-base';\nimport { getDateFromRecurrenceDateString, getRecurrenceStringFromDate } from '../../recurrence-editor/date-generator';\n/**\n * ICalendar Export Module\n */\n\nvar ICalendarExport =\n/** @class */\nfunction () {\n  function ICalendarExport(parent) {\n    this.parent = parent;\n  }\n\n  ICalendarExport.prototype.initializeCalendarExport = function (fileName, customData) {\n    var icsString = this.getCalendarString(fileName, customData);\n    this.download(icsString, fileName);\n  };\n\n  ICalendarExport.prototype.getCalendarString = function (fileName, customData) {\n    var _this = this;\n\n    var eventsData = customData ? customData : extend([], this.parent.eventsData, null, true);\n    eventsData = this.parent.eventBase.sortByTime(eventsData);\n    var SEPARATOR = navigator.appVersion.indexOf('Win') !== -1 ? '\\r\\n' : '\\n';\n    var iCalendarEvents = [];\n    var filterCollection = [];\n    var timeZone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n    var fields = this.parent.eventFields;\n    eventsData.forEach(function (eventObj) {\n      var uId = eventObj[fields.id] || eventObj.Guid || _this.parent.eventBase.generateGuid();\n\n      var editedExDate = [];\n\n      if (eventObj[fields.recurrenceID]) {\n        var filter = _this.filterEvents(filterCollection, fields.id, eventObj[fields.recurrenceID]);\n\n        uId = filter.length > 0 ? filter[0].UID : uId;\n      }\n\n      if (!eventObj[fields.recurrenceID] && eventObj[fields.recurrenceRule] && eventObj[fields.recurrenceException]) {\n        var exDate = eventObj[fields.recurrenceException].split(',');\n\n        var editedObj = _this.filterEvents(eventsData, fields.recurrenceID, eventObj[fields.id]);\n\n        editedObj.forEach(function (edited) {\n          editedExDate.push(getRecurrenceStringFromDate(edited[fields.startTime]));\n        });\n        var exceptionDateList = exDate.filter(function (value) {\n          return editedExDate.indexOf(value) === -1;\n        });\n        eventObj[fields.recurrenceException] = exceptionDateList.length > 0 ? exceptionDateList.join(',') + ',' : '';\n      }\n\n      var startZone = eventObj[fields.startTimezone] || timeZone;\n      var endZone = eventObj[fields.endTimezone] || timeZone;\n      var readonly = eventObj[fields.isReadonly] ? eventObj[fields.isReadonly] : false;\n      var calendarEvent = ['BEGIN:VEVENT', 'LOCATION:' + (eventObj[fields.location] || ''), 'SUMMARY:' + (eventObj[fields.subject] || ''), 'UID:' + uId, 'DESCRIPTION:' + (eventObj[fields.description] || ''), 'ISREADONLY:' + readonly, 'END:VEVENT'];\n\n      if (eventObj[fields.isAllDay]) {\n        calendarEvent.splice(4, 0, 'DTEND;VALUE=DATE:' + _this.convertDateToString(eventObj[fields.endTime], true));\n        calendarEvent.splice(4, 0, 'DTSTART;VALUE=DATE:' + _this.convertDateToString(eventObj[fields.startTime], true));\n      } else if (!eventObj[fields.isAllDay] && !eventObj[fields.recurrenceRule]) {\n        calendarEvent.splice(4, 0, 'DTEND:' + _this.convertDateToString(eventObj[fields.endTime]));\n        calendarEvent.splice(4, 0, 'DTSTART:' + _this.convertDateToString(eventObj[fields.startTime]));\n      } else {\n        calendarEvent.splice(4, 0, 'DTEND;TZID=\"' + endZone + '\":' + _this.convertDateToString(eventObj[fields.endTime]));\n        calendarEvent.splice(4, 0, 'DTSTART;TZID=\"' + startZone + '\":' + _this.convertDateToString(eventObj[fields.startTime]));\n      }\n\n      if (eventObj[fields.recurrenceRule]) {\n        calendarEvent.splice(4, 0, 'RRULE:' + eventObj[fields.recurrenceRule]);\n      }\n\n      if (eventObj[fields.recurrenceException]) {\n        var exDate = eventObj[fields.recurrenceException].split(',');\n\n        for (var i = 0; i < exDate.length - 1; i++) {\n          calendarEvent.splice(5, 0, 'EXDATE:' + _this.convertDateToString(getDateFromRecurrenceDateString(exDate[i]), eventObj[fields.isAllDay]));\n        }\n      }\n\n      if (eventObj[fields.recurrenceID]) {\n        calendarEvent.splice(4, 0, 'RECURRENCE-ID;TZID=\"' + startZone + '\":' + _this.convertDateToString(eventObj[fields.startTime], eventObj[fields.isAllDay]));\n      }\n\n      var customFields = _this.customFieldFilter(eventObj, fields);\n\n      if (customFields.length > 0) {\n        customFields.forEach(function (customField) {\n          return calendarEvent.splice(4, 0, customField + ':' + (eventObj[customField] || ''));\n        });\n      }\n\n      var app = extend({}, eventObj);\n      app.UID = uId;\n      filterCollection.push(app);\n      iCalendarEvents.push(calendarEvent.join(SEPARATOR));\n    });\n    var iCalendar = ['BEGIN:VCALENDAR', 'PRODID:-//Syncfusion Inc//Scheduler//EN', 'VERSION:2.0', 'CALSCALE:GREGORIAN', 'METHOD:PUBLISH', 'X-WR-CALNAME:' + (fileName || 'Calendar'), 'X-WR-TIMEZONE:' + timeZone].join(SEPARATOR);\n    var icsString = iCalendar + SEPARATOR + iCalendarEvents.join(SEPARATOR) + SEPARATOR + 'END:VCALENDAR';\n    return icsString;\n  };\n\n  ICalendarExport.prototype.customFieldFilter = function (eventObj, fields) {\n    var defaultFields = Object.keys(fields).map(function (key) {\n      return fields[key];\n    });\n    var eventFields = Object.keys(eventObj);\n    return eventFields.filter(function (value) {\n      return defaultFields.indexOf(value) === -1 && value !== 'Guid';\n    });\n  };\n\n  ICalendarExport.prototype.convertDateToString = function (eventDate, allDay) {\n    var year = ('0000' + eventDate.getFullYear().toString()).slice(-4);\n    var month = ('00' + (eventDate.getMonth() + 1).toString()).slice(-2);\n    var date = ('00' + eventDate.getDate().toString()).slice(-2);\n    var hours = ('00' + eventDate.getHours().toString()).slice(-2);\n    var minutes = ('00' + eventDate.getMinutes().toString()).slice(-2);\n    var seconds = ('00' + eventDate.getSeconds().toString()).slice(-2);\n    var timeString = allDay ? year + month + date : year + month + date + 'T' + hours + minutes + seconds;\n    return timeString;\n  };\n\n  ICalendarExport.prototype.download = function (icsString, fileName) {\n    var buffer = new Blob([icsString], {\n      type: 'data:text/calendar;charset=utf8'\n    });\n    fileName = (fileName || 'Calendar') + '.ics';\n\n    if (navigator.msSaveBlob) {\n      navigator.msSaveBlob(buffer, fileName);\n    } else {\n      var downloadLink_1 = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');\n      downloadLink_1.download = fileName;\n      downloadLink_1.href = URL.createObjectURL(buffer);\n      var event_1 = document.createEvent('MouseEvent');\n      event_1.initEvent('click', true, true);\n      downloadLink_1.dispatchEvent(event_1);\n      setTimeout(function () {\n        URL.revokeObjectURL(downloadLink_1.href);\n        downloadLink_1.href = undefined;\n      });\n    }\n  };\n\n  ICalendarExport.prototype.filterEvents = function (data, field, value) {\n    return data.filter(function (e) {\n      return e[field] === value;\n    });\n  };\n\n  ICalendarExport.prototype.getModuleName = function () {\n    return 'iCalendarExport';\n  };\n\n  ICalendarExport.prototype.destroy = function () {\n    if (!this.parent || this.parent && this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent = null;\n  };\n\n  return ICalendarExport;\n}();\n\nexport { ICalendarExport };","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/@syncfusion/ej2-schedule/src/schedule/exports/calendar-export.js"],"names":["extend","getDateFromRecurrenceDateString","getRecurrenceStringFromDate","ICalendarExport","parent","prototype","initializeCalendarExport","fileName","customData","icsString","getCalendarString","download","_this","eventsData","eventBase","sortByTime","SEPARATOR","navigator","appVersion","indexOf","iCalendarEvents","filterCollection","timeZone","timezone","tzModule","getLocalTimezoneName","fields","eventFields","forEach","eventObj","uId","id","Guid","generateGuid","editedExDate","recurrenceID","filter","filterEvents","length","UID","recurrenceRule","recurrenceException","exDate","split","editedObj","edited","push","startTime","exceptionDateList","value","join","startZone","startTimezone","endZone","endTimezone","readonly","isReadonly","calendarEvent","location","subject","description","isAllDay","splice","convertDateToString","endTime","i","customFields","customFieldFilter","customField","app","iCalendar","defaultFields","Object","keys","map","key","eventDate","allDay","year","getFullYear","toString","slice","month","getMonth","date","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","timeString","buffer","Blob","type","msSaveBlob","downloadLink_1","document","createElementNS","href","URL","createObjectURL","event_1","createEvent","initEvent","dispatchEvent","setTimeout","revokeObjectURL","undefined","data","field","e","getModuleName","destroy","isDestroyed"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { extend } from '@syncfusion/ej2-base';\nimport { getDateFromRecurrenceDateString, getRecurrenceStringFromDate } from '../../recurrence-editor/date-generator';\n/**\n * ICalendar Export Module\n */\nvar ICalendarExport = /** @class */ (function () {\n    function ICalendarExport(parent) {\n        this.parent = parent;\n    }\n    ICalendarExport.prototype.initializeCalendarExport = function (fileName, customData) {\n        var icsString = this.getCalendarString(fileName, customData);\n        this.download(icsString, fileName);\n    };\n    ICalendarExport.prototype.getCalendarString = function (fileName, customData) {\n        var _this = this;\n        var eventsData = (customData) ? customData :\n            extend([], this.parent.eventsData, null, true);\n        eventsData = this.parent.eventBase.sortByTime(eventsData);\n        var SEPARATOR = (navigator.appVersion.indexOf('Win') !== -1) ? '\\r\\n' : '\\n';\n        var iCalendarEvents = [];\n        var filterCollection = [];\n        var timeZone = this.parent.timezone || this.parent.tzModule.getLocalTimezoneName();\n        var fields = this.parent.eventFields;\n        eventsData.forEach(function (eventObj) {\n            var uId = eventObj[fields.id] || eventObj.Guid || _this.parent.eventBase.generateGuid();\n            var editedExDate = [];\n            if (eventObj[fields.recurrenceID]) {\n                var filter = _this.filterEvents(filterCollection, fields.id, eventObj[fields.recurrenceID]);\n                uId = filter.length > 0 ? filter[0].UID : uId;\n            }\n            if (!eventObj[fields.recurrenceID] && eventObj[fields.recurrenceRule] && eventObj[fields.recurrenceException]) {\n                var exDate = (eventObj[fields.recurrenceException]).split(',');\n                var editedObj = _this.filterEvents(eventsData, fields.recurrenceID, eventObj[fields.id]);\n                editedObj.forEach(function (edited) {\n                    editedExDate.push(getRecurrenceStringFromDate(edited[fields.startTime]));\n                });\n                var exceptionDateList = exDate.filter(function (value) { return editedExDate.indexOf(value) === -1; });\n                eventObj[fields.recurrenceException] = (exceptionDateList.length > 0) ? (exceptionDateList.join(',') + ',') : '';\n            }\n            var startZone = (eventObj[fields.startTimezone] || timeZone);\n            var endZone = (eventObj[fields.endTimezone] || timeZone);\n            var readonly = (eventObj[fields.isReadonly]) ? (eventObj[fields.isReadonly]) : false;\n            var calendarEvent = [\n                'BEGIN:VEVENT',\n                'LOCATION:' + (eventObj[fields.location] || ''),\n                'SUMMARY:' + (eventObj[fields.subject] || ''),\n                'UID:' + uId,\n                'DESCRIPTION:' + (eventObj[fields.description] || ''),\n                'ISREADONLY:' + readonly,\n                'END:VEVENT'\n            ];\n            if (eventObj[fields.isAllDay]) {\n                calendarEvent.splice(4, 0, 'DTEND;VALUE=DATE:' + _this.convertDateToString(eventObj[fields.endTime], true));\n                calendarEvent.splice(4, 0, 'DTSTART;VALUE=DATE:' + _this.convertDateToString(eventObj[fields.startTime], true));\n            }\n            else if (!eventObj[fields.isAllDay] && !eventObj[fields.recurrenceRule]) {\n                calendarEvent.splice(4, 0, 'DTEND:' + _this.convertDateToString(eventObj[fields.endTime]));\n                calendarEvent.splice(4, 0, 'DTSTART:' + _this.convertDateToString(eventObj[fields.startTime]));\n            }\n            else {\n                calendarEvent.splice(4, 0, 'DTEND;TZID=\"' + endZone + '\":' + _this.convertDateToString(eventObj[fields.endTime]));\n                calendarEvent.splice(4, 0, 'DTSTART;TZID=\"' + startZone + '\":'\n                    + _this.convertDateToString(eventObj[fields.startTime]));\n            }\n            if (eventObj[fields.recurrenceRule]) {\n                calendarEvent.splice(4, 0, 'RRULE:' + eventObj[fields.recurrenceRule]);\n            }\n            if (eventObj[fields.recurrenceException]) {\n                var exDate = eventObj[fields.recurrenceException].split(',');\n                for (var i = 0; i < exDate.length - 1; i++) {\n                    calendarEvent.splice(5, 0, 'EXDATE:' +\n                        _this.convertDateToString(getDateFromRecurrenceDateString(exDate[i]), eventObj[fields.isAllDay]));\n                }\n            }\n            if (eventObj[fields.recurrenceID]) {\n                calendarEvent.splice(4, 0, 'RECURRENCE-ID;TZID=\"' + startZone + '\":'\n                    + _this.convertDateToString(eventObj[fields.startTime], eventObj[fields.isAllDay]));\n            }\n            var customFields = _this.customFieldFilter(eventObj, fields);\n            if (customFields.length > 0) {\n                customFields.forEach(function (customField) {\n                    return calendarEvent.splice(4, 0, customField + ':' + (eventObj[customField] || ''));\n                });\n            }\n            var app = extend({}, eventObj);\n            app.UID = uId;\n            filterCollection.push(app);\n            iCalendarEvents.push(calendarEvent.join(SEPARATOR));\n        });\n        var iCalendar = [\n            'BEGIN:VCALENDAR',\n            'PRODID:-//Syncfusion Inc//Scheduler//EN',\n            'VERSION:2.0',\n            'CALSCALE:GREGORIAN',\n            'METHOD:PUBLISH',\n            'X-WR-CALNAME:' + (fileName || 'Calendar'),\n            'X-WR-TIMEZONE:' + timeZone\n        ].join(SEPARATOR);\n        var icsString = iCalendar + SEPARATOR + iCalendarEvents.join(SEPARATOR) + SEPARATOR + 'END:VCALENDAR';\n        return icsString;\n    };\n    ICalendarExport.prototype.customFieldFilter = function (eventObj, fields) {\n        var defaultFields = Object.keys(fields).map(function (key) { return fields[key]; });\n        var eventFields = Object.keys(eventObj);\n        return eventFields.filter(function (value) { return (defaultFields.indexOf(value) === -1) && (value !== 'Guid'); });\n    };\n    ICalendarExport.prototype.convertDateToString = function (eventDate, allDay) {\n        var year = ('0000' + (eventDate.getFullYear().toString())).slice(-4);\n        var month = ('00' + ((eventDate.getMonth() + 1).toString())).slice(-2);\n        var date = ('00' + ((eventDate.getDate()).toString())).slice(-2);\n        var hours = ('00' + (eventDate.getHours().toString())).slice(-2);\n        var minutes = ('00' + (eventDate.getMinutes().toString())).slice(-2);\n        var seconds = ('00' + (eventDate.getSeconds().toString())).slice(-2);\n        var timeString = (allDay) ? year + month + date : year + month + date + 'T' + hours + minutes + seconds;\n        return timeString;\n    };\n    ICalendarExport.prototype.download = function (icsString, fileName) {\n        var buffer = new Blob([icsString], { type: 'data:text/calendar;charset=utf8' });\n        fileName = (fileName || 'Calendar') + '.ics';\n        if (navigator.msSaveBlob) {\n            navigator.msSaveBlob(buffer, fileName);\n        }\n        else {\n            var downloadLink_1 = document.createElementNS('http://www.w3.org/1999/xhtml', 'a');\n            downloadLink_1.download = fileName;\n            downloadLink_1.href = URL.createObjectURL(buffer);\n            var event_1 = document.createEvent('MouseEvent');\n            event_1.initEvent('click', true, true);\n            downloadLink_1.dispatchEvent(event_1);\n            setTimeout(function () {\n                URL.revokeObjectURL(downloadLink_1.href);\n                downloadLink_1.href = undefined;\n            });\n        }\n    };\n    ICalendarExport.prototype.filterEvents = function (data, field, value) {\n        return data.filter(function (e) { return e[field] === value; });\n    };\n    ICalendarExport.prototype.getModuleName = function () {\n        return 'iCalendarExport';\n    };\n    ICalendarExport.prototype.destroy = function () {\n        if (!this.parent || this.parent && this.parent.isDestroyed) {\n            return;\n        }\n        this.parent = null;\n    };\n    return ICalendarExport;\n}());\nexport { ICalendarExport };\n"]},"metadata":{},"sourceType":"module"}