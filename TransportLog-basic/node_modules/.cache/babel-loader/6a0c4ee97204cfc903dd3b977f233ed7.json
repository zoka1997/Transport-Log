{"ast":null,"code":"/**\r\n * DevExtreme (esm/data/data_source/data_source.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport Class from \"../../core/class\";\nimport { extend } from \"../../core/utils/extend\";\nimport { executeAsync } from \"../../core/utils/common\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isString, isNumeric, isBoolean, isDefined, isObject } from \"../../core/utils/type\";\nimport { throttleChanges } from \"../utils\";\nimport { applyBatch } from \"../array_utils\";\nimport CustomStore from \"../custom_store\";\nimport { EventsStrategy } from \"../../core/events_strategy\";\nimport { errors } from \"../errors\";\nimport { create } from \"../../core/utils/queue\";\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport OperationManager from \"./operation_manager\";\nimport { normalizeDataSourceOptions, normalizeStoreLoadOptionAccessorArguments, CANCELED_TOKEN, isPending, normalizeLoadResult, mapDataRespectingGrouping } from \"./utils\";\nexport var DataSource = Class.inherit({\n  ctor(options) {\n    var _options$reshapeOnPus;\n\n    options = normalizeDataSourceOptions(options);\n    this._eventsStrategy = new EventsStrategy(this, {\n      syncStrategy: true\n    });\n    this._store = options.store;\n    this._changedTime = 0;\n    var needThrottling = 0 !== options.pushAggregationTimeout;\n\n    if (needThrottling) {\n      var throttlingTimeout = void 0 === options.pushAggregationTimeout ? () => 5 * this._changedTime : options.pushAggregationTimeout;\n      var pushDeferred;\n      var lastPushWaiters;\n      var throttlingPushHandler = throttleChanges(changes => {\n        pushDeferred.resolve();\n        var storePushPending = when(...lastPushWaiters);\n        storePushPending.done(() => this._onPush(changes));\n        lastPushWaiters = void 0;\n        pushDeferred = void 0;\n      }, throttlingTimeout);\n\n      this._onPushHandler = args => {\n        this._aggregationTimeoutId = throttlingPushHandler(args.changes);\n\n        if (!pushDeferred) {\n          pushDeferred = new Deferred();\n        }\n\n        lastPushWaiters = args.waitFor;\n        args.waitFor.push(pushDeferred.promise());\n      };\n\n      this._store.on(\"beforePush\", this._onPushHandler);\n    } else {\n      this._onPushHandler = changes => this._onPush(changes);\n\n      this._store.on(\"push\", this._onPushHandler);\n    }\n\n    this._storeLoadOptions = this._extractLoadOptions(options);\n    this._mapFunc = options.map;\n    this._postProcessFunc = options.postProcess;\n    this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\n    this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\n    this._loadingCount = 0;\n    this._loadQueue = this._createLoadQueue();\n    this._searchValue = \"searchValue\" in options ? options.searchValue : null;\n    this._searchOperation = options.searchOperation || \"contains\";\n    this._searchExpr = options.searchExpr;\n    this._paginate = options.paginate;\n    this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\n    each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], (_, optionName) => {\n      if (optionName in options) {\n        this.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName]);\n      }\n    });\n    this._operationManager = new OperationManager();\n\n    this._init();\n  },\n\n  _init() {\n    this._items = [];\n    this._userData = {};\n    this._totalCount = -1;\n    this._isLoaded = false;\n\n    if (!isDefined(this._paginate)) {\n      this._paginate = !this.group();\n    }\n\n    this._isLastPage = !this._paginate;\n  },\n\n  dispose() {\n    var _this$_delayedLoadTas;\n\n    this._store.off(\"beforePush\", this._onPushHandler);\n\n    this._store.off(\"push\", this._onPushHandler);\n\n    this._eventsStrategy.dispose();\n\n    clearTimeout(this._aggregationTimeoutId);\n    null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\n\n    this._operationManager.cancelAll();\n\n    delete this._store;\n    delete this._items;\n    delete this._delayedLoadTask;\n    this._disposed = true;\n  },\n\n  _extractLoadOptions(options) {\n    var result = {};\n    var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\n\n    var customNames = this._store._customLoadOptions();\n\n    if (customNames) {\n      names = names.concat(customNames);\n    }\n\n    each(names, function () {\n      result[this] = options[this];\n    });\n    return result;\n  },\n\n  loadOptions() {\n    return this._storeLoadOptions;\n  },\n\n  items() {\n    return this._items;\n  },\n\n  pageIndex(newIndex) {\n    if (!isNumeric(newIndex)) {\n      return this._pageIndex;\n    }\n\n    this._pageIndex = newIndex;\n    this._isLastPage = !this._paginate;\n  },\n\n  paginate(value) {\n    if (!isBoolean(value)) {\n      return this._paginate;\n    }\n\n    if (this._paginate !== value) {\n      this._paginate = value;\n      this.pageIndex(0);\n    }\n  },\n\n  pageSize(value) {\n    if (!isNumeric(value)) {\n      return this._pageSize;\n    }\n\n    this._pageSize = value;\n  },\n\n  isLastPage() {\n    return this._isLastPage;\n  },\n\n  generateStoreLoadOptionAccessor(optionName) {\n    return args => {\n      var normalizedArgs = normalizeStoreLoadOptionAccessorArguments(args);\n\n      if (void 0 === normalizedArgs) {\n        return this._storeLoadOptions[optionName];\n      }\n\n      this._storeLoadOptions[optionName] = normalizedArgs;\n    };\n  },\n\n  sort() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"sort\")(args);\n  },\n\n  filter() {\n    var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\n\n    if (void 0 === newFilter) {\n      return this._storeLoadOptions.filter;\n    }\n\n    this._storeLoadOptions.filter = newFilter;\n    this.pageIndex(0);\n  },\n\n  group() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"group\")(args);\n  },\n\n  select() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"select\")(args);\n  },\n\n  requireTotalCount(value) {\n    if (!isBoolean(value)) {\n      return this._storeLoadOptions.requireTotalCount;\n    }\n\n    this._storeLoadOptions.requireTotalCount = value;\n  },\n\n  searchValue(value) {\n    if (arguments.length < 1) {\n      return this._searchValue;\n    }\n\n    this._searchValue = value;\n    this.pageIndex(0);\n  },\n\n  searchOperation(op) {\n    if (!isString(op)) {\n      return this._searchOperation;\n    }\n\n    this._searchOperation = op;\n    this.pageIndex(0);\n  },\n\n  searchExpr(expr) {\n    var argc = arguments.length;\n\n    if (0 === argc) {\n      return this._searchExpr;\n    }\n\n    if (argc > 1) {\n      expr = [].slice.call(arguments);\n    }\n\n    this._searchExpr = expr;\n    this.pageIndex(0);\n  },\n\n  store() {\n    return this._store;\n  },\n\n  key() {\n    var _this$_store;\n\n    return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key();\n  },\n\n  totalCount() {\n    return this._totalCount;\n  },\n\n  isLoaded() {\n    return this._isLoaded;\n  },\n\n  isLoading() {\n    return this._loadingCount > 0;\n  },\n\n  beginLoading() {\n    this._changeLoadingCount(1);\n  },\n\n  endLoading() {\n    this._changeLoadingCount(-1);\n  },\n\n  _createLoadQueue: () => create(),\n\n  _changeLoadingCount(increment) {\n    var oldLoading = this.isLoading();\n    this._loadingCount += increment;\n    var newLoading = this.isLoading();\n\n    if (oldLoading ^ newLoading) {\n      this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading]);\n    }\n  },\n\n  _scheduleLoadCallbacks(deferred) {\n    this.beginLoading();\n    deferred.always(() => {\n      this.endLoading();\n    });\n  },\n\n  _scheduleFailCallbacks(deferred) {\n    var _this = this;\n\n    deferred.fail(function () {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      if (args[0] === CANCELED_TOKEN) {\n        return;\n      }\n\n      _this._eventsStrategy.fireEvent(\"loadError\", args);\n    });\n  },\n\n  _fireChanged(args) {\n    var date = new Date();\n\n    this._eventsStrategy.fireEvent(\"changed\", args);\n\n    this._changedTime = new Date() - date;\n  },\n\n  _scheduleChangedCallbacks(deferred) {\n    deferred.done(() => this._fireChanged());\n  },\n\n  loadSingle(propName, propValue) {\n    var d = new Deferred();\n    var key = this.key();\n    var store = this._store;\n\n    var options = this._createStoreLoadOptions();\n\n    this._scheduleFailCallbacks(d);\n\n    if (arguments.length < 2) {\n      propValue = propName;\n      propName = key;\n    }\n\n    delete options.skip;\n    delete options.group;\n    delete options.refresh;\n    delete options.pageIndex;\n    delete options.searchString;\n    (() => {\n      if (propName === key || store instanceof CustomStore && !store._byKeyViaLoad()) {\n        return store.byKey(propValue, options);\n      }\n\n      options.take = 1;\n      options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\n      return store.load(options);\n    })().fail(d.reject).done(data => {\n      var isEmptyArray = Array.isArray(data) && !data.length;\n\n      if (!isDefined(data) || isEmptyArray) {\n        d.reject(new errors.Error(\"E4009\"));\n      } else {\n        if (!Array.isArray(data)) {\n          data = [data];\n        }\n\n        d.resolve(this._applyMapFunction(data)[0]);\n      }\n    });\n    return d.promise();\n  },\n\n  load() {\n    var d = new Deferred();\n\n    var loadTask = () => {\n      if (this._disposed) {\n        return;\n      }\n\n      if (!isPending(d)) {\n        return;\n      }\n\n      return this._loadFromStore(loadOperation, d);\n    };\n\n    this._scheduleLoadCallbacks(d);\n\n    this._scheduleFailCallbacks(d);\n\n    this._scheduleChangedCallbacks(d);\n\n    var loadOperation = this._createLoadOperation(d);\n\n    this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\n\n    this._loadQueue.add(() => {\n      if (\"number\" === typeof loadOperation.delay) {\n        this._delayedLoadTask = executeAsync(loadTask, loadOperation.delay);\n      } else {\n        loadTask();\n      }\n\n      return d.promise();\n    });\n\n    return d.promise({\n      operationId: loadOperation.operationId\n    });\n  },\n\n  _onPush(changes) {\n    if (this._reshapeOnPush) {\n      this.load();\n    } else {\n      var changingArgs = {\n        changes: changes\n      };\n\n      this._eventsStrategy.fireEvent(\"changing\", [changingArgs]);\n\n      var group = this.group();\n      var items = this.items();\n      var groupLevel = 0;\n      var dataSourceChanges = this.paginate() || group ? changes.filter(item => \"update\" === item.type) : changes;\n\n      if (group) {\n        groupLevel = Array.isArray(group) ? group.length : 1;\n      }\n\n      if (this._mapFunc) {\n        dataSourceChanges.forEach(item => {\n          if (\"insert\" === item.type) {\n            item.data = this._mapFunc(item.data);\n          }\n        });\n      }\n\n      if (changingArgs.postProcessChanges) {\n        dataSourceChanges = changingArgs.postProcessChanges(dataSourceChanges);\n      }\n\n      applyBatch({\n        keyInfo: this.store(),\n        data: items,\n        changes: dataSourceChanges,\n        groupCount: groupLevel,\n        useInsertIndex: true\n      });\n\n      this._fireChanged([{\n        changes: changes\n      }]);\n    }\n  },\n\n  _createLoadOperation(deferred) {\n    var operationId = this._operationManager.add(deferred);\n\n    var storeLoadOptions = this._createStoreLoadOptions();\n\n    deferred.always(() => this._operationManager.remove(operationId));\n    return {\n      operationId: operationId,\n      storeLoadOptions: storeLoadOptions\n    };\n  },\n\n  reload() {\n    var store = this.store();\n\n    if (store instanceof CustomStore) {\n      store.clearRawDataCache();\n    }\n\n    this._init();\n\n    return this.load();\n  },\n\n  cancel(operationId) {\n    return this._operationManager.cancel(operationId);\n  },\n\n  cancelAll() {\n    return this._operationManager.cancelAll();\n  },\n\n  _addSearchOptions(storeLoadOptions) {\n    if (this._disposed) {\n      return;\n    }\n\n    if (this.store()._useDefaultSearch) {\n      this._addSearchFilter(storeLoadOptions);\n    } else {\n      storeLoadOptions.searchOperation = this._searchOperation;\n      storeLoadOptions.searchValue = this._searchValue;\n      storeLoadOptions.searchExpr = this._searchExpr;\n    }\n  },\n\n  _createStoreLoadOptions() {\n    var result = extend({}, this._storeLoadOptions);\n\n    this._addSearchOptions(result);\n\n    if (this._paginate) {\n      if (this._pageSize) {\n        result.skip = this._pageIndex * this._pageSize;\n        result.take = this._pageSize;\n      }\n    }\n\n    result.userData = this._userData;\n    return result;\n  },\n\n  _addSearchFilter(storeLoadOptions) {\n    var value = this._searchValue;\n    var op = this._searchOperation;\n    var selector = this._searchExpr;\n    var searchFilter = [];\n\n    if (!value) {\n      return;\n    }\n\n    if (!selector) {\n      selector = \"this\";\n    }\n\n    if (!Array.isArray(selector)) {\n      selector = [selector];\n    }\n\n    each(selector, function (i, item) {\n      if (searchFilter.length) {\n        searchFilter.push(\"or\");\n      }\n\n      searchFilter.push([item, op, value]);\n    });\n\n    if (storeLoadOptions.filter) {\n      storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter];\n    } else {\n      storeLoadOptions.filter = searchFilter;\n    }\n  },\n\n  _loadFromStore(loadOptions, pendingDeferred) {\n    var handleSuccess = (data, extra) => {\n      if (this._disposed) {\n        return;\n      }\n\n      if (!isPending(pendingDeferred)) {\n        return;\n      }\n\n      var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\n\n      this._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\n\n      when(loadResult.data).done(data => {\n        loadResult.data = data;\n\n        this._processStoreLoadResult(loadResult, pendingDeferred);\n      }).fail(pendingDeferred.reject);\n    };\n\n    if (loadOptions.data) {\n      return new Deferred().resolve(loadOptions.data).done(handleSuccess);\n    }\n\n    return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject);\n  },\n\n  _processStoreLoadResult(loadResult, pendingDeferred) {\n    var data = loadResult.data;\n    var extra = loadResult.extra;\n    var storeLoadOptions = loadResult.storeLoadOptions;\n\n    var resolvePendingDeferred = () => {\n      this._isLoaded = true;\n      this._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\n      return pendingDeferred.resolve(data, extra);\n    };\n\n    if (this._disposed) {\n      return;\n    }\n\n    data = this._applyPostProcessFunction(this._applyMapFunction(data));\n\n    if (!isObject(extra)) {\n      extra = {};\n    }\n\n    this._items = data;\n\n    if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\n      this._isLastPage = true;\n    }\n\n    if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\n      (() => {\n        this.store().totalCount(storeLoadOptions).done(function (count) {\n          extra.totalCount = count;\n          resolvePendingDeferred();\n        }).fail(pendingDeferred.reject);\n      })();\n    } else {\n      resolvePendingDeferred();\n    }\n  },\n\n  _applyMapFunction(data) {\n    if (this._mapFunc) {\n      return mapDataRespectingGrouping(data, this._mapFunc, this.group());\n    }\n\n    return data;\n  },\n\n  _applyPostProcessFunction(data) {\n    if (this._postProcessFunc) {\n      return this._postProcessFunc(data);\n    }\n\n    return data;\n  },\n\n  on(eventName, eventHandler) {\n    this._eventsStrategy.on(eventName, eventHandler);\n\n    return this;\n  },\n\n  off(eventName, eventHandler) {\n    this._eventsStrategy.off(eventName, eventHandler);\n\n    return this;\n  }\n\n});","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/data/data_source/data_source.js"],"names":["Class","extend","executeAsync","each","isString","isNumeric","isBoolean","isDefined","isObject","throttleChanges","applyBatch","CustomStore","EventsStrategy","errors","create","Deferred","when","OperationManager","normalizeDataSourceOptions","normalizeStoreLoadOptionAccessorArguments","CANCELED_TOKEN","isPending","normalizeLoadResult","mapDataRespectingGrouping","DataSource","inherit","ctor","options","_options$reshapeOnPus","_eventsStrategy","syncStrategy","_store","store","_changedTime","needThrottling","pushAggregationTimeout","throttlingTimeout","pushDeferred","lastPushWaiters","throttlingPushHandler","changes","resolve","storePushPending","done","_onPush","_onPushHandler","args","_aggregationTimeoutId","waitFor","push","promise","on","_storeLoadOptions","_extractLoadOptions","_mapFunc","map","_postProcessFunc","postProcess","_pageIndex","pageIndex","_pageSize","pageSize","_loadingCount","_loadQueue","_createLoadQueue","_searchValue","searchValue","_searchOperation","searchOperation","_searchExpr","searchExpr","_paginate","paginate","_reshapeOnPush","reshapeOnPush","_","optionName","substr","toLowerCase","_operationManager","_init","_items","_userData","_totalCount","_isLoaded","group","_isLastPage","dispose","_this$_delayedLoadTas","off","clearTimeout","_delayedLoadTask","abort","cancelAll","_disposed","result","names","customNames","_customLoadOptions","concat","loadOptions","items","newIndex","value","isLastPage","generateStoreLoadOptionAccessor","normalizedArgs","sort","_len","arguments","length","Array","_key","filter","newFilter","_len2","_key2","select","_len3","_key3","requireTotalCount","op","expr","argc","slice","call","key","_this$_store","totalCount","isLoaded","isLoading","beginLoading","_changeLoadingCount","endLoading","increment","oldLoading","newLoading","fireEvent","_scheduleLoadCallbacks","deferred","always","_scheduleFailCallbacks","_this","fail","_len4","_key4","_fireChanged","date","Date","_scheduleChangedCallbacks","loadSingle","propName","propValue","d","_createStoreLoadOptions","skip","refresh","searchString","_byKeyViaLoad","byKey","take","load","reject","data","isEmptyArray","isArray","Error","_applyMapFunction","loadTask","_loadFromStore","loadOperation","_createLoadOperation","add","delay","operationId","changingArgs","groupLevel","dataSourceChanges","item","type","forEach","postProcessChanges","keyInfo","groupCount","useInsertIndex","storeLoadOptions","remove","reload","clearRawDataCache","cancel","_addSearchOptions","_useDefaultSearch","_addSearchFilter","userData","selector","searchFilter","i","pendingDeferred","handleSuccess","extra","loadResult","_processStoreLoadResult","resolvePendingDeferred","isFinite","_applyPostProcessFunction","count","eventName","eventHandler"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/data/data_source/data_source.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport Class from \"../../core/class\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    executeAsync\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    isString,\r\n    isNumeric,\r\n    isBoolean,\r\n    isDefined,\r\n    isObject\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    throttleChanges\r\n} from \"../utils\";\r\nimport {\r\n    applyBatch\r\n} from \"../array_utils\";\r\nimport CustomStore from \"../custom_store\";\r\nimport {\r\n    EventsStrategy\r\n} from \"../../core/events_strategy\";\r\nimport {\r\n    errors\r\n} from \"../errors\";\r\nimport {\r\n    create\r\n} from \"../../core/utils/queue\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport OperationManager from \"./operation_manager\";\r\nimport {\r\n    normalizeDataSourceOptions,\r\n    normalizeStoreLoadOptionAccessorArguments,\r\n    CANCELED_TOKEN,\r\n    isPending,\r\n    normalizeLoadResult,\r\n    mapDataRespectingGrouping\r\n} from \"./utils\";\r\nexport var DataSource = Class.inherit({\r\n    ctor(options) {\r\n        var _options$reshapeOnPus;\r\n        options = normalizeDataSourceOptions(options);\r\n        this._eventsStrategy = new EventsStrategy(this, {\r\n            syncStrategy: true\r\n        });\r\n        this._store = options.store;\r\n        this._changedTime = 0;\r\n        var needThrottling = 0 !== options.pushAggregationTimeout;\r\n        if (needThrottling) {\r\n            var throttlingTimeout = void 0 === options.pushAggregationTimeout ? () => 5 * this._changedTime : options.pushAggregationTimeout;\r\n            var pushDeferred;\r\n            var lastPushWaiters;\r\n            var throttlingPushHandler = throttleChanges(changes => {\r\n                pushDeferred.resolve();\r\n                var storePushPending = when(...lastPushWaiters);\r\n                storePushPending.done(() => this._onPush(changes));\r\n                lastPushWaiters = void 0;\r\n                pushDeferred = void 0\r\n            }, throttlingTimeout);\r\n            this._onPushHandler = args => {\r\n                this._aggregationTimeoutId = throttlingPushHandler(args.changes);\r\n                if (!pushDeferred) {\r\n                    pushDeferred = new Deferred\r\n                }\r\n                lastPushWaiters = args.waitFor;\r\n                args.waitFor.push(pushDeferred.promise())\r\n            };\r\n            this._store.on(\"beforePush\", this._onPushHandler)\r\n        } else {\r\n            this._onPushHandler = changes => this._onPush(changes);\r\n            this._store.on(\"push\", this._onPushHandler)\r\n        }\r\n        this._storeLoadOptions = this._extractLoadOptions(options);\r\n        this._mapFunc = options.map;\r\n        this._postProcessFunc = options.postProcess;\r\n        this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\r\n        this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\r\n        this._loadingCount = 0;\r\n        this._loadQueue = this._createLoadQueue();\r\n        this._searchValue = \"searchValue\" in options ? options.searchValue : null;\r\n        this._searchOperation = options.searchOperation || \"contains\";\r\n        this._searchExpr = options.searchExpr;\r\n        this._paginate = options.paginate;\r\n        this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\r\n        each([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], (_, optionName) => {\r\n            if (optionName in options) {\r\n                this.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName])\r\n            }\r\n        });\r\n        this._operationManager = new OperationManager;\r\n        this._init()\r\n    },\r\n    _init() {\r\n        this._items = [];\r\n        this._userData = {};\r\n        this._totalCount = -1;\r\n        this._isLoaded = false;\r\n        if (!isDefined(this._paginate)) {\r\n            this._paginate = !this.group()\r\n        }\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    dispose() {\r\n        var _this$_delayedLoadTas;\r\n        this._store.off(\"beforePush\", this._onPushHandler);\r\n        this._store.off(\"push\", this._onPushHandler);\r\n        this._eventsStrategy.dispose();\r\n        clearTimeout(this._aggregationTimeoutId);\r\n        null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\r\n        this._operationManager.cancelAll();\r\n        delete this._store;\r\n        delete this._items;\r\n        delete this._delayedLoadTask;\r\n        this._disposed = true\r\n    },\r\n    _extractLoadOptions(options) {\r\n        var result = {};\r\n        var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\r\n        var customNames = this._store._customLoadOptions();\r\n        if (customNames) {\r\n            names = names.concat(customNames)\r\n        }\r\n        each(names, (function() {\r\n            result[this] = options[this]\r\n        }));\r\n        return result\r\n    },\r\n    loadOptions() {\r\n        return this._storeLoadOptions\r\n    },\r\n    items() {\r\n        return this._items\r\n    },\r\n    pageIndex(newIndex) {\r\n        if (!isNumeric(newIndex)) {\r\n            return this._pageIndex\r\n        }\r\n        this._pageIndex = newIndex;\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    paginate(value) {\r\n        if (!isBoolean(value)) {\r\n            return this._paginate\r\n        }\r\n        if (this._paginate !== value) {\r\n            this._paginate = value;\r\n            this.pageIndex(0)\r\n        }\r\n    },\r\n    pageSize(value) {\r\n        if (!isNumeric(value)) {\r\n            return this._pageSize\r\n        }\r\n        this._pageSize = value\r\n    },\r\n    isLastPage() {\r\n        return this._isLastPage\r\n    },\r\n    generateStoreLoadOptionAccessor(optionName) {\r\n        return args => {\r\n            var normalizedArgs = normalizeStoreLoadOptionAccessorArguments(args);\r\n            if (void 0 === normalizedArgs) {\r\n                return this._storeLoadOptions[optionName]\r\n            }\r\n            this._storeLoadOptions[optionName] = normalizedArgs\r\n        }\r\n    },\r\n    sort() {\r\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n            args[_key] = arguments[_key]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"sort\")(args)\r\n    },\r\n    filter() {\r\n        var newFilter = normalizeStoreLoadOptionAccessorArguments(arguments);\r\n        if (void 0 === newFilter) {\r\n            return this._storeLoadOptions.filter\r\n        }\r\n        this._storeLoadOptions.filter = newFilter;\r\n        this.pageIndex(0)\r\n    },\r\n    group() {\r\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\r\n            args[_key2] = arguments[_key2]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"group\")(args)\r\n    },\r\n    select() {\r\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\r\n            args[_key3] = arguments[_key3]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"select\")(args)\r\n    },\r\n    requireTotalCount(value) {\r\n        if (!isBoolean(value)) {\r\n            return this._storeLoadOptions.requireTotalCount\r\n        }\r\n        this._storeLoadOptions.requireTotalCount = value\r\n    },\r\n    searchValue(value) {\r\n        if (arguments.length < 1) {\r\n            return this._searchValue\r\n        }\r\n        this._searchValue = value;\r\n        this.pageIndex(0)\r\n    },\r\n    searchOperation(op) {\r\n        if (!isString(op)) {\r\n            return this._searchOperation\r\n        }\r\n        this._searchOperation = op;\r\n        this.pageIndex(0)\r\n    },\r\n    searchExpr(expr) {\r\n        var argc = arguments.length;\r\n        if (0 === argc) {\r\n            return this._searchExpr\r\n        }\r\n        if (argc > 1) {\r\n            expr = [].slice.call(arguments)\r\n        }\r\n        this._searchExpr = expr;\r\n        this.pageIndex(0)\r\n    },\r\n    store() {\r\n        return this._store\r\n    },\r\n    key() {\r\n        var _this$_store;\r\n        return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key()\r\n    },\r\n    totalCount() {\r\n        return this._totalCount\r\n    },\r\n    isLoaded() {\r\n        return this._isLoaded\r\n    },\r\n    isLoading() {\r\n        return this._loadingCount > 0\r\n    },\r\n    beginLoading() {\r\n        this._changeLoadingCount(1)\r\n    },\r\n    endLoading() {\r\n        this._changeLoadingCount(-1)\r\n    },\r\n    _createLoadQueue: () => create(),\r\n    _changeLoadingCount(increment) {\r\n        var oldLoading = this.isLoading();\r\n        this._loadingCount += increment;\r\n        var newLoading = this.isLoading();\r\n        if (oldLoading ^ newLoading) {\r\n            this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading])\r\n        }\r\n    },\r\n    _scheduleLoadCallbacks(deferred) {\r\n        this.beginLoading();\r\n        deferred.always(() => {\r\n            this.endLoading()\r\n        })\r\n    },\r\n    _scheduleFailCallbacks(deferred) {\r\n        var _this = this;\r\n        deferred.fail((function() {\r\n            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\r\n                args[_key4] = arguments[_key4]\r\n            }\r\n            if (args[0] === CANCELED_TOKEN) {\r\n                return\r\n            }\r\n            _this._eventsStrategy.fireEvent(\"loadError\", args)\r\n        }))\r\n    },\r\n    _fireChanged(args) {\r\n        var date = new Date;\r\n        this._eventsStrategy.fireEvent(\"changed\", args);\r\n        this._changedTime = new Date - date\r\n    },\r\n    _scheduleChangedCallbacks(deferred) {\r\n        deferred.done(() => this._fireChanged())\r\n    },\r\n    loadSingle(propName, propValue) {\r\n        var d = new Deferred;\r\n        var key = this.key();\r\n        var store = this._store;\r\n        var options = this._createStoreLoadOptions();\r\n        this._scheduleFailCallbacks(d);\r\n        if (arguments.length < 2) {\r\n            propValue = propName;\r\n            propName = key\r\n        }\r\n        delete options.skip;\r\n        delete options.group;\r\n        delete options.refresh;\r\n        delete options.pageIndex;\r\n        delete options.searchString;\r\n        (() => {\r\n            if (propName === key || store instanceof CustomStore && !store._byKeyViaLoad()) {\r\n                return store.byKey(propValue, options)\r\n            }\r\n            options.take = 1;\r\n            options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\r\n            return store.load(options)\r\n        })().fail(d.reject).done(data => {\r\n            var isEmptyArray = Array.isArray(data) && !data.length;\r\n            if (!isDefined(data) || isEmptyArray) {\r\n                d.reject(new errors.Error(\"E4009\"))\r\n            } else {\r\n                if (!Array.isArray(data)) {\r\n                    data = [data]\r\n                }\r\n                d.resolve(this._applyMapFunction(data)[0])\r\n            }\r\n        });\r\n        return d.promise()\r\n    },\r\n    load() {\r\n        var d = new Deferred;\r\n        var loadTask = () => {\r\n            if (this._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(d)) {\r\n                return\r\n            }\r\n            return this._loadFromStore(loadOperation, d)\r\n        };\r\n        this._scheduleLoadCallbacks(d);\r\n        this._scheduleFailCallbacks(d);\r\n        this._scheduleChangedCallbacks(d);\r\n        var loadOperation = this._createLoadOperation(d);\r\n        this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\r\n        this._loadQueue.add(() => {\r\n            if (\"number\" === typeof loadOperation.delay) {\r\n                this._delayedLoadTask = executeAsync(loadTask, loadOperation.delay)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d.promise()\r\n        });\r\n        return d.promise({\r\n            operationId: loadOperation.operationId\r\n        })\r\n    },\r\n    _onPush(changes) {\r\n        if (this._reshapeOnPush) {\r\n            this.load()\r\n        } else {\r\n            var changingArgs = {\r\n                changes: changes\r\n            };\r\n            this._eventsStrategy.fireEvent(\"changing\", [changingArgs]);\r\n            var group = this.group();\r\n            var items = this.items();\r\n            var groupLevel = 0;\r\n            var dataSourceChanges = this.paginate() || group ? changes.filter(item => \"update\" === item.type) : changes;\r\n            if (group) {\r\n                groupLevel = Array.isArray(group) ? group.length : 1\r\n            }\r\n            if (this._mapFunc) {\r\n                dataSourceChanges.forEach(item => {\r\n                    if (\"insert\" === item.type) {\r\n                        item.data = this._mapFunc(item.data)\r\n                    }\r\n                })\r\n            }\r\n            if (changingArgs.postProcessChanges) {\r\n                dataSourceChanges = changingArgs.postProcessChanges(dataSourceChanges)\r\n            }\r\n            applyBatch({\r\n                keyInfo: this.store(),\r\n                data: items,\r\n                changes: dataSourceChanges,\r\n                groupCount: groupLevel,\r\n                useInsertIndex: true\r\n            });\r\n            this._fireChanged([{\r\n                changes: changes\r\n            }])\r\n        }\r\n    },\r\n    _createLoadOperation(deferred) {\r\n        var operationId = this._operationManager.add(deferred);\r\n        var storeLoadOptions = this._createStoreLoadOptions();\r\n        deferred.always(() => this._operationManager.remove(operationId));\r\n        return {\r\n            operationId: operationId,\r\n            storeLoadOptions: storeLoadOptions\r\n        }\r\n    },\r\n    reload() {\r\n        var store = this.store();\r\n        if (store instanceof CustomStore) {\r\n            store.clearRawDataCache()\r\n        }\r\n        this._init();\r\n        return this.load()\r\n    },\r\n    cancel(operationId) {\r\n        return this._operationManager.cancel(operationId)\r\n    },\r\n    cancelAll() {\r\n        return this._operationManager.cancelAll()\r\n    },\r\n    _addSearchOptions(storeLoadOptions) {\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        if (this.store()._useDefaultSearch) {\r\n            this._addSearchFilter(storeLoadOptions)\r\n        } else {\r\n            storeLoadOptions.searchOperation = this._searchOperation;\r\n            storeLoadOptions.searchValue = this._searchValue;\r\n            storeLoadOptions.searchExpr = this._searchExpr\r\n        }\r\n    },\r\n    _createStoreLoadOptions() {\r\n        var result = extend({}, this._storeLoadOptions);\r\n        this._addSearchOptions(result);\r\n        if (this._paginate) {\r\n            if (this._pageSize) {\r\n                result.skip = this._pageIndex * this._pageSize;\r\n                result.take = this._pageSize\r\n            }\r\n        }\r\n        result.userData = this._userData;\r\n        return result\r\n    },\r\n    _addSearchFilter(storeLoadOptions) {\r\n        var value = this._searchValue;\r\n        var op = this._searchOperation;\r\n        var selector = this._searchExpr;\r\n        var searchFilter = [];\r\n        if (!value) {\r\n            return\r\n        }\r\n        if (!selector) {\r\n            selector = \"this\"\r\n        }\r\n        if (!Array.isArray(selector)) {\r\n            selector = [selector]\r\n        }\r\n        each(selector, (function(i, item) {\r\n            if (searchFilter.length) {\r\n                searchFilter.push(\"or\")\r\n            }\r\n            searchFilter.push([item, op, value])\r\n        }));\r\n        if (storeLoadOptions.filter) {\r\n            storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter]\r\n        } else {\r\n            storeLoadOptions.filter = searchFilter\r\n        }\r\n    },\r\n    _loadFromStore(loadOptions, pendingDeferred) {\r\n        var handleSuccess = (data, extra) => {\r\n            if (this._disposed) {\r\n                return\r\n            }\r\n            if (!isPending(pendingDeferred)) {\r\n                return\r\n            }\r\n            var loadResult = extend(normalizeLoadResult(data, extra), loadOptions);\r\n            this._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\r\n            when(loadResult.data).done(data => {\r\n                loadResult.data = data;\r\n                this._processStoreLoadResult(loadResult, pendingDeferred)\r\n            }).fail(pendingDeferred.reject)\r\n        };\r\n        if (loadOptions.data) {\r\n            return (new Deferred).resolve(loadOptions.data).done(handleSuccess)\r\n        }\r\n        return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject)\r\n    },\r\n    _processStoreLoadResult(loadResult, pendingDeferred) {\r\n        var data = loadResult.data;\r\n        var extra = loadResult.extra;\r\n        var storeLoadOptions = loadResult.storeLoadOptions;\r\n        var resolvePendingDeferred = () => {\r\n            this._isLoaded = true;\r\n            this._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\r\n            return pendingDeferred.resolve(data, extra)\r\n        };\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        data = this._applyPostProcessFunction(this._applyMapFunction(data));\r\n        if (!isObject(extra)) {\r\n            extra = {}\r\n        }\r\n        this._items = data;\r\n        if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\r\n            this._isLastPage = true\r\n        }\r\n        if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\r\n            (() => {\r\n                this.store().totalCount(storeLoadOptions).done((function(count) {\r\n                    extra.totalCount = count;\r\n                    resolvePendingDeferred()\r\n                })).fail(pendingDeferred.reject)\r\n            })()\r\n        } else {\r\n            resolvePendingDeferred()\r\n        }\r\n    },\r\n    _applyMapFunction(data) {\r\n        if (this._mapFunc) {\r\n            return mapDataRespectingGrouping(data, this._mapFunc, this.group())\r\n        }\r\n        return data\r\n    },\r\n    _applyPostProcessFunction(data) {\r\n        if (this._postProcessFunc) {\r\n            return this._postProcessFunc(data)\r\n        }\r\n        return data\r\n    },\r\n    on(eventName, eventHandler) {\r\n        this._eventsStrategy.on(eventName, eventHandler);\r\n        return this\r\n    },\r\n    off(eventName, eventHandler) {\r\n        this._eventsStrategy.off(eventName, eventHandler);\r\n        return this\r\n    }\r\n});\r\n"]},"metadata":{},"sourceType":"module"}