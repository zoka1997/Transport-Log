{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/scheduler/resources/utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { normalizeDataSourceOptions } from \"../../../data/data_source/utils\";\nimport { DataSource } from \"../../../data/data_source/data_source\";\nimport { when, Deferred } from \"../../../core/utils/deferred\";\nimport { compileGetter, compileSetter } from \"../../../core/utils/data\";\nimport { each } from \"../../../core/utils/iterator\";\nimport { extend } from \"../../../core/utils/extend\";\nimport { isDefined } from \"../../../core/utils/type\";\nimport { wrapToArray } from \"../../../core/utils/array\";\nimport { deepExtendArraySafe } from \"../../../core/utils/object\";\nimport { equalByValue } from \"../../../core/utils/common\";\nimport { hasResourceValue } from \"../../../renovation/ui/scheduler/resources/hasResourceValue\";\nexport var getValueExpr = resource => resource.valueExpr || \"id\";\nexport var getDisplayExpr = resource => resource.displayExpr || \"text\";\nexport var getFieldExpr = resource => resource.fieldExpr || resource.field;\nexport var getWrappedDataSource = dataSource => {\n  if (dataSource instanceof DataSource) {\n    return dataSource;\n  }\n\n  var result = _extends({}, normalizeDataSourceOptions(dataSource), {\n    pageSize: 0\n  });\n\n  if (!Array.isArray(dataSource)) {\n    result.filter = dataSource.filter;\n  }\n\n  return new DataSource(result);\n};\nexport var createResourcesTree = groups => {\n  var leafIndex = 0;\n\n  var make = (group, groupIndex, result, parent) => {\n    result = result || [];\n\n    for (var itemIndex = 0; itemIndex < group.items.length; itemIndex++) {\n      var _group$data;\n\n      var currentGroupItem = group.items[itemIndex];\n      var resultItem = {\n        name: group.name,\n        value: currentGroupItem.id,\n        title: currentGroupItem.text,\n        data: null === (_group$data = group.data) || void 0 === _group$data ? void 0 : _group$data[itemIndex],\n        children: [],\n        parent: parent || null\n      };\n      var nextGroupIndex = groupIndex + 1;\n\n      if (groups[nextGroupIndex]) {\n        make(groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem);\n      }\n\n      if (!resultItem.children.length) {\n        resultItem.leafIndex = leafIndex;\n        leafIndex++;\n      }\n\n      result.push(resultItem);\n    }\n\n    return result;\n  };\n\n  return make(groups[0], 0);\n};\nexport var getPathToLeaf = (leafIndex, groups) => {\n  var tree = createResourcesTree(groups);\n\n  var findLeafByIndex = (data, index) => {\n    for (var i = 0; i < data.length; i++) {\n      if (data[i].leafIndex === index) {\n        return data[i];\n      } else {\n        var _leaf = findLeafByIndex(data[i].children, index);\n\n        if (_leaf) {\n          return _leaf;\n        }\n      }\n    }\n  };\n\n  var makeBranch = (leaf, result) => {\n    result = result || [];\n    result.push(leaf.value);\n\n    if (leaf.parent) {\n      makeBranch(leaf.parent, result);\n    }\n\n    return result;\n  };\n\n  var leaf = findLeafByIndex(tree, leafIndex);\n  return makeBranch(leaf).reverse();\n};\nexport var getCellGroups = (groupIndex, groups) => {\n  var result = [];\n\n  if (getGroupCount(groups)) {\n    if (groupIndex < 0) {\n      return;\n    }\n\n    var path = getPathToLeaf(groupIndex, groups);\n\n    for (var i = 0; i < groups.length; i++) {\n      result.push({\n        name: groups[i].name,\n        id: path[i]\n      });\n    }\n  }\n\n  return result;\n};\nexport var getGroupCount = groups => {\n  var result = 0;\n\n  for (var i = 0, len = groups.length; i < len; i++) {\n    if (!i) {\n      result = groups[i].items.length;\n    } else {\n      result *= groups[i].items.length;\n    }\n  }\n\n  return result;\n};\nexport var getGroupsObjectFromGroupsArray = groupsArray => groupsArray.reduce((currentGroups, _ref) => {\n  var {\n    name: name,\n    id: id\n  } = _ref;\n  return _extends({}, currentGroups, {\n    [name]: id\n  });\n}, {});\nexport var getAllGroups = groups => {\n  var groupCount = getGroupCount(groups);\n  return [...new Array(groupCount)].map((_, groupIndex) => {\n    var groupsArray = getCellGroups(groupIndex, groups);\n    return getGroupsObjectFromGroupsArray(groupsArray);\n  });\n};\nexport var getResourceByField = (fieldName, loadedResources) => {\n  for (var i = 0; i < loadedResources.length; i++) {\n    var resource = loadedResources[i];\n\n    if (resource.name === fieldName) {\n      return resource.data;\n    }\n  }\n\n  return [];\n};\nexport var createResourceEditorModel = (resources, loadedResources) => resources.map(resource => {\n  var dataField = getFieldExpr(resource);\n  var dataSource = getResourceByField(dataField, loadedResources);\n  return {\n    editorOptions: {\n      dataSource: dataSource.length ? dataSource : getWrappedDataSource(resource.dataSource),\n      displayExpr: getDisplayExpr(resource),\n      valueExpr: getValueExpr(resource)\n    },\n    dataField: dataField,\n    editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\n    label: {\n      text: resource.label || dataField\n    }\n  };\n});\nexport var isResourceMultiple = (resources, resourceField) => {\n  var resource = resources.find(resource => {\n    var field = getFieldExpr(resource);\n    return field === resourceField;\n  });\n  return !!(null !== resource && void 0 !== resource && resource.allowMultiple);\n};\nexport var filterResources = (resources, fields) => resources.filter(resource => {\n  var field = getFieldExpr(resource);\n  return fields.indexOf(field) > -1;\n});\nexport var getPaintedResources = (resources, groups) => {\n  var newGroups = groups || [];\n  var result = resources.find(resource => resource.useColorAsDefault);\n\n  if (result) {\n    return result;\n  }\n\n  var newResources = newGroups.length ? filterResources(resources, newGroups) : resources;\n  return newResources[newResources.length - 1];\n};\nexport var getOrLoadResourceItem = (resources, resourceLoaderMap, field, value) => {\n  var result = new Deferred();\n  resources.filter(resource => getFieldExpr(resource) === field && isDefined(resource.dataSource)).forEach(resource => {\n    var wrappedDataSource = getWrappedDataSource(resource.dataSource);\n    var valueExpr = getValueExpr(resource);\n\n    if (!resourceLoaderMap.has(field)) {\n      resourceLoaderMap.set(field, wrappedDataSource.load());\n    }\n\n    resourceLoaderMap.get(field).done(data => {\n      var getter = compileGetter(valueExpr);\n      var filteredData = data.filter(resource => equalByValue(getter(resource), value));\n      result.resolve(filteredData[0]);\n    }).fail(() => {\n      resourceLoaderMap.delete(field);\n      result.reject();\n    });\n  });\n  return result.promise();\n};\nexport var getDataAccessors = (dataAccessors, fieldName, type) => {\n  var actions = dataAccessors[type];\n  return actions[fieldName];\n};\nexport var groupAppointmentsByResources = function (config, appointments) {\n  var groups = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [];\n  var result = {\n    0: appointments\n  };\n\n  if (groups.length && config.loadedResources.length) {\n    result = groupAppointmentsByResourcesCore(config, appointments, config.loadedResources);\n  }\n\n  var totalResourceCount = 0;\n  config.loadedResources.forEach((resource, index) => {\n    if (!index) {\n      totalResourceCount = resource.items.length;\n    } else {\n      totalResourceCount *= resource.items.length;\n    }\n  });\n\n  for (var index = 0; index < totalResourceCount; index++) {\n    var key = index.toString();\n\n    if (result[key]) {\n      continue;\n    }\n\n    result[key] = [];\n  }\n\n  return result;\n};\nexport var groupAppointmentsByResourcesCore = (config, appointments, resources) => {\n  var tree = createResourcesTree(resources);\n  var result = {};\n  appointments.forEach(appointment => {\n    var treeLeaves = getResourceTreeLeaves((field, action) => getDataAccessors(config.dataAccessors, field, action), tree, appointment);\n\n    for (var i = 0; i < treeLeaves.length; i++) {\n      if (!result[treeLeaves[i]]) {\n        result[treeLeaves[i]] = [];\n      }\n\n      result[treeLeaves[i]].push(deepExtendArraySafe({}, appointment, true));\n    }\n  });\n  return result;\n};\nexport var getResourceTreeLeaves = (getDataAccessors, tree, rawAppointment, result) => {\n  result = result || [];\n\n  for (var i = 0; i < tree.length; i++) {\n    if (!hasGroupItem(getDataAccessors, rawAppointment, tree[i].name, tree[i].value)) {\n      continue;\n    }\n\n    if (isDefined(tree[i].leafIndex)) {\n      result.push(tree[i].leafIndex);\n    }\n\n    if (tree[i].children) {\n      getResourceTreeLeaves(getDataAccessors, tree[i].children, rawAppointment, result);\n    }\n  }\n\n  return result;\n};\n\nvar hasGroupItem = (getDataAccessors, rawAppointment, groupName, itemValue) => {\n  var resourceValue = getDataAccessors(groupName, \"getter\")(rawAppointment);\n  return hasResourceValue(wrapToArray(resourceValue), itemValue);\n};\n\nexport var createReducedResourcesTree = (loadedResources, getDataAccessors, appointments) => {\n  var tree = createResourcesTree(loadedResources);\n  return reduceResourcesTree(getDataAccessors, tree, appointments);\n};\nexport var reduceResourcesTree = (getDataAccessors, tree, existingAppointments, _result) => {\n  _result = _result ? _result.children : [];\n  tree.forEach(function (node, index) {\n    var ok = false;\n    var resourceName = node.name;\n    var resourceValue = node.value;\n    var resourceTitle = node.title;\n    var resourceData = node.data;\n    var resourceGetter = getDataAccessors(resourceName, \"getter\");\n    existingAppointments.forEach(function (appointment) {\n      if (!ok) {\n        var resourceFromAppointment = resourceGetter(appointment);\n\n        if (Array.isArray(resourceFromAppointment)) {\n          if (resourceFromAppointment.indexOf(resourceValue) > -1) {\n            _result.push({\n              name: resourceName,\n              value: resourceValue,\n              title: resourceTitle,\n              data: resourceData,\n              children: []\n            });\n\n            ok = true;\n          }\n        } else if (resourceFromAppointment === resourceValue) {\n          _result.push({\n            name: resourceName,\n            value: resourceValue,\n            title: resourceTitle,\n            data: resourceData,\n            children: []\n          });\n\n          ok = true;\n        }\n      }\n    });\n\n    if (ok && node.children && node.children.length) {\n      reduceResourcesTree(getDataAccessors, node.children, existingAppointments, _result[index]);\n    }\n  });\n  return _result;\n};\nexport var getResourcesDataByGroups = (loadedResources, resources, groups) => {\n  if (!groups || !groups.length) {\n    return loadedResources;\n  }\n\n  var fieldNames = {};\n  var currentResourcesData = [];\n  groups.forEach(group => {\n    each(group, (name, value) => fieldNames[name] = value);\n  });\n  var resourceData = loadedResources.filter(_ref2 => {\n    var {\n      name: name\n    } = _ref2;\n    return isDefined(fieldNames[name]);\n  });\n  resourceData.forEach(data => currentResourcesData.push(extend({}, data)));\n  currentResourcesData.forEach(currentResource => {\n    var {\n      items: items,\n      data: data,\n      name: resourceName\n    } = currentResource;\n    var resource = filterResources(resources, [resourceName])[0] || {};\n    var valueExpr = getValueExpr(resource);\n    var filteredItems = [];\n    var filteredData = [];\n    groups.filter(group => isDefined(group[resourceName])).forEach(group => {\n      each(group, (name, value) => {\n        if (!filteredItems.filter(item => item.id === value && item[valueExpr] === name).length) {\n          var currentItems = items.filter(item => item.id === value);\n          var currentData = data.filter(item => item[valueExpr] === value);\n          filteredItems.push(...currentItems);\n          filteredData.push(...currentData);\n        }\n      });\n    });\n    currentResource.items = filteredItems;\n    currentResource.data = filteredData;\n  });\n  return currentResourcesData;\n};\nexport var setResourceToAppointment = (resources, dataAccessors, appointment, groups) => {\n  var resourcesSetter = dataAccessors.setter;\n\n  for (var name in groups) {\n    var resourceData = groups[name];\n    var value = isResourceMultiple(resources, name) ? wrapToArray(resourceData) : resourceData;\n    resourcesSetter[name](appointment, value);\n  }\n};\nexport var getResourceColor = (resources, resourceLoaderMap, field, value) => {\n  var result = new Deferred();\n  var resource = filterResources(resources, [field])[0] || {};\n  var colorExpr = resource.colorExpr || \"color\";\n  var colorGetter = compileGetter(colorExpr);\n  getOrLoadResourceItem(resources, resourceLoaderMap, field, value).done(resource => result.resolve(colorGetter(resource))).fail(() => result.reject());\n  return result.promise();\n};\nexport var getAppointmentColor = (resourceConfig, appointmentConfig) => {\n  var {\n    resources: resources,\n    dataAccessors: dataAccessors,\n    loadedResources: loadedResources,\n    resourceLoaderMap: resourceLoaderMap\n  } = resourceConfig;\n  var {\n    groupIndex: groupIndex,\n    groups: groups,\n    itemData: itemData\n  } = appointmentConfig;\n  var paintedResources = getPaintedResources(resources || [], groups);\n\n  if (paintedResources) {\n    var field = getFieldExpr(paintedResources);\n    var cellGroups = getCellGroups(groupIndex, loadedResources);\n    var resourcesDataAccessors = getDataAccessors(dataAccessors, field, \"getter\");\n    var resourceValues = wrapToArray(resourcesDataAccessors(itemData));\n    var groupId = resourceValues[0];\n\n    for (var i = 0; i < cellGroups.length; i++) {\n      if (cellGroups[i].name === field) {\n        groupId = cellGroups[i].id;\n        break;\n      }\n    }\n\n    return getResourceColor(resources, resourceLoaderMap, field, groupId);\n  }\n\n  return new Deferred().resolve().promise();\n};\nexport var createExpressions = function () {\n  var resources = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\n  var result = {\n    getter: {},\n    setter: {}\n  };\n  resources.forEach(resource => {\n    var field = getFieldExpr(resource);\n    result.getter[field] = compileGetter(field);\n    result.setter[field] = compileSetter(field);\n  });\n  return result;\n};\n\nvar getTransformedResourceData = (resource, data) => {\n  var valueGetter = compileGetter(getValueExpr(resource));\n  var displayGetter = compileGetter(getDisplayExpr(resource));\n  return data.map(item => {\n    var result = {\n      id: valueGetter(item),\n      text: displayGetter(item)\n    };\n\n    if (item.color) {\n      result.color = item.color;\n    }\n\n    return result;\n  });\n};\n\nexport var loadResources = (groups, resources, resourceLoaderMap) => {\n  var result = new Deferred();\n  var deferreds = [];\n  var newGroups = groups || [];\n  var newResources = resources || [];\n  var loadedResources = [];\n  filterResources(newResources, newGroups).forEach(resource => {\n    var deferred = new Deferred();\n    var name = getFieldExpr(resource);\n    deferreds.push(deferred);\n    var dataSourcePromise = getWrappedDataSource(resource.dataSource).load();\n    resourceLoaderMap.set(name, dataSourcePromise);\n    dataSourcePromise.done(data => {\n      var items = getTransformedResourceData(resource, data);\n      deferred.resolve({\n        name: name,\n        items: items,\n        data: data\n      });\n    }).fail(() => deferred.reject());\n  });\n\n  if (!deferreds.length) {\n    return result.resolve(loadedResources);\n  }\n\n  when.apply(null, deferreds).done(function () {\n    for (var _len = arguments.length, resources = new Array(_len), _key = 0; _key < _len; _key++) {\n      resources[_key] = arguments[_key];\n    }\n\n    var hasEmpty = resources.some(r => 0 === r.items.length);\n    loadedResources = hasEmpty ? [] : resources;\n    result.resolve(loadedResources);\n  }).fail(() => result.reject());\n  return result.promise();\n};\nexport var getNormalizedResources = (rawAppointment, dataAccessors, resources) => {\n  var result = {};\n  each(dataAccessors.resources.getter, fieldName => {\n    var value = dataAccessors.resources.getter[fieldName](rawAppointment);\n\n    if (isDefined(value)) {\n      var isMultiple = isResourceMultiple(resources, fieldName);\n      var resourceValue = isMultiple ? wrapToArray(value) : value;\n      result[fieldName] = resourceValue;\n    }\n  });\n  return result;\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/scheduler/resources/utils.js"],"names":["_extends","normalizeDataSourceOptions","DataSource","when","Deferred","compileGetter","compileSetter","each","extend","isDefined","wrapToArray","deepExtendArraySafe","equalByValue","hasResourceValue","getValueExpr","resource","valueExpr","getDisplayExpr","displayExpr","getFieldExpr","fieldExpr","field","getWrappedDataSource","dataSource","result","pageSize","Array","isArray","filter","createResourcesTree","groups","leafIndex","make","group","groupIndex","parent","itemIndex","items","length","_group$data","currentGroupItem","resultItem","name","value","id","title","text","data","children","nextGroupIndex","push","getPathToLeaf","tree","findLeafByIndex","index","i","_leaf","makeBranch","leaf","reverse","getCellGroups","getGroupCount","path","len","getGroupsObjectFromGroupsArray","groupsArray","reduce","currentGroups","_ref","getAllGroups","groupCount","map","_","getResourceByField","fieldName","loadedResources","createResourceEditorModel","resources","dataField","editorOptions","editorType","allowMultiple","label","isResourceMultiple","resourceField","find","filterResources","fields","indexOf","getPaintedResources","newGroups","useColorAsDefault","newResources","getOrLoadResourceItem","resourceLoaderMap","forEach","wrappedDataSource","has","set","load","get","done","getter","filteredData","resolve","fail","delete","reject","promise","getDataAccessors","dataAccessors","type","actions","groupAppointmentsByResources","config","appointments","arguments","groupAppointmentsByResourcesCore","totalResourceCount","key","toString","appointment","treeLeaves","getResourceTreeLeaves","action","rawAppointment","hasGroupItem","groupName","itemValue","resourceValue","createReducedResourcesTree","reduceResourcesTree","existingAppointments","_result","node","ok","resourceName","resourceTitle","resourceData","resourceGetter","resourceFromAppointment","getResourcesDataByGroups","fieldNames","currentResourcesData","_ref2","currentResource","filteredItems","item","currentItems","currentData","setResourceToAppointment","resourcesSetter","setter","getResourceColor","colorExpr","colorGetter","getAppointmentColor","resourceConfig","appointmentConfig","itemData","paintedResources","cellGroups","resourcesDataAccessors","resourceValues","groupId","createExpressions","getTransformedResourceData","valueGetter","displayGetter","color","loadResources","deferreds","deferred","dataSourcePromise","apply","_len","_key","hasEmpty","some","r","getNormalizedResources","isMultiple"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/scheduler/resources/utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport {\r\n    normalizeDataSourceOptions\r\n} from \"../../../data/data_source/utils\";\r\nimport {\r\n    DataSource\r\n} from \"../../../data/data_source/data_source\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../../core/utils/deferred\";\r\nimport {\r\n    compileGetter,\r\n    compileSetter\r\n} from \"../../../core/utils/data\";\r\nimport {\r\n    each\r\n} from \"../../../core/utils/iterator\";\r\nimport {\r\n    extend\r\n} from \"../../../core/utils/extend\";\r\nimport {\r\n    isDefined\r\n} from \"../../../core/utils/type\";\r\nimport {\r\n    wrapToArray\r\n} from \"../../../core/utils/array\";\r\nimport {\r\n    deepExtendArraySafe\r\n} from \"../../../core/utils/object\";\r\nimport {\r\n    equalByValue\r\n} from \"../../../core/utils/common\";\r\nimport {\r\n    hasResourceValue\r\n} from \"../../../renovation/ui/scheduler/resources/hasResourceValue\";\r\nexport var getValueExpr = resource => resource.valueExpr || \"id\";\r\nexport var getDisplayExpr = resource => resource.displayExpr || \"text\";\r\nexport var getFieldExpr = resource => resource.fieldExpr || resource.field;\r\nexport var getWrappedDataSource = dataSource => {\r\n    if (dataSource instanceof DataSource) {\r\n        return dataSource\r\n    }\r\n    var result = _extends({}, normalizeDataSourceOptions(dataSource), {\r\n        pageSize: 0\r\n    });\r\n    if (!Array.isArray(dataSource)) {\r\n        result.filter = dataSource.filter\r\n    }\r\n    return new DataSource(result)\r\n};\r\nexport var createResourcesTree = groups => {\r\n    var leafIndex = 0;\r\n    var make = (group, groupIndex, result, parent) => {\r\n        result = result || [];\r\n        for (var itemIndex = 0; itemIndex < group.items.length; itemIndex++) {\r\n            var _group$data;\r\n            var currentGroupItem = group.items[itemIndex];\r\n            var resultItem = {\r\n                name: group.name,\r\n                value: currentGroupItem.id,\r\n                title: currentGroupItem.text,\r\n                data: null === (_group$data = group.data) || void 0 === _group$data ? void 0 : _group$data[itemIndex],\r\n                children: [],\r\n                parent: parent || null\r\n            };\r\n            var nextGroupIndex = groupIndex + 1;\r\n            if (groups[nextGroupIndex]) {\r\n                make(groups[nextGroupIndex], nextGroupIndex, resultItem.children, resultItem)\r\n            }\r\n            if (!resultItem.children.length) {\r\n                resultItem.leafIndex = leafIndex;\r\n                leafIndex++\r\n            }\r\n            result.push(resultItem)\r\n        }\r\n        return result\r\n    };\r\n    return make(groups[0], 0)\r\n};\r\nexport var getPathToLeaf = (leafIndex, groups) => {\r\n    var tree = createResourcesTree(groups);\r\n    var findLeafByIndex = (data, index) => {\r\n        for (var i = 0; i < data.length; i++) {\r\n            if (data[i].leafIndex === index) {\r\n                return data[i]\r\n            } else {\r\n                var _leaf = findLeafByIndex(data[i].children, index);\r\n                if (_leaf) {\r\n                    return _leaf\r\n                }\r\n            }\r\n        }\r\n    };\r\n    var makeBranch = (leaf, result) => {\r\n        result = result || [];\r\n        result.push(leaf.value);\r\n        if (leaf.parent) {\r\n            makeBranch(leaf.parent, result)\r\n        }\r\n        return result\r\n    };\r\n    var leaf = findLeafByIndex(tree, leafIndex);\r\n    return makeBranch(leaf).reverse()\r\n};\r\nexport var getCellGroups = (groupIndex, groups) => {\r\n    var result = [];\r\n    if (getGroupCount(groups)) {\r\n        if (groupIndex < 0) {\r\n            return\r\n        }\r\n        var path = getPathToLeaf(groupIndex, groups);\r\n        for (var i = 0; i < groups.length; i++) {\r\n            result.push({\r\n                name: groups[i].name,\r\n                id: path[i]\r\n            })\r\n        }\r\n    }\r\n    return result\r\n};\r\nexport var getGroupCount = groups => {\r\n    var result = 0;\r\n    for (var i = 0, len = groups.length; i < len; i++) {\r\n        if (!i) {\r\n            result = groups[i].items.length\r\n        } else {\r\n            result *= groups[i].items.length\r\n        }\r\n    }\r\n    return result\r\n};\r\nexport var getGroupsObjectFromGroupsArray = groupsArray => groupsArray.reduce((currentGroups, _ref) => {\r\n    var {\r\n        name: name,\r\n        id: id\r\n    } = _ref;\r\n    return _extends({}, currentGroups, {\r\n        [name]: id\r\n    })\r\n}, {});\r\nexport var getAllGroups = groups => {\r\n    var groupCount = getGroupCount(groups);\r\n    return [...new Array(groupCount)].map((_, groupIndex) => {\r\n        var groupsArray = getCellGroups(groupIndex, groups);\r\n        return getGroupsObjectFromGroupsArray(groupsArray)\r\n    })\r\n};\r\nexport var getResourceByField = (fieldName, loadedResources) => {\r\n    for (var i = 0; i < loadedResources.length; i++) {\r\n        var resource = loadedResources[i];\r\n        if (resource.name === fieldName) {\r\n            return resource.data\r\n        }\r\n    }\r\n    return []\r\n};\r\nexport var createResourceEditorModel = (resources, loadedResources) => resources.map(resource => {\r\n    var dataField = getFieldExpr(resource);\r\n    var dataSource = getResourceByField(dataField, loadedResources);\r\n    return {\r\n        editorOptions: {\r\n            dataSource: dataSource.length ? dataSource : getWrappedDataSource(resource.dataSource),\r\n            displayExpr: getDisplayExpr(resource),\r\n            valueExpr: getValueExpr(resource)\r\n        },\r\n        dataField: dataField,\r\n        editorType: resource.allowMultiple ? \"dxTagBox\" : \"dxSelectBox\",\r\n        label: {\r\n            text: resource.label || dataField\r\n        }\r\n    }\r\n});\r\nexport var isResourceMultiple = (resources, resourceField) => {\r\n    var resource = resources.find(resource => {\r\n        var field = getFieldExpr(resource);\r\n        return field === resourceField\r\n    });\r\n    return !!(null !== resource && void 0 !== resource && resource.allowMultiple)\r\n};\r\nexport var filterResources = (resources, fields) => resources.filter(resource => {\r\n    var field = getFieldExpr(resource);\r\n    return fields.indexOf(field) > -1\r\n});\r\nexport var getPaintedResources = (resources, groups) => {\r\n    var newGroups = groups || [];\r\n    var result = resources.find(resource => resource.useColorAsDefault);\r\n    if (result) {\r\n        return result\r\n    }\r\n    var newResources = newGroups.length ? filterResources(resources, newGroups) : resources;\r\n    return newResources[newResources.length - 1]\r\n};\r\nexport var getOrLoadResourceItem = (resources, resourceLoaderMap, field, value) => {\r\n    var result = new Deferred;\r\n    resources.filter(resource => getFieldExpr(resource) === field && isDefined(resource.dataSource)).forEach(resource => {\r\n        var wrappedDataSource = getWrappedDataSource(resource.dataSource);\r\n        var valueExpr = getValueExpr(resource);\r\n        if (!resourceLoaderMap.has(field)) {\r\n            resourceLoaderMap.set(field, wrappedDataSource.load())\r\n        }\r\n        resourceLoaderMap.get(field).done(data => {\r\n            var getter = compileGetter(valueExpr);\r\n            var filteredData = data.filter(resource => equalByValue(getter(resource), value));\r\n            result.resolve(filteredData[0])\r\n        }).fail(() => {\r\n            resourceLoaderMap.delete(field);\r\n            result.reject()\r\n        })\r\n    });\r\n    return result.promise()\r\n};\r\nexport var getDataAccessors = (dataAccessors, fieldName, type) => {\r\n    var actions = dataAccessors[type];\r\n    return actions[fieldName]\r\n};\r\nexport var groupAppointmentsByResources = function(config, appointments) {\r\n    var groups = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : [];\r\n    var result = {\r\n        0: appointments\r\n    };\r\n    if (groups.length && config.loadedResources.length) {\r\n        result = groupAppointmentsByResourcesCore(config, appointments, config.loadedResources)\r\n    }\r\n    var totalResourceCount = 0;\r\n    config.loadedResources.forEach((resource, index) => {\r\n        if (!index) {\r\n            totalResourceCount = resource.items.length\r\n        } else {\r\n            totalResourceCount *= resource.items.length\r\n        }\r\n    });\r\n    for (var index = 0; index < totalResourceCount; index++) {\r\n        var key = index.toString();\r\n        if (result[key]) {\r\n            continue\r\n        }\r\n        result[key] = []\r\n    }\r\n    return result\r\n};\r\nexport var groupAppointmentsByResourcesCore = (config, appointments, resources) => {\r\n    var tree = createResourcesTree(resources);\r\n    var result = {};\r\n    appointments.forEach(appointment => {\r\n        var treeLeaves = getResourceTreeLeaves((field, action) => getDataAccessors(config.dataAccessors, field, action), tree, appointment);\r\n        for (var i = 0; i < treeLeaves.length; i++) {\r\n            if (!result[treeLeaves[i]]) {\r\n                result[treeLeaves[i]] = []\r\n            }\r\n            result[treeLeaves[i]].push(deepExtendArraySafe({}, appointment, true))\r\n        }\r\n    });\r\n    return result\r\n};\r\nexport var getResourceTreeLeaves = (getDataAccessors, tree, rawAppointment, result) => {\r\n    result = result || [];\r\n    for (var i = 0; i < tree.length; i++) {\r\n        if (!hasGroupItem(getDataAccessors, rawAppointment, tree[i].name, tree[i].value)) {\r\n            continue\r\n        }\r\n        if (isDefined(tree[i].leafIndex)) {\r\n            result.push(tree[i].leafIndex)\r\n        }\r\n        if (tree[i].children) {\r\n            getResourceTreeLeaves(getDataAccessors, tree[i].children, rawAppointment, result)\r\n        }\r\n    }\r\n    return result\r\n};\r\nvar hasGroupItem = (getDataAccessors, rawAppointment, groupName, itemValue) => {\r\n    var resourceValue = getDataAccessors(groupName, \"getter\")(rawAppointment);\r\n    return hasResourceValue(wrapToArray(resourceValue), itemValue)\r\n};\r\nexport var createReducedResourcesTree = (loadedResources, getDataAccessors, appointments) => {\r\n    var tree = createResourcesTree(loadedResources);\r\n    return reduceResourcesTree(getDataAccessors, tree, appointments)\r\n};\r\nexport var reduceResourcesTree = (getDataAccessors, tree, existingAppointments, _result) => {\r\n    _result = _result ? _result.children : [];\r\n    tree.forEach((function(node, index) {\r\n        var ok = false;\r\n        var resourceName = node.name;\r\n        var resourceValue = node.value;\r\n        var resourceTitle = node.title;\r\n        var resourceData = node.data;\r\n        var resourceGetter = getDataAccessors(resourceName, \"getter\");\r\n        existingAppointments.forEach((function(appointment) {\r\n            if (!ok) {\r\n                var resourceFromAppointment = resourceGetter(appointment);\r\n                if (Array.isArray(resourceFromAppointment)) {\r\n                    if (resourceFromAppointment.indexOf(resourceValue) > -1) {\r\n                        _result.push({\r\n                            name: resourceName,\r\n                            value: resourceValue,\r\n                            title: resourceTitle,\r\n                            data: resourceData,\r\n                            children: []\r\n                        });\r\n                        ok = true\r\n                    }\r\n                } else if (resourceFromAppointment === resourceValue) {\r\n                    _result.push({\r\n                        name: resourceName,\r\n                        value: resourceValue,\r\n                        title: resourceTitle,\r\n                        data: resourceData,\r\n                        children: []\r\n                    });\r\n                    ok = true\r\n                }\r\n            }\r\n        }));\r\n        if (ok && node.children && node.children.length) {\r\n            reduceResourcesTree(getDataAccessors, node.children, existingAppointments, _result[index])\r\n        }\r\n    }));\r\n    return _result\r\n};\r\nexport var getResourcesDataByGroups = (loadedResources, resources, groups) => {\r\n    if (!groups || !groups.length) {\r\n        return loadedResources\r\n    }\r\n    var fieldNames = {};\r\n    var currentResourcesData = [];\r\n    groups.forEach(group => {\r\n        each(group, (name, value) => fieldNames[name] = value)\r\n    });\r\n    var resourceData = loadedResources.filter(_ref2 => {\r\n        var {\r\n            name: name\r\n        } = _ref2;\r\n        return isDefined(fieldNames[name])\r\n    });\r\n    resourceData.forEach(data => currentResourcesData.push(extend({}, data)));\r\n    currentResourcesData.forEach(currentResource => {\r\n        var {\r\n            items: items,\r\n            data: data,\r\n            name: resourceName\r\n        } = currentResource;\r\n        var resource = filterResources(resources, [resourceName])[0] || {};\r\n        var valueExpr = getValueExpr(resource);\r\n        var filteredItems = [];\r\n        var filteredData = [];\r\n        groups.filter(group => isDefined(group[resourceName])).forEach(group => {\r\n            each(group, (name, value) => {\r\n                if (!filteredItems.filter(item => item.id === value && item[valueExpr] === name).length) {\r\n                    var currentItems = items.filter(item => item.id === value);\r\n                    var currentData = data.filter(item => item[valueExpr] === value);\r\n                    filteredItems.push(...currentItems);\r\n                    filteredData.push(...currentData)\r\n                }\r\n            })\r\n        });\r\n        currentResource.items = filteredItems;\r\n        currentResource.data = filteredData\r\n    });\r\n    return currentResourcesData\r\n};\r\nexport var setResourceToAppointment = (resources, dataAccessors, appointment, groups) => {\r\n    var resourcesSetter = dataAccessors.setter;\r\n    for (var name in groups) {\r\n        var resourceData = groups[name];\r\n        var value = isResourceMultiple(resources, name) ? wrapToArray(resourceData) : resourceData;\r\n        resourcesSetter[name](appointment, value)\r\n    }\r\n};\r\nexport var getResourceColor = (resources, resourceLoaderMap, field, value) => {\r\n    var result = new Deferred;\r\n    var resource = filterResources(resources, [field])[0] || {};\r\n    var colorExpr = resource.colorExpr || \"color\";\r\n    var colorGetter = compileGetter(colorExpr);\r\n    getOrLoadResourceItem(resources, resourceLoaderMap, field, value).done(resource => result.resolve(colorGetter(resource))).fail(() => result.reject());\r\n    return result.promise()\r\n};\r\nexport var getAppointmentColor = (resourceConfig, appointmentConfig) => {\r\n    var {\r\n        resources: resources,\r\n        dataAccessors: dataAccessors,\r\n        loadedResources: loadedResources,\r\n        resourceLoaderMap: resourceLoaderMap\r\n    } = resourceConfig;\r\n    var {\r\n        groupIndex: groupIndex,\r\n        groups: groups,\r\n        itemData: itemData\r\n    } = appointmentConfig;\r\n    var paintedResources = getPaintedResources(resources || [], groups);\r\n    if (paintedResources) {\r\n        var field = getFieldExpr(paintedResources);\r\n        var cellGroups = getCellGroups(groupIndex, loadedResources);\r\n        var resourcesDataAccessors = getDataAccessors(dataAccessors, field, \"getter\");\r\n        var resourceValues = wrapToArray(resourcesDataAccessors(itemData));\r\n        var groupId = resourceValues[0];\r\n        for (var i = 0; i < cellGroups.length; i++) {\r\n            if (cellGroups[i].name === field) {\r\n                groupId = cellGroups[i].id;\r\n                break\r\n            }\r\n        }\r\n        return getResourceColor(resources, resourceLoaderMap, field, groupId)\r\n    }\r\n    return (new Deferred).resolve().promise()\r\n};\r\nexport var createExpressions = function() {\r\n    var resources = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];\r\n    var result = {\r\n        getter: {},\r\n        setter: {}\r\n    };\r\n    resources.forEach(resource => {\r\n        var field = getFieldExpr(resource);\r\n        result.getter[field] = compileGetter(field);\r\n        result.setter[field] = compileSetter(field)\r\n    });\r\n    return result\r\n};\r\nvar getTransformedResourceData = (resource, data) => {\r\n    var valueGetter = compileGetter(getValueExpr(resource));\r\n    var displayGetter = compileGetter(getDisplayExpr(resource));\r\n    return data.map(item => {\r\n        var result = {\r\n            id: valueGetter(item),\r\n            text: displayGetter(item)\r\n        };\r\n        if (item.color) {\r\n            result.color = item.color\r\n        }\r\n        return result\r\n    })\r\n};\r\nexport var loadResources = (groups, resources, resourceLoaderMap) => {\r\n    var result = new Deferred;\r\n    var deferreds = [];\r\n    var newGroups = groups || [];\r\n    var newResources = resources || [];\r\n    var loadedResources = [];\r\n    filterResources(newResources, newGroups).forEach(resource => {\r\n        var deferred = new Deferred;\r\n        var name = getFieldExpr(resource);\r\n        deferreds.push(deferred);\r\n        var dataSourcePromise = getWrappedDataSource(resource.dataSource).load();\r\n        resourceLoaderMap.set(name, dataSourcePromise);\r\n        dataSourcePromise.done(data => {\r\n            var items = getTransformedResourceData(resource, data);\r\n            deferred.resolve({\r\n                name: name,\r\n                items: items,\r\n                data: data\r\n            })\r\n        }).fail(() => deferred.reject())\r\n    });\r\n    if (!deferreds.length) {\r\n        return result.resolve(loadedResources)\r\n    }\r\n    when.apply(null, deferreds).done((function() {\r\n        for (var _len = arguments.length, resources = new Array(_len), _key = 0; _key < _len; _key++) {\r\n            resources[_key] = arguments[_key]\r\n        }\r\n        var hasEmpty = resources.some(r => 0 === r.items.length);\r\n        loadedResources = hasEmpty ? [] : resources;\r\n        result.resolve(loadedResources)\r\n    })).fail(() => result.reject());\r\n    return result.promise()\r\n};\r\nexport var getNormalizedResources = (rawAppointment, dataAccessors, resources) => {\r\n    var result = {};\r\n    each(dataAccessors.resources.getter, fieldName => {\r\n        var value = dataAccessors.resources.getter[fieldName](rawAppointment);\r\n        if (isDefined(value)) {\r\n            var isMultiple = isResourceMultiple(resources, fieldName);\r\n            var resourceValue = isMultiple ? wrapToArray(value) : value;\r\n            result[fieldName] = resourceValue\r\n        }\r\n    });\r\n    return result\r\n};\r\n"]},"metadata":{},"sourceType":"module"}