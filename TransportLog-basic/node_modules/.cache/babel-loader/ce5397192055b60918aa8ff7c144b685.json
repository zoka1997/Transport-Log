{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.header_filter.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport modules from \"./ui.grid_core.modules\";\nimport filterUtils from \"../shared/filtering\";\nimport gridCoreUtils from \"./ui.grid_core.utils\";\nimport { headerFilterMixin, HeaderFilterView, updateHeaderFilterItemSelectionState, allowHeaderFiltering } from \"./ui.grid_core.header_filter_core\";\nimport messageLocalization from \"../../localization/message\";\nimport { name as clickEventName } from \"../../events/click\";\nimport { compileGetter } from \"../../core/utils/data\";\nimport { each } from \"../../core/utils/iterator\";\nimport { isDefined, isObject, isFunction } from \"../../core/utils/type\";\nimport { getDefaultAlignment } from \"../../core/utils/position\";\nimport { extend } from \"../../core/utils/extend\";\nimport { normalizeDataSourceOptions } from \"../../data/data_source/utils\";\nimport dateLocalization from \"../../localization/date\";\nimport { Deferred } from \"../../core/utils/deferred\";\nimport { restoreFocus } from \"../shared/accessibility\";\nimport dataQuery from \"../../data/query\";\nimport storeHelper from \"../../data/store_helper\";\nvar DATE_INTERVAL_FORMATS = {\n  month: function (value) {\n    return dateLocalization.getMonthNames()[value - 1];\n  },\n  quarter: function (value) {\n    return dateLocalization.format(new Date(2e3, 3 * value - 1), \"quarter\");\n  }\n};\n\nfunction ungroupUTCDates(items, dateParts, dates) {\n  dateParts = dateParts || [];\n  dates = dates || [];\n  items.forEach(item => {\n    if (isDefined(item.key)) {\n      var isMonthPart = 1 === dateParts.length;\n      dateParts.push(isMonthPart ? item.key - 1 : item.key);\n\n      if (item.items) {\n        ungroupUTCDates(item.items, dateParts, dates);\n      } else {\n        var date = new Date(Date.UTC.apply(Date, dateParts));\n        dates.push(date);\n      }\n\n      dateParts.pop();\n    } else {\n      dates.push(null);\n    }\n  });\n  return dates;\n}\n\nfunction convertDataFromUTCToLocal(data, column) {\n  var dates = ungroupUTCDates(data);\n  var query = dataQuery(dates);\n  var group = gridCoreUtils.getHeaderFilterGroupParameters(_extends({}, column, {\n    calculateCellValue: date => date\n  }));\n  return storeHelper.queryByOptions(query, {\n    group: group\n  }).toArray();\n}\n\nfunction isUTCFormat(format) {\n  return \"Z\" === (null === format || void 0 === format ? void 0 : format.slice(-1)) || \"'Z'\" === (null === format || void 0 === format ? void 0 : format.slice(-3));\n}\n\nvar HeaderFilterController = modules.ViewController.inherit({\n  init: function () {\n    this._columnsController = this.getController(\"columns\");\n    this._dataController = this.getController(\"data\");\n    this._headerFilterView = this.getView(\"headerFilterView\");\n  },\n  _updateSelectedState: function (items, column) {\n    var i = items.length;\n    var isExclude = \"exclude\" === column.filterType;\n\n    while (i--) {\n      var item = items[i];\n\n      if (\"items\" in items[i]) {\n        this._updateSelectedState(items[i].items, column);\n      }\n\n      updateHeaderFilterItemSelectionState(item, gridCoreUtils.getIndexByKey(items[i].value, column.filterValues, null) > -1, isExclude);\n    }\n  },\n  _normalizeGroupItem: function (item, currentLevel, options) {\n    var value;\n    var displayValue;\n    var path = options.path;\n    var valueSelector = options.valueSelector;\n    var displaySelector = options.displaySelector;\n    var column = options.column;\n\n    if (valueSelector && displaySelector) {\n      value = valueSelector(item);\n      displayValue = displaySelector(item);\n    } else {\n      value = item.key;\n      displayValue = value;\n    }\n\n    if (!isObject(item)) {\n      item = {};\n    } else {\n      item = extend({}, item);\n    }\n\n    path.push(value);\n\n    if (1 === path.length) {\n      item.value = path[0];\n    } else {\n      item.value = path.join(\"/\");\n    }\n\n    item.text = this.getHeaderItemText(displayValue, column, currentLevel, options.headerFilterOptions);\n    return item;\n  },\n  getHeaderItemText: function (displayValue, column, currentLevel, headerFilterOptions) {\n    var text = gridCoreUtils.formatValue(displayValue, function (value, column, currentLevel) {\n      var groupInterval = filterUtils.getGroupInterval(column);\n      var result = gridCoreUtils.getFormatOptionsByColumn(column, \"headerFilter\");\n\n      if (groupInterval) {\n        result.groupInterval = groupInterval[currentLevel];\n\n        if (gridCoreUtils.isDateType(column.dataType)) {\n          result.format = DATE_INTERVAL_FORMATS[groupInterval[currentLevel]];\n        } else if (\"number\" === column.dataType) {\n          result.getDisplayFormat = function () {\n            var formatOptions = {\n              format: column.format,\n              target: \"headerFilter\"\n            };\n            var firstValueText = gridCoreUtils.formatValue(value, formatOptions);\n            var secondValue = value + groupInterval[currentLevel];\n            var secondValueText = gridCoreUtils.formatValue(secondValue, formatOptions);\n            return firstValueText && secondValueText ? firstValueText + \" - \" + secondValueText : \"\";\n          };\n        }\n      }\n\n      return result;\n    }(displayValue, column, currentLevel));\n\n    if (!text) {\n      text = headerFilterOptions.texts.emptyValue;\n    }\n\n    return text;\n  },\n  _processGroupItems: function (groupItems, currentLevel, path, options) {\n    var displaySelector;\n    var valueSelector;\n    var column = options.column;\n    var lookup = column.lookup;\n    var level = options.level;\n    path = path || [];\n    currentLevel = currentLevel || 0;\n\n    if (lookup) {\n      displaySelector = compileGetter(lookup.displayExpr);\n      valueSelector = compileGetter(lookup.valueExpr);\n    }\n\n    for (var i = 0; i < groupItems.length; i++) {\n      groupItems[i] = this._normalizeGroupItem(groupItems[i], currentLevel, {\n        column: options.column,\n        headerFilterOptions: options.headerFilterOptions,\n        displaySelector: displaySelector,\n        valueSelector: valueSelector,\n        path: path\n      });\n\n      if (\"items\" in groupItems[i]) {\n        if (currentLevel === level || !isDefined(groupItems[i].value)) {\n          delete groupItems[i].items;\n        } else {\n          this._processGroupItems(groupItems[i].items, currentLevel + 1, path, options);\n        }\n      }\n\n      path.pop();\n    }\n  },\n  getDataSource: function (column) {\n    var _column$headerFilter;\n\n    var dataSource = this._dataController.dataSource();\n\n    var remoteGrouping = null === dataSource || void 0 === dataSource ? void 0 : dataSource.remoteOperations().grouping;\n    var group = gridCoreUtils.getHeaderFilterGroupParameters(column, remoteGrouping);\n    var headerFilterDataSource = null === (_column$headerFilter = column.headerFilter) || void 0 === _column$headerFilter ? void 0 : _column$headerFilter.dataSource;\n    var headerFilterOptions = this.option(\"headerFilter\");\n    var isLookup = false;\n    var options = {\n      component: this.component\n    };\n\n    if (!dataSource) {\n      return;\n    }\n\n    if (isDefined(headerFilterDataSource) && !isFunction(headerFilterDataSource)) {\n      options.dataSource = normalizeDataSourceOptions(headerFilterDataSource);\n    } else if (column.lookup) {\n      isLookup = true;\n\n      if (this.option(\"syncLookupFilterValues\")) {\n        this._currentColumn = column;\n\n        var filter = this._dataController.getCombinedFilter();\n\n        this._currentColumn = null;\n        options.dataSource = gridCoreUtils.getWrappedLookupDataSource(column, dataSource, filter);\n      } else {\n        options.dataSource = gridCoreUtils.normalizeLookupDataSource(column.lookup);\n      }\n    } else {\n      var cutoffLevel = Array.isArray(group) ? group.length - 1 : 0;\n      this._currentColumn = column;\n\n      var _filter = this._dataController.getCombinedFilter();\n\n      this._currentColumn = null;\n      options.dataSource = {\n        filter: _filter,\n        group: group,\n        useDefaultSearch: true,\n        load: options => {\n          var d = new Deferred();\n          options.dataField = column.dataField || column.name;\n          dataSource.load(options).done(function (data) {\n            var convertUTCDates = remoteGrouping && isUTCFormat(column.serializationFormat) && cutoffLevel > 3;\n\n            if (convertUTCDates) {\n              data = convertDataFromUTCToLocal(data, column);\n            }\n\n            that._processGroupItems(data, null, null, {\n              level: cutoffLevel,\n              column: column,\n              headerFilterOptions: headerFilterOptions\n            });\n\n            d.resolve(data);\n          }).fail(d.reject);\n          return d;\n        }\n      };\n    }\n\n    if (isFunction(headerFilterDataSource)) {\n      headerFilterDataSource.call(column, options);\n    }\n\n    var origPostProcess = options.dataSource.postProcess;\n    var that = this;\n\n    options.dataSource.postProcess = function (data) {\n      var items = data;\n\n      if (isLookup) {\n        if (0 === this.pageIndex() && !this.searchValue()) {\n          items = items.slice(0);\n          items.unshift(null);\n        }\n\n        that._processGroupItems(items, null, null, {\n          level: 0,\n          column: column,\n          headerFilterOptions: headerFilterOptions\n        });\n      }\n\n      items = origPostProcess && origPostProcess.call(this, items) || items;\n\n      that._updateSelectedState(items, column);\n\n      return items;\n    };\n\n    return options.dataSource;\n  },\n  getCurrentColumn: function () {\n    return this._currentColumn;\n  },\n  showHeaderFilterMenu: function (columnIndex, isGroupPanel) {\n    var columnsController = this._columnsController;\n    var column = extend(true, {}, this._columnsController.getColumns()[columnIndex]);\n\n    if (column) {\n      var visibleIndex = columnsController.getVisibleIndex(columnIndex);\n      var view = isGroupPanel ? this.getView(\"headerPanel\") : this.getView(\"columnHeadersView\");\n      var $columnElement = $columnElement || view.getColumnElements().eq(isGroupPanel ? column.groupIndex : visibleIndex);\n      this.showHeaderFilterMenuBase({\n        columnElement: $columnElement,\n        column: column,\n        applyFilter: true,\n        apply: function () {\n          columnsController.columnOption(columnIndex, {\n            filterValues: this.filterValues,\n            filterType: this.filterType\n          });\n        }\n      });\n    }\n  },\n  showHeaderFilterMenuBase: function (options) {\n    var that = this;\n    var column = options.column;\n\n    if (column) {\n      var groupInterval = filterUtils.getGroupInterval(column);\n\n      var dataSource = that._dataController.dataSource();\n\n      var remoteFiltering = dataSource && dataSource.remoteOperations().filtering;\n      extend(options, column, {\n        type: groupInterval && groupInterval.length > 1 ? \"tree\" : \"list\",\n        remoteFiltering: remoteFiltering,\n        onShowing: function (e) {\n          var dxResizableInstance = e.component.$overlayContent().dxResizable(\"instance\");\n          dxResizableInstance && dxResizableInstance.option(\"onResizeEnd\", function (e) {\n            var columnsController = that.getController(\"columns\");\n            var headerFilterByColumn = columnsController.columnOption(options.dataField, \"headerFilter\");\n            headerFilterByColumn = headerFilterByColumn || {};\n            headerFilterByColumn.width = e.width;\n            headerFilterByColumn.height = e.height;\n            columnsController.columnOption(options.dataField, \"headerFilter\", headerFilterByColumn, true);\n          });\n        },\n        onHidden: () => restoreFocus(this)\n      });\n      options.dataSource = that.getDataSource(options);\n\n      if (options.isFilterBuilder) {\n        options.dataSource.filter = null;\n        options.alignment = \"right\";\n      }\n\n      that._headerFilterView.showHeaderFilterMenu(options.columnElement, options);\n    }\n  },\n  hideHeaderFilterMenu: function () {\n    this._headerFilterView.hideHeaderFilterMenu();\n  }\n});\nvar ColumnHeadersViewHeaderFilterExtender = extend({}, headerFilterMixin, {\n  _renderCellContent: function ($cell, options) {\n    var that = this;\n    var $headerFilterIndicator;\n    var column = options.column;\n\n    if (!column.command && allowHeaderFiltering(column) && that.option(\"headerFilter.visible\") && \"header\" === options.rowType) {\n      $headerFilterIndicator = that._applyColumnState({\n        name: \"headerFilter\",\n        rootElement: $cell,\n        column: column,\n        showColumnLines: that.option(\"showColumnLines\")\n      });\n      $headerFilterIndicator && that._subscribeToIndicatorEvent($headerFilterIndicator, column, \"headerFilter\");\n    }\n\n    this.callBase.apply(this, arguments);\n  },\n  _subscribeToIndicatorEvent: function ($indicator, column, indicatorName) {\n    var that = this;\n\n    if (\"headerFilter\" === indicatorName) {\n      eventsEngine.on($indicator, clickEventName, that.createAction(function (e) {\n        e.event.stopPropagation();\n        that.getController(\"headerFilter\").showHeaderFilterMenu(column.index, false);\n      }));\n    }\n  },\n  _updateIndicator: function ($cell, column, indicatorName) {\n    var $indicator = this.callBase($cell, column, indicatorName);\n    $indicator && this._subscribeToIndicatorEvent($indicator, column, indicatorName);\n  },\n  _updateHeaderFilterIndicators: function () {\n    if (this.option(\"headerFilter.visible\")) {\n      this._updateIndicators(\"headerFilter\");\n    }\n  },\n  _needUpdateFilterIndicators: function () {\n    return true;\n  },\n  _columnOptionChanged: function (e) {\n    var optionNames = e.optionNames;\n\n    if (gridCoreUtils.checkChanges(optionNames, [\"filterValues\", \"filterType\"])) {\n      if (this._needUpdateFilterIndicators()) {\n        this._updateHeaderFilterIndicators();\n      }\n\n      return;\n    }\n\n    this.callBase(e);\n  }\n});\nvar HeaderPanelHeaderFilterExtender = extend({}, headerFilterMixin, {\n  _createGroupPanelItem: function ($rootElement, groupColumn) {\n    var that = this;\n    var $item = that.callBase.apply(that, arguments);\n    var $headerFilterIndicator;\n\n    if (!groupColumn.command && allowHeaderFiltering(groupColumn) && that.option(\"headerFilter.visible\")) {\n      $headerFilterIndicator = that._applyColumnState({\n        name: \"headerFilter\",\n        rootElement: $item,\n        column: {\n          alignment: getDefaultAlignment(that.option(\"rtlEnabled\")),\n          filterValues: groupColumn.filterValues,\n          allowHeaderFiltering: true\n        },\n        showColumnLines: true\n      });\n      $headerFilterIndicator && eventsEngine.on($headerFilterIndicator, clickEventName, that.createAction(function (e) {\n        var event = e.event;\n        event.stopPropagation();\n        that.getController(\"headerFilter\").showHeaderFilterMenu(groupColumn.index, true);\n      }));\n    }\n\n    return $item;\n  }\n});\nexport function invertFilterExpression(filter) {\n  return [\"!\", filter];\n}\nvar DataControllerFilterRowExtender = {\n  skipCalculateColumnFilters: function () {\n    return false;\n  },\n  _calculateAdditionalFilter: function () {\n    if (this.skipCalculateColumnFilters()) {\n      return this.callBase();\n    }\n\n    var filters = [this.callBase()];\n\n    var columns = this._columnsController.getVisibleColumns(null, true);\n\n    var headerFilterController = this.getController(\"headerFilter\");\n    var currentColumn = headerFilterController.getCurrentColumn();\n    each(columns, function (_, column) {\n      var filter;\n\n      if (currentColumn && currentColumn.index === column.index) {\n        return;\n      }\n\n      if (allowHeaderFiltering(column) && column.calculateFilterExpression && Array.isArray(column.filterValues) && column.filterValues.length) {\n        var filterValues = [];\n        each(column.filterValues, function (_, filterValue) {\n          if (Array.isArray(filterValue)) {\n            filter = filterValue;\n          } else {\n            if (column.deserializeValue && !gridCoreUtils.isDateType(column.dataType) && \"number\" !== column.dataType) {\n              filterValue = column.deserializeValue(filterValue);\n            }\n\n            filter = column.createFilterExpression(filterValue, \"=\", \"headerFilter\");\n          }\n\n          if (filter) {\n            filter.columnIndex = column.index;\n          }\n\n          filterValues.push(filter);\n        });\n        filterValues = gridCoreUtils.combineFilters(filterValues, \"or\");\n        filters.push(\"exclude\" === column.filterType ? [\"!\", filterValues] : filterValues);\n      }\n    });\n    return gridCoreUtils.combineFilters(filters);\n  }\n};\nexport var headerFilterModule = {\n  defaultOptions: function () {\n    return {\n      syncLookupFilterValues: true,\n      headerFilter: {\n        visible: false,\n        width: 252,\n        height: 325,\n        allowSearch: false,\n        searchTimeout: 500,\n        texts: {\n          emptyValue: messageLocalization.format(\"dxDataGrid-headerFilterEmptyValue\"),\n          ok: messageLocalization.format(\"dxDataGrid-headerFilterOK\"),\n          cancel: messageLocalization.format(\"dxDataGrid-headerFilterCancel\")\n        }\n      }\n    };\n  },\n  controllers: {\n    headerFilter: HeaderFilterController\n  },\n  views: {\n    headerFilterView: HeaderFilterView\n  },\n  extenders: {\n    controllers: {\n      data: DataControllerFilterRowExtender\n    },\n    views: {\n      columnHeadersView: ColumnHeadersViewHeaderFilterExtender,\n      headerPanel: HeaderPanelHeaderFilterExtender\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.header_filter.js"],"names":["_extends","eventsEngine","modules","filterUtils","gridCoreUtils","headerFilterMixin","HeaderFilterView","updateHeaderFilterItemSelectionState","allowHeaderFiltering","messageLocalization","name","clickEventName","compileGetter","each","isDefined","isObject","isFunction","getDefaultAlignment","extend","normalizeDataSourceOptions","dateLocalization","Deferred","restoreFocus","dataQuery","storeHelper","DATE_INTERVAL_FORMATS","month","value","getMonthNames","quarter","format","Date","ungroupUTCDates","items","dateParts","dates","forEach","item","key","isMonthPart","length","push","date","UTC","apply","pop","convertDataFromUTCToLocal","data","column","query","group","getHeaderFilterGroupParameters","calculateCellValue","queryByOptions","toArray","isUTCFormat","slice","HeaderFilterController","ViewController","inherit","init","_columnsController","getController","_dataController","_headerFilterView","getView","_updateSelectedState","i","isExclude","filterType","getIndexByKey","filterValues","_normalizeGroupItem","currentLevel","options","displayValue","path","valueSelector","displaySelector","join","text","getHeaderItemText","headerFilterOptions","formatValue","groupInterval","getGroupInterval","result","getFormatOptionsByColumn","isDateType","dataType","getDisplayFormat","formatOptions","target","firstValueText","secondValue","secondValueText","texts","emptyValue","_processGroupItems","groupItems","lookup","level","displayExpr","valueExpr","getDataSource","_column$headerFilter","dataSource","remoteGrouping","remoteOperations","grouping","headerFilterDataSource","headerFilter","option","isLookup","component","_currentColumn","filter","getCombinedFilter","getWrappedLookupDataSource","normalizeLookupDataSource","cutoffLevel","Array","isArray","_filter","useDefaultSearch","load","d","dataField","done","convertUTCDates","serializationFormat","that","resolve","fail","reject","call","origPostProcess","postProcess","pageIndex","searchValue","unshift","getCurrentColumn","showHeaderFilterMenu","columnIndex","isGroupPanel","columnsController","getColumns","visibleIndex","getVisibleIndex","view","$columnElement","getColumnElements","eq","groupIndex","showHeaderFilterMenuBase","columnElement","applyFilter","columnOption","remoteFiltering","filtering","type","onShowing","e","dxResizableInstance","$overlayContent","dxResizable","headerFilterByColumn","width","height","onHidden","isFilterBuilder","alignment","hideHeaderFilterMenu","ColumnHeadersViewHeaderFilterExtender","_renderCellContent","$cell","$headerFilterIndicator","command","rowType","_applyColumnState","rootElement","showColumnLines","_subscribeToIndicatorEvent","callBase","arguments","$indicator","indicatorName","on","createAction","event","stopPropagation","index","_updateIndicator","_updateHeaderFilterIndicators","_updateIndicators","_needUpdateFilterIndicators","_columnOptionChanged","optionNames","checkChanges","HeaderPanelHeaderFilterExtender","_createGroupPanelItem","$rootElement","groupColumn","$item","invertFilterExpression","DataControllerFilterRowExtender","skipCalculateColumnFilters","_calculateAdditionalFilter","filters","columns","getVisibleColumns","headerFilterController","currentColumn","_","calculateFilterExpression","filterValue","deserializeValue","createFilterExpression","combineFilters","headerFilterModule","defaultOptions","syncLookupFilterValues","visible","allowSearch","searchTimeout","ok","cancel","controllers","views","headerFilterView","extenders","columnHeadersView","headerPanel"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.header_filter.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport _extends from \"@babel/runtime/helpers/esm/extends\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport modules from \"./ui.grid_core.modules\";\r\nimport filterUtils from \"../shared/filtering\";\r\nimport gridCoreUtils from \"./ui.grid_core.utils\";\r\nimport {\r\n    headerFilterMixin,\r\n    HeaderFilterView,\r\n    updateHeaderFilterItemSelectionState,\r\n    allowHeaderFiltering\r\n} from \"./ui.grid_core.header_filter_core\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    name as clickEventName\r\n} from \"../../events/click\";\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport {\r\n    each\r\n} from \"../../core/utils/iterator\";\r\nimport {\r\n    isDefined,\r\n    isObject,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    getDefaultAlignment\r\n} from \"../../core/utils/position\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    normalizeDataSourceOptions\r\n} from \"../../data/data_source/utils\";\r\nimport dateLocalization from \"../../localization/date\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    restoreFocus\r\n} from \"../shared/accessibility\";\r\nimport dataQuery from \"../../data/query\";\r\nimport storeHelper from \"../../data/store_helper\";\r\nvar DATE_INTERVAL_FORMATS = {\r\n    month: function(value) {\r\n        return dateLocalization.getMonthNames()[value - 1]\r\n    },\r\n    quarter: function(value) {\r\n        return dateLocalization.format(new Date(2e3, 3 * value - 1), \"quarter\")\r\n    }\r\n};\r\n\r\nfunction ungroupUTCDates(items, dateParts, dates) {\r\n    dateParts = dateParts || [];\r\n    dates = dates || [];\r\n    items.forEach(item => {\r\n        if (isDefined(item.key)) {\r\n            var isMonthPart = 1 === dateParts.length;\r\n            dateParts.push(isMonthPart ? item.key - 1 : item.key);\r\n            if (item.items) {\r\n                ungroupUTCDates(item.items, dateParts, dates)\r\n            } else {\r\n                var date = new Date(Date.UTC.apply(Date, dateParts));\r\n                dates.push(date)\r\n            }\r\n            dateParts.pop()\r\n        } else {\r\n            dates.push(null)\r\n        }\r\n    });\r\n    return dates\r\n}\r\n\r\nfunction convertDataFromUTCToLocal(data, column) {\r\n    var dates = ungroupUTCDates(data);\r\n    var query = dataQuery(dates);\r\n    var group = gridCoreUtils.getHeaderFilterGroupParameters(_extends({}, column, {\r\n        calculateCellValue: date => date\r\n    }));\r\n    return storeHelper.queryByOptions(query, {\r\n        group: group\r\n    }).toArray()\r\n}\r\n\r\nfunction isUTCFormat(format) {\r\n    return \"Z\" === (null === format || void 0 === format ? void 0 : format.slice(-1)) || \"'Z'\" === (null === format || void 0 === format ? void 0 : format.slice(-3))\r\n}\r\nvar HeaderFilterController = modules.ViewController.inherit({\r\n    init: function() {\r\n        this._columnsController = this.getController(\"columns\");\r\n        this._dataController = this.getController(\"data\");\r\n        this._headerFilterView = this.getView(\"headerFilterView\")\r\n    },\r\n    _updateSelectedState: function(items, column) {\r\n        var i = items.length;\r\n        var isExclude = \"exclude\" === column.filterType;\r\n        while (i--) {\r\n            var item = items[i];\r\n            if (\"items\" in items[i]) {\r\n                this._updateSelectedState(items[i].items, column)\r\n            }\r\n            updateHeaderFilterItemSelectionState(item, gridCoreUtils.getIndexByKey(items[i].value, column.filterValues, null) > -1, isExclude)\r\n        }\r\n    },\r\n    _normalizeGroupItem: function(item, currentLevel, options) {\r\n        var value;\r\n        var displayValue;\r\n        var path = options.path;\r\n        var valueSelector = options.valueSelector;\r\n        var displaySelector = options.displaySelector;\r\n        var column = options.column;\r\n        if (valueSelector && displaySelector) {\r\n            value = valueSelector(item);\r\n            displayValue = displaySelector(item)\r\n        } else {\r\n            value = item.key;\r\n            displayValue = value\r\n        }\r\n        if (!isObject(item)) {\r\n            item = {}\r\n        } else {\r\n            item = extend({}, item)\r\n        }\r\n        path.push(value);\r\n        if (1 === path.length) {\r\n            item.value = path[0]\r\n        } else {\r\n            item.value = path.join(\"/\")\r\n        }\r\n        item.text = this.getHeaderItemText(displayValue, column, currentLevel, options.headerFilterOptions);\r\n        return item\r\n    },\r\n    getHeaderItemText: function(displayValue, column, currentLevel, headerFilterOptions) {\r\n        var text = gridCoreUtils.formatValue(displayValue, function(value, column, currentLevel) {\r\n            var groupInterval = filterUtils.getGroupInterval(column);\r\n            var result = gridCoreUtils.getFormatOptionsByColumn(column, \"headerFilter\");\r\n            if (groupInterval) {\r\n                result.groupInterval = groupInterval[currentLevel];\r\n                if (gridCoreUtils.isDateType(column.dataType)) {\r\n                    result.format = DATE_INTERVAL_FORMATS[groupInterval[currentLevel]]\r\n                } else if (\"number\" === column.dataType) {\r\n                    result.getDisplayFormat = function() {\r\n                        var formatOptions = {\r\n                            format: column.format,\r\n                            target: \"headerFilter\"\r\n                        };\r\n                        var firstValueText = gridCoreUtils.formatValue(value, formatOptions);\r\n                        var secondValue = value + groupInterval[currentLevel];\r\n                        var secondValueText = gridCoreUtils.formatValue(secondValue, formatOptions);\r\n                        return firstValueText && secondValueText ? firstValueText + \" - \" + secondValueText : \"\"\r\n                    }\r\n                }\r\n            }\r\n            return result\r\n        }(displayValue, column, currentLevel));\r\n        if (!text) {\r\n            text = headerFilterOptions.texts.emptyValue\r\n        }\r\n        return text\r\n    },\r\n    _processGroupItems: function(groupItems, currentLevel, path, options) {\r\n        var displaySelector;\r\n        var valueSelector;\r\n        var column = options.column;\r\n        var lookup = column.lookup;\r\n        var level = options.level;\r\n        path = path || [];\r\n        currentLevel = currentLevel || 0;\r\n        if (lookup) {\r\n            displaySelector = compileGetter(lookup.displayExpr);\r\n            valueSelector = compileGetter(lookup.valueExpr)\r\n        }\r\n        for (var i = 0; i < groupItems.length; i++) {\r\n            groupItems[i] = this._normalizeGroupItem(groupItems[i], currentLevel, {\r\n                column: options.column,\r\n                headerFilterOptions: options.headerFilterOptions,\r\n                displaySelector: displaySelector,\r\n                valueSelector: valueSelector,\r\n                path: path\r\n            });\r\n            if (\"items\" in groupItems[i]) {\r\n                if (currentLevel === level || !isDefined(groupItems[i].value)) {\r\n                    delete groupItems[i].items\r\n                } else {\r\n                    this._processGroupItems(groupItems[i].items, currentLevel + 1, path, options)\r\n                }\r\n            }\r\n            path.pop()\r\n        }\r\n    },\r\n    getDataSource: function(column) {\r\n        var _column$headerFilter;\r\n        var dataSource = this._dataController.dataSource();\r\n        var remoteGrouping = null === dataSource || void 0 === dataSource ? void 0 : dataSource.remoteOperations().grouping;\r\n        var group = gridCoreUtils.getHeaderFilterGroupParameters(column, remoteGrouping);\r\n        var headerFilterDataSource = null === (_column$headerFilter = column.headerFilter) || void 0 === _column$headerFilter ? void 0 : _column$headerFilter.dataSource;\r\n        var headerFilterOptions = this.option(\"headerFilter\");\r\n        var isLookup = false;\r\n        var options = {\r\n            component: this.component\r\n        };\r\n        if (!dataSource) {\r\n            return\r\n        }\r\n        if (isDefined(headerFilterDataSource) && !isFunction(headerFilterDataSource)) {\r\n            options.dataSource = normalizeDataSourceOptions(headerFilterDataSource)\r\n        } else if (column.lookup) {\r\n            isLookup = true;\r\n            if (this.option(\"syncLookupFilterValues\")) {\r\n                this._currentColumn = column;\r\n                var filter = this._dataController.getCombinedFilter();\r\n                this._currentColumn = null;\r\n                options.dataSource = gridCoreUtils.getWrappedLookupDataSource(column, dataSource, filter)\r\n            } else {\r\n                options.dataSource = gridCoreUtils.normalizeLookupDataSource(column.lookup)\r\n            }\r\n        } else {\r\n            var cutoffLevel = Array.isArray(group) ? group.length - 1 : 0;\r\n            this._currentColumn = column;\r\n            var _filter = this._dataController.getCombinedFilter();\r\n            this._currentColumn = null;\r\n            options.dataSource = {\r\n                filter: _filter,\r\n                group: group,\r\n                useDefaultSearch: true,\r\n                load: options => {\r\n                    var d = new Deferred;\r\n                    options.dataField = column.dataField || column.name;\r\n                    dataSource.load(options).done((function(data) {\r\n                        var convertUTCDates = remoteGrouping && isUTCFormat(column.serializationFormat) && cutoffLevel > 3;\r\n                        if (convertUTCDates) {\r\n                            data = convertDataFromUTCToLocal(data, column)\r\n                        }\r\n                        that._processGroupItems(data, null, null, {\r\n                            level: cutoffLevel,\r\n                            column: column,\r\n                            headerFilterOptions: headerFilterOptions\r\n                        });\r\n                        d.resolve(data)\r\n                    })).fail(d.reject);\r\n                    return d\r\n                }\r\n            }\r\n        }\r\n        if (isFunction(headerFilterDataSource)) {\r\n            headerFilterDataSource.call(column, options)\r\n        }\r\n        var origPostProcess = options.dataSource.postProcess;\r\n        var that = this;\r\n        options.dataSource.postProcess = function(data) {\r\n            var items = data;\r\n            if (isLookup) {\r\n                if (0 === this.pageIndex() && !this.searchValue()) {\r\n                    items = items.slice(0);\r\n                    items.unshift(null)\r\n                }\r\n                that._processGroupItems(items, null, null, {\r\n                    level: 0,\r\n                    column: column,\r\n                    headerFilterOptions: headerFilterOptions\r\n                })\r\n            }\r\n            items = origPostProcess && origPostProcess.call(this, items) || items;\r\n            that._updateSelectedState(items, column);\r\n            return items\r\n        };\r\n        return options.dataSource\r\n    },\r\n    getCurrentColumn: function() {\r\n        return this._currentColumn\r\n    },\r\n    showHeaderFilterMenu: function(columnIndex, isGroupPanel) {\r\n        var columnsController = this._columnsController;\r\n        var column = extend(true, {}, this._columnsController.getColumns()[columnIndex]);\r\n        if (column) {\r\n            var visibleIndex = columnsController.getVisibleIndex(columnIndex);\r\n            var view = isGroupPanel ? this.getView(\"headerPanel\") : this.getView(\"columnHeadersView\");\r\n            var $columnElement = $columnElement || view.getColumnElements().eq(isGroupPanel ? column.groupIndex : visibleIndex);\r\n            this.showHeaderFilterMenuBase({\r\n                columnElement: $columnElement,\r\n                column: column,\r\n                applyFilter: true,\r\n                apply: function() {\r\n                    columnsController.columnOption(columnIndex, {\r\n                        filterValues: this.filterValues,\r\n                        filterType: this.filterType\r\n                    })\r\n                }\r\n            })\r\n        }\r\n    },\r\n    showHeaderFilterMenuBase: function(options) {\r\n        var that = this;\r\n        var column = options.column;\r\n        if (column) {\r\n            var groupInterval = filterUtils.getGroupInterval(column);\r\n            var dataSource = that._dataController.dataSource();\r\n            var remoteFiltering = dataSource && dataSource.remoteOperations().filtering;\r\n            extend(options, column, {\r\n                type: groupInterval && groupInterval.length > 1 ? \"tree\" : \"list\",\r\n                remoteFiltering: remoteFiltering,\r\n                onShowing: function(e) {\r\n                    var dxResizableInstance = e.component.$overlayContent().dxResizable(\"instance\");\r\n                    dxResizableInstance && dxResizableInstance.option(\"onResizeEnd\", (function(e) {\r\n                        var columnsController = that.getController(\"columns\");\r\n                        var headerFilterByColumn = columnsController.columnOption(options.dataField, \"headerFilter\");\r\n                        headerFilterByColumn = headerFilterByColumn || {};\r\n                        headerFilterByColumn.width = e.width;\r\n                        headerFilterByColumn.height = e.height;\r\n                        columnsController.columnOption(options.dataField, \"headerFilter\", headerFilterByColumn, true)\r\n                    }))\r\n                },\r\n                onHidden: () => restoreFocus(this)\r\n            });\r\n            options.dataSource = that.getDataSource(options);\r\n            if (options.isFilterBuilder) {\r\n                options.dataSource.filter = null;\r\n                options.alignment = \"right\"\r\n            }\r\n            that._headerFilterView.showHeaderFilterMenu(options.columnElement, options)\r\n        }\r\n    },\r\n    hideHeaderFilterMenu: function() {\r\n        this._headerFilterView.hideHeaderFilterMenu()\r\n    }\r\n});\r\nvar ColumnHeadersViewHeaderFilterExtender = extend({}, headerFilterMixin, {\r\n    _renderCellContent: function($cell, options) {\r\n        var that = this;\r\n        var $headerFilterIndicator;\r\n        var column = options.column;\r\n        if (!column.command && allowHeaderFiltering(column) && that.option(\"headerFilter.visible\") && \"header\" === options.rowType) {\r\n            $headerFilterIndicator = that._applyColumnState({\r\n                name: \"headerFilter\",\r\n                rootElement: $cell,\r\n                column: column,\r\n                showColumnLines: that.option(\"showColumnLines\")\r\n            });\r\n            $headerFilterIndicator && that._subscribeToIndicatorEvent($headerFilterIndicator, column, \"headerFilter\")\r\n        }\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _subscribeToIndicatorEvent: function($indicator, column, indicatorName) {\r\n        var that = this;\r\n        if (\"headerFilter\" === indicatorName) {\r\n            eventsEngine.on($indicator, clickEventName, that.createAction((function(e) {\r\n                e.event.stopPropagation();\r\n                that.getController(\"headerFilter\").showHeaderFilterMenu(column.index, false)\r\n            })))\r\n        }\r\n    },\r\n    _updateIndicator: function($cell, column, indicatorName) {\r\n        var $indicator = this.callBase($cell, column, indicatorName);\r\n        $indicator && this._subscribeToIndicatorEvent($indicator, column, indicatorName)\r\n    },\r\n    _updateHeaderFilterIndicators: function() {\r\n        if (this.option(\"headerFilter.visible\")) {\r\n            this._updateIndicators(\"headerFilter\")\r\n        }\r\n    },\r\n    _needUpdateFilterIndicators: function() {\r\n        return true\r\n    },\r\n    _columnOptionChanged: function(e) {\r\n        var optionNames = e.optionNames;\r\n        if (gridCoreUtils.checkChanges(optionNames, [\"filterValues\", \"filterType\"])) {\r\n            if (this._needUpdateFilterIndicators()) {\r\n                this._updateHeaderFilterIndicators()\r\n            }\r\n            return\r\n        }\r\n        this.callBase(e)\r\n    }\r\n});\r\nvar HeaderPanelHeaderFilterExtender = extend({}, headerFilterMixin, {\r\n    _createGroupPanelItem: function($rootElement, groupColumn) {\r\n        var that = this;\r\n        var $item = that.callBase.apply(that, arguments);\r\n        var $headerFilterIndicator;\r\n        if (!groupColumn.command && allowHeaderFiltering(groupColumn) && that.option(\"headerFilter.visible\")) {\r\n            $headerFilterIndicator = that._applyColumnState({\r\n                name: \"headerFilter\",\r\n                rootElement: $item,\r\n                column: {\r\n                    alignment: getDefaultAlignment(that.option(\"rtlEnabled\")),\r\n                    filterValues: groupColumn.filterValues,\r\n                    allowHeaderFiltering: true\r\n                },\r\n                showColumnLines: true\r\n            });\r\n            $headerFilterIndicator && eventsEngine.on($headerFilterIndicator, clickEventName, that.createAction((function(e) {\r\n                var event = e.event;\r\n                event.stopPropagation();\r\n                that.getController(\"headerFilter\").showHeaderFilterMenu(groupColumn.index, true)\r\n            })))\r\n        }\r\n        return $item\r\n    }\r\n});\r\nexport function invertFilterExpression(filter) {\r\n    return [\"!\", filter]\r\n}\r\nvar DataControllerFilterRowExtender = {\r\n    skipCalculateColumnFilters: function() {\r\n        return false\r\n    },\r\n    _calculateAdditionalFilter: function() {\r\n        if (this.skipCalculateColumnFilters()) {\r\n            return this.callBase()\r\n        }\r\n        var filters = [this.callBase()];\r\n        var columns = this._columnsController.getVisibleColumns(null, true);\r\n        var headerFilterController = this.getController(\"headerFilter\");\r\n        var currentColumn = headerFilterController.getCurrentColumn();\r\n        each(columns, (function(_, column) {\r\n            var filter;\r\n            if (currentColumn && currentColumn.index === column.index) {\r\n                return\r\n            }\r\n            if (allowHeaderFiltering(column) && column.calculateFilterExpression && Array.isArray(column.filterValues) && column.filterValues.length) {\r\n                var filterValues = [];\r\n                each(column.filterValues, (function(_, filterValue) {\r\n                    if (Array.isArray(filterValue)) {\r\n                        filter = filterValue\r\n                    } else {\r\n                        if (column.deserializeValue && !gridCoreUtils.isDateType(column.dataType) && \"number\" !== column.dataType) {\r\n                            filterValue = column.deserializeValue(filterValue)\r\n                        }\r\n                        filter = column.createFilterExpression(filterValue, \"=\", \"headerFilter\")\r\n                    }\r\n                    if (filter) {\r\n                        filter.columnIndex = column.index\r\n                    }\r\n                    filterValues.push(filter)\r\n                }));\r\n                filterValues = gridCoreUtils.combineFilters(filterValues, \"or\");\r\n                filters.push(\"exclude\" === column.filterType ? [\"!\", filterValues] : filterValues)\r\n            }\r\n        }));\r\n        return gridCoreUtils.combineFilters(filters)\r\n    }\r\n};\r\nexport var headerFilterModule = {\r\n    defaultOptions: function() {\r\n        return {\r\n            syncLookupFilterValues: true,\r\n            headerFilter: {\r\n                visible: false,\r\n                width: 252,\r\n                height: 325,\r\n                allowSearch: false,\r\n                searchTimeout: 500,\r\n                texts: {\r\n                    emptyValue: messageLocalization.format(\"dxDataGrid-headerFilterEmptyValue\"),\r\n                    ok: messageLocalization.format(\"dxDataGrid-headerFilterOK\"),\r\n                    cancel: messageLocalization.format(\"dxDataGrid-headerFilterCancel\")\r\n                }\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        headerFilter: HeaderFilterController\r\n    },\r\n    views: {\r\n        headerFilterView: HeaderFilterView\r\n    },\r\n    extenders: {\r\n        controllers: {\r\n            data: DataControllerFilterRowExtender\r\n        },\r\n        views: {\r\n            columnHeadersView: ColumnHeadersViewHeaderFilterExtender,\r\n            headerPanel: HeaderPanelHeaderFilterExtender\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}