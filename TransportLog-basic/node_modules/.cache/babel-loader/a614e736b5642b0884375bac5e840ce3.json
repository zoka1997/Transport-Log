{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editing_cell_based.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport domAdapter from \"../../core/dom_adapter\";\nimport { getWindow } from \"../../core/utils/window\";\nimport eventsEngine from \"../../events/core/events_engine\";\nimport { isDefined, isString } from \"../../core/utils/type\";\nimport { name as clickEventName } from \"../../events/click\";\nimport pointerEvents from \"../../events/pointer\";\nimport { addNamespace } from \"../../events/utils/index\";\nimport holdEvent from \"../../events/hold\";\nimport { when, Deferred } from \"../../core/utils/deferred\";\nimport { deferRender } from \"../../core/utils/common\";\nimport { createObjectWithChanges } from \"../../data/array_utils\";\nimport { EDIT_MODE_BATCH, EDIT_MODE_CELL, TARGET_COMPONENT_NAME } from \"./ui.grid_core.editing_constants\";\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\nvar ROW_CLASS = \"dx-row\";\nvar CELL_MODIFIED_CLASS = \"dx-cell-modified\";\nvar DATA_ROW_CLASS = \"dx-data-row\";\nvar ROW_REMOVED = \"dx-row-removed\";\nvar EDITING_EDITROWKEY_OPTION_NAME = \"editing.editRowKey\";\nvar EDITING_EDITCOLUMNNAME_OPTION_NAME = \"editing.editColumnName\";\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\nexport default {\n  extenders: {\n    controllers: {\n      editing: {\n        init: function () {\n          var needCreateHandlers = !this._saveEditorHandler;\n          this.callBase.apply(this, arguments);\n\n          if (needCreateHandlers) {\n            var $pointerDownTarget;\n            var isResizing;\n\n            this._pointerUpEditorHandler = () => {\n              var _this$getController;\n\n              isResizing = null === (_this$getController = this.getController(\"columnsResizer\")) || void 0 === _this$getController ? void 0 : _this$getController.isResizing();\n            };\n\n            this._pointerDownEditorHandler = e => $pointerDownTarget = $(e.target);\n\n            this._saveEditorHandler = this.createAction(function (e) {\n              var event = e.event;\n              var $target = $(event.target);\n              var targetComponent = event[TARGET_COMPONENT_NAME];\n              var component = this.component;\n\n              if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\n                return;\n              }\n\n              function checkEditorPopup($element) {\n                if (!$element) {\n                  return false;\n                }\n\n                var $dropDownEditorOverlay = $element.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS));\n                var $componentElement = component.$element();\n                return $dropDownEditorOverlay.length > 0 && 0 === $componentElement.closest($dropDownEditorOverlay).length;\n              }\n\n              if (this.isCellOrBatchEditMode() && !this._editCellInProgress) {\n                var isEditorPopup = checkEditorPopup($target) || checkEditorPopup(null === targetComponent || void 0 === targetComponent ? void 0 : targetComponent.$element());\n                var isDomElement = !!$target.closest(getWindow().document).length;\n                var isAnotherComponent = targetComponent && !targetComponent._disposed && targetComponent !== this.component;\n                var isAddRowButton = !!$target.closest(\".\".concat(this.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\n                var isFocusOverlay = $target.hasClass(this.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\n                var isCellEditMode = this.isCellEditMode();\n\n                if (!isResizing && !isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && this.isEditing()) && (isDomElement || isAnotherComponent)) {\n                  this._closeEditItem.bind(this)($target);\n                }\n              }\n            });\n            eventsEngine.on(domAdapter.getDocument(), pointerEvents.up, this._pointerUpEditorHandler);\n            eventsEngine.on(domAdapter.getDocument(), pointerEvents.down, this._pointerDownEditorHandler);\n            eventsEngine.on(domAdapter.getDocument(), clickEventName, this._saveEditorHandler);\n          }\n        },\n        isCellEditMode: function () {\n          return this.option(\"editing.mode\") === EDIT_MODE_CELL;\n        },\n        isBatchEditMode: function () {\n          return this.option(\"editing.mode\") === EDIT_MODE_BATCH;\n        },\n        isCellOrBatchEditMode: function () {\n          return this.isCellEditMode() || this.isBatchEditMode();\n        },\n        _needToCloseEditableCell: function ($targetElement) {\n          var $element = this.component.$element();\n          var result = this.isEditing();\n          var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\n\n          if (isCurrentComponentElement) {\n            var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\n\n            if (isDataRow) {\n              var rowsView = this.getView(\"rowsView\");\n              var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\n              var rowIndex = rowsView.getRowIndex($targetCell.parent());\n              var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\n\n              var visibleColumns = this._columnsController.getVisibleColumns();\n\n              var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\n              result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex);\n            }\n          }\n\n          return result || this.callBase.apply(this, arguments);\n        },\n        _closeEditItem: function ($targetElement) {\n          if (this._needToCloseEditableCell($targetElement)) {\n            this.closeEditCell();\n          }\n        },\n        _focusEditorIfNeed: function () {\n          if (this._needFocusEditor && this.isCellOrBatchEditMode()) {\n            var _this$_rowsView;\n\n            var editColumnIndex = this._getVisibleEditColumnIndex();\n\n            var $cell = null === (_this$_rowsView = this._rowsView) || void 0 === _this$_rowsView ? void 0 : _this$_rowsView._getCellElement(this._getVisibleEditRowIndex(), editColumnIndex);\n\n            if ($cell && !$cell.find(\":focus\").length) {\n              this._focusEditingCell(() => {\n                this._editCellInProgress = false;\n              }, $cell, true);\n            } else {\n              this._editCellInProgress = false;\n            }\n\n            this._needFocusEditor = false;\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        isEditing: function () {\n          if (this.isCellOrBatchEditMode()) {\n            var isEditRowKeyDefined = isDefined(this.option(EDITING_EDITROWKEY_OPTION_NAME));\n            var isEditColumnNameDefined = isDefined(this.option(EDITING_EDITCOLUMNNAME_OPTION_NAME));\n            return isEditRowKeyDefined && isEditColumnNameDefined;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _handleEditColumnNameChange: function (args) {\n          var oldRowIndex = this._getVisibleEditRowIndex(args.previousValue);\n\n          if (this.isCellOrBatchEditMode() && -1 !== oldRowIndex && isDefined(args.value) && args.value !== args.previousValue) {\n            var columnIndex = this._columnsController.getVisibleColumnIndex(args.value);\n\n            var oldColumnIndex = this._columnsController.getVisibleColumnIndex(args.previousValue);\n\n            this._editCellFromOptionChanged(columnIndex, oldColumnIndex, oldRowIndex);\n          }\n        },\n        _addRow: function (parentKey, deferred) {\n          if (this.isCellEditMode() && this.hasChanges()) {\n            var _deferred = new Deferred();\n\n            this.saveEditData().done(() => {\n              if (!this.hasChanges()) {\n                this.addRow(parentKey).done(_deferred.resolve).fail(_deferred.reject);\n              } else {\n                _deferred.reject(\"cancel\");\n              }\n            });\n            return _deferred.promise();\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        editCell: function (rowIndex, columnIndex) {\n          return this._editCell({\n            rowIndex: rowIndex,\n            columnIndex: columnIndex\n          });\n        },\n        _editCell: function (options) {\n          var d = new Deferred();\n          var coreResult;\n          this.executeOperation(d, () => {\n            coreResult = this._editCellCore(options);\n            when(coreResult).done(d.resolve).fail(d.reject);\n          });\n          return void 0 !== coreResult ? coreResult : d.promise();\n        },\n        _editCellCore: function (options) {\n          var dataController = this._dataController;\n          var isEditByOptionChanged = isDefined(options.oldColumnIndex) || isDefined(options.oldRowIndex);\n\n          var {\n            columnIndex: columnIndex,\n            rowIndex: rowIndex,\n            column: column,\n            item: item\n          } = this._getNormalizedEditCellOptions(options);\n\n          var params = {\n            data: null === item || void 0 === item ? void 0 : item.data,\n            cancel: false,\n            column: column\n          };\n\n          if (void 0 === item.key) {\n            this._dataController.fireError(\"E1043\");\n\n            return;\n          }\n\n          if (column && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && this.isCellOrBatchEditMode()) {\n            if (!isEditByOptionChanged && this.isEditCell(rowIndex, columnIndex)) {\n              return true;\n            }\n\n            var editRowIndex = rowIndex + dataController.getRowIndexOffset();\n            return when(this._beforeEditCell(rowIndex, columnIndex, item)).done(cancel => {\n              if (cancel) {\n                return;\n              }\n\n              if (!this._prepareEditCell(params, item, columnIndex, editRowIndex)) {\n                this._processCanceledEditingCell();\n              }\n            });\n          }\n\n          return false;\n        },\n        _beforeEditCell: function (rowIndex, columnIndex, item) {\n          if (this.isCellEditMode() && !item.isNewRow && this.hasChanges()) {\n            var d = new Deferred();\n            this.saveEditData().always(() => {\n              d.resolve(this.hasChanges());\n            });\n            return d;\n          }\n        },\n        publicMethods: function () {\n          var publicMethods = this.callBase.apply(this, arguments);\n          return publicMethods.concat([\"editCell\", \"closeEditCell\"]);\n        },\n        _getNormalizedEditCellOptions: function (_ref) {\n          var {\n            oldColumnIndex: oldColumnIndex,\n            oldRowIndex: oldRowIndex,\n            columnIndex: columnIndex,\n            rowIndex: rowIndex\n          } = _ref;\n          var columnsController = this._columnsController;\n          var visibleColumns = columnsController.getVisibleColumns();\n\n          var items = this._dataController.items();\n\n          var item = items[rowIndex];\n          var oldColumn;\n\n          if (isDefined(oldColumnIndex)) {\n            oldColumn = visibleColumns[oldColumnIndex];\n          } else {\n            oldColumn = this._getEditColumn();\n          }\n\n          if (!isDefined(oldRowIndex)) {\n            oldRowIndex = this._getVisibleEditRowIndex();\n          }\n\n          if (isString(columnIndex)) {\n            columnIndex = columnsController.columnOption(columnIndex, \"index\");\n            columnIndex = columnsController.getVisibleIndex(columnIndex);\n          }\n\n          var column = visibleColumns[columnIndex];\n          return {\n            oldColumn: oldColumn,\n            columnIndex: columnIndex,\n            oldRowIndex: oldRowIndex,\n            rowIndex: rowIndex,\n            column: column,\n            item: item\n          };\n        },\n        _prepareEditCell: function (params, item, editColumnIndex, editRowIndex) {\n          if (!item.isNewRow) {\n            params.key = item.key;\n          }\n\n          if (this._isEditingStart(params)) {\n            return false;\n          }\n\n          this._pageIndex = this._dataController.pageIndex();\n\n          this._setEditRowKey(item.key);\n\n          this._setEditColumnNameByIndex(editColumnIndex);\n\n          if (!params.column.showEditorAlways) {\n            var _item$oldData;\n\n            this._addInternalData({\n              key: item.key,\n              oldData: null !== (_item$oldData = item.oldData) && void 0 !== _item$oldData ? _item$oldData : item.data\n            });\n          }\n\n          return true;\n        },\n        closeEditCell: function (isError, withoutSaveEditData) {\n          var result = when();\n\n          var oldEditRowIndex = this._getVisibleEditRowIndex();\n\n          if (this.isCellOrBatchEditMode()) {\n            var deferred = new Deferred();\n            result = new Deferred();\n            this.executeOperation(deferred, () => {\n              this._closeEditCellCore(isError, oldEditRowIndex, withoutSaveEditData).always(result.resolve);\n            });\n          }\n\n          return result.promise();\n        },\n        _closeEditCellCore: function (isError, oldEditRowIndex, withoutSaveEditData) {\n          var dataController = this._dataController;\n          var deferred = new Deferred();\n          var promise = deferred.promise();\n\n          if (this.isCellEditMode() && this.hasChanges()) {\n            if (!withoutSaveEditData) {\n              this.saveEditData().done(error => {\n                if (!this.hasChanges()) {\n                  this.closeEditCell(!!error).always(deferred.resolve);\n                  return;\n                }\n\n                deferred.resolve();\n              });\n              return promise;\n            }\n          } else {\n            this._resetEditRowKey();\n\n            this._resetEditColumnName();\n\n            if (oldEditRowIndex >= 0) {\n              var rowIndices = [oldEditRowIndex];\n\n              this._beforeCloseEditCellInBatchMode(rowIndices);\n\n              if (!isError) {\n                dataController.updateItems({\n                  changeType: \"update\",\n                  rowIndices: rowIndices\n                });\n              }\n            }\n          }\n\n          deferred.resolve();\n          return promise;\n        },\n        _resetModifiedClassCells: function (changes) {\n          if (this.isBatchEditMode()) {\n            var columnsCount = this._columnsController.getVisibleColumns().length;\n\n            changes.forEach(_ref2 => {\n              var {\n                key: key\n              } = _ref2;\n\n              var rowIndex = this._dataController.getRowIndexByKey(key);\n\n              if (-1 !== rowIndex) {\n                for (var columnIndex = 0; columnIndex < columnsCount; columnIndex++) {\n                  this._rowsView._getCellElement(rowIndex, columnIndex).removeClass(CELL_MODIFIED_CLASS);\n                }\n              }\n            });\n          }\n        },\n        _prepareChange: function (options, value, text) {\n          var $cellElement = $(options.cellElement);\n\n          if (this.isBatchEditMode() && void 0 !== options.key) {\n            this._applyModified($cellElement, options);\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _cancelSaving: function () {\n          var dataController = this._dataController;\n\n          if (this.isCellOrBatchEditMode()) {\n            if (this.isBatchEditMode()) {\n              this._resetEditIndices();\n            }\n\n            dataController.updateItems();\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        optionChanged: function (args) {\n          var fullName = args.fullName;\n\n          if (\"editing\" === args.name && fullName === EDITING_EDITCOLUMNNAME_OPTION_NAME) {\n            this._handleEditColumnNameChange(args);\n\n            args.handled = true;\n          } else {\n            this.callBase(args);\n          }\n        },\n        _editCellFromOptionChanged: function (columnIndex, oldColumnIndex, oldRowIndex) {\n          var columns = this._columnsController.getVisibleColumns();\n\n          if (columnIndex > -1) {\n            deferRender(() => {\n              this._repaintEditCell(columns[columnIndex], columns[oldColumnIndex], oldRowIndex);\n            });\n          }\n        },\n        _handleEditRowKeyChange: function (args) {\n          if (this.isCellOrBatchEditMode()) {\n            var columnIndex = this._getVisibleEditColumnIndex();\n\n            var oldRowIndexCorrection = this._getEditRowIndexCorrection();\n\n            var oldRowIndex = this._dataController.getRowIndexByKey(args.previousValue) + oldRowIndexCorrection;\n\n            if (isDefined(args.value) && args.value !== args.previousValue) {\n              var _this$_editCellFromOp;\n\n              null === (_this$_editCellFromOp = this._editCellFromOptionChanged) || void 0 === _this$_editCellFromOp ? void 0 : _this$_editCellFromOp.call(this, columnIndex, columnIndex, oldRowIndex);\n            }\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        deleteRow: function (rowIndex) {\n          if (this.isCellEditMode() && this.isEditing()) {\n            var isNewRow = this._dataController.items()[rowIndex].isNewRow;\n\n            var rowKey = this._dataController.getKeyByRowIndex(rowIndex);\n\n            this.closeEditCell(null, isNewRow).always(() => {\n              rowIndex = this._dataController.getRowIndexByKey(rowKey);\n\n              this._checkAndDeleteRow(rowIndex);\n            });\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _checkAndDeleteRow: function (rowIndex) {\n          if (this.isBatchEditMode()) {\n            this._deleteRowCore(rowIndex);\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _refreshCore: function (params) {\n          var {\n            isPageChanged: isPageChanged\n          } = null !== params && void 0 !== params ? params : {};\n          var needResetIndexes = this.isBatchEditMode() || isPageChanged && \"virtual\" !== this.option(\"scrolling.mode\");\n\n          if (this.isCellOrBatchEditMode()) {\n            if (needResetIndexes) {\n              this._resetEditColumnName();\n\n              this._resetEditRowKey();\n            }\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _allowRowAdding: function (params) {\n          if (this.isBatchEditMode()) {\n            return true;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _afterDeleteRow: function (rowIndex, oldEditRowIndex) {\n          var dataController = this._dataController;\n\n          if (this.isBatchEditMode()) {\n            dataController.updateItems({\n              changeType: \"update\",\n              rowIndices: [oldEditRowIndex, rowIndex]\n            });\n            return new Deferred().resolve();\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _updateEditRow: function (row, forceUpdateRow, isCustomSetCellValue) {\n          if (this.isCellOrBatchEditMode()) {\n            this._updateRowImmediately(row, forceUpdateRow, isCustomSetCellValue);\n          } else {\n            this.callBase.apply(this, arguments);\n          }\n        },\n        _isDefaultButtonVisible: function (button, options) {\n          if (this.isCellOrBatchEditMode()) {\n            var isBatchMode = this.isBatchEditMode();\n\n            switch (button.name) {\n              case \"save\":\n              case \"cancel\":\n              case \"edit\":\n                return false;\n\n              case \"delete\":\n                return this.callBase.apply(this, arguments) && (!isBatchMode || !options.row.removed);\n\n              case \"undelete\":\n                return isBatchMode && this.allowDeleting(options) && options.row.removed;\n\n              default:\n                return this.callBase.apply(this, arguments);\n            }\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _isRowDeleteAllowed: function () {\n          var callBase = this.callBase.apply(this, arguments);\n          return callBase || this.isBatchEditMode();\n        },\n        _beforeEndSaving: function (changes) {\n          if (this.isCellEditMode()) {\n            var _changes$;\n\n            if (\"update\" !== (null === (_changes$ = changes[0]) || void 0 === _changes$ ? void 0 : _changes$.type)) {\n              this.callBase.apply(this, arguments);\n            }\n          } else {\n            if (this.isBatchEditMode()) {\n              this._resetModifiedClassCells(changes);\n            }\n\n            this.callBase.apply(this, arguments);\n          }\n        },\n        prepareEditButtons: function (headerPanel) {\n          var editingOptions = this.option(\"editing\") || {};\n          var buttonItems = this.callBase.apply(this, arguments);\n\n          if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && this.isBatchEditMode()) {\n            buttonItems.push(this.prepareButtonItem(headerPanel, \"save\", \"saveEditData\", 21));\n            buttonItems.push(this.prepareButtonItem(headerPanel, \"revert\", \"cancelEditData\", 22));\n          }\n\n          return buttonItems;\n        },\n        _saveEditDataInner: function () {\n          var _deferred2;\n\n          var editRow = this._dataController.getVisibleRows()[this.getEditRowIndex()];\n\n          var editColumn = this._getEditColumn();\n\n          var showEditorAlways = null === editColumn || void 0 === editColumn ? void 0 : editColumn.showEditorAlways;\n          var isUpdateInCellMode = this.isCellEditMode() && !(null !== editRow && void 0 !== editRow && editRow.isNewRow);\n          var deferred;\n\n          if (isUpdateInCellMode && showEditorAlways) {\n            deferred = new Deferred();\n            this.addDeferred(deferred);\n          }\n\n          return this.callBase.apply(this, arguments).always(null === (_deferred2 = deferred) || void 0 === _deferred2 ? void 0 : _deferred2.resolve);\n        },\n        _applyChange: function (options, params, forceUpdateRow) {\n          var isUpdateInCellMode = this.isCellEditMode() && options.row && !options.row.isNewRow;\n          var showEditorAlways = options.column.showEditorAlways;\n          var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\n          var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && this.hasEditData() && !this.isEditCell(options.rowIndex, options.columnIndex);\n\n          if (focusPreviousEditingCell) {\n            this._focusEditingCell();\n\n            this._updateEditRow(options.row, true, isCustomSetCellValue);\n\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _applyChangeCore: function (options, forceUpdateRow) {\n          var showEditorAlways = options.column.showEditorAlways;\n          var isUpdateInCellMode = this.isCellEditMode() && options.row && !options.row.isNewRow;\n\n          if (showEditorAlways && !forceUpdateRow) {\n            if (isUpdateInCellMode) {\n              this._setEditRowKey(options.row.key, true);\n\n              this._setEditColumnNameByIndex(options.columnIndex, true);\n\n              return this.saveEditData();\n            } else if (this.isBatchEditMode()) {\n              forceUpdateRow = this._needUpdateRow(options.column);\n              return this.callBase(options, forceUpdateRow);\n            }\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _processDataItemCore: function (item, _ref3) {\n          var {\n            data: data,\n            type: type\n          } = _ref3;\n\n          if (this.isBatchEditMode() && type === DATA_EDIT_DATA_REMOVE_TYPE) {\n            item.data = createObjectWithChanges(item.data, data);\n          }\n\n          this.callBase.apply(this, arguments);\n        },\n        _processRemoveCore: function (changes, editIndex, processIfBatch) {\n          if (this.isBatchEditMode() && !processIfBatch) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _processRemoveIfError: function () {\n          if (this.isBatchEditMode()) {\n            return;\n          }\n\n          return this.callBase.apply(this, arguments);\n        },\n        _beforeFocusElementInRow: function (rowIndex) {\n          this.callBase.apply(this, arguments);\n          var editRowIndex = rowIndex >= 0 ? rowIndex : 0;\n          var columnIndex = this.getFirstEditableColumnIndex();\n          columnIndex >= 0 && this.editCell(editRowIndex, columnIndex);\n        }\n      }\n    },\n    views: {\n      rowsView: {\n        _createTable: function () {\n          var $table = this.callBase.apply(this, arguments);\n          var editingController = this._editingController;\n\n          if (editingController.isCellOrBatchEditMode() && this.option(\"editing.allowUpdating\")) {\n            eventsEngine.on($table, addNamespace(holdEvent.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", this.createAction(() => {\n              if (editingController.isEditing()) {\n                editingController.closeEditCell();\n              }\n            }));\n          }\n\n          return $table;\n        },\n        _createRow: function (row) {\n          var $row = this.callBase.apply(this, arguments);\n\n          if (row) {\n            var editingController = this._editingController;\n            var isRowRemoved = !!row.removed;\n\n            if (editingController.isBatchEditMode()) {\n              isRowRemoved && $row.addClass(ROW_REMOVED);\n            }\n          }\n\n          return $row;\n        }\n      },\n      headerPanel: {\n        isVisible: function () {\n          var editingOptions = this.getController(\"editing\").option(\"editing\");\n          return this.callBase() || editingOptions && (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH;\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.editing_cell_based.js"],"names":["$","domAdapter","getWindow","eventsEngine","isDefined","isString","name","clickEventName","pointerEvents","addNamespace","holdEvent","when","Deferred","deferRender","createObjectWithChanges","EDIT_MODE_BATCH","EDIT_MODE_CELL","TARGET_COMPONENT_NAME","FOCUS_OVERLAY_CLASS","ADD_ROW_BUTTON_CLASS","DROPDOWN_EDITOR_OVERLAY_CLASS","EDITOR_CELL_CLASS","ROW_CLASS","CELL_MODIFIED_CLASS","DATA_ROW_CLASS","ROW_REMOVED","EDITING_EDITROWKEY_OPTION_NAME","EDITING_EDITCOLUMNNAME_OPTION_NAME","DATA_EDIT_DATA_REMOVE_TYPE","extenders","controllers","editing","init","needCreateHandlers","_saveEditorHandler","callBase","apply","arguments","$pointerDownTarget","isResizing","_pointerUpEditorHandler","_this$getController","getController","_pointerDownEditorHandler","e","target","createAction","event","$target","targetComponent","component","is","checkEditorPopup","$element","$dropDownEditorOverlay","closest","concat","$componentElement","length","isCellOrBatchEditMode","_editCellInProgress","isEditorPopup","isDomElement","document","isAnotherComponent","_disposed","isAddRowButton","addWidgetPrefix","isFocusOverlay","hasClass","isCellEditMode","isEditing","_closeEditItem","bind","on","getDocument","up","down","option","isBatchEditMode","_needToCloseEditableCell","$targetElement","result","isCurrentComponentElement","isDataRow","rowsView","getView","$targetCell","rowIndex","getRowIndex","parent","columnIndex","getCellElements","index","visibleColumns","_columnsController","getVisibleColumns","allowEditing","isEditCell","closeEditCell","_focusEditorIfNeed","_needFocusEditor","_this$_rowsView","editColumnIndex","_getVisibleEditColumnIndex","$cell","_rowsView","_getCellElement","_getVisibleEditRowIndex","find","_focusEditingCell","isEditRowKeyDefined","isEditColumnNameDefined","_handleEditColumnNameChange","args","oldRowIndex","previousValue","value","getVisibleColumnIndex","oldColumnIndex","_editCellFromOptionChanged","_addRow","parentKey","deferred","hasChanges","_deferred","saveEditData","done","addRow","resolve","fail","reject","promise","editCell","_editCell","options","d","coreResult","executeOperation","_editCellCore","dataController","_dataController","isEditByOptionChanged","column","item","_getNormalizedEditCellOptions","params","data","cancel","key","fireError","rowType","removed","editRowIndex","getRowIndexOffset","_beforeEditCell","_prepareEditCell","_processCanceledEditingCell","isNewRow","always","publicMethods","_ref","columnsController","items","oldColumn","_getEditColumn","columnOption","getVisibleIndex","_isEditingStart","_pageIndex","pageIndex","_setEditRowKey","_setEditColumnNameByIndex","showEditorAlways","_item$oldData","_addInternalData","oldData","isError","withoutSaveEditData","oldEditRowIndex","_closeEditCellCore","error","_resetEditRowKey","_resetEditColumnName","rowIndices","_beforeCloseEditCellInBatchMode","updateItems","changeType","_resetModifiedClassCells","changes","columnsCount","forEach","_ref2","getRowIndexByKey","removeClass","_prepareChange","text","$cellElement","cellElement","_applyModified","_cancelSaving","_resetEditIndices","optionChanged","fullName","handled","columns","_repaintEditCell","_handleEditRowKeyChange","oldRowIndexCorrection","_getEditRowIndexCorrection","_this$_editCellFromOp","call","deleteRow","rowKey","getKeyByRowIndex","_checkAndDeleteRow","_deleteRowCore","_refreshCore","isPageChanged","needResetIndexes","_allowRowAdding","_afterDeleteRow","_updateEditRow","row","forceUpdateRow","isCustomSetCellValue","_updateRowImmediately","_isDefaultButtonVisible","button","isBatchMode","allowDeleting","_isRowDeleteAllowed","_beforeEndSaving","_changes$","type","prepareEditButtons","headerPanel","editingOptions","buttonItems","allowUpdating","allowAdding","push","prepareButtonItem","_saveEditDataInner","_deferred2","editRow","getVisibleRows","getEditRowIndex","editColumn","isUpdateInCellMode","addDeferred","_applyChange","setCellValue","defaultSetCellValue","focusPreviousEditingCell","hasEditData","_applyChangeCore","_needUpdateRow","_processDataItemCore","_ref3","_processRemoveCore","editIndex","processIfBatch","_processRemoveIfError","_beforeFocusElementInRow","getFirstEditableColumnIndex","views","_createTable","$table","editingController","_editingController","_createRow","$row","isRowRemoved","addClass","isVisible","mode"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.editing_cell_based.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport domAdapter from \"../../core/dom_adapter\";\r\nimport {\r\n    getWindow\r\n} from \"../../core/utils/window\";\r\nimport eventsEngine from \"../../events/core/events_engine\";\r\nimport {\r\n    isDefined,\r\n    isString\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    name as clickEventName\r\n} from \"../../events/click\";\r\nimport pointerEvents from \"../../events/pointer\";\r\nimport {\r\n    addNamespace\r\n} from \"../../events/utils/index\";\r\nimport holdEvent from \"../../events/hold\";\r\nimport {\r\n    when,\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    deferRender\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    createObjectWithChanges\r\n} from \"../../data/array_utils\";\r\nimport {\r\n    EDIT_MODE_BATCH,\r\n    EDIT_MODE_CELL,\r\n    TARGET_COMPONENT_NAME\r\n} from \"./ui.grid_core.editing_constants\";\r\nvar FOCUS_OVERLAY_CLASS = \"focus-overlay\";\r\nvar ADD_ROW_BUTTON_CLASS = \"addrow-button\";\r\nvar DROPDOWN_EDITOR_OVERLAY_CLASS = \"dx-dropdowneditor-overlay\";\r\nvar EDITOR_CELL_CLASS = \"dx-editor-cell\";\r\nvar ROW_CLASS = \"dx-row\";\r\nvar CELL_MODIFIED_CLASS = \"dx-cell-modified\";\r\nvar DATA_ROW_CLASS = \"dx-data-row\";\r\nvar ROW_REMOVED = \"dx-row-removed\";\r\nvar EDITING_EDITROWKEY_OPTION_NAME = \"editing.editRowKey\";\r\nvar EDITING_EDITCOLUMNNAME_OPTION_NAME = \"editing.editColumnName\";\r\nvar DATA_EDIT_DATA_REMOVE_TYPE = \"remove\";\r\nexport default {\r\n    extenders: {\r\n        controllers: {\r\n            editing: {\r\n                init: function() {\r\n                    var needCreateHandlers = !this._saveEditorHandler;\r\n                    this.callBase.apply(this, arguments);\r\n                    if (needCreateHandlers) {\r\n                        var $pointerDownTarget;\r\n                        var isResizing;\r\n                        this._pointerUpEditorHandler = () => {\r\n                            var _this$getController;\r\n                            isResizing = null === (_this$getController = this.getController(\"columnsResizer\")) || void 0 === _this$getController ? void 0 : _this$getController.isResizing()\r\n                        };\r\n                        this._pointerDownEditorHandler = e => $pointerDownTarget = $(e.target);\r\n                        this._saveEditorHandler = this.createAction((function(e) {\r\n                            var event = e.event;\r\n                            var $target = $(event.target);\r\n                            var targetComponent = event[TARGET_COMPONENT_NAME];\r\n                            var component = this.component;\r\n                            if ($pointerDownTarget && $pointerDownTarget.is(\"input\") && !$pointerDownTarget.is($target)) {\r\n                                return\r\n                            }\r\n\r\n                            function checkEditorPopup($element) {\r\n                                if (!$element) {\r\n                                    return false\r\n                                }\r\n                                var $dropDownEditorOverlay = $element.closest(\".\".concat(DROPDOWN_EDITOR_OVERLAY_CLASS));\r\n                                var $componentElement = component.$element();\r\n                                return $dropDownEditorOverlay.length > 0 && 0 === $componentElement.closest($dropDownEditorOverlay).length\r\n                            }\r\n                            if (this.isCellOrBatchEditMode() && !this._editCellInProgress) {\r\n                                var isEditorPopup = checkEditorPopup($target) || checkEditorPopup(null === targetComponent || void 0 === targetComponent ? void 0 : targetComponent.$element());\r\n                                var isDomElement = !!$target.closest(getWindow().document).length;\r\n                                var isAnotherComponent = targetComponent && !targetComponent._disposed && targetComponent !== this.component;\r\n                                var isAddRowButton = !!$target.closest(\".\".concat(this.addWidgetPrefix(ADD_ROW_BUTTON_CLASS))).length;\r\n                                var isFocusOverlay = $target.hasClass(this.addWidgetPrefix(FOCUS_OVERLAY_CLASS));\r\n                                var isCellEditMode = this.isCellEditMode();\r\n                                if (!isResizing && !isEditorPopup && !isFocusOverlay && !(isAddRowButton && isCellEditMode && this.isEditing()) && (isDomElement || isAnotherComponent)) {\r\n                                    this._closeEditItem.bind(this)($target)\r\n                                }\r\n                            }\r\n                        }));\r\n                        eventsEngine.on(domAdapter.getDocument(), pointerEvents.up, this._pointerUpEditorHandler);\r\n                        eventsEngine.on(domAdapter.getDocument(), pointerEvents.down, this._pointerDownEditorHandler);\r\n                        eventsEngine.on(domAdapter.getDocument(), clickEventName, this._saveEditorHandler)\r\n                    }\r\n                },\r\n                isCellEditMode: function() {\r\n                    return this.option(\"editing.mode\") === EDIT_MODE_CELL\r\n                },\r\n                isBatchEditMode: function() {\r\n                    return this.option(\"editing.mode\") === EDIT_MODE_BATCH\r\n                },\r\n                isCellOrBatchEditMode: function() {\r\n                    return this.isCellEditMode() || this.isBatchEditMode()\r\n                },\r\n                _needToCloseEditableCell: function($targetElement) {\r\n                    var $element = this.component.$element();\r\n                    var result = this.isEditing();\r\n                    var isCurrentComponentElement = !$element || !!$targetElement.closest($element).length;\r\n                    if (isCurrentComponentElement) {\r\n                        var isDataRow = $targetElement.closest(\".\" + DATA_ROW_CLASS).length;\r\n                        if (isDataRow) {\r\n                            var rowsView = this.getView(\"rowsView\");\r\n                            var $targetCell = $targetElement.closest(\".\" + ROW_CLASS + \"> td\");\r\n                            var rowIndex = rowsView.getRowIndex($targetCell.parent());\r\n                            var columnIndex = rowsView.getCellElements(rowIndex).index($targetCell);\r\n                            var visibleColumns = this._columnsController.getVisibleColumns();\r\n                            var allowEditing = visibleColumns[columnIndex] && visibleColumns[columnIndex].allowEditing;\r\n                            result = result && !allowEditing && !this.isEditCell(rowIndex, columnIndex)\r\n                        }\r\n                    }\r\n                    return result || this.callBase.apply(this, arguments)\r\n                },\r\n                _closeEditItem: function($targetElement) {\r\n                    if (this._needToCloseEditableCell($targetElement)) {\r\n                        this.closeEditCell()\r\n                    }\r\n                },\r\n                _focusEditorIfNeed: function() {\r\n                    if (this._needFocusEditor && this.isCellOrBatchEditMode()) {\r\n                        var _this$_rowsView;\r\n                        var editColumnIndex = this._getVisibleEditColumnIndex();\r\n                        var $cell = null === (_this$_rowsView = this._rowsView) || void 0 === _this$_rowsView ? void 0 : _this$_rowsView._getCellElement(this._getVisibleEditRowIndex(), editColumnIndex);\r\n                        if ($cell && !$cell.find(\":focus\").length) {\r\n                            this._focusEditingCell(() => {\r\n                                this._editCellInProgress = false\r\n                            }, $cell, true)\r\n                        } else {\r\n                            this._editCellInProgress = false\r\n                        }\r\n                        this._needFocusEditor = false\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                isEditing: function() {\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        var isEditRowKeyDefined = isDefined(this.option(EDITING_EDITROWKEY_OPTION_NAME));\r\n                        var isEditColumnNameDefined = isDefined(this.option(EDITING_EDITCOLUMNNAME_OPTION_NAME));\r\n                        return isEditRowKeyDefined && isEditColumnNameDefined\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _handleEditColumnNameChange: function(args) {\r\n                    var oldRowIndex = this._getVisibleEditRowIndex(args.previousValue);\r\n                    if (this.isCellOrBatchEditMode() && -1 !== oldRowIndex && isDefined(args.value) && args.value !== args.previousValue) {\r\n                        var columnIndex = this._columnsController.getVisibleColumnIndex(args.value);\r\n                        var oldColumnIndex = this._columnsController.getVisibleColumnIndex(args.previousValue);\r\n                        this._editCellFromOptionChanged(columnIndex, oldColumnIndex, oldRowIndex)\r\n                    }\r\n                },\r\n                _addRow: function(parentKey, deferred) {\r\n                    if (this.isCellEditMode() && this.hasChanges()) {\r\n                        var _deferred = new Deferred;\r\n                        this.saveEditData().done(() => {\r\n                            if (!this.hasChanges()) {\r\n                                this.addRow(parentKey).done(_deferred.resolve).fail(_deferred.reject)\r\n                            } else {\r\n                                _deferred.reject(\"cancel\")\r\n                            }\r\n                        });\r\n                        return _deferred.promise()\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                editCell: function(rowIndex, columnIndex) {\r\n                    return this._editCell({\r\n                        rowIndex: rowIndex,\r\n                        columnIndex: columnIndex\r\n                    })\r\n                },\r\n                _editCell: function(options) {\r\n                    var d = new Deferred;\r\n                    var coreResult;\r\n                    this.executeOperation(d, () => {\r\n                        coreResult = this._editCellCore(options);\r\n                        when(coreResult).done(d.resolve).fail(d.reject)\r\n                    });\r\n                    return void 0 !== coreResult ? coreResult : d.promise()\r\n                },\r\n                _editCellCore: function(options) {\r\n                    var dataController = this._dataController;\r\n                    var isEditByOptionChanged = isDefined(options.oldColumnIndex) || isDefined(options.oldRowIndex);\r\n                    var {\r\n                        columnIndex: columnIndex,\r\n                        rowIndex: rowIndex,\r\n                        column: column,\r\n                        item: item\r\n                    } = this._getNormalizedEditCellOptions(options);\r\n                    var params = {\r\n                        data: null === item || void 0 === item ? void 0 : item.data,\r\n                        cancel: false,\r\n                        column: column\r\n                    };\r\n                    if (void 0 === item.key) {\r\n                        this._dataController.fireError(\"E1043\");\r\n                        return\r\n                    }\r\n                    if (column && (\"data\" === item.rowType || \"detailAdaptive\" === item.rowType) && !item.removed && this.isCellOrBatchEditMode()) {\r\n                        if (!isEditByOptionChanged && this.isEditCell(rowIndex, columnIndex)) {\r\n                            return true\r\n                        }\r\n                        var editRowIndex = rowIndex + dataController.getRowIndexOffset();\r\n                        return when(this._beforeEditCell(rowIndex, columnIndex, item)).done(cancel => {\r\n                            if (cancel) {\r\n                                return\r\n                            }\r\n                            if (!this._prepareEditCell(params, item, columnIndex, editRowIndex)) {\r\n                                this._processCanceledEditingCell()\r\n                            }\r\n                        })\r\n                    }\r\n                    return false\r\n                },\r\n                _beforeEditCell: function(rowIndex, columnIndex, item) {\r\n                    if (this.isCellEditMode() && !item.isNewRow && this.hasChanges()) {\r\n                        var d = new Deferred;\r\n                        this.saveEditData().always(() => {\r\n                            d.resolve(this.hasChanges())\r\n                        });\r\n                        return d\r\n                    }\r\n                },\r\n                publicMethods: function() {\r\n                    var publicMethods = this.callBase.apply(this, arguments);\r\n                    return publicMethods.concat([\"editCell\", \"closeEditCell\"])\r\n                },\r\n                _getNormalizedEditCellOptions: function(_ref) {\r\n                    var {\r\n                        oldColumnIndex: oldColumnIndex,\r\n                        oldRowIndex: oldRowIndex,\r\n                        columnIndex: columnIndex,\r\n                        rowIndex: rowIndex\r\n                    } = _ref;\r\n                    var columnsController = this._columnsController;\r\n                    var visibleColumns = columnsController.getVisibleColumns();\r\n                    var items = this._dataController.items();\r\n                    var item = items[rowIndex];\r\n                    var oldColumn;\r\n                    if (isDefined(oldColumnIndex)) {\r\n                        oldColumn = visibleColumns[oldColumnIndex]\r\n                    } else {\r\n                        oldColumn = this._getEditColumn()\r\n                    }\r\n                    if (!isDefined(oldRowIndex)) {\r\n                        oldRowIndex = this._getVisibleEditRowIndex()\r\n                    }\r\n                    if (isString(columnIndex)) {\r\n                        columnIndex = columnsController.columnOption(columnIndex, \"index\");\r\n                        columnIndex = columnsController.getVisibleIndex(columnIndex)\r\n                    }\r\n                    var column = visibleColumns[columnIndex];\r\n                    return {\r\n                        oldColumn: oldColumn,\r\n                        columnIndex: columnIndex,\r\n                        oldRowIndex: oldRowIndex,\r\n                        rowIndex: rowIndex,\r\n                        column: column,\r\n                        item: item\r\n                    }\r\n                },\r\n                _prepareEditCell: function(params, item, editColumnIndex, editRowIndex) {\r\n                    if (!item.isNewRow) {\r\n                        params.key = item.key\r\n                    }\r\n                    if (this._isEditingStart(params)) {\r\n                        return false\r\n                    }\r\n                    this._pageIndex = this._dataController.pageIndex();\r\n                    this._setEditRowKey(item.key);\r\n                    this._setEditColumnNameByIndex(editColumnIndex);\r\n                    if (!params.column.showEditorAlways) {\r\n                        var _item$oldData;\r\n                        this._addInternalData({\r\n                            key: item.key,\r\n                            oldData: null !== (_item$oldData = item.oldData) && void 0 !== _item$oldData ? _item$oldData : item.data\r\n                        })\r\n                    }\r\n                    return true\r\n                },\r\n                closeEditCell: function(isError, withoutSaveEditData) {\r\n                    var result = when();\r\n                    var oldEditRowIndex = this._getVisibleEditRowIndex();\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        var deferred = new Deferred;\r\n                        result = new Deferred;\r\n                        this.executeOperation(deferred, () => {\r\n                            this._closeEditCellCore(isError, oldEditRowIndex, withoutSaveEditData).always(result.resolve)\r\n                        })\r\n                    }\r\n                    return result.promise()\r\n                },\r\n                _closeEditCellCore: function(isError, oldEditRowIndex, withoutSaveEditData) {\r\n                    var dataController = this._dataController;\r\n                    var deferred = new Deferred;\r\n                    var promise = deferred.promise();\r\n                    if (this.isCellEditMode() && this.hasChanges()) {\r\n                        if (!withoutSaveEditData) {\r\n                            this.saveEditData().done(error => {\r\n                                if (!this.hasChanges()) {\r\n                                    this.closeEditCell(!!error).always(deferred.resolve);\r\n                                    return\r\n                                }\r\n                                deferred.resolve()\r\n                            });\r\n                            return promise\r\n                        }\r\n                    } else {\r\n                        this._resetEditRowKey();\r\n                        this._resetEditColumnName();\r\n                        if (oldEditRowIndex >= 0) {\r\n                            var rowIndices = [oldEditRowIndex];\r\n                            this._beforeCloseEditCellInBatchMode(rowIndices);\r\n                            if (!isError) {\r\n                                dataController.updateItems({\r\n                                    changeType: \"update\",\r\n                                    rowIndices: rowIndices\r\n                                })\r\n                            }\r\n                        }\r\n                    }\r\n                    deferred.resolve();\r\n                    return promise\r\n                },\r\n                _resetModifiedClassCells: function(changes) {\r\n                    if (this.isBatchEditMode()) {\r\n                        var columnsCount = this._columnsController.getVisibleColumns().length;\r\n                        changes.forEach(_ref2 => {\r\n                            var {\r\n                                key: key\r\n                            } = _ref2;\r\n                            var rowIndex = this._dataController.getRowIndexByKey(key);\r\n                            if (-1 !== rowIndex) {\r\n                                for (var columnIndex = 0; columnIndex < columnsCount; columnIndex++) {\r\n                                    this._rowsView._getCellElement(rowIndex, columnIndex).removeClass(CELL_MODIFIED_CLASS)\r\n                                }\r\n                            }\r\n                        })\r\n                    }\r\n                },\r\n                _prepareChange: function(options, value, text) {\r\n                    var $cellElement = $(options.cellElement);\r\n                    if (this.isBatchEditMode() && void 0 !== options.key) {\r\n                        this._applyModified($cellElement, options)\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _cancelSaving: function() {\r\n                    var dataController = this._dataController;\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        if (this.isBatchEditMode()) {\r\n                            this._resetEditIndices()\r\n                        }\r\n                        dataController.updateItems()\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                optionChanged: function(args) {\r\n                    var fullName = args.fullName;\r\n                    if (\"editing\" === args.name && fullName === EDITING_EDITCOLUMNNAME_OPTION_NAME) {\r\n                        this._handleEditColumnNameChange(args);\r\n                        args.handled = true\r\n                    } else {\r\n                        this.callBase(args)\r\n                    }\r\n                },\r\n                _editCellFromOptionChanged: function(columnIndex, oldColumnIndex, oldRowIndex) {\r\n                    var columns = this._columnsController.getVisibleColumns();\r\n                    if (columnIndex > -1) {\r\n                        deferRender(() => {\r\n                            this._repaintEditCell(columns[columnIndex], columns[oldColumnIndex], oldRowIndex)\r\n                        })\r\n                    }\r\n                },\r\n                _handleEditRowKeyChange: function(args) {\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        var columnIndex = this._getVisibleEditColumnIndex();\r\n                        var oldRowIndexCorrection = this._getEditRowIndexCorrection();\r\n                        var oldRowIndex = this._dataController.getRowIndexByKey(args.previousValue) + oldRowIndexCorrection;\r\n                        if (isDefined(args.value) && args.value !== args.previousValue) {\r\n                            var _this$_editCellFromOp;\r\n                            null === (_this$_editCellFromOp = this._editCellFromOptionChanged) || void 0 === _this$_editCellFromOp ? void 0 : _this$_editCellFromOp.call(this, columnIndex, columnIndex, oldRowIndex)\r\n                        }\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                deleteRow: function(rowIndex) {\r\n                    if (this.isCellEditMode() && this.isEditing()) {\r\n                        var isNewRow = this._dataController.items()[rowIndex].isNewRow;\r\n                        var rowKey = this._dataController.getKeyByRowIndex(rowIndex);\r\n                        this.closeEditCell(null, isNewRow).always(() => {\r\n                            rowIndex = this._dataController.getRowIndexByKey(rowKey);\r\n                            this._checkAndDeleteRow(rowIndex)\r\n                        })\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _checkAndDeleteRow: function(rowIndex) {\r\n                    if (this.isBatchEditMode()) {\r\n                        this._deleteRowCore(rowIndex)\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _refreshCore: function(params) {\r\n                    var {\r\n                        isPageChanged: isPageChanged\r\n                    } = null !== params && void 0 !== params ? params : {};\r\n                    var needResetIndexes = this.isBatchEditMode() || isPageChanged && \"virtual\" !== this.option(\"scrolling.mode\");\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        if (needResetIndexes) {\r\n                            this._resetEditColumnName();\r\n                            this._resetEditRowKey()\r\n                        }\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _allowRowAdding: function(params) {\r\n                    if (this.isBatchEditMode()) {\r\n                        return true\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _afterDeleteRow: function(rowIndex, oldEditRowIndex) {\r\n                    var dataController = this._dataController;\r\n                    if (this.isBatchEditMode()) {\r\n                        dataController.updateItems({\r\n                            changeType: \"update\",\r\n                            rowIndices: [oldEditRowIndex, rowIndex]\r\n                        });\r\n                        return (new Deferred).resolve()\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _updateEditRow: function(row, forceUpdateRow, isCustomSetCellValue) {\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        this._updateRowImmediately(row, forceUpdateRow, isCustomSetCellValue)\r\n                    } else {\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                _isDefaultButtonVisible: function(button, options) {\r\n                    if (this.isCellOrBatchEditMode()) {\r\n                        var isBatchMode = this.isBatchEditMode();\r\n                        switch (button.name) {\r\n                            case \"save\":\r\n                            case \"cancel\":\r\n                            case \"edit\":\r\n                                return false;\r\n                            case \"delete\":\r\n                                return this.callBase.apply(this, arguments) && (!isBatchMode || !options.row.removed);\r\n                            case \"undelete\":\r\n                                return isBatchMode && this.allowDeleting(options) && options.row.removed;\r\n                            default:\r\n                                return this.callBase.apply(this, arguments)\r\n                        }\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _isRowDeleteAllowed: function() {\r\n                    var callBase = this.callBase.apply(this, arguments);\r\n                    return callBase || this.isBatchEditMode()\r\n                },\r\n                _beforeEndSaving: function(changes) {\r\n                    if (this.isCellEditMode()) {\r\n                        var _changes$;\r\n                        if (\"update\" !== (null === (_changes$ = changes[0]) || void 0 === _changes$ ? void 0 : _changes$.type)) {\r\n                            this.callBase.apply(this, arguments)\r\n                        }\r\n                    } else {\r\n                        if (this.isBatchEditMode()) {\r\n                            this._resetModifiedClassCells(changes)\r\n                        }\r\n                        this.callBase.apply(this, arguments)\r\n                    }\r\n                },\r\n                prepareEditButtons: function(headerPanel) {\r\n                    var editingOptions = this.option(\"editing\") || {};\r\n                    var buttonItems = this.callBase.apply(this, arguments);\r\n                    if ((editingOptions.allowUpdating || editingOptions.allowAdding || editingOptions.allowDeleting) && this.isBatchEditMode()) {\r\n                        buttonItems.push(this.prepareButtonItem(headerPanel, \"save\", \"saveEditData\", 21));\r\n                        buttonItems.push(this.prepareButtonItem(headerPanel, \"revert\", \"cancelEditData\", 22))\r\n                    }\r\n                    return buttonItems\r\n                },\r\n                _saveEditDataInner: function() {\r\n                    var _deferred2;\r\n                    var editRow = this._dataController.getVisibleRows()[this.getEditRowIndex()];\r\n                    var editColumn = this._getEditColumn();\r\n                    var showEditorAlways = null === editColumn || void 0 === editColumn ? void 0 : editColumn.showEditorAlways;\r\n                    var isUpdateInCellMode = this.isCellEditMode() && !(null !== editRow && void 0 !== editRow && editRow.isNewRow);\r\n                    var deferred;\r\n                    if (isUpdateInCellMode && showEditorAlways) {\r\n                        deferred = new Deferred;\r\n                        this.addDeferred(deferred)\r\n                    }\r\n                    return this.callBase.apply(this, arguments).always(null === (_deferred2 = deferred) || void 0 === _deferred2 ? void 0 : _deferred2.resolve)\r\n                },\r\n                _applyChange: function(options, params, forceUpdateRow) {\r\n                    var isUpdateInCellMode = this.isCellEditMode() && options.row && !options.row.isNewRow;\r\n                    var showEditorAlways = options.column.showEditorAlways;\r\n                    var isCustomSetCellValue = options.column.setCellValue !== options.column.defaultSetCellValue;\r\n                    var focusPreviousEditingCell = showEditorAlways && !forceUpdateRow && isUpdateInCellMode && this.hasEditData() && !this.isEditCell(options.rowIndex, options.columnIndex);\r\n                    if (focusPreviousEditingCell) {\r\n                        this._focusEditingCell();\r\n                        this._updateEditRow(options.row, true, isCustomSetCellValue);\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _applyChangeCore: function(options, forceUpdateRow) {\r\n                    var showEditorAlways = options.column.showEditorAlways;\r\n                    var isUpdateInCellMode = this.isCellEditMode() && options.row && !options.row.isNewRow;\r\n                    if (showEditorAlways && !forceUpdateRow) {\r\n                        if (isUpdateInCellMode) {\r\n                            this._setEditRowKey(options.row.key, true);\r\n                            this._setEditColumnNameByIndex(options.columnIndex, true);\r\n                            return this.saveEditData()\r\n                        } else if (this.isBatchEditMode()) {\r\n                            forceUpdateRow = this._needUpdateRow(options.column);\r\n                            return this.callBase(options, forceUpdateRow)\r\n                        }\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _processDataItemCore: function(item, _ref3) {\r\n                    var {\r\n                        data: data,\r\n                        type: type\r\n                    } = _ref3;\r\n                    if (this.isBatchEditMode() && type === DATA_EDIT_DATA_REMOVE_TYPE) {\r\n                        item.data = createObjectWithChanges(item.data, data)\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                },\r\n                _processRemoveCore: function(changes, editIndex, processIfBatch) {\r\n                    if (this.isBatchEditMode() && !processIfBatch) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _processRemoveIfError: function() {\r\n                    if (this.isBatchEditMode()) {\r\n                        return\r\n                    }\r\n                    return this.callBase.apply(this, arguments)\r\n                },\r\n                _beforeFocusElementInRow: function(rowIndex) {\r\n                    this.callBase.apply(this, arguments);\r\n                    var editRowIndex = rowIndex >= 0 ? rowIndex : 0;\r\n                    var columnIndex = this.getFirstEditableColumnIndex();\r\n                    columnIndex >= 0 && this.editCell(editRowIndex, columnIndex)\r\n                }\r\n            }\r\n        },\r\n        views: {\r\n            rowsView: {\r\n                _createTable: function() {\r\n                    var $table = this.callBase.apply(this, arguments);\r\n                    var editingController = this._editingController;\r\n                    if (editingController.isCellOrBatchEditMode() && this.option(\"editing.allowUpdating\")) {\r\n                        eventsEngine.on($table, addNamespace(holdEvent.name, \"dxDataGridRowsView\"), \"td:not(.\" + EDITOR_CELL_CLASS + \")\", this.createAction(() => {\r\n                            if (editingController.isEditing()) {\r\n                                editingController.closeEditCell()\r\n                            }\r\n                        }))\r\n                    }\r\n                    return $table\r\n                },\r\n                _createRow: function(row) {\r\n                    var $row = this.callBase.apply(this, arguments);\r\n                    if (row) {\r\n                        var editingController = this._editingController;\r\n                        var isRowRemoved = !!row.removed;\r\n                        if (editingController.isBatchEditMode()) {\r\n                            isRowRemoved && $row.addClass(ROW_REMOVED)\r\n                        }\r\n                    }\r\n                    return $row\r\n                }\r\n            },\r\n            headerPanel: {\r\n                isVisible: function() {\r\n                    var editingOptions = this.getController(\"editing\").option(\"editing\");\r\n                    return this.callBase() || editingOptions && (editingOptions.allowUpdating || editingOptions.allowDeleting) && editingOptions.mode === EDIT_MODE_BATCH\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}