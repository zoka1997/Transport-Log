{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/filter_builder/utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport $ from \"../../core/renderer\";\nimport { Deferred, when } from \"../../core/utils/deferred\";\nimport { errors as dataErrors } from \"../../data/errors\";\nimport { isDefined, isFunction } from \"../../core/utils/type\";\nimport { compileGetter } from \"../../core/utils/data\";\nimport errors from \"../widget/ui.errors\";\nimport filterUtils from \"../shared/filtering\";\nimport formatHelper from \"../../format_helper\";\nimport { extend } from \"../../core/utils/extend\";\nimport { captionize } from \"../../core/utils/inflector\";\nimport { getConfig } from \"./between\";\nimport messageLocalization from \"../../localization/message\";\nimport { DataSource } from \"../../data/data_source/data_source\";\nimport filterOperationsDictionary from \"./ui.filter_operations_dictionary\";\nvar DEFAULT_DATA_TYPE = \"string\";\nvar EMPTY_MENU_ICON = \"icon-none\";\nvar AND_GROUP_OPERATION = \"and\";\nvar EQUAL_OPERATION = \"=\";\nvar NOT_EQUAL_OPERATION = \"<>\";\nvar DATATYPE_OPERATIONS = {\n  number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\n  boolean: [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\n  object: [\"isblank\", \"isnotblank\"]\n};\nvar DEFAULT_FORMAT = {\n  date: \"shortDate\",\n  datetime: \"shortDateShortTime\"\n};\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\nvar FILTER_BUILDER_ITEM_TEXT_PART_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-part\";\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-separator\";\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS = FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS + \"-empty\";\n\nfunction getFormattedValueText(field, value) {\n  var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\n  return formatHelper.format(value, fieldFormat);\n}\n\nfunction isNegationGroup(group) {\n  return group && group.length > 1 && \"!\" === group[0] && !isCondition(group);\n}\n\nexport function getGroupCriteria(group) {\n  return isNegationGroup(group) ? group[1] : group;\n}\n\nfunction setGroupCriteria(group, criteria) {\n  if (isNegationGroup(group)) {\n    group[1] = criteria;\n  } else {\n    group = criteria;\n  }\n\n  return group;\n}\n\nfunction convertGroupToNewStructure(group, value) {\n  if (function (value) {\n    return -1 !== value.indexOf(\"!\");\n  }(value)) {\n    if (!isNegationGroup(group)) {\n      !function (group) {\n        var criteria = group.slice(0);\n        group.length = 0;\n        group.push(\"!\", criteria);\n      }(group);\n    }\n  } else if (isNegationGroup(group)) {\n    !function (group) {\n      var criteria = getGroupCriteria(group);\n      group.length = 0;\n      [].push.apply(group, criteria);\n    }(group);\n  }\n}\n\nexport function setGroupValue(group, value) {\n  convertGroupToNewStructure(group, value);\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  value = function (value) {\n    return -1 === value.indexOf(\"!\") ? value : value.substring(1);\n  }(value);\n\n  !function (criteria, value) {\n    for (i = 0; i < criteria.length; i++) {\n      if (!Array.isArray(criteria[i])) {\n        criteria[i] = value;\n      }\n    }\n  }(criteria, value);\n  return group;\n}\nexport function getGroupMenuItem(group, availableGroups) {\n  var groupValue = getGroupValue(group);\n  return availableGroups.filter(function (item) {\n    return item.value === groupValue;\n  })[0];\n}\n\nfunction getCriteriaOperation(criteria) {\n  if (isCondition(criteria)) {\n    return AND_GROUP_OPERATION;\n  }\n\n  var value = \"\";\n\n  for (var i = 0; i < criteria.length; i++) {\n    var item = criteria[i];\n\n    if (!Array.isArray(item)) {\n      if (value && value !== item) {\n        throw new dataErrors.Error(\"E4019\");\n      }\n\n      if (\"!\" !== item) {\n        value = item;\n      }\n    }\n  }\n\n  return value;\n}\n\nexport function getGroupValue(group) {\n  var criteria = getGroupCriteria(group);\n  var value = getCriteriaOperation(criteria);\n\n  if (!value) {\n    value = AND_GROUP_OPERATION;\n  }\n\n  if (criteria !== group) {\n    value = \"!\" + value;\n  }\n\n  return value;\n}\n\nfunction getDefaultFilterOperations(field) {\n  return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE];\n}\n\nfunction containItems(entity) {\n  return Array.isArray(entity) && entity.length;\n}\n\nexport function getFilterOperations(field) {\n  var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\n  return extend([], result);\n}\nexport function getCaptionByOperation(operation, filterOperationDescriptions) {\n  var operationName = filterOperationsDictionary.getNameByFilterOperation(operation);\n  return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName;\n}\nexport function getOperationFromAvailable(operation, availableOperations) {\n  for (var i = 0; i < availableOperations.length; i++) {\n    if (availableOperations[i].value === operation) {\n      return availableOperations[i];\n    }\n  }\n\n  throw new errors.Error(\"E1048\", operation);\n}\nexport function getCustomOperation(customOperations, name) {\n  var filteredOperations = customOperations.filter(function (item) {\n    return item.name === name;\n  });\n  return filteredOperations.length ? filteredOperations[0] : null;\n}\nexport function getAvailableOperations(field, filterOperationDescriptions, customOperations) {\n  var filterOperations = getFilterOperations(field);\n  var isLookupField = !!field.lookup;\n  customOperations.forEach(function (customOperation) {\n    if (!field.filterOperations && -1 === filterOperations.indexOf(customOperation.name)) {\n      var dataTypes = customOperation && customOperation.dataTypes;\n      var isOperationForbidden = isLookupField ? !!customOperation.notForLookup : false;\n\n      if (!isOperationForbidden && dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\n        filterOperations.push(customOperation.name);\n      }\n    }\n  });\n  return filterOperations.map(function (operation) {\n    var customOperation = getCustomOperation(customOperations, operation);\n\n    if (customOperation) {\n      return {\n        icon: customOperation.icon || EMPTY_MENU_ICON,\n        text: customOperation.caption || captionize(customOperation.name),\n        value: customOperation.name,\n        isCustom: true\n      };\n    } else {\n      return {\n        icon: filterOperationsDictionary.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\n        text: getCaptionByOperation(operation, filterOperationDescriptions),\n        value: operation\n      };\n    }\n  });\n}\nexport function getDefaultOperation(field) {\n  return field.defaultFilterOperation || getFilterOperations(field)[0];\n}\nexport function createCondition(field, customOperations) {\n  var condition = [field.dataField, \"\", \"\"];\n  var filterOperation = getDefaultOperation(field);\n  updateConditionByOperation(condition, filterOperation, customOperations);\n  return condition;\n}\nexport function removeItem(group, item) {\n  var criteria = getGroupCriteria(group);\n  var index = criteria.indexOf(item);\n  criteria.splice(index, 1);\n\n  if (1 !== criteria.length) {\n    criteria.splice(index, 1);\n  }\n\n  return group;\n}\nexport function createEmptyGroup(value) {\n  var isNegation = isNegationGroupOperation(value);\n  var groupOperation = isNegation ? getGroupOperationFromNegationOperation(value) : value;\n  return isNegation ? [\"!\", [groupOperation]] : [groupOperation];\n}\nexport function isEmptyGroup(group) {\n  var criteria = getGroupCriteria(group);\n\n  if (isCondition(criteria)) {\n    return false;\n  }\n\n  var hasConditions = criteria.some(function (item) {\n    return isCondition(item);\n  });\n  return !hasConditions;\n}\nexport function addItem(item, group) {\n  var criteria = getGroupCriteria(group);\n  var groupValue = getGroupValue(criteria);\n  1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\n  return group;\n}\nexport function getField(dataField, fields) {\n  for (var i = 0; i < fields.length; i++) {\n    if (fields[i].name === dataField) {\n      return fields[i];\n    }\n\n    if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\n      return fields[i];\n    }\n  }\n\n  var extendedFields = getItems(fields, true).filter(function (item) {\n    return item.dataField.toLowerCase() === dataField.toLowerCase();\n  });\n\n  if (extendedFields.length > 0) {\n    return extendedFields[0];\n  }\n\n  throw new errors.Error(\"E1047\", dataField);\n}\nexport function isGroup(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1]);\n}\nexport function isCondition(criteria) {\n  if (!Array.isArray(criteria)) {\n    return false;\n  }\n\n  return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1]);\n}\n\nfunction convertToInnerGroup(group, customOperations, defaultGroupOperation) {\n  defaultGroupOperation = defaultGroupOperation || AND_GROUP_OPERATION;\n  var groupOperation = getCriteriaOperation(group).toLowerCase() || defaultGroupOperation;\n  var innerGroup = [];\n\n  for (var i = 0; i < group.length; i++) {\n    if (isGroup(group[i])) {\n      innerGroup.push(convertToInnerStructure(group[i], customOperations, defaultGroupOperation));\n      innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation);\n    } else if (isCondition(group[i])) {\n      innerGroup.push(convertToInnerCondition(group[i], customOperations));\n      innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation);\n    }\n  }\n\n  if (0 === innerGroup.length) {\n    innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation);\n  }\n\n  return innerGroup;\n}\n\nfunction conditionHasCustomOperation(condition, customOperations) {\n  var customOperation = getCustomOperation(customOperations, condition[1]);\n  return customOperation && customOperation.name === condition[1];\n}\n\nfunction convertToInnerCondition(condition, customOperations) {\n  if (conditionHasCustomOperation(condition, customOperations)) {\n    return condition;\n  }\n\n  if (condition.length < 3) {\n    condition[2] = condition[1];\n    condition[1] = EQUAL_OPERATION;\n  }\n\n  return condition;\n}\n\nfunction isNegationGroupOperation(operation) {\n  return -1 !== operation.indexOf(\"not\");\n}\n\nfunction getGroupOperationFromNegationOperation(operation) {\n  return operation.substring(3).toLowerCase();\n}\n\nfunction appendGroupOperationToCriteria(criteria, groupOperation) {\n  var isNegation = isNegationGroupOperation(groupOperation);\n  groupOperation = isNegation ? getGroupOperationFromNegationOperation(groupOperation) : groupOperation;\n  return isNegation ? [\"!\", criteria, groupOperation] : [criteria, groupOperation];\n}\n\nfunction appendGroupOperationToGroup(group, groupOperation) {\n  var isNegation = isNegationGroupOperation(groupOperation);\n  groupOperation = isNegation ? getGroupOperationFromNegationOperation(groupOperation) : groupOperation;\n  group.push(groupOperation);\n  var result = group;\n\n  if (isNegation) {\n    result = [\"!\", result];\n  }\n\n  return result;\n}\n\nexport function convertToInnerStructure(value, customOperations, defaultGroupOperation) {\n  defaultGroupOperation = defaultGroupOperation || AND_GROUP_OPERATION;\n\n  if (!value) {\n    return createEmptyGroup(defaultGroupOperation);\n  }\n\n  value = extend(true, [], value);\n\n  if (isCondition(value)) {\n    return appendGroupOperationToCriteria(convertToInnerCondition(value, customOperations), defaultGroupOperation);\n  }\n\n  if (isNegationGroup(value)) {\n    return [\"!\", isCondition(value[1]) ? appendGroupOperationToCriteria(convertToInnerCondition(value[1], customOperations), defaultGroupOperation) : isNegationGroup(value[1]) ? appendGroupOperationToCriteria(convertToInnerStructure(value[1], customOperations), defaultGroupOperation) : convertToInnerGroup(value[1], customOperations, defaultGroupOperation)];\n  }\n\n  return convertToInnerGroup(value, customOperations, defaultGroupOperation);\n}\nexport function getNormalizedFields(fields) {\n  return fields.reduce(function (result, field) {\n    if (isDefined(field.dataField)) {\n      var normalizedField = {};\n\n      for (var key in field) {\n        if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\n          normalizedField[key] = field[key];\n        }\n      }\n\n      normalizedField.defaultCalculateFilterExpression = filterUtils.defaultCalculateFilterExpression;\n\n      if (!isDefined(normalizedField.dataType)) {\n        normalizedField.dataType = DEFAULT_DATA_TYPE;\n      }\n\n      if (!isDefined(normalizedField.trueText)) {\n        normalizedField.trueText = messageLocalization.format(\"dxDataGrid-trueText\");\n      }\n\n      if (!isDefined(normalizedField.falseText)) {\n        normalizedField.falseText = messageLocalization.format(\"dxDataGrid-falseText\");\n      }\n\n      result.push(normalizedField);\n    }\n\n    return result;\n  }, []);\n}\n\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\n  var field = getField(condition[0], fields);\n  var filterExpression = convertToInnerCondition(condition, customOperations);\n  var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\n\n  if (customOperation && customOperation.calculateFilterExpression) {\n    return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, fields]);\n  } else if (field.createFilterExpression) {\n    return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n  } else if (field.calculateFilterExpression) {\n    return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n  } else {\n    return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target]);\n  }\n}\n\nexport function getFilterExpression(value, fields, customOperations, target) {\n  if (!isDefined(value)) {\n    return null;\n  }\n\n  if (isNegationGroup(value)) {\n    var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\n    return [\"!\", filterExpression];\n  }\n\n  var criteria = getGroupCriteria(value);\n\n  if (isCondition(criteria)) {\n    return getConditionFilterExpression(criteria, fields, customOperations, target) || null;\n  } else {\n    var result = [];\n\n    var _filterExpression;\n\n    var groupValue = getGroupValue(criteria);\n\n    for (var i = 0; i < criteria.length; i++) {\n      if (isGroup(criteria[i])) {\n        _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\n\n        if (_filterExpression) {\n          i && result.push(groupValue);\n          result.push(_filterExpression);\n        }\n      } else if (isCondition(criteria[i])) {\n        _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\n\n        if (_filterExpression) {\n          result.length && result.push(groupValue);\n          result.push(_filterExpression);\n        }\n      }\n    }\n\n    if (1 === result.length) {\n      result = result[0];\n    }\n\n    return result.length ? result : null;\n  }\n}\nexport function getNormalizedFilter(group) {\n  var criteria = getGroupCriteria(group);\n  var i;\n\n  if (0 === criteria.length) {\n    return null;\n  }\n\n  var itemsForRemove = [];\n\n  for (i = 0; i < criteria.length; i++) {\n    if (isGroup(criteria[i])) {\n      var normalizedGroupValue = getNormalizedFilter(criteria[i]);\n\n      if (normalizedGroupValue) {\n        criteria[i] = normalizedGroupValue;\n      } else {\n        itemsForRemove.push(criteria[i]);\n      }\n    } else if (isCondition(criteria[i])) {\n      if (!isValidCondition(criteria[i])) {\n        itemsForRemove.push(criteria[i]);\n      }\n    }\n  }\n\n  for (i = 0; i < itemsForRemove.length; i++) {\n    removeItem(criteria, itemsForRemove[i]);\n  }\n\n  if (1 === criteria.length) {\n    return null;\n  }\n\n  criteria.splice(criteria.length - 1, 1);\n\n  if (1 === criteria.length) {\n    group = setGroupCriteria(group, criteria[0]);\n  }\n\n  if (0 === group.length) {\n    return null;\n  }\n\n  return group;\n}\nexport function getCurrentLookupValueText(field, value, handler) {\n  if (\"\" === value) {\n    handler(\"\");\n    return;\n  }\n\n  var lookup = field.lookup;\n\n  if (lookup.items) {\n    handler(lookup.calculateCellValue(value) || \"\");\n  } else {\n    var lookupDataSource = isFunction(lookup.dataSource) ? lookup.dataSource({}) : lookup.dataSource;\n    var dataSource = new DataSource(lookupDataSource);\n    dataSource.loadSingle(lookup.valueExpr, value).done(function (result) {\n      var valueText = \"\";\n\n      if (result) {\n        valueText = lookup.displayExpr ? compileGetter(lookup.displayExpr)(result) : result;\n      }\n\n      if (field.customizeText) {\n        valueText = field.customizeText({\n          value: value,\n          valueText: valueText\n        });\n      }\n\n      handler(valueText);\n    }).fail(function () {\n      handler(\"\");\n    });\n  }\n}\n\nfunction getPrimitiveValueText(field, value, customOperation, target, options) {\n  var valueText;\n\n  if (true === value) {\n    valueText = field.trueText || messageLocalization.format(\"dxDataGrid-trueText\");\n  } else if (false === value) {\n    valueText = field.falseText || messageLocalization.format(\"dxDataGrid-falseText\");\n  } else {\n    valueText = getFormattedValueText(field, value);\n  }\n\n  if (field.customizeText) {\n    valueText = field.customizeText.call(field, {\n      value: value,\n      valueText: valueText,\n      target: target\n    });\n  }\n\n  if (customOperation && customOperation.customizeText) {\n    valueText = customOperation.customizeText.call(customOperation, {\n      value: value,\n      valueText: valueText,\n      field: field,\n      target: target\n    }, options);\n  }\n\n  return valueText;\n}\n\nfunction getArrayValueText(field, value, customOperation, target) {\n  var options = {\n    values: value\n  };\n  return value.map(v => getPrimitiveValueText(field, v, customOperation, target, options));\n}\n\nfunction checkDefaultValue(value) {\n  return \"\" === value || null === value;\n}\n\nexport function getCurrentValueText(field, value, customOperation) {\n  var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\n\n  if (checkDefaultValue(value)) {\n    return \"\";\n  }\n\n  if (Array.isArray(value)) {\n    var result = new Deferred();\n    when.apply(this, getArrayValueText(field, value, customOperation, target)).done(function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      var text = args.some(item => !checkDefaultValue(item)) ? args.map(item => !checkDefaultValue(item) ? item : \"?\") : \"\";\n      result.resolve(text);\n    });\n    return result;\n  } else {\n    return getPrimitiveValueText(field, value, customOperation, target);\n  }\n}\n\nfunction itemExists(plainItems, parentId) {\n  return plainItems.some(function (item) {\n    return item.dataField === parentId;\n  });\n}\n\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\n  var dataField = item.dataField;\n\n  if (hasParent(dataField)) {\n    item.parentId = getParentIdFromItemDataField(dataField);\n\n    if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\n      pushItemAndCheckParent(originalItems, plainItems, {\n        id: item.parentId,\n        dataType: \"object\",\n        dataField: item.parentId,\n        caption: generateCaptionByDataField(item.parentId, true),\n        filterOperations: [\"isblank\", \"isnotblank\"]\n      });\n    }\n  }\n\n  plainItems.push(item);\n}\n\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\n  var caption = \"\";\n\n  if (allowHierarchicalFields) {\n    dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1);\n  } else if (hasParent(dataField)) {\n    dataField.split(\".\").forEach(function (field, index, arr) {\n      caption += captionize(field);\n\n      if (index !== arr.length - 1) {\n        caption += \".\";\n      }\n    });\n    return caption;\n  }\n\n  return captionize(dataField);\n}\n\nexport function getItems(fields, allowHierarchicalFields) {\n  var items = [];\n\n  for (var i = 0; i < fields.length; i++) {\n    var item = extend(true, {\n      caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\n    }, fields[i]);\n    item.id = item.name || item.dataField;\n\n    if (allowHierarchicalFields) {\n      pushItemAndCheckParent(fields, items, item);\n    } else {\n      items.push(item);\n    }\n  }\n\n  return items;\n}\n\nfunction hasParent(dataField) {\n  return -1 !== dataField.lastIndexOf(\".\");\n}\n\nfunction getParentIdFromItemDataField(dataField) {\n  return dataField.substring(0, dataField.lastIndexOf(\".\"));\n}\n\nexport function getCaptionWithParents(item, plainItems) {\n  if (hasParent(item.dataField)) {\n    var parentId = getParentIdFromItemDataField(item.dataField);\n\n    for (var i = 0; i < plainItems.length; i++) {\n      if (plainItems[i].dataField === parentId) {\n        return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption;\n      }\n    }\n  }\n\n  return item.caption;\n}\nexport function updateConditionByOperation(condition, operation, customOperations) {\n  var customOperation = getCustomOperation(customOperations, operation);\n\n  if (customOperation) {\n    if (false === customOperation.hasValue) {\n      condition[1] = operation;\n      condition.length = 2;\n    } else {\n      condition[1] = operation;\n      condition[2] = \"\";\n    }\n\n    return condition;\n  }\n\n  if (\"isblank\" === operation) {\n    condition[1] = EQUAL_OPERATION;\n    condition[2] = null;\n  } else if (\"isnotblank\" === operation) {\n    condition[1] = NOT_EQUAL_OPERATION;\n    condition[2] = null;\n  } else {\n    customOperation = getCustomOperation(customOperations, condition[1]);\n\n    if (customOperation || 2 === condition.length || null === condition[2]) {\n      condition[2] = \"\";\n    }\n\n    condition[1] = operation;\n  }\n\n  return condition;\n}\nexport function getOperationValue(condition) {\n  var caption;\n\n  if (null === condition[2]) {\n    if (condition[1] === EQUAL_OPERATION) {\n      caption = \"isblank\";\n    } else {\n      caption = \"isnotblank\";\n    }\n  } else {\n    caption = condition[1];\n  }\n\n  return caption;\n}\nexport function isValidCondition(condition) {\n  return \"\" !== condition[2];\n}\nexport function getMergedOperations(customOperations, betweenCaption, context) {\n  var result = extend(true, [], customOperations);\n  var betweenIndex = -1;\n  result.some(function (customOperation, index) {\n    if (\"between\" === customOperation.name) {\n      betweenIndex = index;\n      return true;\n    }\n  });\n\n  if (-1 !== betweenIndex) {\n    result[betweenIndex] = extend(getConfig(betweenCaption, context), result[betweenIndex]);\n  } else {\n    result.unshift(getConfig(betweenCaption, context));\n  }\n\n  return result;\n}\n\nfunction isMatchedCondition(filter, addedFilterDataField) {\n  return filter[0] === addedFilterDataField;\n}\n\nexport function removeFieldConditionsFromFilter(filter, dataField) {\n  if (!filter || 0 === filter.length) {\n    return null;\n  }\n\n  if (isCondition(filter)) {\n    var hasMatchedCondition = isMatchedCondition(filter, dataField);\n    return !hasMatchedCondition ? filter : null;\n  } else {\n    return syncConditionIntoGroup(filter, [dataField], false);\n  }\n}\n\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\n  var result = [];\n  filter.forEach(function (item) {\n    if (isCondition(item)) {\n      if (isMatchedCondition(item, addedFilter[0])) {\n        if (canPush) {\n          result.push(addedFilter);\n          canPush = false;\n        } else {\n          result.splice(result.length - 1, 1);\n        }\n      } else {\n        result.push(item);\n      }\n    } else {\n      (result.length || isGroup(item)) && result.push(item);\n    }\n  });\n\n  if (0 === result.length) {\n    return null;\n  }\n\n  if (canPush) {\n    result.push(AND_GROUP_OPERATION);\n    result.push(addedFilter);\n  }\n\n  return 1 === result.length ? result[0] : result;\n}\n\nexport function syncFilters(filter, addedFilter) {\n  if (null === filter || 0 === filter.length) {\n    return addedFilter;\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, addedFilter[0])) {\n      return addedFilter;\n    } else {\n      return [filter, AND_GROUP_OPERATION, addedFilter];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [addedFilter, \"and\", filter];\n  }\n\n  return syncConditionIntoGroup(filter, addedFilter, true);\n}\nexport function getMatchedConditions(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return [];\n  }\n\n  if (isCondition(filter)) {\n    if (isMatchedCondition(filter, dataField)) {\n      return [filter];\n    } else {\n      return [];\n    }\n  }\n\n  var groupValue = getGroupValue(filter);\n\n  if (groupValue !== AND_GROUP_OPERATION) {\n    return [];\n  }\n\n  var result = filter.filter(function (item) {\n    return isCondition(item) && isMatchedCondition(item, dataField);\n  });\n  return result;\n}\nexport function filterHasField(filter, dataField) {\n  if (null === filter || 0 === filter.length) {\n    return false;\n  }\n\n  if (isCondition(filter)) {\n    return filter[0] === dataField;\n  }\n\n  return filter.some(function (item) {\n    return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField);\n  });\n}\nexport var renderValueText = function ($container, value, customOperation) {\n  if (Array.isArray(value)) {\n    var lastItemIndex = value.length - 1;\n    $container.empty();\n    value.forEach((t, i) => {\n      $(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_PART_CLASS).text(t).appendTo($container);\n\n      if (i !== lastItemIndex) {\n        $(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS).text(customOperation && customOperation.valueSeparator ? customOperation.valueSeparator : \"|\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS).appendTo($container);\n      }\n    });\n  } else if (value) {\n    $container.text(value);\n  } else {\n    $container.text(messageLocalization.format(\"dxFilterBuilder-enterValueText\"));\n  }\n};","map":{"version":3,"sources":["C:/Users/Zoran/source/repos/TransportApp/TransportLog-basic/node_modules/devextreme/esm/ui/filter_builder/utils.js"],"names":["$","Deferred","when","errors","dataErrors","isDefined","isFunction","compileGetter","filterUtils","formatHelper","extend","captionize","getConfig","messageLocalization","DataSource","filterOperationsDictionary","DEFAULT_DATA_TYPE","EMPTY_MENU_ICON","AND_GROUP_OPERATION","EQUAL_OPERATION","NOT_EQUAL_OPERATION","DATATYPE_OPERATIONS","number","string","date","datetime","boolean","object","DEFAULT_FORMAT","LOOKUP_OPERATIONS","AVAILABLE_FIELD_PROPERTIES","FILTER_BUILDER_CLASS","FILTER_BUILDER_ITEM_TEXT_CLASS","FILTER_BUILDER_ITEM_TEXT_PART_CLASS","FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS","FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS","getFormattedValueText","field","value","fieldFormat","format","dataType","isNegationGroup","group","length","isCondition","getGroupCriteria","setGroupCriteria","criteria","convertGroupToNewStructure","indexOf","slice","push","apply","setGroupValue","i","substring","Array","isArray","getGroupMenuItem","availableGroups","groupValue","getGroupValue","filter","item","getCriteriaOperation","Error","getDefaultFilterOperations","lookup","containItems","entity","getFilterOperations","result","filterOperations","getCaptionByOperation","operation","filterOperationDescriptions","operationName","getNameByFilterOperation","getOperationFromAvailable","availableOperations","getCustomOperation","customOperations","name","filteredOperations","getAvailableOperations","isLookupField","forEach","customOperation","dataTypes","isOperationForbidden","notForLookup","map","icon","text","caption","isCustom","getIconByFilterOperation","getDefaultOperation","defaultFilterOperation","createCondition","condition","dataField","filterOperation","updateConditionByOperation","removeItem","index","splice","createEmptyGroup","isNegation","isNegationGroupOperation","groupOperation","getGroupOperationFromNegationOperation","isEmptyGroup","hasConditions","some","addItem","unshift","getField","fields","toLowerCase","extendedFields","getItems","isGroup","convertToInnerGroup","defaultGroupOperation","innerGroup","convertToInnerStructure","appendGroupOperationToGroup","convertToInnerCondition","conditionHasCustomOperation","appendGroupOperationToCriteria","getNormalizedFields","reduce","normalizedField","key","defaultCalculateFilterExpression","trueText","falseText","getConditionFilterExpression","target","filterExpression","calculateFilterExpression","createFilterExpression","getFilterExpression","_filterExpression","getNormalizedFilter","itemsForRemove","normalizedGroupValue","isValidCondition","getCurrentLookupValueText","handler","items","calculateCellValue","lookupDataSource","dataSource","loadSingle","valueExpr","done","valueText","displayExpr","customizeText","fail","getPrimitiveValueText","options","call","getArrayValueText","values","v","checkDefaultValue","getCurrentValueText","arguments","_len","args","_key","resolve","itemExists","plainItems","parentId","pushItemAndCheckParent","originalItems","hasParent","getParentIdFromItemDataField","id","generateCaptionByDataField","allowHierarchicalFields","lastIndexOf","split","arr","getCaptionWithParents","hasValue","getOperationValue","getMergedOperations","betweenCaption","context","betweenIndex","isMatchedCondition","addedFilterDataField","removeFieldConditionsFromFilter","hasMatchedCondition","syncConditionIntoGroup","addedFilter","canPush","syncFilters","getMatchedConditions","filterHasField","renderValueText","$container","lastItemIndex","empty","t","addClass","appendTo","valueSeparator"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/filter_builder/utils.js)\r\n * Version: 22.1.6\r\n * Build date: Tue Oct 18 2022\r\n *\r\n * Copyright (c) 2012 - 2022 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport $ from \"../../core/renderer\";\r\nimport {\r\n    Deferred,\r\n    when\r\n} from \"../../core/utils/deferred\";\r\nimport {\r\n    errors as dataErrors\r\n} from \"../../data/errors\";\r\nimport {\r\n    isDefined,\r\n    isFunction\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    compileGetter\r\n} from \"../../core/utils/data\";\r\nimport errors from \"../widget/ui.errors\";\r\nimport filterUtils from \"../shared/filtering\";\r\nimport formatHelper from \"../../format_helper\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    captionize\r\n} from \"../../core/utils/inflector\";\r\nimport {\r\n    getConfig\r\n} from \"./between\";\r\nimport messageLocalization from \"../../localization/message\";\r\nimport {\r\n    DataSource\r\n} from \"../../data/data_source/data_source\";\r\nimport filterOperationsDictionary from \"./ui.filter_operations_dictionary\";\r\nvar DEFAULT_DATA_TYPE = \"string\";\r\nvar EMPTY_MENU_ICON = \"icon-none\";\r\nvar AND_GROUP_OPERATION = \"and\";\r\nvar EQUAL_OPERATION = \"=\";\r\nvar NOT_EQUAL_OPERATION = \"<>\";\r\nvar DATATYPE_OPERATIONS = {\r\n    number: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    string: [\"contains\", \"notcontains\", \"startswith\", \"endswith\", \"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    date: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    datetime: [\"=\", \"<>\", \"<\", \">\", \"<=\", \">=\", \"isblank\", \"isnotblank\"],\r\n    boolean: [\"=\", \"<>\", \"isblank\", \"isnotblank\"],\r\n    object: [\"isblank\", \"isnotblank\"]\r\n};\r\nvar DEFAULT_FORMAT = {\r\n    date: \"shortDate\",\r\n    datetime: \"shortDateShortTime\"\r\n};\r\nvar LOOKUP_OPERATIONS = [\"=\", \"<>\", \"isblank\", \"isnotblank\"];\r\nvar AVAILABLE_FIELD_PROPERTIES = [\"caption\", \"customizeText\", \"dataField\", \"dataType\", \"editorTemplate\", \"falseText\", \"editorOptions\", \"filterOperations\", \"format\", \"lookup\", \"trueText\", \"calculateFilterExpression\", \"name\"];\r\nvar FILTER_BUILDER_CLASS = \"dx-filterbuilder\";\r\nvar FILTER_BUILDER_ITEM_TEXT_CLASS = FILTER_BUILDER_CLASS + \"-text\";\r\nvar FILTER_BUILDER_ITEM_TEXT_PART_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-part\";\r\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS = FILTER_BUILDER_ITEM_TEXT_CLASS + \"-separator\";\r\nvar FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS = FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS + \"-empty\";\r\n\r\nfunction getFormattedValueText(field, value) {\r\n    var fieldFormat = field.format || DEFAULT_FORMAT[field.dataType];\r\n    return formatHelper.format(value, fieldFormat)\r\n}\r\n\r\nfunction isNegationGroup(group) {\r\n    return group && group.length > 1 && \"!\" === group[0] && !isCondition(group)\r\n}\r\nexport function getGroupCriteria(group) {\r\n    return isNegationGroup(group) ? group[1] : group\r\n}\r\n\r\nfunction setGroupCriteria(group, criteria) {\r\n    if (isNegationGroup(group)) {\r\n        group[1] = criteria\r\n    } else {\r\n        group = criteria\r\n    }\r\n    return group\r\n}\r\n\r\nfunction convertGroupToNewStructure(group, value) {\r\n    if (function(value) {\r\n            return -1 !== value.indexOf(\"!\")\r\n        }(value)) {\r\n        if (!isNegationGroup(group)) {\r\n            ! function(group) {\r\n                var criteria = group.slice(0);\r\n                group.length = 0;\r\n                group.push(\"!\", criteria)\r\n            }(group)\r\n        }\r\n    } else if (isNegationGroup(group)) {\r\n        ! function(group) {\r\n            var criteria = getGroupCriteria(group);\r\n            group.length = 0;\r\n            [].push.apply(group, criteria)\r\n        }(group)\r\n    }\r\n}\r\nexport function setGroupValue(group, value) {\r\n    convertGroupToNewStructure(group, value);\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    value = function(value) {\r\n        return -1 === value.indexOf(\"!\") ? value : value.substring(1)\r\n    }(value);\r\n    ! function(criteria, value) {\r\n        for (i = 0; i < criteria.length; i++) {\r\n            if (!Array.isArray(criteria[i])) {\r\n                criteria[i] = value\r\n            }\r\n        }\r\n    }(criteria, value);\r\n    return group\r\n}\r\nexport function getGroupMenuItem(group, availableGroups) {\r\n    var groupValue = getGroupValue(group);\r\n    return availableGroups.filter((function(item) {\r\n        return item.value === groupValue\r\n    }))[0]\r\n}\r\n\r\nfunction getCriteriaOperation(criteria) {\r\n    if (isCondition(criteria)) {\r\n        return AND_GROUP_OPERATION\r\n    }\r\n    var value = \"\";\r\n    for (var i = 0; i < criteria.length; i++) {\r\n        var item = criteria[i];\r\n        if (!Array.isArray(item)) {\r\n            if (value && value !== item) {\r\n                throw new dataErrors.Error(\"E4019\")\r\n            }\r\n            if (\"!\" !== item) {\r\n                value = item\r\n            }\r\n        }\r\n    }\r\n    return value\r\n}\r\nexport function getGroupValue(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var value = getCriteriaOperation(criteria);\r\n    if (!value) {\r\n        value = AND_GROUP_OPERATION\r\n    }\r\n    if (criteria !== group) {\r\n        value = \"!\" + value\r\n    }\r\n    return value\r\n}\r\n\r\nfunction getDefaultFilterOperations(field) {\r\n    return field.lookup && LOOKUP_OPERATIONS || DATATYPE_OPERATIONS[field.dataType || DEFAULT_DATA_TYPE]\r\n}\r\n\r\nfunction containItems(entity) {\r\n    return Array.isArray(entity) && entity.length\r\n}\r\nexport function getFilterOperations(field) {\r\n    var result = containItems(field.filterOperations) ? field.filterOperations : getDefaultFilterOperations(field);\r\n    return extend([], result)\r\n}\r\nexport function getCaptionByOperation(operation, filterOperationDescriptions) {\r\n    var operationName = filterOperationsDictionary.getNameByFilterOperation(operation);\r\n    return filterOperationDescriptions && filterOperationDescriptions[operationName] ? filterOperationDescriptions[operationName] : operationName\r\n}\r\nexport function getOperationFromAvailable(operation, availableOperations) {\r\n    for (var i = 0; i < availableOperations.length; i++) {\r\n        if (availableOperations[i].value === operation) {\r\n            return availableOperations[i]\r\n        }\r\n    }\r\n    throw new errors.Error(\"E1048\", operation)\r\n}\r\nexport function getCustomOperation(customOperations, name) {\r\n    var filteredOperations = customOperations.filter((function(item) {\r\n        return item.name === name\r\n    }));\r\n    return filteredOperations.length ? filteredOperations[0] : null\r\n}\r\nexport function getAvailableOperations(field, filterOperationDescriptions, customOperations) {\r\n    var filterOperations = getFilterOperations(field);\r\n    var isLookupField = !!field.lookup;\r\n    customOperations.forEach((function(customOperation) {\r\n        if (!field.filterOperations && -1 === filterOperations.indexOf(customOperation.name)) {\r\n            var dataTypes = customOperation && customOperation.dataTypes;\r\n            var isOperationForbidden = isLookupField ? !!customOperation.notForLookup : false;\r\n            if (!isOperationForbidden && dataTypes && dataTypes.indexOf(field.dataType || DEFAULT_DATA_TYPE) >= 0) {\r\n                filterOperations.push(customOperation.name)\r\n            }\r\n        }\r\n    }));\r\n    return filterOperations.map((function(operation) {\r\n        var customOperation = getCustomOperation(customOperations, operation);\r\n        if (customOperation) {\r\n            return {\r\n                icon: customOperation.icon || EMPTY_MENU_ICON,\r\n                text: customOperation.caption || captionize(customOperation.name),\r\n                value: customOperation.name,\r\n                isCustom: true\r\n            }\r\n        } else {\r\n            return {\r\n                icon: filterOperationsDictionary.getIconByFilterOperation(operation) || EMPTY_MENU_ICON,\r\n                text: getCaptionByOperation(operation, filterOperationDescriptions),\r\n                value: operation\r\n            }\r\n        }\r\n    }))\r\n}\r\nexport function getDefaultOperation(field) {\r\n    return field.defaultFilterOperation || getFilterOperations(field)[0]\r\n}\r\nexport function createCondition(field, customOperations) {\r\n    var condition = [field.dataField, \"\", \"\"];\r\n    var filterOperation = getDefaultOperation(field);\r\n    updateConditionByOperation(condition, filterOperation, customOperations);\r\n    return condition\r\n}\r\nexport function removeItem(group, item) {\r\n    var criteria = getGroupCriteria(group);\r\n    var index = criteria.indexOf(item);\r\n    criteria.splice(index, 1);\r\n    if (1 !== criteria.length) {\r\n        criteria.splice(index, 1)\r\n    }\r\n    return group\r\n}\r\nexport function createEmptyGroup(value) {\r\n    var isNegation = isNegationGroupOperation(value);\r\n    var groupOperation = isNegation ? getGroupOperationFromNegationOperation(value) : value;\r\n    return isNegation ? [\"!\", [groupOperation]] : [groupOperation]\r\n}\r\nexport function isEmptyGroup(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    if (isCondition(criteria)) {\r\n        return false\r\n    }\r\n    var hasConditions = criteria.some((function(item) {\r\n        return isCondition(item)\r\n    }));\r\n    return !hasConditions\r\n}\r\nexport function addItem(item, group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var groupValue = getGroupValue(criteria);\r\n    1 === criteria.length ? criteria.unshift(item) : criteria.push(item, groupValue);\r\n    return group\r\n}\r\nexport function getField(dataField, fields) {\r\n    for (var i = 0; i < fields.length; i++) {\r\n        if (fields[i].name === dataField) {\r\n            return fields[i]\r\n        }\r\n        if (fields[i].dataField.toLowerCase() === dataField.toLowerCase()) {\r\n            return fields[i]\r\n        }\r\n    }\r\n    var extendedFields = getItems(fields, true).filter((function(item) {\r\n        return item.dataField.toLowerCase() === dataField.toLowerCase()\r\n    }));\r\n    if (extendedFields.length > 0) {\r\n        return extendedFields[0]\r\n    }\r\n    throw new errors.Error(\"E1047\", dataField)\r\n}\r\nexport function isGroup(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length < 2 || Array.isArray(criteria[0]) || Array.isArray(criteria[1])\r\n}\r\nexport function isCondition(criteria) {\r\n    if (!Array.isArray(criteria)) {\r\n        return false\r\n    }\r\n    return criteria.length > 1 && !Array.isArray(criteria[0]) && !Array.isArray(criteria[1])\r\n}\r\n\r\nfunction convertToInnerGroup(group, customOperations, defaultGroupOperation) {\r\n    defaultGroupOperation = defaultGroupOperation || AND_GROUP_OPERATION;\r\n    var groupOperation = getCriteriaOperation(group).toLowerCase() || defaultGroupOperation;\r\n    var innerGroup = [];\r\n    for (var i = 0; i < group.length; i++) {\r\n        if (isGroup(group[i])) {\r\n            innerGroup.push(convertToInnerStructure(group[i], customOperations, defaultGroupOperation));\r\n            innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation)\r\n        } else if (isCondition(group[i])) {\r\n            innerGroup.push(convertToInnerCondition(group[i], customOperations));\r\n            innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation)\r\n        }\r\n    }\r\n    if (0 === innerGroup.length) {\r\n        innerGroup = appendGroupOperationToGroup(innerGroup, groupOperation)\r\n    }\r\n    return innerGroup\r\n}\r\n\r\nfunction conditionHasCustomOperation(condition, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, condition[1]);\r\n    return customOperation && customOperation.name === condition[1]\r\n}\r\n\r\nfunction convertToInnerCondition(condition, customOperations) {\r\n    if (conditionHasCustomOperation(condition, customOperations)) {\r\n        return condition\r\n    }\r\n    if (condition.length < 3) {\r\n        condition[2] = condition[1];\r\n        condition[1] = EQUAL_OPERATION\r\n    }\r\n    return condition\r\n}\r\n\r\nfunction isNegationGroupOperation(operation) {\r\n    return -1 !== operation.indexOf(\"not\")\r\n}\r\n\r\nfunction getGroupOperationFromNegationOperation(operation) {\r\n    return operation.substring(3).toLowerCase()\r\n}\r\n\r\nfunction appendGroupOperationToCriteria(criteria, groupOperation) {\r\n    var isNegation = isNegationGroupOperation(groupOperation);\r\n    groupOperation = isNegation ? getGroupOperationFromNegationOperation(groupOperation) : groupOperation;\r\n    return isNegation ? [\"!\", criteria, groupOperation] : [criteria, groupOperation]\r\n}\r\n\r\nfunction appendGroupOperationToGroup(group, groupOperation) {\r\n    var isNegation = isNegationGroupOperation(groupOperation);\r\n    groupOperation = isNegation ? getGroupOperationFromNegationOperation(groupOperation) : groupOperation;\r\n    group.push(groupOperation);\r\n    var result = group;\r\n    if (isNegation) {\r\n        result = [\"!\", result]\r\n    }\r\n    return result\r\n}\r\nexport function convertToInnerStructure(value, customOperations, defaultGroupOperation) {\r\n    defaultGroupOperation = defaultGroupOperation || AND_GROUP_OPERATION;\r\n    if (!value) {\r\n        return createEmptyGroup(defaultGroupOperation)\r\n    }\r\n    value = extend(true, [], value);\r\n    if (isCondition(value)) {\r\n        return appendGroupOperationToCriteria(convertToInnerCondition(value, customOperations), defaultGroupOperation)\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        return [\"!\", isCondition(value[1]) ? appendGroupOperationToCriteria(convertToInnerCondition(value[1], customOperations), defaultGroupOperation) : isNegationGroup(value[1]) ? appendGroupOperationToCriteria(convertToInnerStructure(value[1], customOperations), defaultGroupOperation) : convertToInnerGroup(value[1], customOperations, defaultGroupOperation)]\r\n    }\r\n    return convertToInnerGroup(value, customOperations, defaultGroupOperation)\r\n}\r\nexport function getNormalizedFields(fields) {\r\n    return fields.reduce((function(result, field) {\r\n        if (isDefined(field.dataField)) {\r\n            var normalizedField = {};\r\n            for (var key in field) {\r\n                if (field[key] && AVAILABLE_FIELD_PROPERTIES.indexOf(key) > -1) {\r\n                    normalizedField[key] = field[key]\r\n                }\r\n            }\r\n            normalizedField.defaultCalculateFilterExpression = filterUtils.defaultCalculateFilterExpression;\r\n            if (!isDefined(normalizedField.dataType)) {\r\n                normalizedField.dataType = DEFAULT_DATA_TYPE\r\n            }\r\n            if (!isDefined(normalizedField.trueText)) {\r\n                normalizedField.trueText = messageLocalization.format(\"dxDataGrid-trueText\")\r\n            }\r\n            if (!isDefined(normalizedField.falseText)) {\r\n                normalizedField.falseText = messageLocalization.format(\"dxDataGrid-falseText\")\r\n            }\r\n            result.push(normalizedField)\r\n        }\r\n        return result\r\n    }), [])\r\n}\r\n\r\nfunction getConditionFilterExpression(condition, fields, customOperations, target) {\r\n    var field = getField(condition[0], fields);\r\n    var filterExpression = convertToInnerCondition(condition, customOperations);\r\n    var customOperation = customOperations.length && getCustomOperation(customOperations, filterExpression[1]);\r\n    if (customOperation && customOperation.calculateFilterExpression) {\r\n        return customOperation.calculateFilterExpression.apply(customOperation, [filterExpression[2], field, fields])\r\n    } else if (field.createFilterExpression) {\r\n        return field.createFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n    } else if (field.calculateFilterExpression) {\r\n        return field.calculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n    } else {\r\n        return field.defaultCalculateFilterExpression.apply(field, [filterExpression[2], filterExpression[1], target])\r\n    }\r\n}\r\nexport function getFilterExpression(value, fields, customOperations, target) {\r\n    if (!isDefined(value)) {\r\n        return null\r\n    }\r\n    if (isNegationGroup(value)) {\r\n        var filterExpression = getFilterExpression(value[1], fields, customOperations, target);\r\n        return [\"!\", filterExpression]\r\n    }\r\n    var criteria = getGroupCriteria(value);\r\n    if (isCondition(criteria)) {\r\n        return getConditionFilterExpression(criteria, fields, customOperations, target) || null\r\n    } else {\r\n        var result = [];\r\n        var _filterExpression;\r\n        var groupValue = getGroupValue(criteria);\r\n        for (var i = 0; i < criteria.length; i++) {\r\n            if (isGroup(criteria[i])) {\r\n                _filterExpression = getFilterExpression(criteria[i], fields, customOperations, target);\r\n                if (_filterExpression) {\r\n                    i && result.push(groupValue);\r\n                    result.push(_filterExpression)\r\n                }\r\n            } else if (isCondition(criteria[i])) {\r\n                _filterExpression = getConditionFilterExpression(criteria[i], fields, customOperations, target);\r\n                if (_filterExpression) {\r\n                    result.length && result.push(groupValue);\r\n                    result.push(_filterExpression)\r\n                }\r\n            }\r\n        }\r\n        if (1 === result.length) {\r\n            result = result[0]\r\n        }\r\n        return result.length ? result : null\r\n    }\r\n}\r\nexport function getNormalizedFilter(group) {\r\n    var criteria = getGroupCriteria(group);\r\n    var i;\r\n    if (0 === criteria.length) {\r\n        return null\r\n    }\r\n    var itemsForRemove = [];\r\n    for (i = 0; i < criteria.length; i++) {\r\n        if (isGroup(criteria[i])) {\r\n            var normalizedGroupValue = getNormalizedFilter(criteria[i]);\r\n            if (normalizedGroupValue) {\r\n                criteria[i] = normalizedGroupValue\r\n            } else {\r\n                itemsForRemove.push(criteria[i])\r\n            }\r\n        } else if (isCondition(criteria[i])) {\r\n            if (!isValidCondition(criteria[i])) {\r\n                itemsForRemove.push(criteria[i])\r\n            }\r\n        }\r\n    }\r\n    for (i = 0; i < itemsForRemove.length; i++) {\r\n        removeItem(criteria, itemsForRemove[i])\r\n    }\r\n    if (1 === criteria.length) {\r\n        return null\r\n    }\r\n    criteria.splice(criteria.length - 1, 1);\r\n    if (1 === criteria.length) {\r\n        group = setGroupCriteria(group, criteria[0])\r\n    }\r\n    if (0 === group.length) {\r\n        return null\r\n    }\r\n    return group\r\n}\r\nexport function getCurrentLookupValueText(field, value, handler) {\r\n    if (\"\" === value) {\r\n        handler(\"\");\r\n        return\r\n    }\r\n    var lookup = field.lookup;\r\n    if (lookup.items) {\r\n        handler(lookup.calculateCellValue(value) || \"\")\r\n    } else {\r\n        var lookupDataSource = isFunction(lookup.dataSource) ? lookup.dataSource({}) : lookup.dataSource;\r\n        var dataSource = new DataSource(lookupDataSource);\r\n        dataSource.loadSingle(lookup.valueExpr, value).done((function(result) {\r\n            var valueText = \"\";\r\n            if (result) {\r\n                valueText = lookup.displayExpr ? compileGetter(lookup.displayExpr)(result) : result\r\n            }\r\n            if (field.customizeText) {\r\n                valueText = field.customizeText({\r\n                    value: value,\r\n                    valueText: valueText\r\n                })\r\n            }\r\n            handler(valueText)\r\n        })).fail((function() {\r\n            handler(\"\")\r\n        }))\r\n    }\r\n}\r\n\r\nfunction getPrimitiveValueText(field, value, customOperation, target, options) {\r\n    var valueText;\r\n    if (true === value) {\r\n        valueText = field.trueText || messageLocalization.format(\"dxDataGrid-trueText\")\r\n    } else if (false === value) {\r\n        valueText = field.falseText || messageLocalization.format(\"dxDataGrid-falseText\")\r\n    } else {\r\n        valueText = getFormattedValueText(field, value)\r\n    }\r\n    if (field.customizeText) {\r\n        valueText = field.customizeText.call(field, {\r\n            value: value,\r\n            valueText: valueText,\r\n            target: target\r\n        })\r\n    }\r\n    if (customOperation && customOperation.customizeText) {\r\n        valueText = customOperation.customizeText.call(customOperation, {\r\n            value: value,\r\n            valueText: valueText,\r\n            field: field,\r\n            target: target\r\n        }, options)\r\n    }\r\n    return valueText\r\n}\r\n\r\nfunction getArrayValueText(field, value, customOperation, target) {\r\n    var options = {\r\n        values: value\r\n    };\r\n    return value.map(v => getPrimitiveValueText(field, v, customOperation, target, options))\r\n}\r\n\r\nfunction checkDefaultValue(value) {\r\n    return \"\" === value || null === value\r\n}\r\nexport function getCurrentValueText(field, value, customOperation) {\r\n    var target = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : \"filterBuilder\";\r\n    if (checkDefaultValue(value)) {\r\n        return \"\"\r\n    }\r\n    if (Array.isArray(value)) {\r\n        var result = new Deferred;\r\n        when.apply(this, getArrayValueText(field, value, customOperation, target)).done((function() {\r\n            for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n                args[_key] = arguments[_key]\r\n            }\r\n            var text = args.some(item => !checkDefaultValue(item)) ? args.map(item => !checkDefaultValue(item) ? item : \"?\") : \"\";\r\n            result.resolve(text)\r\n        }));\r\n        return result\r\n    } else {\r\n        return getPrimitiveValueText(field, value, customOperation, target)\r\n    }\r\n}\r\n\r\nfunction itemExists(plainItems, parentId) {\r\n    return plainItems.some((function(item) {\r\n        return item.dataField === parentId\r\n    }))\r\n}\r\n\r\nfunction pushItemAndCheckParent(originalItems, plainItems, item) {\r\n    var dataField = item.dataField;\r\n    if (hasParent(dataField)) {\r\n        item.parentId = getParentIdFromItemDataField(dataField);\r\n        if (!itemExists(plainItems, item.parentId) && !itemExists(originalItems, item.parentId)) {\r\n            pushItemAndCheckParent(originalItems, plainItems, {\r\n                id: item.parentId,\r\n                dataType: \"object\",\r\n                dataField: item.parentId,\r\n                caption: generateCaptionByDataField(item.parentId, true),\r\n                filterOperations: [\"isblank\", \"isnotblank\"]\r\n            })\r\n        }\r\n    }\r\n    plainItems.push(item)\r\n}\r\n\r\nfunction generateCaptionByDataField(dataField, allowHierarchicalFields) {\r\n    var caption = \"\";\r\n    if (allowHierarchicalFields) {\r\n        dataField = dataField.substring(dataField.lastIndexOf(\".\") + 1)\r\n    } else if (hasParent(dataField)) {\r\n        dataField.split(\".\").forEach((function(field, index, arr) {\r\n            caption += captionize(field);\r\n            if (index !== arr.length - 1) {\r\n                caption += \".\"\r\n            }\r\n        }));\r\n        return caption\r\n    }\r\n    return captionize(dataField)\r\n}\r\nexport function getItems(fields, allowHierarchicalFields) {\r\n    var items = [];\r\n    for (var i = 0; i < fields.length; i++) {\r\n        var item = extend(true, {\r\n            caption: generateCaptionByDataField(fields[i].dataField, allowHierarchicalFields)\r\n        }, fields[i]);\r\n        item.id = item.name || item.dataField;\r\n        if (allowHierarchicalFields) {\r\n            pushItemAndCheckParent(fields, items, item)\r\n        } else {\r\n            items.push(item)\r\n        }\r\n    }\r\n    return items\r\n}\r\n\r\nfunction hasParent(dataField) {\r\n    return -1 !== dataField.lastIndexOf(\".\")\r\n}\r\n\r\nfunction getParentIdFromItemDataField(dataField) {\r\n    return dataField.substring(0, dataField.lastIndexOf(\".\"))\r\n}\r\nexport function getCaptionWithParents(item, plainItems) {\r\n    if (hasParent(item.dataField)) {\r\n        var parentId = getParentIdFromItemDataField(item.dataField);\r\n        for (var i = 0; i < plainItems.length; i++) {\r\n            if (plainItems[i].dataField === parentId) {\r\n                return getCaptionWithParents(plainItems[i], plainItems) + \".\" + item.caption\r\n            }\r\n        }\r\n    }\r\n    return item.caption\r\n}\r\nexport function updateConditionByOperation(condition, operation, customOperations) {\r\n    var customOperation = getCustomOperation(customOperations, operation);\r\n    if (customOperation) {\r\n        if (false === customOperation.hasValue) {\r\n            condition[1] = operation;\r\n            condition.length = 2\r\n        } else {\r\n            condition[1] = operation;\r\n            condition[2] = \"\"\r\n        }\r\n        return condition\r\n    }\r\n    if (\"isblank\" === operation) {\r\n        condition[1] = EQUAL_OPERATION;\r\n        condition[2] = null\r\n    } else if (\"isnotblank\" === operation) {\r\n        condition[1] = NOT_EQUAL_OPERATION;\r\n        condition[2] = null\r\n    } else {\r\n        customOperation = getCustomOperation(customOperations, condition[1]);\r\n        if (customOperation || 2 === condition.length || null === condition[2]) {\r\n            condition[2] = \"\"\r\n        }\r\n        condition[1] = operation\r\n    }\r\n    return condition\r\n}\r\nexport function getOperationValue(condition) {\r\n    var caption;\r\n    if (null === condition[2]) {\r\n        if (condition[1] === EQUAL_OPERATION) {\r\n            caption = \"isblank\"\r\n        } else {\r\n            caption = \"isnotblank\"\r\n        }\r\n    } else {\r\n        caption = condition[1]\r\n    }\r\n    return caption\r\n}\r\nexport function isValidCondition(condition) {\r\n    return \"\" !== condition[2]\r\n}\r\nexport function getMergedOperations(customOperations, betweenCaption, context) {\r\n    var result = extend(true, [], customOperations);\r\n    var betweenIndex = -1;\r\n    result.some((function(customOperation, index) {\r\n        if (\"between\" === customOperation.name) {\r\n            betweenIndex = index;\r\n            return true\r\n        }\r\n    }));\r\n    if (-1 !== betweenIndex) {\r\n        result[betweenIndex] = extend(getConfig(betweenCaption, context), result[betweenIndex])\r\n    } else {\r\n        result.unshift(getConfig(betweenCaption, context))\r\n    }\r\n    return result\r\n}\r\n\r\nfunction isMatchedCondition(filter, addedFilterDataField) {\r\n    return filter[0] === addedFilterDataField\r\n}\r\nexport function removeFieldConditionsFromFilter(filter, dataField) {\r\n    if (!filter || 0 === filter.length) {\r\n        return null\r\n    }\r\n    if (isCondition(filter)) {\r\n        var hasMatchedCondition = isMatchedCondition(filter, dataField);\r\n        return !hasMatchedCondition ? filter : null\r\n    } else {\r\n        return syncConditionIntoGroup(filter, [dataField], false)\r\n    }\r\n}\r\n\r\nfunction syncConditionIntoGroup(filter, addedFilter, canPush) {\r\n    var result = [];\r\n    filter.forEach((function(item) {\r\n        if (isCondition(item)) {\r\n            if (isMatchedCondition(item, addedFilter[0])) {\r\n                if (canPush) {\r\n                    result.push(addedFilter);\r\n                    canPush = false\r\n                } else {\r\n                    result.splice(result.length - 1, 1)\r\n                }\r\n            } else {\r\n                result.push(item)\r\n            }\r\n        } else {\r\n            (result.length || isGroup(item)) && result.push(item)\r\n        }\r\n    }));\r\n    if (0 === result.length) {\r\n        return null\r\n    }\r\n    if (canPush) {\r\n        result.push(AND_GROUP_OPERATION);\r\n        result.push(addedFilter)\r\n    }\r\n    return 1 === result.length ? result[0] : result\r\n}\r\nexport function syncFilters(filter, addedFilter) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return addedFilter\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, addedFilter[0])) {\r\n            return addedFilter\r\n        } else {\r\n            return [filter, AND_GROUP_OPERATION, addedFilter]\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return [addedFilter, \"and\", filter]\r\n    }\r\n    return syncConditionIntoGroup(filter, addedFilter, true)\r\n}\r\nexport function getMatchedConditions(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return []\r\n    }\r\n    if (isCondition(filter)) {\r\n        if (isMatchedCondition(filter, dataField)) {\r\n            return [filter]\r\n        } else {\r\n            return []\r\n        }\r\n    }\r\n    var groupValue = getGroupValue(filter);\r\n    if (groupValue !== AND_GROUP_OPERATION) {\r\n        return []\r\n    }\r\n    var result = filter.filter((function(item) {\r\n        return isCondition(item) && isMatchedCondition(item, dataField)\r\n    }));\r\n    return result\r\n}\r\nexport function filterHasField(filter, dataField) {\r\n    if (null === filter || 0 === filter.length) {\r\n        return false\r\n    }\r\n    if (isCondition(filter)) {\r\n        return filter[0] === dataField\r\n    }\r\n    return filter.some((function(item) {\r\n        return (isCondition(item) || isGroup(item)) && filterHasField(item, dataField)\r\n    }))\r\n}\r\nexport var renderValueText = function($container, value, customOperation) {\r\n    if (Array.isArray(value)) {\r\n        var lastItemIndex = value.length - 1;\r\n        $container.empty();\r\n        value.forEach((t, i) => {\r\n            $(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_PART_CLASS).text(t).appendTo($container);\r\n            if (i !== lastItemIndex) {\r\n                $(\"<span>\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_CLASS).text(customOperation && customOperation.valueSeparator ? customOperation.valueSeparator : \"|\").addClass(FILTER_BUILDER_ITEM_TEXT_SEPARATOR_EMPTY_CLASS).appendTo($container)\r\n            }\r\n        })\r\n    } else if (value) {\r\n        $container.text(value)\r\n    } else {\r\n        $container.text(messageLocalization.format(\"dxFilterBuilder-enterValueText\"))\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}